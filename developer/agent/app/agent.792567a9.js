import{u as e}from"./agent.e31bae84.js";import{r as t}from"./agent.8750769a.js";import"./agent.862e5520.js";async function a(e,a){let l=e;if(!Array.isArray(l))return Promise.reject("channels is not array");let n=l.length;for(let e=0;e<n;e+=1){let n=l[e];if(!n||!n.id||!Array.isArray(n.tables))continue;let o=n.tables,s=[];n.results=s;for(let e=0;e<o.length;e+=1){let l=o[e];s[e]={value:0,delay:9999};let i=`${a.getLabel()}`,c=`${a.name} 頻道:${n.id} 桌號:${e+1} ${l}`,y=await r(l,i,c,a.category);s[e]=y,t.log0({eventName:c,label:i,value:y.value,category:`${a.category} 容量`},!0),t.log0({eventName:c,label:i,value:y.delay,category:`${a.category} 延時`},!0)}}return e}async function r(a,r,l,n){return new Promise((o=>{let s=!1,i={value:0,delay:9999},c=!1,y={name:l,category:n,getLabel:()=>r};t.serviceBegin(y);let g=new WebSocket(a);g.binaryType="arraybuffer",g.onopen=()=>{e.setTimeout((()=>{s||(s=!0,g.close(),o(i))}),5)},g.onclose=()=>{s=!0},g.onerror=()=>{s=!0,o(i)},g.onmessage=a=>{const r=new Uint8Array(a.data);i.value+=r.length,c||(c=!0,y.category=`${n} 延時`,t.serviceEnd(y),i.delay=y.time,e.setTimeout((()=>{s||(s=!0,g.close(),y.category=`${n} 容量`,y.time=i.value,t.serviceEnd(y,!0),o(i))}),.2))}}))}export{a as scan,r as test};
