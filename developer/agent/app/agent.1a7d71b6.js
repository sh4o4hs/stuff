import{b as e,s as t,i}from"./agent.84641a90.js";import"mithril";import"localforage";let o="filename",r="blob",l={"video/photos":1,"video/domains":1,"video/player":1,"video/player2":1,"scenes/loading":1,"lib/264":1,"lib/player":1};async function a(e,i){let a=globalThis.BASE_URL,n=null,s=null,p=null;if(!t.versionTimestamp){let e=new Date;t.versionTimestamp=e.getTime()}let c=t.versionTimestamp;if(i&&(i.mode&&(n=i.mode),i.version&&(s=i.version)),l[e])try{p=import.meta.resolve(e)}catch(e){}let m=`${t.projectURL}${e}`;if(a&&a.length>0&&("/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),m=m.replace(t.projectURL,"/"),m=`${a}${m}`),!p){let e=null;if(e=s?await fetch(`${m}/v${s}.json`):await fetch(`${m}/index.json?v=${c}`),e&&e.ok){let t=await e.json();p=t.isDebug?t.app:`${m}/${t.app.replace("./","")}`}}if(p){if(n){if(n===o)return{root:a,filename:p,pathname:m};if(n===r){let e=await fetch(p,{credentials:"omit"});if(e&&e.ok){let t=await e.text(),i=new Blob([t]);return{root:a,blob:i,blobURL:globalThis.URL.createObjectURL(i),pathname:m}}return Promise.reject(new Error("getProject error"))}}return{root:a,lib:await import(p),pathname:m}}return Promise.reject(new Error("getProject error"))}async function n(e){return new Promise(((t,i)=>{let o=document.createElement("script");o.type="text/javascript",o.src=e,o.onload=()=>{t()},o.onerror=()=>{i()},document.body.appendChild(o)}))}async function s(){let i,o="/dependence/";t.selectCDN&&(o=`${globalThis.BASE_URL}dependence/`),i=["pixi/pixi.min.6.5.9.js","socket.io/socket.io.min.2.4.0.js","createjs/tweenjs.min.1.0.2.js"];let r=[];for(let e=0;e<i.length;e++){let t=n(o+i[e]);r.push(t)}await Promise.all(r);let l=["pixi/pixi-spine.2.0.5.js"];r=[];for(let e=0;e<l.length;e++){let t=n(o+l[e]);r.push(t)}await Promise.all(r);let a=await import("foot"),s=await import("pixi.js"),p=await import("pixi-spine");e.PIXI=s,e.spine=p,e.Howl=a.Howl,e.Howler=a.Howler,e.IsMobile=a.IsMobile,e.Mustache=a.Mustache,e.decode=a.decode}export{a as getProject,s as load};
