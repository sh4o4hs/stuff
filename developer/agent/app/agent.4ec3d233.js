import{r as e,i as t,s as n,o as i,O as a,b as s,G as o,a as l,c as r,d as c,T as g,e as d,f as u}from"./agent.747503bc.js";import h from"mithril";import*as m from"nuts";import{g as p,a as f,I as b,b as w}from"./agent.00d1e5bf.js";import y from"localforage";let v=!1;function C(){return v}let L="title";function T(){return L}let E="message";function R(){return E}function x(e){L=e.title,E=e.msg,v=!0,h.redraw()}function k(){v=!1,h.redraw()}var I=Object.freeze({__proto__:null,getMessage:R,getTitle:T,hide:k,isVisible:C,show:x});let O=null,$={oninit(e){let t=e.attrs;this.style=t.style,this.complete=t.complete,this.logo=null},async oncreate(e){let t=this,n=e.attrs,i=e.dom,a=n.url,s=await fetch(a);if(s&&s.ok){let e=await s.blob();const n=URL.createObjectURL(e);i.src=n,h.redraw(),t.complete&&t.complete()}},view(){return h("img",{style:this.style})}},U={timeBase:1,oninit(e){let t=e.attrs;this.class=t.class||"ba b--light-blue animate__animated animate__bounceIn",this.style=t.style||{left:"0%",top:"0%",width:"100%",height:"100%"},this.info=t.info,this.serve=t.serve,this.config=t.config||{width:300,height:200,resolution:1,antialias:!1,transparent:!0},this.id=t.id,this.group=t.group,this.title=t.title||"標題",this.logo=t.logo,this.game=null,this.eventClass={current:"ba b--dotted bw1 white-50",onmouseenter:"ba b--dotted bw2 white-50",onmouseleave:"ba b--dotted bw1 white-50"}},onbeforeremove(e){let t=this;return t.game&&t.game.pause(),["animate__animated","animate__lightSpeedOut"].forEach((t=>{e.dom.classList.add(t)})),new Promise((e=>{m.updateManager.setTimeout(e,.4)}))},view(){let t=this,n=t.eventClass;return h(".",{class:t.class,style:t.style},[h(".game-card-title",t.title),h($,{class:"game-card-view ba b--light-gray",style:{zValue:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},url:t.logo,complete(){}}),h(".",{onclick(){globalThis.Howl&&(O||(O=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]}),O.volume(.01)),O.play()),Lt(!1),Xe({serve:t.serve,id:t.id,group:t.group})},onmouseenter(){n.current=n.onmouseenter,h.redraw()},onmouseleave(){n.current=n.onmouseleave,h.redraw()},class:n.current,style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"75%"}}),h(".game-card-download",{onclick(){x({yesno:!1,title:"connecting",msg:"disconnect"})}},[h.trust(`<div class="no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma2 tc br2 pa2">\n    <svg fill="#77ff77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/>\n    <path d="M0 0h24v24H0z" fill="none"/>\n</svg>\n    <span class="f6 ml3 pr2">${p("download")}</span>\n  </div>`)]),h(".game-card-stop",{onclick(){e.getIP().then((e=>{}))}},[h.trust(`<div class="no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma2 tc br2 pa2">\n    <svg fill="#77ff77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n    <path d="M0 0h24v24H0z" fill="none"/>\n    <path d="M14.59 8L12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41 14.59 8zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>\n</svg>\n    <span class="f6 ml3 pr2">${p("stop")}</span>\n  </div>`)])])}},M={left:"0px",top:"0px",width:"300px",height:"200px"},A={},B={},N=null;function S(e){return A[e]||(A[e]={}),B=A[e],B}function F(e,t,s,o){let l={};function r(){let e=n.registration;e&&e.active&&navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage(l):m.updateManager.setTimeout(r,.05)}if(!n.versionTimestamp){let e=new Date;n.versionTimestamp=e.getTime()}let c=n.versionTimestamp,g=!1,d=null;return d=new Promise((d=>{if(!e||!t)return void d(null);function u(){let o=`config/${t}/${e}/gamecard.txt?v=${c}`,u=`config/${t}/${e}/cache.txt`;if(s){let n=s;"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),o=`${n}/config/${t}/${e}/gamecard.txt?v=${c}`,u=`${n}/config/${t}/${e}/cache.txt`}else o=`config/${t}/${e}/gamecard.txt?v=${c}`,u=`config/${t}/${e}/cache.txt`;l.cacheName=`${t}${e}`,l.url=u,n.useCache&&r(),fetch(o,{headers:{"Content-Type":"text/plain"}}).then((e=>e.ok?e.text():null)).then((e=>{if(!e)return;let t={},o=new String(e),l=o.indexOf("{");if(l>=0&&l<=9){let e=JSON.parse(o);if(!e.options||!e.options.overview){let e=a;n.useOptions||(i[e.OVERVIEW_LOGO]=1,i[e.OVERVIEW_ANIMATION]=0,i[e.OVERVIEW_BACKGROUND]=0,i[e.OVERVIEW_PROGRESS]=1)}if(e.templateVersion="slot.2.1",t.gameCard=e,s){let e=s;"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t.gameCard.baseURL=`${e}/`}g=!0,d(t)}})).catch((e=>{}))}let h,m;if(s){let n=s;"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),o?h=`${n}/${t}/${e}/config/v${o}.txt`:(h=`${n}/${t}/${e}/config/gamecard.txt?v=${c}`,m=`${n}/${t}/${e}/config/cache.txt`)}else o?h=`${n.projectURL}${t}/${e}/config/v${o}.txt`:(h=`${n.projectURL}${t}/${e}/config/gamecard.txt?v=${c}`,m=`${n.projectURL}${t}/${e}/config/cache.txt`);l.cacheName=`${t}${e}`,l.url=m,n.useCache&&r(),fetch(h,{headers:{"Content-Type":"text/plain"}}).then((e=>e.ok?e.text():(u(),null))).then((e=>{if(!e)return;let t={},i=new String(e),a=i.indexOf("{");if(a>=0&&a<=9){if(t.gameCard=JSON.parse(i),s)if(t.gameCard.baseURL){let e=s;"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),t.gameCard.baseURL=e+t.gameCard.baseURL.replace(n.projectURL,"/")}else t.gameCard.baseURL=s;else{let e=globalThis.location.origin;t.gameCard.baseURL?t.gameCard.baseURL.indexOf("://")<0&&(t.gameCard.baseURL=e+t.gameCard.baseURL):t.gameCard.baseURL=globalThis.location.origin+"/"}g=!0,d(t)}if(g)return!0;u()})).catch((()=>{u()}))})),d}function P(e,n,i){let a=Date.now(),s="";t&&(s="test/data/gameList.txt?v="+a),n[e]=[],i[e]=0;let o=0;h.request(s).then((t=>{n[e]=t||[],t.forEach((e=>{if(!e)return;e.isSub&&(o+=1);let t=S(e.group);if(globalThis.BASE_URL)if(e.baseURL){let t=globalThis.BASE_URL;"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e.baseURL=t+e.baseURL}else e.baseURL=globalThis.BASE_URL;else{let t=globalThis.location.origin;e.baseURL?e.baseURL=t+e.baseURL:e.baseURL=globalThis.location.origin+"/"}t[e.id]=e})),i[e]=t.length-o}))}function _(e){const n=e.key||e.code;if(t)switch(n){case"r":case"R":if(N){globalThis.scene[N.id].reload({game:N.appConfig,group:N.group,id:N.id,tablekey:"abcd1234"})}}}function z(e){e.key||e.code}let D={oninit(){let e={},n={};t?P("test",e,n):(P("slot",e,n),P("video",e,n),P("game",e,n)),this.group=e,this.displayCount=n,globalThis.addEventListener("keydown",_),globalThis.addEventListener("keyup",z)},view(){let e=this;return t?h(".gameCardList",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},h(".",{style:{position:"absolute",left:"0%",top:"40%",width:"100%",height:"25%"}},"group zzzz",h(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.game+"%",height:"100%"}},e.group.test?e.group.test.map((e=>{if(!e||e.isSub)return h(".");let t=e.baseURL||"",i=e.images;return n.useAvif?i.v2&&(i=i.v2):i.v1&&(i=i.v1),h(".",{style:M},[h(U,{id:e.id,group:e.group,serve:{game:e.id,group:e.group},logo:t+i.logo,title:`${e.name[f()]}(${e.appConfig})`})])})):h(".")))):h(".gameCardList",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},h(".",{style:{position:"absolute",left:"0%",top:"65%",width:"100%",height:"25%",overflowX:"scroll"}},"group game",h(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.game+"%",height:"100%"}},e.group.game.map((e=>{if(!e||e.isSub)return h(".");let t=e.baseURL||"";return h(".",{style:{left:"0%",top:"0%",width:"90%",height:"100%"}},h(U,{id:e.id,group:"game",serve:{game:e.id,group:"game"},logo:t+e.images.logo,title:e.name[f()]}))})))),h(".",{style:{position:"absolute",left:"0%",top:"5%",width:"100%",height:"25%",overflowX:"scroll"}},"group slot",h(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.slot+"%",height:"100%"}},e.group.slot.map((e=>{if(!e&&e.isSub)return h(".");let t=e.baseURL||"";return h(".",{style:{left:"0%",top:"0%",width:"100%",height:"100%"}},[h(U,{id:e.id,group:"slot",serve:{game:e.id,group:"slot"},logo:t+e.images.logo,title:e.name[f()]})])})))),h(".",{style:{position:"absolute",left:"0%",top:"35%",width:"100%",height:"25%",overflowX:"scroll"}},"group video",h(".layout",{style:{left:"0%",marginTop:"0px",width:25*e.displayCount.video+"%",height:"100%"}},e.group.video.map((e=>{if(!e||e.isSub)return h(".");let t=e.baseURL||"";return h(".",{style:{left:"0%",top:"0%",width:"100%",height:"80%"}},[h(U,{id:e.id,group:"video",serve:{game:e.id,group:"video"},logo:t+e.images.logo,title:e.name[f()]})])})))))}},j={Android:()=>navigator.userAgent.match(/Android/i),BlackBerry:()=>navigator.userAgent.match(/BlackBerry/i),iOS:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),Opera:()=>navigator.userAgent.match(/Opera Mini/i),Windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>j.Android()||j.BlackBerry()||j.iOS()||j.Opera()||j.Windows()};function V(e,t){return null!=e?e:t()}function H(e){let t,n=e[0],i=1;for(;i<e.length;){const a=e[i],s=e[i+1];if(i+=2,("optionalAccess"===a||"optionalCall"===a)&&null==n)return;"access"===a||"optionalAccess"===a?(t=n,n=s(n)):"call"!==a&&"optionalCall"!==a||(n=s(((...e)=>n.call(t,...e))),t=void 0)}return n}let G={},W={resizeTimer:null,timer:null,eventDelay:260},Y=null,q={name:null,angle:0,isTrigger:!1},X=null;function K(e){switch(X&&X.setCurrentValue&&X.setCurrentValue(e),e){case 0:(G.usePortrait||G.useLandscape)&&(G.isPortrait=!0,G.isLandscape=!1),G.screenHeight=screen.height,G.screenWidth=screen.width;break;case 270:case-90:case-270:case 90:(G.usePortrait||G.useLandscape)&&(G.isPortrait=!1,G.isLandscape=!0),screen.width<screen.height?(G.screenHeight=screen.width,G.screenWidth=screen.height):(G.screenHeight=screen.height,G.screenWidth=screen.width);break;case-180:case 180:(G.usePortrait||G.useLandscape)&&(G.isPortrait=!0,G.isLandscape=!1),G.screenHeight=screen.height,G.screenWidth=screen.width}globalThis.parent===window&&globalThis.scrollTo(0,G.currentY)}function J(){G.isPortrait=!1,G.isLandscape=!1;let e=0;e=window.matchMedia("(orientation: portrait)").matches?0:90,0===e&&(e=globalThis.screen.orientation&&"number"==typeof globalThis.screen.orientation.angle?globalThis.screen.orientation.angle:parseInt(globalThis.orientation)),q.angle=e,Y?Y(e):X&&X.eventOrientation?X.eventOrientation(e):K(e),globalThis.parent===window&&globalThis.scrollTo(0,G.currentY)}function Q(e){W.timer&&(m.updateManager.remove(W.timer),W.timer=null),q.isTrigger=!0,h.redraw(),W.timer=m.updateManager.setTimeout((()=>{q.isTrigger=!1,J(),te()}),.001*W.eventDelay)}function Z(e){if(G.isMobile&&!e.isChild&&X&&X.getCurrentValue){let t=X.getCurrentValue();if(t){let n=t.offset;e.left=0,e.top=0,e.width=globalThis.innerWidth,e.height=globalThis.innerHeight,"number"==typeof n?e.height=globalThis.innerHeight-n:n&&("number"==typeof n.x&&(e.left=n.x),"number"==typeof n.y&&(e.top=n.y),"number"==typeof n.width&&(e.width=globalThis.innerWidth-n.width),"number"==typeof n.height&&(e.height=globalThis.innerHeight-n.height))}else e.left=0,e.top=0,e.width=globalThis.innerWidth,e.height=globalThis.innerHeight;e.left+="px",e.top+="px",e.width+="px",e.height+="px"}}function ee(e){let t=e.game,n={x:1,y:1},i=screen.width,a=screen.height;G.isMobile?(i=globalThis.innerWidth,a=globalThis.innerHeight,G.useFullscreen||(i=globalThis.innerWidth,a=globalThis.innerHeight),G.ios&&(a=globalThis.innerHeight,i=globalThis.innerWidth)):(i=globalThis.innerWidth,a=globalThis.innerHeight),t.portrait&&t.landscape&&(i>a?(t.width=t.landscape.width||512,t.height=t.landscape.height||512):(t.width=t.portrait.width||512,t.height=t.portrait.height||512)),e.fix&&(i=parseInt(e.fix.width),a=parseInt(e.fix.height));let s={x:0,y:0};e.left=0,e.top=0;let o=e.reference;o&&(s.x=o.left*i,s.y=o.top*a,i*=o.width,a*=o.height),i-t.width<0?(e.width=i,n.x=i/t.width):e.width=t.width,a-t.height<0?(e.height=a,n.y=a/t.height):e.height=t.height,n.x<n.y?e.height=t.height*n.x:n.x>n.y&&(e.width=t.width*n.y);let l=e.anchor;if(l){let t=(i-e.width)*V(l.x,(()=>.5)),n=(a-e.height)*V(l.y,(()=>.5));e.left=s.x+t,e.top=s.y+n}if(e.useCenter){let t=0,n=0;"boolean"==typeof e.useCenter?(n=.5*(a-e.height),n<0&&(n=0),t=.5*(i-e.width),t<0&&(t=0)):(e.useCenter.vertical&&(n=.5*(a-e.height),n<0&&(n=0)),(e.useCenter.horizontal||e.useCenter.left)&&(t=.5*(i-e.width),t<0&&(t=0))),e.left=s.x+t,e.top=s.y+n}e.absPos&&("number"==typeof e.absPos.top?e.top=e.absPos.top:"number"==typeof e.absPos.bottom&&(e.top=a+e.absPos.bottom),"number"==typeof e.absPos.left?e.left=e.absPos.left:"number"==typeof e.absPos.right&&(e.left=i+e.absPos.right)),t.eventResize&&t.eventResize({left:e.left,top:e.top,width:e.width,height:e.height}),e.eventResize&&e.eventResize({width:globalThis.innerWidth,height:globalThis.innerHeight}),e.left+="px",e.top+="px",e.width+="px",e.height+="px"}function te(e){if(!q.isTrigger&&!G.disableResize){if(!e)return!!q.isTrigger||void(W.resizeTimer||(G.isResize=!0,h.redraw(),W.resizeTimer=m.updateManager.setTimeout((()=>{m.updateManager.remove(W.resizeTimer),W.resizeTimer=null,t()}),.3)));t()}function t(){G.isMobile&&globalThis.parent===window&&globalThis.scrollTo(0,G.currentY),m.updateManager.setTimeout((()=>{X&&X.checkFullscreen&&G.useFullscreen&&X.checkFullscreen(G);let e=globalThis.scene;if(G.settingList.forEach((t=>{if(t){if(!t.isLock)return Z(t),h.redraw(),!0;if(ee(t),e){let n=e[t.id];if(n){let e=n.localEvent;if(e&&e.resize){let n={isMobile:G.isMobile};n.width=globalThis.innerWidth,n.height=globalThis.innerHeight,n.setting=t,e.resize(n)}}}h.redraw()}})),e){Object.getOwnPropertyNames(e).forEach((t=>{let n=e[t];if(n){let e=n.localEvent;if(e&&e.resize){let t={isMobile:G.isMobile};t.width=globalThis.innerWidth,t.height=globalThis.innerHeight,4!==n.state&&5!==n.state||e.resize(t)}}}))}G.isResize=!1,h.redraw()}),.01)}}function ne(e){if(H([e,"optionalAccess",e=>e.index])>=0)return-1;let t=-1;for(let n=0;n<G.settingList.length;n+=1){G.settingList[n]||(t=n,G.settingList[n]=e)}return t<0&&(t=G.settingList.length,G.settingList.push(e)),e.isLock&&ee(e),e.index=t,t}function ie(e){if(H([e,"optionalAccess",e=>e.index])>=0){let t=e.index;t<G.settingList.length&&(G.settingList[t]=null),delete e.index}}function ae(e){G.disableResize=e}function se(){G.settingList=[]}G.ios=!1,G.useOrientation=!1,G.usePortrait=!1,G.useLandscape=!1,G.isMobile=!1,G.mobileReady=null,G.useFullscreen=!1,G.isFullscreen=!1,G.isPortrait=!1,G.isLandscape=!1,G.isTouchOnce=!1,G.isResize=!1,G.currentY=0,G.screenWidth=screen.width,G.screenHeight=screen.height,G.screenUnit="px",G.orientation=q,G.isTouchDown=!1,G.useFocus=!1,G.disableResize=!1,G.settingList=[];let oe=!1;async function le(e){let t=await import("./agent.aa3805c9.js"),i=await import("./agent.d1aa9c92.js"),a=await Promise.resolve().then((function(){return fe}));if(G.currentY=0,document){let e=globalThis.scene;document.onfullscreenchange=document.onwebkitfullscreenchange=()=>{G.settingList.forEach((t=>{if(t&&e){let n=e[t.id];if(n){let e=n.game&&n.game.sysTray;a.checkFullsreen(e);let t=n.localEvent;if(t&&t.fullscreen){let n=e&&e.isFullscreen;t.fullscreen(n)}}}})),h.redraw()},document.onfullscreenerror=document.onwebkitfullscreenerror=()=>{G.settingList.forEach((t=>{if(t&&e){let n=e[t.id];if(n){let e=n.game&&n.game.sysTray;a.checkFullsreen(e);let t=n.localEvent;if(t&&t.fullscreen){let n=e&&e.isFullscreen;t.fullscreen(n)}}}})),h.redraw()}}if(!n.isCheckGameCDN&&j.any()?(oe||(screen&&screen.orientation&&screen.orientation.addEventListener?screen.orientation.addEventListener("change",Q):globalThis.addEventListener("orientationchange",Q)),G.isMobile=!0,Y=K,j.iOS()?(globalThis.parent===window&&(G.currentY=200),G.ios=!0,Y=null):j.Android()&&(globalThis.parent===window&&(G.currentY=200),Y=null)):G.isMobile=!1,e&&(G.useOrientation=!1,G.usePortrait=!1,G.useLandscape=!1,G.isMobile&&("string"==typeof e.orientation&&("portrait"===e.orientation?(G.usePortrait=!0,G.orientation.name="portrait"):(G.useLandscape=!0,G.orientation.name="landscape"),G.useOrientation=!0),X=null,G.useFullscreen=!1,j.iOS()?navigator.userAgent.match(/baidu/i)?(X=i.baidu,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/CriOS/i)?(X=i.chrome,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/LieBao|ACHEETAHI/i)?(X=i.liebao,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/FxiOS/i)?(X=i.firefox,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/Safari/i)?(X=i.safari,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/UCB/i)?(X=i.uc,G.screenUnit="px",G.useFullscreen=!1):X=i.unset:j.Android()&&(navigator.userAgent.match(/OPR/i)?(X=t.opera,G.screenUnit="px",G.useFullscreen=!1,navigator.userAgent.match(/baidu/i)?X=t.baidu:navigator.userAgent.match(/LieBao|ACHEETAHI/i)&&(X=t.liebao,G.screenUnit="px",G.useFullscreen=!1)):navigator.userAgent.match(/baidu/i)?(X=t.baidu,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/LieBao|ACHEETAHI/i)?(X=t.liebao,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/Firefox/i)?(X=t.firefox,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/UCB/i)?(X=t.uc,G.screenUnit="px",G.useFullscreen=!1):navigator.userAgent.match(/Chrome/i)?(G.useFullscreen=!1,G.screenUnit="px",X=t.chrome):X=t.unset),navigator.userAgent.match(/(UBiOS|Pad|Tablet|KFAUW|Mb2345|ME173X|NRD90M|VIE|N2G47H)/i)&&(G.useFullscreen=!1,G.screenUnit="px"),X&&(X.value.state=G),oe||globalThis.addEventListener("focus",(()=>{G.useFocus&&(G.isTouchOnce=!0,G.useFocus=!1,te(!0))}),!0),J(),te(!0),G.settingList.forEach((e=>{if(e)return e.isLock?void ee(e):(Z(e),!0)})),G.isFullscreen=!0,G.isTouchDown=!1,G.isTouchOnce=!0)),n.mobileMode){let e=n.mobileMode;parseInt(e)>0&&(G.isFullscreen=!0,G.isTouchDown=!1,G.isTouchOnce=!0)}document.body.onscroll=()=>{!G.isMobile||G.orientation.isTrigger||G.isResize||G.disableResize||globalThis.parent===window&&G.isMobile&&(G.currentY=globalThis.pageYOffset,globalThis.scrollTo(0,G.currentY),h.redraw())},oe||globalThis.addEventListener("resize",te),oe=!0}var re=Object.freeze({__proto__:null,__unload:()=>{screen&&screen.orientation&&screen.orientation.removeEventListener?screen.orientation.removeEventListener("change",Q):globalThis.removeEventListener("orientationchange",Q),globalThis.removeEventListener("resize",te)},addSetting:ne,decSetting:ie,eventResize:te,init:le,orientationChangeHandler:Q,removeAllSetting:se,setDisableResize:ae,state:G});let ce={oninit(e){let t=e.attrs;this.url=t.url,this.manager=t.manager,this.setting={id:"children",isLock:!1,useCenter:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:1024,height:1024},reference:{left:0,top:0,width:1,height:1}},ne(this.setting)},oncreate(e){let t=e.instance.children[0].dom;m.updateManager.setTimeout((()=>{ae(!0),t.focus()}),.2)},view(){let e=this,t=e.setting;return h(".rwdPanelHeader",{style:{position:"absolute",left:t.left,top:t.top,backgroundColor:"rgba(0,0,0,1)",zIndex:950,opacity:1,width:t.width,height:t.height}},h("iframe",{src:e.url,scrolling:"yes",frameborder:0,style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}}),h(".fl.tc.pv4.bg-black.hover-bg-gray",{style:{position:"absolute",left:"5%",top:"0%",width:"90%",height:"10%",opacity:.75,cursor:"pointer"},onclick(){ae(!1),e.manager.childrenVisible=!1,e.url=""}},h(".inline-flex.white.border-box.pointer",`${p("close")}`)))}};function ge(){return'<img src="data/sys/4021bb29611b24c4.svg" class="w-100 h-100 dropshadow">'}function de(e){let t=!1;return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(t=!0,e&&(e.isFullscreen=!0)):(t=!1,e&&(e.isFullscreen=!1)),t}async function ue(e){if(!document.fullscreenEnabled)return Promise.reject();let t=!1;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(e&&(e.isFullscreen=!1),document.exitFullscreen?(await document.exitFullscreen(),t=!0):document.msExitFullscreen?(await document.msExitFullscreen(),t=!0):document.mozCancelFullScreen?(await document.mozCancelFullScreen(),t=!0):document.webkitExitFullscreen&&(await document.webkitExitFullscreen(),t=!0),t&&e&&(e.isFullscreen=!1)):(document.documentElement.requestFullscreen?(await document.documentElement.requestFullscreen(),t=!0):document.documentElement.msRequestFullscreen?(await document.documentElement.msRequestFullscreen(),t=!0):document.documentElement.mozRequestFullScreen?(await document.documentElement.mozRequestFullScreen(),t=!0):document.documentElement.webkitRequestFullscreen&&(await document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),t=!0),t&&(e&&(e.isFullscreen=!0),G.useOrientation&&globalThis.screen&&globalThis.screen.orientation&&globalThis.screen.orientation.lock&&await globalThis.screen.orientation.lock(G.orientation.name)))}let he={visible:!0,isMenu:!1};let me={oninit(e){let t=this,n=e.attrs;t.onclick=n.onclick,t.style=n.style,t.config=n.config},onbeforeremove(){},view(){let e=this,t=e.config;return h(".pointer",{style:{width:"4%",height:"10%",borderRadius:"4px 8px 8px 4px",backgroundColor:"#000",opacity:.6,position:"absolute",left:e.style.left,top:e.style.top,zIndex:900},onclick(){t&&(t.isMenu=!0,t.visible=!1),e.onclick&&e.onclick()}},h.trust('<img src="data/sys/4021bb29611b24c4.svg" class="w-100 h-100 dropshadow">'))}},pe={oninit(e){let t=e.attrs,n=this;n.event=t.event,n.tray=t.tray,n.info=t.info,n.config=t.config,n.isLeave=!1,n.config||(n.config={isMenu:he.isMenu,visible:he.visible,flags:{fullscreen:!0,lock:!0,sound:!0,music:!0}}),n.config.flags||(n.config.flags={}),n.info||(n.info={logo:"logo.png",gameName:"test game",version:"0.0.0",mode:" test mode",token:"token"}),n.tray||(n.tray={state:{visible:!0},sound:{isMute:!1},music:{isMute:!1},screen:{isAutoScale:!0,isLock:!1},isLock:!1,isFullscreen:!1},Object.defineProperty(n.tray,"visible",{get:()=>n.tray.state.visible,set(e){n.tray.state.visible=e}}))},onbeforeremove:e=>(["animate__fadeOutLeft","animate__animated"].forEach((t=>{e.dom.classList.add(t)})),new Promise((e=>{m.updateManager.setTimeout((()=>{e()}),.4)}))),onremove(){},view(){let e=this,t=e.tray,i=e.event,a=e.info,s=e.config,o=s.flags,l=n.menu||[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0];return h(".animate__fadeInLeft animate__animated",{onclick(){e.isLeave?(s.isMenu=!1,s.visible=!1,t.visible=!1):(s.visible=!1,t.visible=!0)},style:{zIndex:900,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},h(".pv2.ph2.bg-black.[id='panel']",[h(".fl.bb.b--gray.mb2.dib.pb2.mb2.w-100.rwdPanelHeader",[h("table.pa2.ml4.dib.br2.bg-black.white.rwdAppInfo",h("tbody.rwd-lh",[h("tr",[h("td",p("gameName")),h("td"," : "),h("td.blue",a.gameName)]),h("tr",[h("td",p("version")),h("td"," : "),h("td.blue",a.version)]),l[8]?h("tr",[h("td",p("gameMode")),h("td"," : "),h("td.blue",a.mode)]):null]))]),l[0]&&o.fullscreen&&!G.ios?h(".",[h(".fl.w-70.pa1.ma1.rwdOpt",h(".no-underline.near-white.inline-flex",[h("img.dib.fl.mv1.rwdOptIcon.dropshadow",{alt:"FULL SCREEN",src:"data/sys/f512613ddcb62054.png"}),h(".ml3.white.mv3.f4.rwdPanelFont",p("fullscreen"))])),h(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){t.isFullscreen=!t.isFullscreen,h.redraw(),ue(t).then((()=>{i&&i.fullscreen&&i.fullscreen(t.isFullscreen)}))}},h("label.switch",[h("input[name='toggle'][type='checkbox'][value='fullscreen']",{disabled:!0,checked:t.isFullscreen}),h("span.slider.round")]))]):h("."),l[1]&&o.lock?h(".",[h(".fl.w-70.pa1.ma1.rwdOpt",h(".no-underline.near-white.inline-flex",[h("img.dib.fl.mv1.rwdOptIcon.dropshadow",{alt:"LOCK SCALE",src:"data/sys/8920df5ffd5c25b0.png"}),h(".ml3.white.mv3.f4.rwdPanelFont",p("lock"))])),h(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){t.isLock=!t.isLock,t.update&&t.update(t),h.redraw(),i&&i.lock&&i.lock(t.isLock)}},h("label.switch",[h("input[name='toggle'][type='checkbox'][value='lock']",{disabled:!0,checked:t.isLock}),h("span.slider.round")]))]):h("."),l[2]&&o.music?h(".",[h(".fl.w-70.pa1.ma1.rwdOpt",h(".no-underline.near-white.inline-flex",[h("img.h-100.dib.fl.mv1.rwdOptIcon.dropshadow[alt='MUSIC'][src='data/sys/ddb7103e5eca70e6.png']"),h(".ml3.white.mv3.f4.rwdPanelFont",p("music"))])),h(".fr.w-20.pt2.mv2.mr2.rwdToggle",{onclick(){t.music.isMute=!t.music.isMute,h.redraw(),i&&i.music&&i.music(t.music)}},h("label.switch",[h("input[name='toggle'][type='checkbox'][value='music']",{disabled:!0,checked:!t.music.isMute}),h("span.slider.round")]))]):h("."),l[3]&&o.sound?h(".",[h(".fl.w-70.pa1.ma1.rwdOpt",h(".no-underline.near-white.inline-flex",[h("img.dib.fl.mv1.rwdOptIcon.dropshadow[alt='SOUND'][src='data/sys/ddb7103e5eca70e6.png']"),h(".ml3.white.mv3.f4.rwdPanelFont",p("sound"))])),h(".fr.w-20.pt2.mv2.mr2.rwdToggle",h("label.switch",[h("input[name='toggle'][type='checkbox'][value='sound']",{checked:!t.sound.isMute,onclick(){t.sound.isMute=!t.sound.isMute,i&&i.sound&&i.sound(t.sound)}}),h("span.slider.round")]))]):h("."),l[4]?h(".fl.w-100.pa2.pt3.bt.b--gray.mt2.rwdBtn",{onclick(){G.useFocus=!0}},h(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[h("img.dib h2 w2[src='data/sys/35b95e6d1d3ebf48.png']"),h(".w-100.f3.white.mv1.dib.noselect.rwdPanelFont",p("history"))])):h("."),l[5]?h(".fl.w-100.pa2",{onclick(){G.useFocus=!0}},h(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[h("img.dib h2 w2[src='data/sys/2357769f78f010b1.png']"),h(".w-100.f3.white.mv1.dib.noselect",p("deposit"))])):h("."),l[6]?h(".fl.w-100.pa2",{onclick(){globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),G.useFocus=!0}},h(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[h("img.dib h2 w2[src='data/sys/94615eed5b8c0616.png']"),h(".w-100.f3.white.mv1.dib.noselect",p("back"))])):h("."),l[7]?h(".fl.w-100.pa2",{onclick(){if(G.useFocus=!0,e.isLeave=!0,a.iframe){let e=a.iframe.contentDocument||a.iframe.contentglobalThis.document;e?(e.open(),e.write(""),e.close()):a.iframe.srcdoc="about:blank"}globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload())}},h(".w-100 no-underline near-white bg-animate bg-near-black hover-bg-gray inline-flex items-center ma1 tc br1 pa1 border-box pointer",[h("img.dib h2 w2[src='data/sys/fe342b264ea95dbb.png']"),h(".w-100.f3.white.mv1.dib.noselect",p("lobby"))])):h("."),h(".")]))}};var fe=Object.freeze({__proto__:null,ButtonSystem:me,Component:pe,checkFullsreen:de,config:he,getButtonSys:ge,toggleFullScreen:ue});let be={engine:null},we={engine:null},ye={engine:null},ve=!1;function Ce(e){let t,n,i={},a=e;return n=s.PIXI.Renderer?new s.PIXI.Renderer(a):new s.PIXI.WebGLRenderer(a),t=new s.PIXI.Container,i.stage=t,i.overlay=new s.PIXI.Container,i.foreground=new s.PIXI.Container,i.main=new s.PIXI.Container,i.background=new s.PIXI.Container,t.addChildAt(i.overlay,0),t.addChildAt(i.foreground,0),t.addChildAt(i.main,0),t.addChildAt(i.background,0),{renderer:n,stage:t,layer:i,render(){n.render(t)}}}function Le(e){let t,n=e[0],i=1;for(;i<e.length;){const a=e[i],s=e[i+1];if(i+=2,("optionalAccess"===a||"optionalCall"===a)&&null==n)return;"access"===a||"optionalAccess"===a?(t=n,n=s(n)):"call"!==a&&"optionalCall"!==a||(n=s(((...e)=>n.call(t,...e))),t=void 0)}return n}const Te=0,Ee=6,Re=1,xe=3,ke=4,Ie=5;let Oe={oninit(){this.options={}},oncreate(i){let a=this;a.isIframeLoaded=!1,a.isIframeInit=!1;let r,c=Math.round(performance.now());a.timestamp=c,a.checkItem=null;let g={isFirstTime:!0,useVideo:!1,isCheckData:!1,isChild:!1,isGame:!0,isCreate:!1,isBusy:!0,rendered:null,disable:!0,sysTray:null,trayVisible:!1,childrenVisible:!1,currentUrl:"",useCenter:!0,position:"absolute",left:"25%",top:"25%",width:"50%",height:"50%"},d={state:{visible:!0},sound:{isMute:!1},music:{isMute:!1},screen:{isAutoScale:!0,isLock:!1},isLock:!1,isFullscreen:!1};Object.prototype.hasOwnProperty.call(d,"visible")||Object.defineProperty(d,"visible",{get:()=>d.state.visible,set(e){g.mode!==o.DEMO&&(d.state.visible=e,g.sysTray&&(e?(g.sysTray.isMenu=!1,g.sysTray.visible=!0):(g.sysTray.isMenu=!1,g.sysTray.visible=!1),h.redraw()))}});let u=a.options,w=i.attrs;if(a.currentBaseURL=null,w&&(a.checkItem=w.checkItem,a.currentBaseURL=w.currentBaseURL,g.left=w.left||"25%",g.top=w.top||"25%",g.width=w.width||"50%",g.height=w.height||"50%",g.reference=w.reference,g.fix=w.fix,g.isChild=w.isChild,g.isCheckData=w.isCheckData,w.sysTray?g.sysTray={visible:!0,isMenu:!1,flags:w.sysTray.flags,style:{left:w.sysTray.left||"0px",top:w.sysTray.top||"0px"}}:g.sysTray=null,r=w.config,a.ctrlEvent=w.ctrlEvent),d.visible=!1,!r)return;let v=f();if(g.isCreate=r.isCreate,g.templateVersion=r.scene.templateVersion,"slot.2.1"===g.templateVersion&&"en-us"===f()&&(v="en"),g.id=r.id,g.mode=r.mode,g.name=r.scene.name[v],g.group=r.scene.group||"game",g.appName=r.scene.app,g.appHash=r.scene.appHash,g.appConfig=r.scene.appConfig,g.devMode=r.scene.devMode,g.dependence=r.scene.dependence,g.background=null,g.backgroundCSS=null,a.appTimeout=t?null:m.updateManager.setTimeout((()=>{u.initGame=null,a.appTimeout=null,h.redraw(),m.updateManager.setTimeout((()=>{n.requestReload=!1,n.isReload=!0,bt({url:a.currentBaseURL,group:g.group,game:g.appConfig})}),.1)}),10),!ye.engine){let e={id:"game",width:512,height:512,resolution:1,antialias:!1,transparent:!0};e.view=ye.canvas,ye.engine=Ce(e),ye.game.setEngine(ye.engine)}let C=`${g.group}${g.appConfig}`,L={category:"遊戲程式 "+(a.currentBaseURL||"主網址"),getLabel:()=>C},T={category:"遊戲場景 "+(a.currentBaseURL||"主網址"),getLabel:()=>C},E={category:"建立遊戲 "+(a.currentBaseURL||"主網址"),getLabel:()=>C};n.isCheckGameCDN||(e.loadBegin(E),e.loadBegin(L)),g.anim={element:null,isPlay:!1},g.display="inline",g.opacity=0,g.zIndex=1,w.updateStyle&&w.updateStyle(g);let R=r.scene.images;n.useAvif?R.v2&&(R=R.v2):R.v1&&(R=R.v1),g.game={id:r.id,group:r.scene.group,mode:r.mode,decimal:r.decimal,name:g.name,logo:R&&R.logo,theOther:r.scene.theOther,version:r.scene.version,baseURL:r.scene.baseURL||"",langID:v},R&&Object.prototype.hasOwnProperty.call(R,"useBackground")&&R.background&&(g.isCheckData||(g.background=`${g.game.baseURL}${R.background}`),"string"==typeof R.useBackground?g.backgroundCSS=`${R.useBackground}`:(R.useBackground,g.backgroundCSS=null)),r.scene.theOther&&r.scene.theOther.id&&(g.game.theOther=r.scene.theOther.id),r.scene.screen&&(g.isLock=r.scene.screen.isLock,g.game.width=r.scene.screen.width||640,g.game.height=r.scene.screen.height||960,g.game.portrait=r.scene.screen.portrait,g.game.landscape=r.scene.screen.landscape,G.isMobile,d.isLock=g.isLock),g.images=R,g.isCheckData||ne(g);let x=null,k=r.loadingEvent,I=Ot(),O=null,$=I.scene[g.id]={templateVersion:g.templateVersion,state:Te,event:{create:null,play:null,pause:null,enter:null,leave:null,focus:null,blur:null,lock:null,fullscreen:null,resize:null,music:null,sound:null},info:{isChild:g.isChild,baseURL:g.game.baseURL||"",id:g.game.id,name:g.game.name,group:g.game.group,theOther:g.game.theOther,width:g.game.width,height:g.game.height,decimal:g.game.decimal,mode:g.game.mode,langID:g.game.langID},gamecard:r.scene,loadingEvent:{title:g.name,start(){n.isCheckGameCDN||e.loadBegin(T),k.start&&k.start()},resBegin(e){k.resBegin&&k.resBegin(e)},resEnd(e){k.resEnd&&k.resEnd(e)},sceneResBegin(e){k.sceneResBegin&&k.sceneResBegin(e)},sceneResLoading(e){k.sceneResLoading&&k.sceneResLoading(e)},sceneResEnd(e){k.sceneResEnd&&k.sceneResEnd(e)},finish(){$.state=ke,n.isCheckGameCDN||(e.loadEnd(T),e.log({label:C,category:"遊戲場景 "+(a.currentBaseURL||"主網址")}),e.loadEnd(E)),k.finish&&k.finish($)}},callWeb(e){"string"==typeof e?I.document&&I.document.location&&I.document.location.replace?I.document.location.replace(e||"about:blank"):I.location.href=e||"about:blank":wt(e)},open(e){g.childrenVisible=!0,g.currentUrl=e,h.redraw()},setDisableResize(e){ae(e)},createTheOther(e,t=0){Ke(e,t)},destroyTheOther(e){Je(e),I.scene[e]=null},callTheOther(e,t){let n,i=!1,a=I.scene[e];return a&&a.state===ke&&($.game.debug=!1,$.state=ke,$.info.isChild?($.localEvent.pause(),$.localEvent.hide()):$.localEvent.pause(),n=t||{what:" is this ?"},n.from=$.info.id,i=!0,a.localEvent.pause(),a.state=Ie,a.templateVersion,a.setting.background=t&&t.background||"rgba(0,0,0,0)",a.localEvent.show(),a.localEvent.play(n)),i},checkTheOther(e){let t=!1,n=I.scene[e];return n&&n.state===ke&&(t=!0),t},getTheOther:e=>I.scene[e],reload(e){if(n.isReload)return;yt(),n.isReload=!0;let t=e;t||(t={game:g.appConfig,group:g.group}),$.game.stop(),$.game.reset();Qe(),m.updateManager.setTimeout((()=>{for(let e=0;e<globalThis.frames.length;e+=1){let t=globalThis.frames[e];if(t){let e=t.document;e&&(e.documentElement.innerHTML="")}}u.initGame=null,$.game=null,a.ctrlEvent&&a.ctrlEvent.reload&&a.ctrlEvent.reload(),h.redraw(),m.updateManager.setTimeout((()=>{qe().then((()=>{F(t.game,t.group,a.currentBaseURL,t.version).then((n=>{n&&n.gameCard&&(n.gameCard.reloadConfig=e,Xe({gameCard:n.gameCard,id:t.game,group:t.group}))}))}))}),.01)}),.05)},leave(e){},setMode(e){let t=o;l.mode=e,l.mode===t.REAL?u.info.mode=p("gameModeReal"):u.info.mode=p("gameModeDemo"),h.redraw()},async fullscreen(e){if(e||!de())try{return await ue(d)}catch(e){}},ready(i){if(!$.game&&i&&($.game=i),a.appTimeout&&(m.updateManager.remove(a.appTimeout),a.appTimeout=null),n.isCheckGameCDN||(e.loadEnd(L),e.log({label:C,category:"遊戲程式 "+(a.currentBaseURL||"主網址")})),a.checkItem){let e=a.checkItem,t=Math.round(performance.now());e.timeInit=t-a.timestamp,a.timestamp=t,e.state="app",e.timeReady=t-e.timestamp,e.timestamp=t,h.redraw(),e.ready&&e.ready(e)}O($.game).then((()=>{if($.game){let t={error(t){e.error({label:C,category:t})},log(t){"string"==typeof t?e.log({label:C,category:t}):t&&(t.label=C,e.log(t))},serviceBegin(t){if(t){if(t.getLabel=()=>C,!t.category)return;e.serviceBegin(t)}},serviceEnd(t){if(t){if(t.getLabel=()=>C,!t.category)return;e.serviceEnd(t)}},loadBegin(t){if(t){if(t.getLabel=()=>C,!t.category)return;e.loadBegin(t)}},loadEnd(t){if(t){if(t.getLabel=()=>C,!t.category)return;e.loadEnd(t)}}};$.game.report=t,$.game.localforage=y}g.isBusy=!1,g.isCreate&&$.event&&$.event.create?(t&&($.info.console=console),$.info.setting=n,$.event.create($.info),$.state=Re):$.state=xe}))},graphReady(){$.ready()},setOverviewVisible(e){$.gamecard.manual&&$.gamecard.manual.overview&&(je.overview.visible=e,h.redraw())},setEvent(e){let t=$.event;t.create=e.create||t.create,t.play=e.play||t.play,t.pause=e.pause||t.pause,t.enter=e.enter||t.enter,t.leave=e.leave||t.leave,t.focus=e.focus||t.focus,t.blur=e.blur||t.blur,t.lock=e.lock||t.lock,t.fullscreen=e.fullscreen||t.fullscreen,t.resize=e.resize||t.resize,t.music=e.music||t.music,t.sound=e.sound||t.sound}};$.state=Ee;let U=!1,M=null,A=null,B=null;async function S(){if(t){M=`${n.projectURL}${g.group}/${g.appConfig}/`,A=`${g.group}/${g.appConfig}`;let e=await import("js-yaml");e.default&&(e=e.default);let t=`${M}system.set.yml`,i=await fetch(t);if(i.ok){let t=await i.text(),a=e.load(t);a.package.skipRollup&&(U=!0),B={imports:{},scopes:{}},B.imports[A]=`${g.game.baseURL}${a.package.main}`;let s=Object.getOwnPropertyNames(a.config.paths),o={};s.forEach((e=>{let t=a.config.paths[e];"/"===t[0]?o[e]=t:o[e]=`${n.projectURL}${t}`})),B.scopes[M]=o}}}O=async e=>{let i=globalThis.location.origin;a.currentBaseURL&&(i=a.currentBaseURL),g.game.baseURL.length>0&&(i=g.game.baseURL);let o=i;o.length>0&&"/"===o[o.length-1]&&(o=o.substring(0,o.length-1));let l=g.appName;if("object"==typeof l&&(l=g.appName[g.game.langID],l||(l=g.appName[b.EN_US])),l){let e=l.split("/"),t=e.length-1;o=t>2?`${o}/${e[t-1]}/${e[t]}`:`${o}/${l}`}if(e.PIXI=s.PIXI,e.spine=s.spine,await S(),"game.6.0"===g.templateVersion){if(e.getRenderer){let t=$.gamecard.pixiConfig;e.getRenderer().resize(t.width,t.height)}let i;if(e.layer.overlay.removeChildren(),e.layer.foreground.removeChildren(),e.layer.main.removeChildren(),e.layer.background.removeChildren(),e.play(),e.scene=$,B){importShim.addImportMap(B);importShim.getImportMap()}if(t&&U){let e=import.meta.resolve(A);i=await import(e)}else i=await import(o);let a=await i.scene.init({setting:n,baseURL:$.info.baseURL,isChild:$.info.isChild,langID:$.info.langID,gamecard:$.gamecard,game:e,nuts:m}),s={create(t){I.lobby&&(e.currentUser=I.lobby.currentUser,e.command=I.lobby.net.gameCommand,e.lobby={setEvent:I.lobby.setEvent,setCommand:I.lobby.net.setLobbyCommand,CMD:I.lobby.net.CMD}),a.create&&(t.game=e,t.setting=n,a.create(t))},play(t){e.play(),a.play&&(t.game=e,t.setting=n,a.play(t))},pause(t){e.pause(),a.pause&&(t.game=e,t.setting=n,a.pause(t))},enter(t){a.enter&&(t.game=e,t.setting=n,a.enter(t))},leave(t){a.leave&&(t.game=e,t.setting=n,a.leave(t))},focus(){a.focus&&a.focus()},blur(){a.blur&&a.blur()},lock(e){a.lock&&a.lock(e)},fullscreen(e){a.fullscreen&&a.fullscreen(e)},resize(e){a.resize&&a.resize(e)},music(e){a.music&&a.music(e)},sound(e){a.sound&&a.sound(e)}};$.setEvent(s),$.game=e}else if("game.5.0"===g.templateVersion){let i;if(Object.defineProperty(e,"scene",{get:()=>$}),B){importShim.addImportMap(B);importShim.getImportMap()}if(t&&U){let e=import.meta.resolve(A);i=await import(e)}else i=await import(o);let a=await i.scene.init({setting:n,baseURL:$.info.baseURL,isChild:$.info.isChild,langID:$.info.langID,gamecard:$.gamecard,game:e,nuts:m}),s={create(t){I.lobby&&(e.currentUser=I.lobby.currentUser,e.command=I.lobby.net.gameCommand,e.lobby={setEvent:I.lobby.setEvent,setCommand:I.lobby.net.setLobbyCommand,CMD:I.lobby.net.CMD}),a.create&&(t.game=e,t.setting=n,a.create(t))},play(t){e.play(),a.play&&(t.game=e,t.setting=n,a.play(t))},pause(t){e.pause(),a.pause&&(t.game=e,t.setting=n,a.pause(t))},enter(t){a.enter&&(t.game=e,t.setting=n,a.enter(t))},leave(t){a.leave&&(t.game=e,t.setting=n,a.leave(t))},focus(){a.focus&&a.focus()},blur(){a.blur&&a.blur()},lock(e){a.lock&&a.lock(e)},fullscreen(e){a.fullscreen&&a.fullscreen(e)},resize(e){a.resize&&a.resize(e)},music(e){a.music&&a.music(e)},sound(e){a.sound&&a.sound(e)}};$.setEvent(s),$.game=e}};let P={isActive:!0,create(e){e.isCreate&&Le([$,"access",e=>e.event,"optionalAccess",e=>e.create])&&(t&&($.info.console=console),$.info.setting=n,$.event.create($.info),$.state=Re)},async enter(t){let i=t||{};i.from||(i.from=$.info.id),i.id||(i.id=g.game.id),i.game||(i.game=$.game),n.isInGame=!0,G.isMobile&&(g.isChild||globalThis.scrollTo(0,G.currentY)),g.isFirstTime&&(g.isFirstTime=!1),$.game&&(I.lobby&&($.game.command=I.lobby.net.gameCommand,$.game.table=I.lobby.table[i.id],$.game.currentUser=I.lobby.currentUser),$.game.sysTray=d,$.game.getLCS=async function(){return null},$.game.scanLCS=async function(e){let t={name:"串流服務",category:"檢測串流",getLabel:()=>C},n=await import("./agent.e7cf82d1.js");return await n.scan(e,t)},$.game.getProject=async function(e,t){const n=await import("./agent.d47b8ed4.js");return await n.getProject(e,t)},$.game.getPlayer=async function(){let e=await import("./agent.fff071a3.js");return await e.getLib(),e.player},$.game.getIP=e.getIP),P.show({finish(){Le([$,"access",e=>e.event,"optionalAccess",e=>e.enter])&&(i.setting=n,$.event.enter(i)),P.blur&&P.blur(),te(!0);let e=null,t=I.scene[$.info.theOther];if($.info.isChild||t||!$.info.theOther||($.info.theOther,$.info.theOther.length>0?e={id:$.info.theOther,group:$.info.group}:"object"==typeof $.info.theOther&&(e={id:$.info.theOther.id,group:$.info.theOther.group})),null!==e){let t={style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},reference:{left:0,top:0,width:1,height:1},groupName:e.group,id:e.id,sceneID:e.id,loadingEvent:{start(){},resBegin(){},resEnd(){},sceneResBegin(){},sceneResLoading(){},sceneResEnd(){},finish(e){e.localEvent.pause(),e.localEvent.hide()}}};$.createTheOther(t)}}})},leave(e){let t=e||{};t.from||(t.from=$.info.id),t.game||(t.game=$.game),Le([$,"access",e=>e.event,"optionalAccess",e=>e.leave])&&(t.setting=n,$.event.leave(t))},play(e){let t=e||{};t.from||(t.from=$.info.id),t.game||(t.game=$.game),Le([$,"access",e=>e.event,"optionalAccess",e=>e.play])&&(t.setting=n,$.event.play(t)),$.state=Ie,te(!0)},pause(e){let t=e||{};t.from||(t.from=$.info.id),t.game||(t.game=$.game),Le([$,"access",e=>e.event,"optionalAccess",e=>e.pause])&&(t.setting=n,$.event.pause(t)),$.state=ke},focus(){P.isActive||(P.isActive=!0,Le([$,"access",e=>e.event,"optionalAccess",e=>e.focus])&&$.event.focus())},blur(){P.isActive&&(P.isActive=!1,Le([$,"access",e=>e.event,"optionalAccess",e=>e.blur])&&$.event.blur())},updateBlur(e){e&&e!==P&&P.blur();let t=w.objList;t&&Array.isArray(t)&&t.forEach((t=>{if(t){let n=t.attrs.localEvent;e!==n&&n&&n.blur&&n.blur()}}))},lock(e){g.isLock=e,g.left=w.left||"25%",g.top=w.top||"25%",g.width=w.width||"50%",g.height=w.height||"50%";let t=I.scene[$.info.theOther];t&&t.localEvent.lock(e),te(!0),Le([$,"access",e=>e.event,"optionalAccess",e=>e.lock])&&$.event.lock(e)},fullscreen(e){Le([$,"access",e=>e.event,"optionalAccess",e=>e.fullscreen])&&$.event.fullscreen(e)},resize(e){Le([$,"access",e=>e.event,"optionalAccess",e=>e.resize])&&$.event.resize(e)},music(e){Le([$,"access",e=>e.event,"optionalAccess",e=>e.music])&&$.event.music(e);let t=I.scene[$.info.theOther];t&&t.localEvent.music(e)},sound(e){Le([$,"access",e=>e.event,"optionalAccess",e=>e.sound])&&$.event.sound(e);let t=I.scene[$.info.theOther];t&&t.localEvent.sound(e)},show(e){let t=g.anim;if(t.element){if(t.isPlay&&(t.isPlay=!1),g.display="inline",g.disable=!1,g.zIndex=4,g.opacity=1,e){if(e.style){let t=e.style;g.zIndex=t.zIndex||4}e.finish&&e.finish()}w.updateStyle&&w.updateStyle(g),h.redraw()}},hide(e){let t=g.anim;if(t.element){if(t.isPlay&&(t.isPlay=!1),g.disable=!0,g.display="none",g.zIndex=2,g.opacity=0,e){if(e.style){let t=e.style;g.zIndex=t.zIndex||2}e.finish&&e.finish()}w.updateStyle&&w.updateStyle(g),h.redraw()}}};$.localEvent=P,$.setting=g,u.onfocus=onfocus,u.initGame=async function(e){g.anim.element=e.dom},u.event=P,u.setting=g,u.tray=d,u.objList=w.objList,u.updateStyle=w.updateStyle;let _=h(".");var z;"game.6.0"===g.templateVersion?$.gamecard.pixiConfig&&(_=h({oninit(){},oncreate(e){e.dom.appendChild(ye.canvas),$.ready&&$.ready(ye.game)},onremove(e){e.dom.removeChild(ye.canvas)},view:()=>h(".",{style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"}})})):"game.5.0"===g.templateVersion?$.gamecard.pixiConfig&&(_=[h(m.components.game.pixi,{id:g.id,style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"},config:$.gamecard.pixiConfig,ready:$.ready})]):_=[h("iframe",{style:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"},scrolling:"no",frameborder:0,oncreate:async function(e){await S(),x=e.dom,x.scrolling="no",x.frameborder=0;let i=x.style;if(i.width="100%",i.height="100%",i.left="0%",i.top="0%",i.position="absolute",g.isChild||(i.zIndex=2,i.display="inline"),a.isIframeInit)return;a.isIframeInit=!0,u.info.iframe=x;let o=g.id,l=g.name,r=g.group,c=g.appName,d=g.appConfig||o,p=g.devMode,f=g.background,w=g.dependence,y=null;if("object"==typeof c&&(c=g.appName[g.game.langID],c||(c=g.appName[b.EN_US])),"game.4.0"===g.templateVersion){let e=globalThis.location.origin;if(a.currentBaseURL&&(e=a.currentBaseURL),g.game.baseURL.length>0&&(e=g.game.baseURL),y={importmapName(){let e=`"${this.key}": "${this.value}"`;return this.isLast||(e+=","),e},scopemapName(){let e=`"${this.key}": "${this.value}"`;return this.isLast||(e+=","),e},appName(){let n=e;if(n.length>0&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),c){let e=c.split("/"),t=e.length-1;n=t>2?`${n}/${e[t-1]}/${e[t]}`:`${n}/${c}`}return t&&U&&(n=A),n},appIntegrity:"",id:o,name:l,group:r,jsName(){let e,t=globalThis.location.origin;return a.currentBaseURL&&(t=a.currentBaseURL),t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e=`<script src="${t}${this.pathname}"  crossorigin><\/script>`,e},background:f},w){let e=[],t=w;Object.getOwnPropertyNames(t).forEach((n=>{let i=t[n],a={};"string"==typeof i?(a.key=n,a.pathname=i):(a.key=n,a.pathname=i.pathname,a.integrity=i.integrity),e.push(a)})),e.length>0&&(e[e.length-1].isLast=!0),y.globalmap=e}if(t&&U){if(y.shimOptions="\n<script  crossorigin=\"anonymous\">\nwindow.esmsInitOptions = {\nshimMode: true, // default false\nnoLoadEventRetriggers: true, // default false\nmapOverrides: true, // default false\n\n// -- Hooks --\n// Module load error\nonerror (e) {  \n  console.log('[shims] onerror', e);\n},\n\n// resolve (id, parentUrl, resolve) {\n//   console.log('[shims] resolve ', id, parentUrl);\n//   resolve(id, parentUrl);\n// },\n\nfetch (url, options) {\n  let str = url;\n  let index = url.lastIndexOf('/');\n  let filename = url.substring(index+1);\n  index = filename.lastIndexOf('.');\n  if(index < 0) {\n    url = url + '.js';\n    filename += '.js';\n  } else {\n    let ext = filename.substring(index+1);\n    // console.log(index, ext);\n  }\n  console.log('[shims] filename', filename);\n  return fetch(url, options);\n},\n\n// meta (meta, url) {\n//   console.log('[shims] meta', meta, url);\n// },\n// onimport (url, options, parentUrl) {\n//   console.log('[shims] onimport', url, options, parentUrl);\n// }\n}\n\n<\/script>\n",y.jsImportShim='<script async src="/systemjs/es-module-shims.wasm.1.7.3.js"><\/script>',y.moduleType="module-shim",B){let e,t=[];e=Object.getOwnPropertyNames(B.imports),e.forEach((e=>{let n={},i=B.imports[e];n.key=e,n.value=i,t.push(n)})),t.length>0&&(t[t.length-1].isLast=!0),y.importmap=t,y.scopeName=M,t=[];let n=B.scopes[M];e=Object.getOwnPropertyNames(n),e.forEach((e=>{let i={},a=n[e];i.key=e,i.value=a,t.push(i)})),t.length>0&&(t[t.length-1].isLast=!0),y.scopemap=t}}else y.moduleType="module";g.rendered=s.Mustache.render(Rt(g.templateVersion),y)}else if("game.3.0"===g.templateVersion){let e=globalThis.location.origin;a.currentBaseURL&&(e=a.currentBaseURL);let t=e;if(t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),y={appName(){let e=t;return e="debug"===p?`${e}/${c}`:`${e}/${n.projectURL}${c}`,e},appIntegrity:"",id:o,name:l,group:r,jsName(){let e,n=`${t}${this.pathname}`,i="";return this.integrity&&(i=`integrity="${this.integrity}"`),this.isLast,e=`<script src="${n}" ${i} crossorigin><\/script>`,e},background:f},w){let e=[],t=w;Object.getOwnPropertyNames(t).forEach((n=>{let i=t[n],a={};"string"==typeof i?(a.key=n,a.pathname=i):(a.key=n,a.pathname=i.pathname,a.integrity=i.integrity),e.push(a)})),e.length>0&&(e[e.length-1].isLast=!0),y.importmap=e}g.rendered=s.Mustache.render(Rt(g.templateVersion),y)}else if("game.2.0"===g.templateVersion){let e=globalThis.location.origin;a.currentBaseURL&&(e=a.currentBaseURL);let t=e;t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),y={appName:c,id:o,name:l,group:r,importmapName(){let e=t;a.currentBaseURL&&(this.pathname=this.pathname.replace(n.projectURL,"/"));let i,s=`${e}${this.pathname}`;return i=`"${this.key}": "${s}"`,this.isLast||(i+=","),i},systemjsURL(){let e=`${t}/`;return e=a.currentBaseURL?`${e}systemjs/6.14.1/system.min.js`:"/systemjs/6.14.1/system.min.js",e},background:f};let i=[];if(y.importmap=i,w){let e=w;Object.getOwnPropertyNames(e).forEach((t=>{let s=e[t],o={};"string"==typeof s?(o.key=t,o.pathname=s):(o.key=t,a.currentBaseURL?o.pathname=s.pathname.replace(n.projectURL,"/"):o.pathname=s.pathname,o.integrity=s.integrity),i.push(o)}))}if(y.appName=`${r}-${o}`,"debug"===p){i.push({key:`${r}-${o}`,pathname:`${c}`});let t=e;t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),y.appName=`${t}${c}`}else{let t=e;a.currentBaseURL?(i.push({key:`${r}-${o}`,pathname:`/${c}`}),y.appName=`${t}${c}`):(i.push({key:`${r}-${o}`,pathname:`${n.projectURL}${c}`}),y.appName=`${t}${n.projectURL}${c}`)}i.length>0&&(i[i.length-1].isLast=!0),g.rendered=s.Mustache.render(Rt(g.templateVersion),y)}else if("slot.2.1"===g.templateVersion){let e="";a.currentBaseURL&&(e=a.currentBaseURL);let t=e;t&&t.length>0&&"/"===t[t.length-1]&&(t=t.substring(0,t.length-1));let i="";y={appName(){let e=t;return e=""===t?`${c}`:a.currentBaseURL?`${e}/${c}`:`${e}${n.projectURL}${c}`,e},systemjsURL(){let e=`${t}/`;return e=`${e}systemjs/system.js`,e},appConfig:()=>i,id:o,name:l,group:r,background:f},$.info.langID=g.game.langID;let u=n.projectURL;a.currentBaseURL&&(u="/");let p=`${t}${u}config/${r}/${d}/browser.config.js`;""===t&&(p=`config/${r}/${d}/browser.config.js`),fetch(p,{headers:{"Content-Type":"text/plain"}}).then((e=>e.ok?e.text():null)).then((e=>{if(!e)return null;if(i=new String(e),""!==t){let e=`${t}/dependence/`;a.currentBaseURL&&(e=`${a.currentBaseURL}dependence/`),i=i.replace("dependence/",e)}g.rendered=s.Mustache.render(Rt(g.templateVersion),y),x.src="data/template/9ef1c941a7edfbb9.html",x.addEventListener("load",(()=>{if(!a.isIframeLoaded&&(a.isIframeLoaded=!0,m.updateManager.setTimeout((()=>{let e=x.contentDocument||x.contentWindow.document;e.open(),e.write(g.rendered||"!!!! unknown template !!!!"),e.close()}),.05),a.checkItem)){let e=a.checkItem,t=Math.round(performance.now());e.timeOnload=t-a.timestamp,a.timestamp=t,e.state="web",h.redraw()}}),{capture:!0,once:!0})}))}if("slot.2.1"!==g.templateVersion){x.src="data/template/9ef1c941a7edfbb9.html";const e=()=>{if(!a.isIframeLoaded&&(a.isIframeLoaded=!0,m.updateManager.setTimeout((()=>{let e=x.contentDocument||x.contentWindow.document;e.open(),e.write(g.rendered||"!!!! unknown template !!!!"),e.close()}),.05),a.checkItem)){let e=a.checkItem,t=Math.round(performance.now());e.timeOnload=t-a.timestamp,a.timestamp=t,e.state="web",h.redraw()}};x.addEventListener("load",e,{capture:!0,once:!0})}}})],u.gamePage=_,u.info={iframe:{},token:l.info.token,gameName:g.game.name,logo:g.game.baseURL+g.game.logo,version:g.game.version||"0.9.9",open(e){g.childrenVisible=!0,g.currentUrl=e,h.redraw()}},z=$.gamecard,N=z;let D=o;l.mode===D.REAL?u.info.mode=p("gameModeReal"):u.info.mode=p("gameModeDemo"),h.redraw()},onremove(){ie(this.options.setting)},view(){let e,t=this.options,i=t.setting,a=t.objList||[];if(t.info&&t.info.iframe&&G.isMobile){t.info.iframe.style||(t.info.iframe.style={});let e=t.info.iframe.style;e.width=i.width,e.height=i.height}if(t.initGame){e=!i.isChild&&G.isMobile?(G.useFullscreen,{position:"absolute",left:"0px",top:G.currentY+"px",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"}):{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"},i.isCheckData&&(e={left:"0%",top:"0%",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"});let s="";return i.images.useBackground&&(s=i.background),h(".",{style:e},i.isChild?null:h(".center",{style:{overflowY:"hidden",position:"absolute",zIndex:1,top:"0%",left:"0%",width:`${globalThis.innerWidth}px`,height:`${globalThis.innerHeight}px`}},h(".aspect-ratio--object cover",{style:{background:`url(${s}) center`}})),h(".",{oncreate:t.initGame,style:{position:i.position,boxShadow:i.backgroundCSS,left:i.left,top:i.top,width:i.width,height:i.height,zIndex:i.zIndex||2,opacity:i.opacity,display:i.display}},t.gamePage,a.map((e=>e?(e.attrs.fix=i,e.attrs.updateBlur=t.event.updateBlur,h(e.com,e.attrs)):null)),i.sysTray&&i.sysTray.visible?h(me,{style:i.sysTray.style,config:i.sysTray}):null,i.sysTray&&i.sysTray.isMenu?h(pe,{tray:t.tray,event:t.event,info:t.info,config:i.sysTray}):null),i.childrenVisible?h(ce,{url:i.currentUrl,manager:i}):null,n.msg.length>0?h(".",{style:{position:"absolute",color:"#fff",left:"50%",top:"0%",width:"64px",height:"16px",zIndex:900}},n.msg):null)}return h(".")}},$e={oninit(e){let t=e.attrs;this.options=t.options,this.saveConfig={}},oncreate(){},view(){let e=this.options,t=e.scene.pixiConfig,n=this.saveConfig;return h("article.pa4.white",h("form",[h("fieldset.ba.b--transparent.ph0.mh0",[h("legend.ph0.mh0.fw6.white","遊戲場景設定"),h(".mt3",h("label.db.fw4.lh-copy.f6","寬"),h("input.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"width",name:"width",oninput(e){let i=e.target.value;n.width=parseInt(i),t.width=i},value:t&&t.width})),h(".mt3",h("label.db.fw4.lh-copy.f6","高"),h("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"height",name:"height",oninput(e){let i=e.target.value;n.height=parseInt(i),t.height=i},value:t&&t.height})),h(".mt3",h("label.db.fw4.lh-copy.f6","解析度"),h("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"resolution",name:"resolution",oninput(e){let i=e.target.value;n.resolution=parseFloat(i),t.resolution=i},value:t&&t.resolution})),h(".mt3",h("label.db.fw4.lh-copy.f6","是否反鋸齒"),h("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"antialias",name:"antialias",oninput(e){let i=e.target.value;n.antialias=!1,"true"===i&&(n.antialias=!0),t.antialias=i},value:t&&t.antialias})),h(".mt3",h("label.db.fw4.lh-copy.f6","是否透明"),h("input.b.pa2.input-reset.ba.bg-transparent.w-40.red",{id:"transparent",name:"transparent",oninput(e){let i=e.target.value;n.transparent=!1,"true"===i&&(n.transparent=!0),t.transparent=i},value:t&&t.transparent})),h(".mt3",h("input.b.ph3.pv2.input-reset.ba.b--black.bg-transparent.grow.pointer.f6 white",{onclick(){Object.getOwnPropertyNames(n).forEach((e=>{t[e]=n[e]})),e&&e.ready&&(e.visible=!1,e.ready())},value:"確定"}))])]))}},Ue=null,Me={oninit(e){let t=this,o=e.attrs;t.style=o.style,t.options=o.options,t.resource=o.resource,t.timeout=null,t.isLeave=!1;let l={start(){},resBegin(){},resEnd(){},sceneResBegin(){},sceneResLoading(){t.timeout&&(m.updateManager.remove(t.timeout),t.timeout=null),t.isLeave||(t.timeout=m.updateManager.setTimeout((()=>{t.isLeave=!0,t.game&&(t.game.stop(),t.game=null),t.options&&t.options.ready&&t.options.ready();let e=a;i[e.OVERVIEW_ANIMATION]=!1,i[e.OVERVIEW_PROGRESS]=!0,h.redraw(),t.timeout=null}),5))},sceneResEnd(){},finish(){t.timeout&&(m.updateManager.remove(t.timeout),t.timeout=null)}};!async function(){if(!Ue)try{const{getProject:e}=await import("./agent.d47b8ed4.js");Ue=await e("scenes/loading",{version:"2.4.0"})}catch(e){t.options&&t.options.ready&&t.options.ready();let n=a;return i[n.OVERVIEW_ANIMATION]=!1,i[n.OVERVIEW_PROGRESS]=!0,void h.redraw()}let e;try{e=await Ue.lib.scene.init({app:s,resName:"base",langID:f(),baseURL:Ue.pathname,useAvif:n.useAvif})}catch(e){}t.resource.setting=e,ne(e),t.pixiConfig=Ue.lib.scene.pixiConfig,be.engine||(t.pixiConfig.view=be.canvas,be.engine=Ce(t.pixiConfig),be.game.setEngine(be.engine)),async function(e){e.resource=o.resource,e.play(),t.game=e;try{t.scene=await Ue.lib.scene.create(e,l,m)}catch(n){t.resource.setting&&ie(t.resource.setting),e.stop(),t.options&&t.options.ready&&t.options.ready();let s=a;return i[s.OVERVIEW_ANIMATION]=!1,i[s.OVERVIEW_PROGRESS]=!0,void h.redraw()}t.options&&t.options.ready&&t.options.ready()}(be.game)}()},async oncreate(e){let t=this,n=e.dom;be.game&&be.game.layer&&(be.game.layer.background.removeChildren(),await be.game.idle(.01)),n.appendChild(be.canvas),t.resource.setting&&ne(t.resource.setting)},onremove(e){let t=this;e.dom.removeChild(be.canvas),t.resource.setting&&ie(t.resource.setting);let n=t.game;n&&n.stop()},view(){let e=this;return e.pixiConfig?h(".",{id:"loading9999",style:e.style}):h(".")}};function Ae(e){let t,n=e[0],i=1;for(;i<e.length;){const a=e[i],s=e[i+1];if(i+=2,("optionalAccess"===a||"optionalCall"===a)&&null==n)return;"access"===a||"optionalAccess"===a?(t=n,n=s(n)):"call"!==a&&"optionalCall"!==a||(n=s(((...e)=>n.call(t,...e))),t=void 0)}return n}let Be,Ne=a,Se={oninit(e){let a=this,s=e.attrs,o=s.setUpdateEvent;a.scene=s.scene,a.ready=s.ready,a.serve=s.serve,a.finish=s.finish,a.manager=s.manager;let g=i;if(!n.useOptions){let e=a.scene.options;if(e){g[Ne.OVERVIEW_LOGO]=!1,//!!overview.logo;
r.isCheckGameCDN?g[Ne.OVERVIEW_ANIMATION]=!1:g[Ne.OVERVIEW_ANIMATION]=!0,g[Ne.OVERVIEW_BACKGROUND]=!0,g[Ne.OVERVIEW_PROGRESS]=!1;let t=e.game;t&&(g[Ne.GAME_SCENE_CUSTOM]=!!t.custom,g[Ne.GAME_PERFORMANCE_FPS]=!!t.fps,g[Ne.GAME_DEBUG_MODE]=!!t.debug,g[Ne.GAME_DIALOG_CUSTOM]=!!t.useDialog)}}a.elementLogo=null,a.progress=0,a.progressValue=0,a.baseURL=a.scene.baseURL||"",le(a.scene.screen),se(),g[Ne.OVERVIEW_LOGO]&&(a.setting={id:"logo",isLock:!0,useCenter:!0,left:"25%",top:"25%",width:"50%",height:"50%",game:{width:512,height:512},reference:{left:.25,top:.25,width:.5,height:.5}});a.settingBackground={id:"background",isLock:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:10240,height:10240},reference:{left:0,top:1,width:1,height:1}},a.message="建立預覽",a.display="inline",a.isFinish=!1,a.options={scene:a.scene,visible:!0,ready:a.ready},a.scene.pixiConfig||(i[Ne.GAME_SCENE_CUSTOM]=!1);let d=r;a.manager.show=()=>{je.overview.visible=!0,h.redraw()},a.manager.hide=()=>{je.overview.visible=!1,h.redraw()},a.leave=function(){if(!r.isCheckGameCDN)if(a.isFinish=!0,d.isFinish=!0,n.isReload=!1,h.redraw(),n.disableNet){if(!je.manual.overview){let e=je.overview.manager;e.hide&&e.hide()}let e=Ot(),t={id:a.scene.id},n=e.scene[t.id];n&&n.localEvent&&n.localEvent.enter(t)}else a.title=p("connecting"),a.message=p("start"),l.isKickOut||(c.isLogin?(et(),tt()):a.serve&&kt(a.serve).then((()=>{a.title=p("quickPlay"),h.redraw()})))},a.timeout=null,o&&o({start(){a.message="開始讀取遊戲資料",h.redraw(),Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.start,"call",e=>e()])},resBegin(e){Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.resBegin,"call",t=>t(e)])},resEnd(e){Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.resEnd,"call",t=>t(e)])},sceneResBegin(e){Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.sceneResBegin,"call",t=>t(e)])},sceneResLoading(e){let s=0;if(Object.prototype.hasOwnProperty.call(e,"totalProgress")){let t=e.state,n=e.totalProgress;if(t){n=(t.currentIndex-1)/t.totals*100+n/t.totals}s=n.toFixed(0),a.progress=s,a.progressValue=.01*n}else{let t=e.current/e.length;s=(100*t).toFixed(0),a.progress=s,a.progressValue=t}a.isFinish||(a.timeout&&(m.updateManager.remove(a.timeout),a.timeout=null),t||(a.timeout=m.updateManager.setTimeout((()=>{n.isReload=!0,bt({url:a.baseURL,group:a.scene.group,game:a.scene.appConfig}),a.timeout=null}),5))),i[Ne.OVERVIEW_PROGRESS]&&h.redraw(),Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.sceneResLoading,"call",e=>e(s)])},sceneResEnd(e){Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.sceneResEnd,"call",t=>t(e)])},async finish(){if(a.timeout&&(m.updateManager.remove(a.timeout),a.timeout=null),n.requestReload)return;let e=n.store;if(e)try{await e.setItem("baseURL",globalThis.BASE_URL)}catch(e){}i[Ne.OVERVIEW_ANIMATION]&&a.animationLeave?a.animationLeave():a.leave(),Ae([d,"optionalAccess",e=>e.loadingEvent,"optionalAccess",e=>e.finish,"call",e=>e()])}})},oncreate(){let e=this;e.setting&&ne(e.setting),e.settingBackground&&ne(e.settingBackground),te(!0),n.requestReload&&(n.requestReload=!1),i[Ne.GAME_SCENE_CUSTOM]||i[Ne.OVERVIEW_ANIMATION]||e.options.ready&&e.options.ready()},onremove(){self.setting&&ie(self.setting),self.settingBackground&&ie(self.settingBackground)},onbeforeremove:e=>(["animate__animated","animate__fadeOut","animate__faster"].forEach((t=>{e.dom.classList.add(t)})),new Promise((function(t){e.dom.addEventListener("animationend",t)}))),view(){let e=this,t=r.setting,a=e.settingBackground,s=e.setting,o=e.options;e.display,t||(t={left:"0%",top:"0%",width:"0%",height:"0%"}),G.isMobile&&G.currentY;let l="",c=n.images;return c&&(l=globalThis.innerHeight>globalThis.innerWidth?c.background[`${n.agent}Portrait`]:c.background[`${n.agent}Landscape`]),globalThis.BASE_URL&&(l=globalThis.BASE_URL+"agent/"+l),h(".",{style:{display:e.display,position:"absolute",zIndex:100,left:a.left,top:`${G.currentY+parseInt(a.top)}px`,width:a.width,height:a.height}},h(".",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},h(".aspect-ratio--object cover",{style:{zIndex:0,background:`url(${l}) center`}})),i[Ne.OVERVIEW_ANIMATION]?h(".",{style:{position:"absolute",left:t.left,top:t.top,width:t.width,height:t.height}},h(Me,{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},options:o,resource:r})):null,!n.isReload&&i[Ne.OVERVIEW_LOGO]?h(".",{style:{position:"absolute",left:"25%",top:"25%",width:"50%",height:"50%"}},h("img",{oncreate(t){e.elementLogo=t.dom},src:n.logo,onload(){["animate__animated","animate__fadeIn"].forEach((t=>{e.elementLogo.classList.add(t)}))},style:{opacity:0,zIndex:700,position:"absolute",left:s.left,top:s.top,width:s.width,height:s.height}})):null,i[Ne.GAME_SCENE_CUSTOM]&&o.visible?h(".",{style:{position:"absolute",zIndex:300,left:"0%",top:"0%",width:"100%",height:"100%"}},h(".pv2 mb2 white bg-dark-green o-20",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}}),h(".",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},h($e,{options:o}))):null,i[Ne.OVERVIEW_PROGRESS]&&!e.isFinish?h(".",{style:{zIndex:100,position:"absolute",left:"10%",top:"90%",width:"80%",height:"4%"}},h("progress.progress",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"40%"},max:"100",value:`${e.progress}`}),h(".tc",{style:{position:"absolute",left:"0%",top:"30%",width:"100%",height:"60%",color:"#a0cdff"}},h("p.v-btm",`${p("loading")} ${e.progress}%`))):null)}},Fe={fatal(e){},high(e){},middle(e){},low(e){}},Pe={disableDialog:!1,handle(){let e=a;if(c.state="未連線",n.isInGame&&globalThis.scene){Object.getOwnPropertyNames(globalThis.scene).forEach((e=>{let t=globalThis.scene[e];t&&t.game&&t.game.disconnect&&t.game.disconnect()}))}Pe.disableDialog||i[e.GAME_DIALOG_CUSTOM]&&(c.isError||m.updateManager.setTimeout((()=>{c.isError||x({title:"errorLow",msg:"disconnect"})}),2))}},_e={handle(t){let n=Ot();c.state="遊戲中",Pe.disableDialog=!0,e.serviceEnd(_e.report),e.log({label:"net",category:"進入遊戲"});let i={id:t.gid};k();let a=n.scene[i.id];a&&a.localEvent&&a.localEvent.enter(i)},report:{time:0,category:"進入遊戲",getLabel:()=>"net"},error:Fe.low};let ze={position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"},De=[{style:{zIndex:10,position:"absolute",left:"5%",top:"5%",width:"30%",height:"85%"},reference:{left:.05,top:.05,width:.3,height:.85}},{style:{zIndex:10,position:"absolute",left:"35%",top:"5%",width:"30%",height:"85%"},reference:{left:.35,top:.05,width:.3,height:.85}},{style:{zIndex:10,position:"absolute",left:"65%",top:"5%",width:"30%",height:"85%"},reference:{left:.65,top:.05,width:.3,height:.85}}],je={overview:{visible:!0,manager:{}},packet:null,gid:null,manual:{overview:!1}},Ve={visible:!1},He="",Ge=[],We={oninit(e){let t=e.attrs,n=this;n.isLoading=!1;let i=t.loadingEvent,a=l,s={id:t.id,decimal:0,mode:a.mode,isCreate:!0,scene:t.scene,loadingEvent:{start(){n.isLoading=!0,i&&i.start&&i.start()},resBegin(e){i&&i.resBegin&&i.resBegin(e)},resEnd(e){i&&i.resEnd&&i.resEnd(e)},sceneResBegin(e){i&&i.sceneResBegin&&i.sceneResBegin(e)},sceneResLoading(e){i&&i.sceneResLoading&&i.sceneResLoading(e)},sceneResEnd(e){i&&i.sceneResEnd&&i.sceneResEnd(e)},finish(e){e&&e.localEvent&&(t.localEvent=e.localEvent),n.isLoading=!1,t.finish&&t.finish(e),i&&i.finish&&i.finish(e)}}};n.config=s,n.style=t.style,n.reference=t.reference,n.fix=t.fix,n.absPos=t.absPos,n.updateBlur=t.updateBlur,n.isChild=t.isChild},view(){let e=this;return h(".",{style:e.style},h(Oe,{updateStyle(t){if(t){let n=e.style;n.display=t.display||n.display,Object.prototype.hasOwnProperty.call(t,"opacity")&&(n.opacity=t.opacity),Object.prototype.hasOwnProperty.call(t,"zIndex")&&(n.zIndex=t.zIndex)}},config:e.config,currentBaseURL:globalThis.BASE_URL,left:"0%",top:"0%",width:"100%",height:"100%",reference:e.reference,updateBlur:e.updateBlur,fix:e.fix,isChild:e.isChild,absPos:e.absPos}))}},Ye={oninit(e){let t=e.attrs,n=this,i=t.sceneInfo;n.objList=t.objList,n.serve=t.serve,n.isReady=!1;let a={reload(){n.isReady=!1}},s={};let o=l,r={id:i.id,decimal:0,mode:o.mode,isCreate:!0,scene:i,loadingEvent:{start(){s.start&&s.start()},resBegin(e){s.resBegin&&s.resBegin(e)},resEnd(e){s.resEnd&&s.resEnd(e)},sceneResBegin(e){s.sceneResBegin&&s.sceneResBegin(e)},sceneResLoading(e){s.sceneResLoading&&s.sceneResLoading(e)},sceneResEnd(e){s.sceneResEnd&&s.sceneResEnd(e)},finish(){s.finish&&s.finish()}}};je.packet=null,je.gid=i.id||n.serve.id,n.setUpdateEvent=function(e){s=e},n.gameConf=r,n.sceneInfo=i,n.ctrlEvent=a,n.event={ready:function(){n.isReady=!0,h.redraw()},finish:function(){let e=It();const t=m.Lobby.CMD;e&&e.setLobbyCommand(t.IN_GAME,{packet:null,gid:i.id||n.serve.id})}}},view(){let e=this,t=e.objList,n=e.gameConf,i=e.event;return h(".",{style:ze},Ve.visible&&e.isReady?h(Oe,{currentBaseURL:globalThis.BASE_URL,sysTray:e.sceneInfo.sysTray,ctrlEvent:e.ctrlEvent,config:e.gameConf,zIndex:4,left:"0%",top:"0%",width:"100%",height:"100%",objList:t}):null,h(".",je.overview.visible?h(Se,{manager:je.overview.manager,serve:e.serve,scene:n.scene,setUpdateEvent:e.setUpdateEvent,ready(){i.ready()},finish(){i.finish()}}):null))}};async function qe(){return new Promise((e=>{Object.getOwnPropertyNames(globalThis.scene).forEach((e=>{let t=globalThis.scene[e];t&&(delete t.event,delete t.loadingEvent),delete globalThis.scene[e]})),globalThis.scene={},Tt({oncreate(){e()},view:()=>null})}))}function Xe(t){Be=n.langID,n.serve=t.serve,je.manual={overview:!1},je.overview.visible=!0,function(t){let i=null;if(t.gameCard)i=t.gameCard;else{let e;e=S(t.group),i=e[t.id]}if(!i)return;i.manual&&(je.manual=i.manual,i.manual.disableNet&&(n.disableNet=!0)),e.report.name=`${i.group}/${i.appConfig}`,He=i.group;let a=i.baseURL||"",s=i.images;if(n.useAvif?s.v2&&(s=s.v2):s.v1&&(s=s.v1),s.icon){let e=document.getElementsByTagName("link");if(e){let t=e[0];if(t)if(t.setAttribute("crossorigin","icon"),t.setAttribute("rel","icon"),t.setAttribute("type","image/png"),"kc"===n.agent){let e="data/img/logo/kc/87faada2e433ffce.ico";t.setAttribute("href",e)}else t.setAttribute("href",a+s.icon)}}let o=i.app;"object"==typeof o&&(o=o[Be]),i.name[Be]?document.title=i.name[Be]:document.title=i.name[b.EN],Ve.objList=Ge,Ve.sceneInfo=i,Ve.serve=t.serve,Ve.visible=!0,Tt(Ye,Ve)}(t)}function Ke(e,t=0){let i=e,a=t;"number"==typeof e&&(i=t,a=e);let s=i.groupName||He;return F(i.sceneID,s,globalThis.BASE_URL).then((e=>{let t=De[a],s=e.gameCard;if(!s)return;i.reloadConfig&&(s.reloadConfig=i.reloadConfig),t||(t={style:ze,reference:{left:0,top:0,width:1,height:1}});let o={com:We,attrs:{loadingEvent:i.loadingEvent,index:a,style:i.style||t.style,reference:i.reference||t.reference,absPos:i.absPos||t.absPos,id:i.id,scene:s,isChild:!0,finish:function(e){n.isReload||i.finish&&i.finish(e)}}};n.isReload||(null!==Ge[a]?(Ge[a]=null,h.redraw(),m.updateManager.setTimeout((()=>{Ge[a]=o,h.redraw()}),.1)):(Ge[a]=o,h.redraw()))}))}function Je(e){Ge[e]=null,h.redraw()}function Qe(){Ge=[],Ve.visible=!0,h.redraw()}let Ze=!1;function et(){Ze=!1}function tt(){let t=It();const i=m.Lobby.CMD;let a=je;if(Ze)return!0;let s=n,o=c;if(m.updateManager.setTimeout((()=>{"遊戲中"!==o.state&&(globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),x({title:"connecting",msg:"disconnect"}))}),.001*g),s.module?import("./agent.8988730e.js").then((e=>{e.ingame({name:l.game,group:l.group,gid:a.gid})})):(t&&t.setLobbyCommand(i.IN_GAME,{packet:a.packet,gid:a.gid}),e.serviceBegin(_e.report)),Ze=!0,!a.manual.overview){let e=a.overview.manager;e.hide&&e.hide()}return!0}var nt=Object.freeze({__proto__:null,clean:Qe,create:Ke,currentGame:je,destroy:Je,enterGame:tt,imgWaiting:function(){return'<svg class="hourglass" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 206" preserveAspectRatio="none">\n  <path class="middle" d="M120 0H0v206h120V0zM77.1 133.2C87.5 140.9 92 145 92 152.6V178H28v-25.4c0-7.6 4.5-11.7 14.9-19.4 6-4.5 13-9.6 17.1-17 4.1 7.4 11.1 12.6 17.1 17zM60 89.7c-4.1-7.3-11.1-12.5-17.1-17C32.5 65.1 28 61 28 53.4V28h64v25.4c0 7.6-4.5 11.7-14.9 19.4-6 4.4-13 9.6-17.1 16.9z"/>\n  <path class="outer" d="M93.7 95.3c10.5-7.7 26.3-19.4 26.3-41.9V0H0v53.4c0 22.5 15.8 34.2 26.3 41.9 3 2.2 7.9 5.8 9 7.7-1.1 1.9-6 5.5-9 7.7C15.8 118.4 0 130.1 0 152.6V206h120v-53.4c0-22.5-15.8-34.2-26.3-41.9-3-2.2-7.9-5.8-9-7.7 1.1-2 6-5.5 9-7.7zM70.6 103c0 18 35.4 21.8 35.4 49.6V192H14v-39.4c0-27.9 35.4-31.6 35.4-49.6S14 81.2 14 53.4V14h92v39.4C106 81.2 70.6 85 70.6 103z"/>\n</svg>'},init:Xe,get isInGame(){return Ze},reload:qe,reset:et});let it={oninit(e){let t=e.attrs,n=t.strings,i=t.dspScreen,a=t.gameManager;this.strings=n,this.dspScreen=i,t.yesno||a.clean(),this.title=t.title,this.msg=t.msg,this.setting={id:"dialog",isLock:!1,useCenter:!1,left:"0%",top:"0%",width:"100%",height:"100%",game:{width:1024,height:1024},reference:{left:0,top:0,width:1,height:1}},i.addSetting(this.setting)},oncreate(){},view(){let e=this,t=e.setting,n=null,i=e.strings,a=e.dspScreen;return n=a.state.isMobile?{position:"absolute",left:t.left,top:a.state.currentY+"px",backgroundColor:"rgba(0,0,0,1)",zIndex:990,opacity:1,width:t.width,height:t.height}:{position:"absolute",left:t.left,top:t.top,backgroundColor:"rgba(0,0,0,1)",zIndex:990,opacity:1,width:t.width,height:t.height},h(".",{style:n},h(".bg-moon-gray ba bw1",{style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"75%"}},h(".bg-near-black white f4 fw6 pa4",{style:{position:"absolute",left:"0%",top:"0%",width:"100%",height:"20%"}},h(".tc",i.get(e.title)||"title")),h(".tc pa5",{style:{position:"absolute",left:"0%",top:"20%",width:"100%",height:"50%"}},h.trust(i.get(e.msg))||"body message")))}},at={oninit(){let e=this;e.timeValue=-1,e.touchmoveOnce=!1,e.fields=["一","二","三","四","五","六","七","八","九","十","一","二","三","四","五","六","七","八","九","十"],e.pageY=0,e.imgRotate={id:"rotate",isLock:!0,useCenter:!0,left:"10%",top:"10",width:"80%",height:"80%",game:{width:5120,height:5120},reference:{left:0,top:0,width:1,height:1}},e.imgFullscreen={id:"screen",isLock:!0,useCenter:!0,left:"10%",top:"10",width:"80%",height:"80%",game:{width:5120,height:5120},reference:{left:0,top:0,width:1,height:1}}},view(){let e=this,t=G,n=t.orientation,i=globalThis.innerWidth,a=globalThis.innerHeight;return n.isTrigger&&(i*=2.5,a*=2.5),t.isMobile&&t.currentY,[t.isTouchOnce&&t.isFullscreen?null:h(".",{style:{zIndex:850,position:"absolute",left:"0%",top:t.currentY+"px",width:(i||t.screenWidth)+"px",height:(a||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"},ontouchmove(e){G.isMobile&&!G.ios&&e.preventDefault()},ontouchend(){if(globalThis.Howl){let e=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]});e&&(e.volume(.001),e.play())}if(t.isFullscreen=!0,t.isTouchDown=!1,t.isTouchOnce=!0,G.ios){let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let n=e[t.id];if(n){(n.game&&n.game.sysTray).isFullscreen=!1}}})),h.redraw(),te(),t.mobileReady&&t.mobileReady()}else ue().then((()=>{let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let n=e[t.id];if(n){(n.game&&n.game.sysTray).isFullscreen=!0}}})),h.redraw(),te(),t.mobileReady&&t.mobileReady()})).catch((()=>{let e=globalThis.scene;t.settingList.forEach((t=>{if(e){let n=e[t.id];if(n){(n.game&&n.game.sysTray).isFullscreen=!1}}})),h.redraw(),te(),t.mobileReady&&t.mobileReady()}))},ontouchstart(n){if(globalThis.Howl){let e=new globalThis.Howl({src:["data/f82550ea2e80cd97.wav"]});e.volume(.001),e.play()}if(t.isTouchDown)return;t.isTouchDown=!0;let i=n.changedTouches||n.originalEvent.touches;if(i){let t=i[0];e.pageY=t.pageY}}},h(".",{oncreate(){ne(e.imgFullscreen)},onremove(){ie(e.imgFullscreen)},style:{position:"absolute",left:"10%",top:"10%",width:"80%",height:"80%"}},h("img",{src:"data/img/c7aecda7af142624.png",style:{position:"absolute",zIndex:850,left:e.imgFullscreen.left,top:e.imgFullscreen.top,width:e.imgFullscreen.width,height:e.imgFullscreen.height}}))),!n.isTrigger&&t.useOrientation&&t.usePortrait&&!t.isPortrait?h(".",{oncreate(){ne(e.imgRotate),te(!0)},onremove(){ie(e.imgRotate)},style:{zIndex:800,position:"absolute",left:"0px",top:globalThis.pageYOffset+"px",width:(globalThis.innerWidth||t.screenWidth)+"px",height:(globalThis.innerHeight||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"}},h("img",{src:"data/img/f14a0482453bcc34.png",style:{position:"absolute",left:e.imgRotate.left,top:e.imgRotate.top,width:e.imgRotate.width,height:e.imgRotate.height}})):null,!n.isTrigger&&t.useOrientation&&t.useLandscape&&!t.isLandscape?h(".",{oncreate(){ne(e.imgRotate),te(!0)},onremove(){ie(e.imgRotate)},style:{zIndex:800,position:"absolute",left:"0px",top:globalThis.pageYOffset+"px",width:(globalThis.innerWidth||t.screenWidth)+"px",height:(globalThis.innerHeight||t.screenHeight)+"px",backgroundColor:"rgba(0,0,0,1)"}},h("img",{src:"data/img/b4c0d11274ffa254.gif",style:{position:"absolute",left:e.imgRotate.left,top:e.imgRotate.top,width:e.imgRotate.width,height:e.imgRotate.height}})):null]}},st={"game.2.0":'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <title>game 2.0 {{{name}}}</title>\n\n  <script type="systemjs-importmap" crossorigin="anonymous">\n    {\n      "imports": {\n      {{#importmap}}\n        {{{importmapName}}}\n      {{/importmap}}\n      }\n    }\n  <\/script>\n\n</head>\n<body id="{{{id}}}" style="height:100%;width:100%;overflow-x:hidden;overflow-y:hidden">\n<script crossorigin="anonymous">\n  if(!window.globalThis) {\n    window.globalThis = window;\n  }\n\n  let isInitCache = false;\n  function initCache () {\n    if(isInitCache) {\n      return;\n    }\n    isInitCache = true;\n    let isLoaded = false;\n    let registration = null;\n    function loadScript() {\n      if(isLoaded) {\n        return;\n      }\n      isLoaded = true;\n      let script = document.createElement(\'script\');\n      script.onload = function() {\n        System.import("{{{appName}}}");\n      };\n      script.src = "{{{systemjsURL}}}";\n      document.getElementsByTagName(\'head\')[0].appendChild(script);\n    }\n    loadScript();\n  }\n  initCache();\n\n<\/script>\n</body>\n</html>\n',"game.3.0":'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <title>game 3.0 {{{name}}}</title>\n\n  {{#importmap}}\n  {{{jsName}}}\n  {{/importmap}}\n\n</head>\n<body id="{{{id}}}" style="height:100%;width:100%;overflow-x:hidden;overflow-y:hidden">\n<script crossorigin="anonymous">\n  if(!window.globalThis) {\n    window.globalThis = window;\n  }\n\n  let isInitCache = false;\n  function initCache () {\n    if(isInitCache) {\n      return;\n    }\n    isInitCache = true;\n    let isLoaded = false;\n    let registration = null;\n    function loadScript() {\n      if(isLoaded) {\n        return;\n      }\n      isLoaded = true;\n      let script = document.createElement(\'script\');\n      script.onload = function() {\n      };\n      script.src = "{{{appName}}}";\n      script.crossorigin = "anonymous";\n      document.getElementsByTagName(\'head\')[0].appendChild(script);\n    }\n    loadScript();\n  }\n\n  initCache();\n<\/script>\n</body>\n</html>\n',"game.4.0":'<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <title>game 4.0 {{{name}}}</title>\n\n  <script crossorigin="anonymous">\n    if(!window.globalThis) {\n      window.globalThis = window;\n    }\n  <\/script>\n  {{{shimOptions}}}\n  {{{jsImportShim}}}\n\n  {{#globalmap}}\n  {{{jsName}}}\n  {{/globalmap}}\n\n  {{#importmap}}\n  <script type="importmap-shim">\n  {\n    "imports": {\n      {{{importmapName}}}\n    },\n    "scopes": {\n      "{{{scopeName}}}": {\n        {{#scopemap}}\n        {{{scopemapName}}}\n        {{/scopemap}}\n      }\n    }\n  }\n  <\/script>\n  {{/importmap}}\n\n</head>\n<body id="{{{id}}}" style="height:100%;width:100%;overflow-x:hidden;overflow-y:hidden">\n  <script crossorigin="anonymous" type="{{{moduleType}}}">\n    import "{{{appName}}}";\n  <\/script>\n</body>\n</html>\n',"slot.2.1":'<!DOCTYPE html>\n<html>\n  <head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n  <title>slot.2.1 {{{name}}}</title>\n  </head>\n  <body id="{{{id}}}" style="height:100%;width:100%;overflow-x:hidden;overflow-y:hidden">\n  <script crossorigin="anonymous">\n  if(!window.globalThis) {\n    window.globalThis = window;\n  }\n\n  let isInitCache = false;\n  function initCache () {\n    if(isInitCache) {\n      return;\n    }\n    isInitCache = true;\n    let isLoaded = false;\n    let registration = null;\n    function loadScript() {\n      if(isLoaded) {\n        return;\n      }\n      isLoaded = true;\n      let script = document.createElement(\'script\');\n      script.onload = function() {\n        {{{appConfig}}}\n        ;System.import(\'{{{appName}}}\');\n\n      };\n      script.src = "{{{systemjsURL}}}";\n      script.crossorigin = "anonymous";\n      document.getElementsByTagName(\'head\')[0].appendChild(script);\n    }\n    loadScript();\n  }\n\n  initCache();\n  <\/script>  \n  </body>\n</html>\n'};let ot={oninit(t){let i=this,a=t.attrs,s={category:"測試CDN 主網址",getLabel:()=>"common"};e.loadBegin(s),i.cdnList=n.cdnList,i.server=l,i.ready=a.ready;let o=[];i.gamecdnFields=o,i.isFinish=!1;let r=0,c=i.cdnList.length;function g(e){r+=1,r>=c&&(i.server.cdn.errorCounts+=1,i.server.cdn.errorCounts<3?(n.requestReload=!1,n.isReload=!0,bt({url:e.target,group:e.group,game:e.appConfig||e.game})):(n.hasCDN=!1,x({yesno:!1,title:"service",msg:"errorCDN"})))}function d(t){i.isFinish||(i.isFinish=!0,t.isLight=!0,n.isCheckGameCDN=!1,i.server.cdn.errorCounts=0,e.loadEnd(s),e.log({label:"common",category:"測試CDN 主網址"}),i.ready&&i.ready(t.target))}n.isCheckGameCDN=!0,i.cdnList.forEach(((e,t)=>{let a={};a.index=t,a.isLight=!1,a.id=e.id,a.url=e.url,a.target=e.target,a.timestamp=Math.round(performance.now()),a.timeOnload=0,a.timeInit=0,a.timeScene=0,a.timeReady=9999,a.gamecard=null,a.icon="",a.isIconLoaded=!1,a.downloadEnabled=!1,a.loadingEvent={},a.ready=d,a.error=g,a.useTest=!0,o.push(a),async function(e,t,i){let a="",s=null,o=null,l=t.target,r=!1,c=f(),g=(new Date).getTime();t.group=e.group,t.game=e.game;try{if(a=e.version?`${l}${e.group}/${e.game}/config/v${e.version}`:`${l}${e.group}/${e.game}/config/gamecard.txt?v=${g}`,s=await fetch(a,{headers:{"Content-Type":"text/plain"}}),!i&&!n.isCheckGameCDN)return null;s.ok&&(o=await s.text())}catch(e){}if(!o)try{if(a=`${l}config/${e.group}/${e.game}/gamecard.txt?v=${g}`,s=await fetch(a,{headers:{"Content-Type":"text/plain"}}),!i&&!n.isCheckGameCDN)return null;s.ok&&(o=await s.text(),r=!0)}catch(e){}let d=null;if(o){d=JSON.parse(o);let a=d.images;n.useAvif?a.v2&&(a=a.v2):a.v1&&(a=a.v1);let g=null;r?(d.templateVersion="slot.2.1",g=`${l}${a.icon}`):g=`${l}${e.group}/${e.game}/${a.icon}`;let u="";"string"==typeof d.name?u+=d.name+" ":u+=d.name[c]+" ";let h=null;if("string"==typeof d.app?(h=`${l}${d.app}`,u+=d.app):(h=`${l}${d.app[c]}`,u+=d.app[c]),t.app=u,t.version=d.version,t.icon=g,t.downloadEnabled=!0,t.appConfig=d.appConfig,t.gamecard=d,t.useTest){if(h){if(s=await fetch(h),!i&&!n.isCheckGameCDN)return null;if(!s.ok)return t.error&&t.error(t),null}if(g){if(s=await fetch(g),!i&&!n.isCheckGameCDN)return null;if(!s.ok)return t.error&&t.error(t),null}t.timeReady=Math.round(performance.now()-t.timestamp),t.ready&&t.ready(t)}}else t.app="",t.version="",t.gamecard=null,t.error&&t.error(t);h.redraw()}(i.server,a)}))},oncreate(){},view:()=>h(".",{left:"0%",right:"0%",width:"100%",height:"100%",position:"absolute",zIndex:0},h(".tmp",h(".cssload-loader",h.trust('<svg class="cssload-logo" height="200" width="200"><text x="49%" y="56%" dominant-baseline="middle" text-anchor="middle" fill="#1375ff">Loading</text></svg>'),h(".cssload-inner cssload-one"),h(".cssload-inner cssload-two"),h(".cssload-inner cssload-three"))),h(".",{style:{opacity:0,left:"0%",right:"0%",width:"1px",height:"1px",position:"absolute",zIndex:0}},h("article.dt.w-100.bb.b--black-05.pb2.mt2",h("div.dtc.v-mid.pl3",h("h1.f6.f5-ns.fw6.lh-title.white.mv1.tc","檢測服務線路"),h("h2.f6.fw4.mt1.mb1.green.tc","使用的線路")))))},lt=!1,rt=["一","二","三","四","五","六","七","八","九","十","一","二","三","四","五","六","七","八","九","十"],ct=!0,gt=null,dt=null,ut=null,ht=!1,mt=null,pt=null,ft=null;async function bt(t){if(!n.requestReload){let i={eventName:`CDN ${t.url}`,category:"服務線路錯誤",label:`${t.group}${t.game}`};e.error(i),globalThis.scene={},n.requestReload=!0,n.cdnList=[],n.hasCDN=!1,n.selectCDN=!1,dt=null,h.redraw();let a=async function(){ft&&(await ft(),0===n.cdnList.length?xt({element:document.body}):h.redraw())};m.updateManager.setTimeout((()=>{a()}),.1)}}async function wt(e){ht=!0,mt=e||{},pt=await import("./agent.a84d08e2.js"),h.redraw()}function yt(){ht=!1,h.redraw()}let vt={ready(t){globalThis.BASE_URL=t,e.report.currentURL=t,n.selectCDN=!0,globalThis.scene={},h.redraw();let i=l;F(i.game,i.group,t).then((e=>{e&&e.gameCard&&Xe({gameCard:e.gameCard,serve:i,id:i.game,group:i.group})}))}},Ct={context:null,view:()=>ct?n.hasCDN&&!n.selectCDN?h(".basic",h(ot,vt)):h(".basic",G.isMobile?h(".",{style:{zIndex:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},G.orientation.isTrigger?null:rt.map((()=>h(".ba h-25 black tc",{style:{opacity:0}},"")))):null,dt?h(dt,ut):null,G.isMobile?h(at):null,C()?h(it,{strings:w,dspScreen:re,gameManager:nt,title:T(),msg:R()}):null,ht&&pt?h(pt.Component,mt):null):n.hasCDN&&!n.selectCDN?h(".basic#root",h(ot,vt)):h(".basic#root",[G.isMobile?h(".",{style:{zIndex:0,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"}},G.orientation.isTrigger?null:rt.map((()=>h(".ba h-25 black tc",{style:{opacity:0}},"")))):null,dt?h(dt,ut):null,G.isMobile?h(at):null,C()?h(it,{strings:w,dspScreen:re,gameManager:nt,title:T(),msg:R()}):null,ht&&pt?h(pt.Component,mt):null])};function Lt(e){ct=e}function Tt(e,t){dt=e,ut=t,h.redraw()}let Et={};function Rt(e){return Et[e]}async function xt(e){let i=l;ft=e.checkCDN;let a=globalThis;a.addEventListener&&(a.addEventListener("beforeunload",(e=>{})),a.addEventListener("unload",(()=>{}))),a.scene={},a.game={},Et["game.2.0"]=st["game.2.0"],Et["game.3.0"]=st["game.3.0"],Et["game.4.0"]=st["game.4.0"],Et["slot.2.1"]=st["slot.2.1"],function(){if(ve)return;ve=!0;let e="position: absolute; left: 0%; top: 0%; width: 100%; height: 100%;";be.canvas=document.createElement("canvas"),be.canvas.style=e,be.game=new m.GameBase.Base,be.game.init({view:be.canvas}),we.canvas=document.createElement("canvas"),we.canvas.style=e,we.game=new m.GameBase.Base,we.game.init({view:we.canvas}),ye.canvas=document.createElement("canvas"),ye.canvas.style=e,ye.game=new m.GameBase.Base,ye.game.init({view:ye.canvas})}();let r={game:i.game,group:i.group};if(i.group&&i.game||!u){if(Lt(!1),!n.hasCDN){let e=globalThis.BASE_URL,t=n.version;F(r.game,r.group,e,t).then((e=>{e&&e.gameCard&&Xe({gameCard:e.gameCard,serve:r,id:r.game,group:r.group})}))}}else dt=D;let c=o;if(i.mode===c.DEMO){let e=840;m.updateManager.setTimeout((()=>{globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),x({title:"gameModeDemo",msg:"demoTimeout"})}),e)}if(h.mount(e.element,Ct),!t)try{let e=(0,s.decode)(l.key);Date.now()-1e3*e.exp>0&&(l.isKickOut=!0,x({title:"exitGame",msg:"kickOut"}))}catch(e){}}function kt(e){let t=l;if(lt){return new Promise((e=>{let n=t.info;gt&&(gt.login(n),e(gt))}))}return lt=!0,e&&(t.game=e.game||t.game,t.group=e.group||t.group,t.host=e.host||t.host),new Promise((e=>{let i=globalThis;i.lobby={currentUser:{},table:{},net:{}},n.module?import("./agent.fa929c01.js").then((n=>{let a=n.create();i.lobby.net.gameCommand=a;(()=>{t.host.indexOf("://")<0&&(t.host=`wss://${t.host}`);let n=t.info,i=t.host,a=t.protocol,s=t.gameFormat,o={hostname:i};import("./agent.8988730e.js").then((t=>{t.init({gameFormat:s,protocol:a}).then((()=>{t.connect(o).then((()=>{(async function(e){try{let t=await import("./agent.8988730e.js");return await t.login(e)}catch(e){}})(n).then((()=>{e(null)}))}))}))}))})()})):(gt=new m.Lobby({},"/"+t.namespace),gt.init(),import("./agent.2a85791a.js").then((n=>{let i=globalThis,a=c,s=n.getCommandList(d);gt.setEventMap(s),gt.setSendEvent(n.getSendEvent()),a.state="連線中",h.redraw();let o={};o.send=gt.setGameCommand,o.registerGameEvent=gt.registerGameEvent,o.unregisterGameEvent=gt.unregisterGameEvent,i.lobby.net.gameCommand=o,i.lobby.net.setLobbyCommand=gt.setLobbyCommand,i.lobby.net.CMD=m.Lobby.CMD,i.lobby.setEvent=n.setEvent,t.host&&gt.setHost(t.host);let l=m.updateManager.setTimeout((()=>{"連線中"===a.state&&(globalThis.Howler&&(globalThis.Howler.mute(!0),globalThis.Howler.unload()),x({title:"connecting",msg:"disconnect"}))}),.001*g);gt.connect({connect(){l&&(m.updateManager.remove(l),l=null),e(gt)},disconnect(){l&&(m.updateManager.remove(l),l=null)}})})))}))}function It(){return gt}function Ot(){return globalThis}var $t=Object.freeze({__proto__:null,autoLogin:kt,getCurrentContext:function(){return dt},getGameTemplate:Rt,getLobby:It,getManager:Ot,hideInfo:yt,reload:bt,resetCache:function(){if(n.useCache){let e=n.registration;if(e&&e.active&&navigator.serviceWorker.controller){let e={reset:"games"};navigator.serviceWorker.controller.postMessage(e)}}},run:xt,setAccountVisible:Lt,setCurrentContext:Tt,setKey:function(e){l.key=e},showGameList:function(){dt=D},showInfo:wt});export{_e as C,ne as a,x as b,I as c,ie as d,te as e,k as f,tt as g,yt as h,Ot as i,It as j,Fe as k,Pe as l,$t as m,G as s};
