import{b as e,s as t,i as o}from"./agent.4720ff0b.js";import"mithril";import"localforage";let r="filename",i="blob",l={"video/photos":1,"video/domains":1,"video/player":1,"video/player2":1,"scenes/loading":1,"lib/264":1,"lib/player":1};async function a(e,o){let a=globalThis.BASE_URL,n=null,s=null,c=null;if(!t.versionTimestamp){let e=new Date;t.versionTimestamp=e.getTime()}let m=t.versionTimestamp;if(o&&(o.mode&&(n=o.mode),o.version&&(s=o.version)),l[e])try{c=import.meta.resolve(e)}catch(e){}let p=`${t.projectURL}${e}`;if(a&&a.length>0&&("/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),p=p.replace(t.projectURL,"/"),p=`${a}${p}`),!c){let e=null;if(e=s?await fetch(`${p}/v${s}.json`):await fetch(`${p}/index.json?v=${m}`),e&&e.ok){let t=await e.json();c=t.isDebug?t.app:`${p}/${t.app.replace("./","")}`}}if(c){if(n){if(n===r)return{root:a,filename:c,pathname:p};if(n===i){let e=await fetch(c,{credentials:"omit"});if(e&&e.ok){let t=await e.text(),o=new Blob([t]);return{root:a,blob:o,blobURL:globalThis.URL.createObjectURL(o),pathname:p}}return Promise.reject(new Error("getProject error"))}}return{root:a,lib:await import(c),pathname:p}}return Promise.reject(new Error("getProject error"))}async function n(e){return new Promise(((t,o)=>{let r=document.createElement("script");r.type="text/javascript",r.src=e,r.onload=()=>{t()},r.onerror=()=>{o()},document.body.appendChild(r)}))}async function s(){let o,r="/dependence/";t.selectCDN&&(r=`${globalThis.BASE_URL}dependence/`),o=["socket.io/socket.io.min.2.4.0.js"];let i=[];for(let e=0;e<o.length;e++){let t=n(r+o[e]);i.push(t)}await Promise.all(i);let l=await import("foot");await import("tweenjs"),e.Howl=l.Howl,e.Howler=l.Howler,e.IsMobile=l.IsMobile,e.Mustache=l.Mustache,e.decode=l.decode}export{a as getProject,s as load};
