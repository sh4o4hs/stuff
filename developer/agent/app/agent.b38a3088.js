let e=null;function t(t){e=t.io}class n{constructor(t,n=""){let s={event:t&&t.event,socket:null,cmdList:t&&t.commandList,isConnect:!1,host:t&&t.host,roomName:n};this.isConnect=()=>s.isConnect,this.setHost=e=>s.host=e,this.setCommandList=e=>s.cmdList=e,this.registerCommand=(e,t)=>{let n=s.socket;n&&n.on(e,t)},this.sendCommand=(e,t)=>{let n=s.socket;n&&n.compress(!0).emit(e,t)},this.setEvent=e=>{s.event=e},this.connect=t=>{let n,a=s.cmdList;if(s.socket)return!1;n=e(s.host+s.roomName,{transports:["websocket"]});let r={};if(t?(s.event=t,r.connect=t.connect,r.disconnect=t.disconnect):s.event&&(r.connect=s.event.connect,r.disconnect=s.event.disconnect),s.socket=n,n.on("connect",(()=>{s.isConnect=!0,r.connect&&(r.connect(),r.connect=null)})),n.on("disconnect",(()=>{s.isConnect=!1,r.disconnect&&(r.disconnect(),r.disconnect=null)})),a){Object.getOwnPropertyNames(a).forEach((e=>{n.on(e,a[e])}))}return!0},this.disconnect=()=>{let e=s.socket;e&&e.disconnect()}}}var s=Object.freeze({__proto__:null,init:t,Network:n});let a,r,i;class o{static init(e){a=e.CMD,r=e.RESULT,i=e.STATE}static create(e){let t,n=e.lobbyBuffer,s=e.gameBuffer,o=null,l={cmdList:null,gameProc:null,setEventMap(e){o=e}};t=(e=>{let t={},c=e.gameEvent;return t.checkData=(e,t,n,s)=>{let a=i.OK;return t.resultCode!==r.OK?(a=i.ERROR,s&&s.error&&s.error(t)):s&&s.handle&&s.handle(t),a},t.gameProc=e=>{let t=c[e.gid];t&&t.recvGameData&&t.recvGameData(e.packet)},t.broadcastProc=e=>{Object.getOwnPropertyNames(c).forEach((t=>{let n=c[t];n&&n.recvBroadcast&&n.recvBroadcast(e)}))},l.gameProc=t.gameProc,{connect(e){let t=o&&o.connect;t&&t.handle&&t.handle(e)},reconnect(e){let t=o&&o.reconnect;t&&t.handle&&t.handle(e)},login(s){let r=o&&o.login;t.checkData(a.LOGIN,s,n,r)&&(e.connectionToken=s.connectionToken)},relogin(s){let r=o&&o.relogin;t.checkData(a.RELOGIN,s,n,r)&&(e.connectionToken=s.connectionToken)},inGame(e){let s=o&&o.inGame;t.checkData(a.IN_GAME,e,n,s)},exitGame(e){let s=o&&o.exitGame;t.checkData(a.EXIT_GAME,e,n,s)},toGame(e){let n=o&&o.toGame;t.checkData(a.TO_GAME,e,s,n),t.gameProc(e)},broadCastMsg(e){let n=o&&o.broadcast;n&&n.handle&&n.handle(e),t.broadcastProc(e)},ping(e){let t=o&&o.ping;t&&t.handle&&t.handle(e)},pong(e){let t=o&&o.pong;t&&t.handle&&t.handle(e)},disconnectMsg(e){let t=o&&o.disconnectMsg;t&&t.handle&&t.handle(e)},disconnect(e){let t=o&&o.disconnect;t&&t.handle&&t.handle(e)}}})(e),l.cmdList=t,e.commandManager=l}}let l=null,c=[],u=[],h=!1;function m(e){let t=!1;return e&&e.update&&(Object.prototype.hasOwnProperty.call(e,"__updateIndex")||(e.__updateIndex=c.length,c.push(e),t=!0)),t}function d(e){let t,n,s=c.length;if("number"==typeof e.__updateIndex){if(t=e.__updateIndex,t>=0&&t<s){let e=s-1;n=c[e],c[t]=n,n.__updateIndex=t,c.splice(e,1)}delete e.__updateIndex}}function p(e,t){let n={currentTime:0,func:e,update:e=>{n.currentTime>=t&&(d(n),n.func&&n.func(n.currentTime)),n.currentTime+=e}};return m(n),n}function g(e,t){let n={currentTime:0,func:e,update:e=>{n.currentTime+=e,n.currentTime>=t&&(n.func&&n.func(n.currentTime),n.currentTime=0)}};return m(n),n}function f(e){e&&e.update&&(u.push(e),h=!0)}function y(){c.forEach((e=>{delete e.__updateIndex})),c=[]}let b=-1;function x(e){let t,n=.001*performance.now();e.paused||(b<0?(t=0,b=n):(t=n-b,b=n),function(e){h&&(u.forEach((t=>{t.update(e),t.pause&&t.pause()})),u=[],h=!1),c.forEach((t=>{t.update(e)}))}(t))}let v=!1,T=!1;function I(){T||(T=!0,l=globalThis.createjs.Ticker,l.timingMode=l.TIMEOUT,l.interval=1e3/60,l.addEventListener("tick",x),y())}function E(){v||(v=!0,b=-1,l.paused=!1)}var S=Object.freeze({__proto__:null,add:m,remove:d,setTimeout:p,idle:function(e){return new Promise((t=>{p((function(){t()}),e)}))},setInterval:g,clearInterval:function(e){d(e)},once:f,reset:y,init:I,play:E,pause:function(){v&&(v=!1,l.paused=!0)}});const P="login",w="relogin",R="toGame",C={ERROR:"error",CONNECT:"connect",RECONNECT:"reconnect",LOGIN:P,RELOGIN:w,IN_GAME:"inGame",EXIT_GAME:"exitGame",TO_GAME:R,BROADCAST:"broadCastMsg",DISCONNECT_MSG:"disconnectMsg",DISCONNECT:"disconnect"},N={ERROR:0,OK:1},j={SEND_LOCK:-3,CONNECT_TIMEOUT:-2,BUFFER_FULL:-1,ERROR:0,OK:1,LOGIN:3,ROOM:4,CONNECT:2};class L extends n{constructor(e,t){let n={gameEvent:{},sendEvent:{},commandManager:null,connectionToken:null,timer:null,login:null,game:{configMap:{},template:null},lobbyBuffer:{sendCommandList:[],token:null},gameBuffer:{sendCommandList:[],token:null}};super(e,t);let s=this;o.init({CMD:C,RESULT:N,STATE:j}),n.timer||(n.timer=g((function(){let e,t=n.lobbyBuffer,a=n.gameBuffer,r=t.sendCommandList;r.length>0&&(e=r.shift(),s.sendLobbyCommand(e)),r=a.sendCommandList,r.length>0&&(e=r.shift(),s.sendGameCommand(e))}),.1)),this.init=()=>{o.create(n),s.setCommandList(n.commandManager.cmdList)},this.getGame=()=>n.game,this.getCommandManager=()=>n.commandManager,this.gameProc=e=>{n.commandManager&&n.commandManager.gameProc(e)},this.setEventMap=e=>{n.commandManager&&n.commandManager.setEventMap(e)},this.setSendEvent=e=>{n.sendEvent.game=e.game},this.login=e=>{let t=e;s.sendCommand(P,t)},this.relogin=()=>{let e={connectionToken:n.connectionToken};s.sendCommand(w,e)},this.registerGameEvent=(e,t)=>{t&&(n.gameEvent[t]=e)},this.unregisterGameEvent=e=>{n.gameEvent[e]=null},this.setLobbyCommand=(e,t)=>(n.lobbyBuffer.sendCommandList.push({name:e,data:t}),j.OK),this.sendLobbyCommand=e=>{s.sendCommand(e.name,e.data)},this.setGameCommand=(e,t)=>(n.gameBuffer.sendCommandList.push({gid:t,packet:e}),j.OK),this.sendGameCommand=e=>{let t=e.packet;"object"==typeof t.data&&(t.data=JSON.stringify(t.data));let a={gid:e.gid,packet:e.packet};s.sendCommand(R,a),n.sendEvent.game&&n.sendEvent.game(e.gid)}}static get STATE(){return j}static get CMD(){return C}static get RESULT(){return N}}function O(e,t){let n=e;if(n){let s=t&&t.split(".");s&&s.every((e=>{let t=n[e];return t?(n=t,!0):(n=null,!1)})),n===e&&(n=null)}return n}function _(e){return class extends e{constructor(e){super(e,!1),this.cloneIndex=0}clone(){this.cloneIndex+=1}addToScene(e){e.addChild(this)}removeFromScene(){this.parent&&this.parent.removeChild(this)}reload(){let e=this,t=e._game.textures,n=e.conf.resource,s=O(t,n.group);s&&(e.texture=s[n.name]||PIXI.Texture.EMPTY)}}}var A=Object.freeze({__proto__:null,debug:function(e,t){let n=e.getBounds(),s=e.graphics;if(!s){let a=e.anchor;s=new t.Graphics,e.graphics=s,e.addChild(s),s.x=0,s.y=0,s.lineStyle(1,16777215,1),s.beginFill(65280,.15),s.drawRect(-n.width*a.x,-n.height*a.y,n.width,n.height),s.endFill()}},getTextureGroup:O,make:_,default:class{constructor(){this.cloneIndex=0}clone(){this.cloneIndex+=1}addToScene(e){e.addChild(this)}removeFromScene(){let e=this;e.parent&&e.parent.removeChild(e)}}});const M="animation";let F=null;const k="button";let B=null;const G="group";let D=null;const V="image";let U=null;const Y="spine";let X=null;const H="bone";let z=null,K=null;const J="digit",$={CHAR_MAP:["0","1","2","3","4","5","6","7","8","9","."],DISPLAY:{TRANSVERSE:1,STRAIGHT:2},ALIGN_TYPE:{POS:1,RECT:2},OFFSET_TYPE:{STATIC:1,DYNAMIC:2},HORI_ALIGN:{LEFT:1,CENTER:2,RIGHT:3},VERTI_ALIGN:{TOP:1,CENTER:2,BOTTOM:3}};let q=null;const W="scrollbar";let Q=null;const Z="text";let ee=null;const te="particle";let ne={demo:{alpha:{start:1,end:0},scale:{start:.1,end:1.5},color:{start:"ffffff",end:"ffffff"},speed:{start:600,end:200},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:20},lifetime:{min:.5,max:.7},blendMode:"normal",frequency:16e-6,emitterLifetime:-1,maxParticles:100,pos:{x:0,y:0},addAtBack:!1,spawnType:"point"}},se=null;function ae(e){let t,n,s,a,r=e.lastIndexOf("/");return r>0&&(r+=1,t=e.slice(0,r),n=e.slice(r)),r=n.lastIndexOf("."),r>0&&(a=n.slice(0,r),r+=1,s=n.slice(r)),{dir:t,base:n,name:a,ext:s}}var re=Object.freeze({__proto__:null,filenameInfo:ae,handleData:function(e,t,n){let s=null;s=n||(e=>e);let a,r=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},i=(e,t,n)=>{let s;Object.getOwnPropertyNames(e).forEach((a=>{let o=e[a];"string"==typeof o?t[a]=n(o):Array.isArray(o)?(s=[],r(o,s,n),t[a]=s):"object"==typeof o&&(s={},i(o,s,n),t[a]=s)}))};a=Object.getOwnPropertyNames(e),a.forEach((n=>{let a,o=t[n];a=e[n],Array.isArray(a)?o?r(a,o,s):(o=[],r(a,o,s),t[n]=o):"object"==typeof a?o?i(a,o,s):(o={},i(a,o,s),t[n]=o):"string"==typeof a&&(t[n]=s(a))}))}});let ie=null;const oe="sound",le="texture",ce="object",ue="asset",he="spine",me="bones",de={INFO:"info",GROUP:"group",SCROLLBAR:"scrollbar",BACKGROUND:"background",PARTICLE:"particle",TEXT:"text",IMAGE:"image",SPINE:"spine",BONE:"bone",ANMIMATION:"animation",NUMBER:"number",BUTTON:"button"};let pe={event:{resBegin:null,resEnd:null,sceneResBegin:null,SceneResLoading:null,SceneResEnd:null},state:null,game:null,baseURL:"",base:0,baseProgress:0,baseIndex:0,baseMax:0,objectFactory:{},isBusy:!1,textures:null,spines:null,sounds:null,bonesFactory:null,soundMapList:[]},ge=O,fe=e=>{let t={};return t.conf=e,t.name=e.name,t.objName=e.objName,t};function ye(e,t,n="#000000"){return PIXI.Texture.Draw((e=>{t?(e.width=t.width||140,e.height=t.height||40):(e.width=100,e.height=24);let s=e.getContext("2d");s.strokeStyle=n,s.strokeRect(0,0,e.width,e.height),s.fillStyle="#FFFFFF",s.fillRect(0,0,2,2),s.fillRect(e.width-2,0,2,2),s.fillRect(0,e.height-2,2,2),s.fillRect(e.width-2,e.height-2,2,2),s.beginPath(),s.lineCap="round",s.moveTo(0,0),s.lineTo(e.width,e.height),s.moveTo(e.width,0),s.lineTo(0,e.height),s.stroke(),s.fillStyle="#FFFFFF";let a=e.width/2,r=e.height/2;s.fillRect(a,r,2,2)}))}let be=(e,t)=>{let n=null,s=e.resource.group,a=e.resource.name,r=e.pos||{x:0,y:0},i=ge(pe.textures,s),o=i&&i[a],l=se.getConfig(e.config.name);if(o&&l){if(e.debug){let t=ye(e.name,e);Array.isArray(o)||(o=[o]),o.push(t)}n=new se({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,setting:{type:e.type,config:l,art:o,useParticleContainer:e.useParticleContainer},pos:r})}return n},xe=(e,t)=>{let n=null,s=e.pos||{x:0,y:0},a=(e=>{let t=pe.spines,n=e&&e.split(".");return t&&n&&n.every((e=>{let n=t[e];return!!n&&(t=n,!0)})),t})(e.resource.spineData),r=ge(pe.textures,e.resource.texture);return a&&(n=new X({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,spineDataGroup:a,textureGroup:r,pos:s})),n},ve=(e,t)=>{let n,s=e.pos||{x:0,y:0},a={},r={timeScale:1};return e.resource&&"string"==typeof e.resource.name&&(a.name=e.resource.name),e.animation&&(r.name=e.animation.name,r.timeScale=e.animation.timeScale),n=new K({game:t,conf:e,name:e.name,objName:e.objName,resource:a,animation:r,isInScene:e.isInScene,pos:s}),n},Te=(e,t)=>{let n,s=e.pos||{x:0,y:0},a=pe.objectFactory;return n=new D({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pivot:e.pivot,pos:s}),e.childList&&e.childList.forEach((e=>{let s,r=a[e.type];r&&(s=r(e,t),s&&(e.isInScene&&s&&n.addChild(s),n.childList.push(s)))})),n},Ie=(e,t)=>{let n,s=e.pos||{x:0,y:0},a=e.anchor||{x:0,y:0};return n=new ee({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:s,anchor:a,text:e.text||"文字訊息"}),n},Ee=(e,t)=>{let n,s=e.resource,a=s.group,r=ge(pe.textures,a),i=PIXI.Texture.EMPTY,o=PIXI.Texture.EMPTY;return e.debug?o=ye(e.name,e):r&&(i=r[s.slider]||i,o=r[s.background]||o),n=new Q({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:e.pos,anchor:e.anchor,slider:i,background:o}),n},Se=(e,t)=>{let n,s=e.resource.group,a=e.resource.name,r=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=ge(pe.textures,s);"number"==typeof a&&a<0&&(a=0);let l=o&&o[a]||PIXI.Texture.EMPTY;return e.debug&&(l=ye(e.name,e)),n=new U({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:r,anchor:i,texture:l}),n},Pe=(e,t)=>{let n,s=e.resource.group,a=e.resource.name,r=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=ge(pe.textures,s),l=e.blend;"number"==typeof a&&a<0&&(a=0);let c=o&&o[a]||PIXI.Texture.EMPTY;return"number"==typeof l?l<0&&(l=0):l=0,e.debug&&(c=ye(e.name,e)),n=new U({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:r,anchor:i,alpha:e.alpha||1,texture:c}),n.blendMode=l,n},we=(e,t)=>{let n,s=e.resource.group,a=e.resource.name,r=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=e.speed||.33,l=e.loop,c=ge(pe.textures,s),u=c&&c[a]||[PIXI.Texture.EMPTY];return e.debug&&(u=[ye(e.name,e)]),n=new F({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,speed:o,loop:l,pos:r,anchor:i,textures:u}),n},Re=(e,t)=>{let n,s=e.resource,a=e.resource.texture,r=ge(pe.textures,s.group),i=e.numCounts||4,o=e.offset,l=e.symbolOffset,c=e.charMap,u=e.autoHide,h={pos:{x:0,y:0},width:e.width,height:e.height},m=r&&r[e.resource.background]||PIXI.Texture.EMPTY;return e.debug&&(m=ye(e.name,e)),n=new q({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,autoHide:u,fixVal:e.fixVal,useComma:e.useComma,useDash:e.useDash,useMoney:e.useMoney,pos:e.pos,anchor:e.anchor,pivot:e.pivot,rect:h,textureName:a,background:m,numCounts:i,charMap:c,symbolOffset:l,offset:o}),n},Ce=(e,t)=>{let n,s,a=e.resource,r=a.group,i=a.name,o=ge(pe.textures,r),l={enter:PIXI.Texture.EMPTY,press:PIXI.Texture.EMPTY,leave:PIXI.Texture.EMPTY,disable:PIXI.Texture.EMPTY};return e.debug?(l.enter=ye(e.name,e),l.press=l.enter,l.leave=l.enter,l.disable=l.enter):(n=o&&o[i],n&&(l.enter=n[a.enter]||l.enter,l.press=n[a.press]||l.press,l.leave=n[a.leave]||l.leave,l.disable=n[a.disable]||l.disable)),s=new B({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:e.pos,anchor:e.anchor,texture:l}),s};function Ne(e){pe.objectFactory[de.INFO]=fe,pe.objectFactory[de.GROUP]=Te,pe.objectFactory[de.SCROLLBAR]=Ee,pe.objectFactory[de.BACKGROUND]=Se,pe.objectFactory[de.TEXT]=Ie,pe.objectFactory[de.IMAGE]=Pe,pe.objectFactory[de.ANMIMATION]=we,pe.objectFactory[de.NUMBER]=Re,pe.objectFactory[de.BUTTON]=Ce,pe.objectFactory[de.SPINE]=xe,pe.objectFactory[de.PARTICLE]=be,ie=e.dragon,ie&&(pe.objectFactory[de.BONE]=ve)}function je(e){let t,n,s=pe.event;if(pe.isBusy)return!1;pe.isBusy=!0,pe.game=e.game;let a=e.objData,r=e.proc,i=e.callback,o=e.finish,l=0,c=e=>{let r=i[l];r&&r(e),s.resEnd&&s.resEnd(l),l+=1,l<a.length?(s.resBegin&&s.resBegin(l),n(l)):t()};if(t=()=>{pe.isBusy=!1,o&&o()},n=e=>{let t,n;t=r[e],n=a[e],pe.baseIndex=e,pe.baseProgress=pe.baseIndex/pe.baseMax*100,t&&n&&t(n,c)},!Array.isArray(a))return!1;if(!Array.isArray(r))return!1;if(!Array.isArray(i))return!1;if(a.length!==r.length)return!1;return pe.baseIndex=0,pe.baseProgress=0,pe.baseMax=a.length,pe.base=1/pe.baseMax,l=0,n(l),!0}function Le(e){let t=pe.event;e?(t.resBegin=e.resBegin||t.resBegin,t.resEnd=e.resEnd||t.resEnd,t.sceneResBegin=e.sceneResBegin||t.sceneResBegin,t.sceneResLoading=e.sceneResLoading||t.sceneResLoading,t.sceneResEnd=e.sceneResEnd||t.sceneResEnd):(t.resBegin=null,t.resEnd=null,t.sceneResBegin=null,t.sceneResLoading=null,t.sceneResEnd=null)}function Oe(e){pe.state=e}function _e(e,t){"object"==typeof e.particle&&se.setConfigMap(e.particle),t(e)}function Ae(e,t){let n=pe.event,s=0,a={},r=t,i=e=>{let t=e.progress;t>100&&(t=100);let s={currentProgress:t,totalProgress:pe.baseProgress+t*pe.base,state:pe.state};n.sceneResLoading&&n.sceneResLoading(s)},o=t=>{let s={};if(!t||!t.resources)return void r(s);let a=t.resources,i=e=>{let t=null;return a[e]&&a[e].spineData&&(t=a[e].spineData),t},o=(e,t,n)=>{let s;Object.getOwnPropertyNames(e).forEach((a=>{let r=e[a];"string"==typeof r?t[a]=n(r):Array.isArray(r)?(s=[],((e,t,n)=>{e.forEach((e=>{t.push(n(e))}))})(r,s,n),t[a]=s):"object"==typeof r&&(s={},o(r,s,n),t[a]=s)}))};e&&e.spines&&e.atlas&&e.spineDataMap?o(e.spineDataMap.spines,s,i):e&&e.spines&&o(e.spines,s,i),n.sceneResEnd&&n.sceneResEnd(he),pe.spines=s,r(s)},l=e=>{a[e]=e},c=(e,t)=>{Object.getOwnPropertyNames(e).forEach((n=>{let s=e[n];"string"==typeof s?t(s):Array.isArray(s)?((e,t)=>{e.forEach((e=>{t(e)}))})(s,t):"object"==typeof s&&c(s,t)}))};(()=>{n.sceneResBegin&&n.sceneResBegin(he);let t=function(){function e(e){this.index=0,this.lines=e.split(/\r\n|\r|\n/)}return e.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},e.prototype.readValue=function(){var e=this.readLine(),t=e.indexOf(":");if(-1===t)throw new Error("Invalid line: "+e);return e.substring(t+1).trim()},e.prototype.readTuple=function(e){var t=this.readLine(),n=t.indexOf(":");if(-1===n)throw new Error("Invalid line: "+t);for(var s=0,a=n+1;s<3;s++){var r=t.indexOf(",",a);if(-1===r)break;e[s]=t.substr(a,r-a).trim(),a=r+1}return e[s]=t.substring(a).trim(),s+1},e}();if(e&&e.spines&&e.atlas){let n={},s={},a=e.atlas,r=Object.getOwnPropertyNames(a);r.forEach((e=>{let n=a[e],r=ae(e);if(!n)return;let i=new t(n);!function(){let e=!0;for(;;){let t=i.readLine();if(null===t)return;if(0!==t.length){if(t.length<=2&&t.indexOf(" ")>=0)e=!0;else if(e){e=!1;let n=r.dir+t;s[n]=1}}else e=!0}}()}));let l=Object.getOwnPropertyNames(s),c=null;c=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let u=new c(pe.baseURL,50);u.onProgress.add(i),u.add(l),u.load((t=>{let s=PIXI.spine.TextureAtlas||PIXI.spine.core.TextureAtlas,i=PIXI.spine.AtlasAttachmentLoader||PIXI.spine.core.AtlasAttachmentLoader,l=PIXI.spine.SkeletonJson||PIXI.spine.core.SkeletonJson;r.forEach((r=>{let o=a[r],c=ae(r);if(!o)return;let u=new s(o,((e,n)=>{let s,a=c.dir+e,r=t.resources[a];s=r?r.texture:PIXI.Texture.EMPTY,n(s.baseTexture)})),h=new i(u),m=new l(h),d=`${c.dir}${c.name}.json`,p=e.spines[d];if(p){let e=m.readSkeletonData(p);n[d]={spineData:e}}})),o({resources:n})}))}else if(e&&e.spines){c(e.spines,l);let t=Object.getOwnPropertyNames(a);if(s=t.length,0===s)o();else{let e=null;e=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let n=new e(pe.baseURL,50);t.forEach((e=>{n.add(e,e)})),n.onProgress.add(i),n.load(o)}}else o()})()}function Me(e,t){let n=pe.event,s={},a=t,r=e=>{let t=e.progress;t>100&&(t=100),t=pe.baseProgress+t*pe.base,n.sceneResLoading&&n.sceneResLoading({current:t,length:100,state:pe.state})},i=t=>{let s=null;if(ie&&(s=new ie.dragonBones.PixiFactory),!t)return void a(s);let r=t.resources,i=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))};i(e.bones.data,[],(e=>{let t=r[e].data;return s&&s.parseDragonBonesData(t),t}));i(e.bones.resource,[],(e=>{let t=r[e.atlas]&&r[e.atlas].data;if(t=JSON.parse(t),s){let n=ge(pe.textures,e.texture.group),a=n&&n[e.texture.name];a&&s.parseTextureAtlasData(t,a)}return t})),n.sceneResEnd&&n.sceneResEnd(me),pe.bonesFactory=s,K.setFactory(s),a(s)},o=e=>{s[e]=e},l=e=>{s[e.atlas]=e.atlas},c=(e,t)=>{e.forEach((e=>{t(e)}))},u=(e,t)=>{Object.getOwnPropertyNames(e).forEach((n=>{let s=e[n];"string"==typeof s?t(s):Array.isArray(s)?c(s,t):"object"==typeof s&&u(s,t)}))};(()=>{if(n.sceneResBegin&&n.sceneResBegin(me),e&&e.bones&&e.bones.data){u(e.bones.data,o),c(e.bones.resource,l);let t=Object.getOwnPropertyNames(s);if(0===t.length)i();else{let e=null;e=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let n=new e(pe.baseURL,50);t.forEach((e=>{n.add(e,e)})),n.onProgress.add(r),n.load(i)}}else i()})()}function Fe(e,t){let n,s=e.objects,a=pe.objectFactory,r=[],i=0,o=0,l=pe.event,c=[];l.sceneResBegin&&l.sceneResBegin(ce),o=s.length,s.forEach((e=>{let t=a[e.type];t?(n=t(e,pe.game),n&&r.push(n)):c.push(e),i+=1;let s=i/o*100,u={currentProgress:s,totalProgress:pe.baseProgress+s*pe.base,state:pe.state};l.sceneResLoading&&l.sceneResLoading(u)})),l.sceneResEnd&&l.sceneResEnd(ce),t&&t(r,c)}function ke(e,t){let n={},s=!1,a={},r=pe.event,i={};pe.textures=null;let o=0,l={currentProgress:0,totalProgress:pe.baseProgress,state:pe.state};r.sceneResLoading&&r.sceneResLoading(l);let c=e=>{let t=e.progress;t>100&&(t=100);let n=0;n=o>0?100*o+pe.baseProgress+t*o:pe.baseProgress+t*pe.base;let s={currentProgress:t,totalProgress:n,state:pe.state};r.sceneResLoading&&r.sceneResLoading(s)},u=s=>{let a,i=s.resources,o=e=>i[e].texture,l=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},c=(e,t,n)=>{let s;Object.getOwnPropertyNames(e).forEach((a=>{let r=e[a];"string"==typeof r?t[a]=n(r):Array.isArray(r)?(s=[],l(r,s,n),t[a]=s):"object"==typeof r&&(s={},c(r,s,n),t[a]=s)}))};a=Object.getOwnPropertyNames(e.images),a.forEach((t=>{let s,a=n[t];s=e.images[t],Array.isArray(s)?a?l(s,a,o):(a=[],l(s,a,o),n[t]=a):"object"==typeof s?a?c(s,a,o):(a={},c(s,a,o),n[t]=a):"string"==typeof s&&(n[t]=o(s))})),r.sceneResEnd&&r.sceneResEnd(le),pe.textures=n,t&&t(n)},h=e=>{let t=e.progress;t>100&&(t=100);let n=0;n=o>0?pe.baseProgress+t*o:pe.baseProgress+t*pe.base;let s={currentProgress:t,totalProgress:n,state:pe.state};r.sceneResLoading&&r.sceneResLoading(s)},m=null,d=()=>{r.sceneResEnd&&r.sceneResEnd(ue),m(e)},p=t=>{let n=t.resources,s=t.assetNames,a=e.assets;s.forEach((e=>{let t=a[e],s=n[t.meta.filename].texture;if(s&&t){new PIXI.Spritesheet(s.baseTexture,t).parse((()=>{}))}})),r.sceneResEnd&&r.sceneResEnd(ue),m(e)},g=e=>{a[e]=e},f=(e,t)=>{e.forEach((e=>{t(e)}))},y=(e,t)=>{if(!e)return;Object.getOwnPropertyNames(e).forEach((n=>{let s=e[n];"string"==typeof s?t(s):Array.isArray(s)?f(s,t):"object"==typeof s&&y(s,t)}))},b=e=>PIXI.utils.TextureCache[e],x=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},v=(e,t,n)=>{Object.getOwnPropertyNames(e).forEach((s=>{let a=e[s],r=[];"string"==typeof a?t[s]=n(a):Array.isArray(a)?(x(a,r,n),t[s]=r):"object"==typeof a&&(t[s]=r,v(a,r,n))}))};if(m=e=>{let i,o,l;if(e.images){i=Object.getOwnPropertyNames(e.images),i.forEach((t=>{let n;n=e.images[t],Array.isArray(n)?f(n,g):"object"==typeof n?y(n,g):"string"==typeof n&&g(n)})),o=Object.getOwnPropertyNames(a),r.sceneResBegin&&r.sceneResBegin(le);let t=null;t=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let n=new t(pe.baseURL,50);o.forEach((e=>{n.add(e,e)})),n.onProgress.add(c),n.load(u)}else s=!0;e.frames&&(l=Object.getOwnPropertyNames(e.frames),l.forEach((t=>{let s,a=n[t];s=e.frames[t],Array.isArray(s)?a?x(s,a,b):(a=[],x(s,a,b),n[t]=a):"object"==typeof s?a?v(s,a,b):(a=[],v(s,a,b),n[t]=a):"string"==typeof s&&(n[t]=b(s))}))),s&&(pe.textures=n,t&&t(n))},e&&e.assets){e.images&&(o=.5*pe.base);let t=e.assets;if(Array.isArray(t)){r.sceneResBegin&&r.sceneResBegin(ue);let e=null;e=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let n=new e(pe.baseURL,50);t.forEach((e=>{n.add(e)})),n.onProgress.add(h),n.load(d)}else if("object"==typeof t){let e=null;e=PIXI.Loader?PIXI.Loader:PIXI.loaders.Loader;let n=new e(pe.baseURL,50),s=Object.getOwnPropertyNames(t);n.assetNames=s,s.forEach((e=>{let s,a,r,i=e.lastIndexOf("/");i>0&&(i+=1,s=e.slice(0,i),a=e.slice(i)),i=a.lastIndexOf("."),i>0&&(i+=1,r=a.slice(i));let o=t[e];a=s+(o.meta&&o.meta.image),o.meta.filename=a,n.add(a)})),n.onProgress.add(h),n.load(p)}}else m(e),i.textures=n;return i}function Be(e){pe.textures=e}function Ge(e){pe.spines=e}function De(e,t){let n,s,a,r=0,i=0,o=pe.event,l={},c=pe.soundMapList;if(!globalThis.Howl||!e.sounds)return t&&t(null),!1;s=Object.getOwnPropertyNames(e.sounds),o.sceneResBegin&&o.sceneResBegin(oe);let u=0,h=0;r=0;let m=pe.baseURL;return s.forEach((t=>{let s={};a=e.sounds[t],i=a.length,h+=i,a.forEach((e=>{let t=e.config.src;if(Array.isArray(e.config.src)){let t=[];e.config.src.forEach((e=>{t.push(m+e)})),e.config.src=t}n=new Howl(e.config),e.config.src=t,s[e.objName]=n,r+=1,u=r/h*100;let a=pe.baseProgress+u*pe.base,i={currentProgress:u,totalProgress:a,state:pe.state};o.sceneResLoading&&o.sceneResLoading(i)})),a.length>0?l[t]=s:l[t]=null})),o.sceneResEnd&&o.sceneResEnd(oe),c.push(l),t&&t(l),!0}function Ve(e){Object.getOwnPropertyNames(e).forEach((t=>{let n=e[t];n&&n.stop?(n.stop(),n.unload()):Ve(n),delete e[t]}))}class Ue{constructor(e){this.game=e,this.isInScene=!1}show(e){let t=this,n=t.game;t.isInScene||(t.isInScene=!0,e||(e=n.layer.main),t.objs&&t.objs.forEach((t=>{t&&(t._game=n,t.isInScene&&(t.addToScene?t.addToScene(e):e.addChild(t)))})))}hide(){let e=this;e.isInScene&&(e.isInScene=!1,e.objs&&e.objs.forEach((e=>{e&&(e.removeFromScene?e.removeFromScene():e.parent&&e.parent.removeChild(e))})))}init(e){let t={};function n(e){e.childList.forEach((t=>{if(t){let s=t.conf;if(s.objName){e[s.objName]=t;t.objName;de.GROUP===t.type&&n(t)}}}))}this.entity=t,e.forEach((e=>{let s="";e&&e.objName&&(t[e.objName]=e,s='set entity name"'+e.objName+'"',de.GROUP===e.type&&n(e))}))}}var Ye=Object.freeze({__proto__:null,OBJ_TYPE:de,createDebugTxeture:ye,createGroup:Te,init:Ne,registerFactory:function(e){pe.objectFactory[e.type]=e.create},loadSceneEx:je,setEvent:Le,setState:Oe,createRawData:_e,createSpineData:Ae,createBonesData:Me,createObject:Fe,createTexture:ke,setTextures:Be,setSpineData:Ge,setBaseURL:function(e){pe.baseURL=e||""},getBaseURL:function(){return pe.baseURL},getTextures:function(e,t){let n,s=e;return t.split(".").every((function(e){return n=s[e],!!n&&(s=n,!0)})),s},createSound:De,destroySound:Ve,destroyAllSound:function(){pe.soundMapList.forEach((e=>{Object.getOwnPropertyNames(e).forEach((t=>{Ve(e[t]),delete e[t]}))}))},createScene:function(e,t){let n=new Promise(((n,s)=>{if(pe.isBusy)return void s("忙碌中");let a=e.game,r=e.infoList,i=e.loading,o=e.loadingEvent,l=new Ue(a),c={data:{proc:_e,callback(e){l.data=e,t&&t.eventRawData&&t.eventRawData(e)}},sound:{proc:De,callback(e){l.sounds=e,t&&t.eventSound&&t.eventSound(e)}},texture:{proc:ke,callback(e){l.textures=e,t&&t.eventTexture&&t.eventTexture(e)}},spine:{proc:Ae,callback(e){l.spines=e,t&&t.eventSpine&&t.eventSpine(e)}},object:{proc:Fe,callback(e){l.objs?e.forEach((e=>{l.objs.push(e)})):l.objs=e,l.init(e),t&&t.eventObject&&t.eventObject(e)}}};o&&o.start&&o.start();let u={game:a,objData:[],proc:[],callback:[],finish:function(){i&&i.setState(!0),t&&t.finish&&t.finish(l),o&&o.finish&&o.finish(l),n(l)}};r&&Array.isArray(r)&&r.forEach((e=>{let t=c[e.eventName];t&&e.obj&&t.proc&&(u.objData.push(e.obj),u.proc.push(t.proc)),u.callback.push(t.callback)})),i?i.go({loadingEvent:o,game:a,layer:a.layer&&a.layer.overlay,load(){je(u)}}):je(u)}));return n}});let Xe={isBusy:!1,game:null,loading:null,useLobbyState:!1,state:{currentIndex:0,totals:0}};var He=Object.freeze({__proto__:null,go:function(e,t){if(Xe.isBusy||!Xe.game||!Array.isArray(e))return!1;let n,s,a=Xe.game,r=Xe.loading,i=0,o=e.length,l=t,c=e;return Oe(Xe.state),n=()=>{if(!(i<o))return Xe.isBusy=!1,Xe.useLobbyState||r&&r.setState(!0),l&&l(),!1;{let e=c[i].scene;if(i+=1,e)return s(e);n()}},s=e=>{Xe.state.currentIndex=i,Xe.state.totals=o;let t=!1;return!e.isCreate()&&e.createScene?(t=!0,e.createScene(n)):n(),t},Xe.isBusy=!0,Xe.useLobbyState?n():r.go({game:a,layer:a.layer&&a.layer.overlay,load(){n()}}),!0},setUseLobbyState:function(e){Xe.useLobbyState=e,e&&Xe.game&&Xe.game.scene?Le(Xe.game.scene.loadingEvent):(Xe.useLobbyState=!1,Le(null))},setGame:function(e){Xe.game=e},setDisplayLoading:function(e){Xe.loading=e}});let ze={init:null,release:null,resource:null,eventResBegin:null,eventResCheck:null,eventResEnd:null,eventStart:null,eventEnter:null,eventLeave:null},Ke=null,Je=null;function $e(e){Ke&&Ke(e)}class qe{static resCreate(e){ze.resource&&ze.resource(e)}static frameStart(e){ze.eventStart&&ze.eventStart(e),Ke=qe.frameEnter}static frameFinish(e){ze.release&&ze.release(e),Ke=null,Je&&(Je(),Je=null)}static frameEnter(e){let t=!0;ze.eventEnter&&(t=ze.eventEnter(e)),t&&(Ke=qe.resBegin)}static frameLeave(e){let t=!0;ze.eventLeave&&(t=ze.eventLeave(e)),t&&(Ke=qe.frameFinish)}static resBegin(e){ze.eventResBegin&&ze.eventResBegin(e),qe.resCreate(),Ke=qe.resLoading}static resLoading(e){ze.eventResCheck?ze.eventResCheck(e)&&(Ke=qe.resEnd):Ke=qe.resEnd}static resEnd(e){ze.eventResEnd&&ze.eventResEnd(e),Ke=qe.frameLeave}}function We(e){return Ke||("object"==typeof e&&(ze.init=e.init,ze.release=e.release,ze.resource=e.resource,ze.eventResBegin=e.resBegin,ze.eventResCheck=e.resCheck,ze.eventResEnd=e.resEnd,ze.eventStart=e.start,ze.eventEnter=e.enter,ze.eventLeave=e.leave,Je=e.finish),ze.init&&ze.init(),Ke=qe.frameStart),!0}var Qe=Object.freeze({__proto__:null,refresh:$e,go:We});let Ze={event:null,scene:{anim:null,message:null,percent:null},isInit:!1,strings:null,resList:null,state:!1},et=null;var tt=Object.freeze({__proto__:null,init:function(){},setState:function(e){Ze.state=e},setStrings:function(e){Ze.strings=e},setPosition:function(e){let t=Ze.scene.anim;t&&(t.x=e.x,t.y=e.y),Ze.pos?(Ze.pos.x=e.x,Ze.pos.y=e.y):Ze.pos={x:e.x,y:e.y}},setScene:function(e){Ze.resList=e,Ze.isInit=!1},go:function(e){if(!globalThis.PIXI)return!1;let t=globalThis.PIXI,n=e.loadingEvent||{},s=e.game,a=Ze.strings;et={resBegin(e){n.resBegin&&n.resBegin(e)},resEnd(e){n.resEnd&&n.resEnd(e)},sceneResBegin(e){let t=e;a&&a.get&&(t=a.get(e)),n.sceneResBegin&&n.sceneResBegin(e)},sceneResLoading(e){let t=e.state,s=e.totalProgress;if(t){s=(t.currentIndex-1)/t.totals*100+s/t.totals}let a=s.toFixed(0)+"%";n.sceneResLoading&&n.sceneResLoading(e),Ze.percent&&(Ze.percent.text=a)},sceneResEnd(e){let t=e;a&&a.get&&(t=a.get(e)),n.sceneResEnd&&n.sceneResEnd(e)}},Le(et);let r={name:"loading",screen:{width:s.screen&&s.screen.width||1024,height:s.screen&&s.screen.height||768},movieClip:null,layer:e.layer||null,load:e.load,init:()=>{if(!Ze.isInit){Ze.isInit=!0;let e,n=Ze.resList,s=[];n.forEach((n=>{e=t.Texture.from(n),s.push(e)}));let a=null;a=t.AnimatedSprite?new t.AnimatedSprite(s):new t.extras.AnimatedSprite(s),a.animationSpeed=.33,a.anchor.x=.5,a.anchor.y=.5,Ze.scene.anim=a;let i=new t.Text("message");i.style.fill="#FFFFFF",i.style.stroke="#006600",i.style.strokeThickness=1,i.anchor.x=.5,i.anchor.y=.5,i.x=0,i.y=-44,Ze.message=i;let o=new t.Text("init");o.style.fill="#FFFFFF",o.style.stroke="#aa0000",o.style.strokeThickness=1,o.anchor.x=.5,o.anchor.y=.5,o.x=0,o.y=24,Ze.percent=o,a.addChild(i),a.addChild(o),Ze.pos||(Ze.pos={x:r.screen.width/2,y:r.screen.height/2}),Ze.anchor=new t.Point(.5,.5)}s.addRefresh(r.name,$e)},release:()=>{null!==r.layer&&null!==Ze.scene.anim&&r.layer.removeChild(Ze.scene.anim),s.removeRefresh(r.name)},resource:()=>{r.load&&r.load()},resBegin:()=>{},resCheck:()=>Ze.state,resEnd:()=>{},start:()=>{if(null!==r.layer&&null!==Ze.scene.anim){Ze.percent&&(Ze.percent.text="start");let e=Ze.scene.anim;e.x=Ze.pos.x,e.y=Ze.pos.y,e.anchor.x=Ze.anchor.x,e.anchor.y=Ze.anchor.y,e.alpha=0,e.gotoAndPlay(0),r.layer.addChild(e)}},enter:()=>{let e=!1,t=Ze.scene.anim;return null!==t?t.alpha>=1?(t.alpha=1,e=!0):t.alpha+=.05:e=!0,e},leave:()=>{let e=!1,t=Ze.scene.anim;return null!==t?(t.alpha<=0&&(t.alpha=0,e=!0),t.alpha-=.05,t.alpha<=0&&(t.alpha=0)):e=!0,e},finish:()=>{}};return Ze.event=r,Ze.state=!1,We(Ze.event)}});let nt=class{constructor(){let e=this,t=null,n={autoUpdate:!0,debug:!1,timeBase:1,currentTime:-1,renderer:null,pause:!0,isInit:!1},s=null,a=[],r=[],i={};e.custom={},e.setEngine=e=>{s=e},e.setElement=e=>{n.element=e},e.getElement=()=>n.element,e.getCanvas=()=>n.canvas,e.update=e=>{n.debug&&t&&t.begin(),n.currentTime<0&&(e=0,n.currentTime=1),e*=n.timeBase,a.forEach((t=>{let n=i[t];n.update?n.update(e):n(e)})),r.forEach((t=>{t.update&&t.update(e)})),n.autoUpdate&&s&&s.render(e),n.debug&&t&&t.end()},n.debug=!1,e.addRefresh=(e,t)=>{i[e]=t,a=Object.getOwnPropertyNames(i)},e.removeRefresh=e=>{Object.prototype.hasOwnProperty.call(i,e)&&(delete i[e],a=Object.getOwnPropertyNames(i))},e.addUpdate=e=>{let t=!1;return e&&e.update&&!Object.prototype.hasOwnProperty.call(e,"__updateIndex")&&(e.__updateIndex=r.length,r[e.__updateIndex]=e,t=!0),t},e.removeUpdate=e=>{let t,n,s=r.length;if("number"==typeof e.__updateIndex){if(t=e.__updateIndex,t>=0&&t<s){let e=s-1;n=r[e],r[t]=n,n.__updateIndex=t,r.splice(e,1)}delete e.__updateIndex}},e.resetUpdate=()=>{r.forEach((e=>{delete e.__updateIndex})),r=[]},e.setTimeout=(t,n)=>{let s={currentTime:0,func:t,update:t=>{s.currentTime.toFixed(2)>=n&&(e.removeUpdate(s),s.func&&s.func(s.currentTime)),s.currentTime+=t}};return e.addUpdate(s),s},e.idle=t=>new Promise((n=>{e.setTimeout((function(){n()}),t)})),e.setInterval=(t,n)=>{let s=0,a={func:t,update:e=>{s+=e,s.toFixed(2)>=n&&(a.func&&a.func(s),s=0)}};return e.addUpdate(a),a},e.clearInterval=t=>{e.removeUpdate(t)},e.isPause=()=>n.pause,e.play=()=>{n.pause&&(n.pause=!1,n.currentTime=-1,m(e))},e.once=()=>{n.pause=!1,n.currentTime=-1,f(e)},e.pause=()=>{n.pause||(n.pause=!0,d(e))},e.stop=()=>{n.pause=!0,d(e),e.resetUpdate()},e.add=e=>{n.timeBase<1&&(n.timeBase=1),n.timeBase+=e,n.timeBase>4&&(n.timeBase=4)},e.dec=e=>{n.timeBase>1&&(n.timeBase=1),n.timeBase-=e,n.timeBase<.1&&(n.timeBase=.1)},e.reset=()=>{n.timeBase=1},e.getTimeBase=()=>n.timeBase,e.setTimeBase=e=>{n.timeBase=e,n.timeBase<.1?n.timeBase=.1:n.timeBase>4&&(n.timeBase=4)},e.init=t=>{if(n.isInit)return!1;n.isInit=!0,n.element=t.element,n.canvas=t.view,n.currentTime=-1;let s={width:t.width,height:t.height};return e.pause(),e.screen=s,!0},e.getRenderer=()=>s&&s.renderer,e.setAutoUpdate=e=>{n.autoUpdate=e},Object.defineProperty(e,"layer",{get:()=>s&&s.layer}),Object.defineProperty(e,"debug",{set(s){t||nt.Stats&&(t=new nt.Stats,e.stats=t),s?t&&n.element&&(t.dom.style.position="absolute",n.element.appendChild(t.dom)):t&&n.element&&t.dom.parentElement&&n.element.removeChild(t.dom),n.debug=s},get:()=>n.debug}),e.stats=null}};nt.Stats=null,nt.isInitial=!1;let st=!1;let at=null;function rt(e){at=e.m,function(){if(st)return;st=!0;let e=globalThis.PIXI;e&&(e.Texture.Draw=t=>{let n=document.createElement("canvas");return"function"==typeof t&&t(n),e.Texture.fromCanvas(n)})}()}let it={position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},ot={zIndex:10,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},lt={oninit(e){let t=this,n=e.attrs,s=e.attrs.config;t.config=s,t.game=s.game,t.style=n.style||ot,t.ready=n.ready},oncreate(e){let t=this,n=t.config;n.view=e.instance.children[0].dom,n.element=e.dom;let s=t.game;s||(s=new nt,t.game=s),s.init(n);let a=function(e){if(!globalThis.PIXI)return null;let t,n,s={},a=e,r=globalThis.PIXI;return n=r.Renderer?new r.Renderer(a):new r.WebGLRenderer(a),t=new r.Container,s.stage=t,s.overlay=new r.Container,s.foreground=new r.Container,s.main=new r.Container,s.background=new r.Container,t.addChildAt(s.overlay,0),t.addChildAt(s.foreground,0),t.addChildAt(s.main,0),t.addChildAt(s.background,0),{renderer:n,stage:t,layer:s,render(){n.render(t)}}}(n);s.setEngine(a),n&&n.ready&&n.ready(s),t.ready&&t.ready(s)},onremove(){let e=this.game;e&&e.stop()},view(){return at(".",{style:this.style},at("canvas",{style:it}))}};function ct(e){!function(e){!nt.isInitial&&(e.Stats&&(nt.Stats=e.Stats.default||e.Stats),nt.isInitial=!0)}(e),rt(e)}var ut=Object.freeze({__proto__:null,init:ct,run:function(e){let t;if(t=new nt,window.parent&&window.parent!==window){let n,s;if(window.Howl=window.parent.Howl,window.Howler=window.parent.Howler,window.parent.scene){let a=e.id,r=e.event||{};n=window.parent.scene[a],Object.defineProperty(t,"scene",{get:()=>n}),n&&n.event&&(s={create(e){window.parent.lobby&&(t.table=window.parent.lobby.table[e.id],t.currentUser=window.parent.lobby.currentUser,t.command=window.parent.lobby.net.gameCommand,t.lobby={setEvent:window.parent.lobby.setEvent,setCommand:window.parent.lobby.net.setLobbyCommand,CMD:window.parent.lobby.net.CMD}),r.create&&(e.game=t,r.create(e))},play(e){t.play(),r.play&&(e.game=t,r.play(e))},pause(e){t.pause(),r.pause&&(e.game=t,r.pause(e))},enter(e){r.enter&&(e.game=t,r.enter(e))},leave(e){r.leave&&(e.game=t,r.leave(e))},focus(){r.focus&&r.focus()},blur(){r.blur&&r.blur()},lock(e){r.lock&&r.lock(e)},fullscreen(e){r.fullscreen&&r.fullscreen(e)},resize(e){r.resize&&r.resize(e)},music(e){r.music&&r.music(e)},sound(e){r.sound&&r.sound(e)}},n.setEvent(s),n.game=t)}}return t}});let ht={utils:re,Base:class{constructor(e){let t=this,n={name:e,root:null,game:null,center:{entity:{}},initMap:null,currentTime:0,isCreate:!1,isInScene:!1};t.properties=n,Object.defineProperty(t,"center",{get:()=>n.center}),Object.defineProperty(t,"entity",{get:()=>n.center.entity})}getName(){return this.properties.name}getGame(){return this.properties.game}isCreate(){return this.properties.isCreate}isInScene(){return this.properties.isInScene}getCurrentTime(){return this.properties.currentTime}getCenter(){return this.properties.center}getRoot(){return this.properties.root}setRoot(e){let t=this.properties;t.root=e,t.center=e.center}setInitMap(e){this.properties.initMap=e}setLayer(e){this.properties.center.layer=e}getLayer(){return this.properties.center.layer}getRawData(){return this.properties.center.rawdata}getSound(e){let t=this.properties.center.sounds;return t&&"string"==typeof e&&(t=t[e]),t}mute(e,t){let n=this.properties.center.sounds[e];if(n){Object.getOwnPropertyNames(n).forEach((e=>{n[e].mute(t)}))}}getTexture(e){let t=this.properties.center.textures;return t&&"string"==typeof e&&(t=t[e]),t}getObject(){return this.properties.center.objs}getEntity(){return this.properties.center.entity}eventFinish(){let e=this,t=e.properties,n=t.center;n.textures&&Be(n.textures),n.spines&&Ge(n.spines),t.initMap&&t.initMap(e)}eventRawData(e){}eventSound(e){}eventTexture(e){}eventSpine(e){}eventBones(e){}eventObject(e){}refresh(e){let t=this.getCenter();t&&t.update&&t.update(e)}setGame(e,t){let n=this.properties;n.game=e,e.layer&&t&&Object.prototype.hasOwnProperty.call(e.layer,t)&&(n.center.layer=e.layer[t])}addToScene(e){let t=this,n=t.properties;if(n.isInScene)return!1;n.isInScene=!0;let s=n.center;n.currentTime=-1,n.game=e||n.game,n.game&&n.game.addRefresh(n.name,(function(e){n.currentTime<0?(n.currentTime=0,e=0):t.currentTime+=e,t.refresh(e)}));let a=s.layer;return!s||!s.objs||(s.objs.forEach((e=>{e&&(e._game=n.game||e._game,e.isInScene&&(e.addToScene?e.addToScene(a):a.addChild(e)))})),!0)}removeFromScene(){let e=this.properties;if(!e.isInScene)return!1;e.isInScene=!1,e.game&&e.game.removeRefresh(e.name);let t=e.center;return!t||!t.objs||(t.objs.forEach((e=>{e&&(e.removeFromScene?e.removeFromScene():e.parent&&e.parent.removeChild(e))})),!0)}init(e){let t=this.properties,n=t.center;const s=de;if(!n||!n.objs)return;let a=n.entity,r={},i=e=>{e.childList.forEach((n=>{if(n){n._game=t.game||n._game;let a=n.conf;if(a.objName){e[a.objName]=n;n.objName}s.GROUP===n.type&&i(n)}}))};if(n.objs.forEach((e=>{let n="";e&&(e._game=t.game||e._game,e.objName&&(a[e.objName]=e,n='set entity name"'+e.objName+'"'),s.GROUP===e.type&&i(e))})),!e)return;r=e.set||{};r.setupGroup=r.setupGroup||(e=>{e.childList.forEach((e=>{if(e){let t=e.conf;s.GROUP===e.type&&r.setupGroup(e),t&&Object.prototype.hasOwnProperty.call(r,t.init)&&r[t.init](e)}}))}),n.objs.forEach((e=>{let t,n="";e&&(t=e.conf,s.GROUP===e.type&&r.setupGroup(e),t&&Object.prototype.hasOwnProperty.call(r,t.init)&&(n=(e.name||e.objName)+" init : "+t.init,r[t.init](e,t)))}))}createScene(e,t){let n=this,s=n.properties;if(s.isCreate)return e&&e(),!1;let a=t.infoList,r=s.center,i={data:{proc:_e,callback:e=>{r&&(r.rawdata=e),n.eventRawData(e)}},sound:{proc:De,callback:e=>{r&&(r.sounds=e),n.eventSound(e)}},texture:{proc:ke,callback:e=>{r&&(r.textures=e),n.eventTexture(e)}},spine:{proc:Ae,callback:e=>{r&&(r.spines=e),n.eventSpine(e)}},bone:{proc:Me,callback:e=>{r&&(r.bonesFactory=e),n.eventBones(e)}},object:{proc:Fe,callback:e=>{r&&(r.objs?e.forEach((e=>{r.objs.push(e)})):r.objs=e),n.eventObject(e)}}};r&&(r.createFinish=e);let o={game:s.game,objData:[],proc:[],callback:[],finish:function(){s.isCreate=!0,r&&r.createFinish&&r.createFinish()}};return a&&Array.isArray(a)&&a.forEach((e=>{let t=i[e.eventName];t&&e.obj&&t.proc&&(o.objData.push(e.obj),o.proc.push(t.proc)),o.callback.push(t.callback)})),je(o),!0}destroyScene(){this.removeFromScene();let e=this.properties,t=e.center;if(!e.isCreate)return!1;if(t&&(t.bonesFactory&&(t.bonesFactory.clear(),t.bonesFactory=null),t.sounds)){Ve(t.sounds)}return t.objs&&(t.objs.forEach(((e,n)=>{e&&delete t.objs[n]})),t.objs=null),e.isCreate=!1,!0}},sceneManager:Ye,loadingManager:He,loading:Qe,set:e=>{let t=de,n=e.game,s=e.scene,a=e.set;a.setupGroup=a.setupGroup||(e=>{e.childList.forEach((e=>{if(e){e._game=n;let s=e.conf;t.GROUP===e.type&&a.setupGroup(e),s&&Object.prototype.hasOwnProperty.call(a,s.init)&&a[s.init](e)}}))}),s.objs.forEach((e=>{let s,r="";e&&(e._game=n,s=e.conf,t.GROUP===e.type&&a.setupGroup(e),s&&Object.prototype.hasOwnProperty.call(a,s.init)&&(r=(e.name||e.objName)+" init : "+s.init,a[s.init](e,s)))}))}},mt={loading:tt,base:A},dt={game:{pixi:lt}},pt=!1;var gt=Object.freeze({__proto__:null,Lobby:L,client:s,components:dt,game:ut,init:function(e){let n=e||{},s=n.plugin||[];return Array.isArray(s)||(s=[]),!globalThis.PIXI&&e.PIXI&&(globalThis.PIXI=e.PIXI),new Promise((e=>{pt&&e("!! init finish again !!"),function a(r){if(r&&r.Spine&&globalThis.PIXI&&(globalThis.PIXI.spine=r),s.length>0){let e=s.shift();window.System?System.import(e).then(a):a()}else n.sceneManager=Ye,globalThis.PIXI&&(!function(){let e=globalThis.PIXI,t=null;t=e.AnimatedSprite?e.AnimatedSprite:e.extras.AnimatedSprite,F=class extends(_(t)){static get TYPE(){return M}constructor(t){super(t.textures||[e.Texture.EMPTY],!1);let n=this;n._game=t.game,n.conf=t.conf,n.type=M,n.name=t.name,n.objName=t.objName||null,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.loop=t.loop,"number"==typeof t.speed&&(n.animationSpeed=t.speed)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,loop:this.loop,speed:this.animationSpeed,pos:this.position,anchor:this.anchor,textures:this.textures};return new F(t)}removeFromScene(){super.removeFromScene(),this._game&&this._game.removeUpdate(this)}addToScene(e){e.addChild(this),this.playing&&this._game&&this._game.addUpdate(this)}play(){this._game&&this._game.addUpdate(this),super.play()}stop(){this._game&&this._game.removeUpdate(this),super.stop()}update(e){super.update(60*e)}reload(){let t=this._game.textures,n=this.conf,s=this.conf.resource,a=O(t,s.group);a&&(this.textures=a[s.name]||[e.Texture.EMPTY]),n.loop&&this.play()}}}(),function(){let e=globalThis.PIXI;B=class extends(_(e.Sprite)){static get TYPE(){return k}constructor(t){super(t.texture&&t.texture.leave||e.Texture.EMPTY);let n=this;n._game=t.game,n.type=k,n.conf=t.conf,n.objName=t.objName||null,n.name=t.name,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.scale.x=1,n.buttonMode=!0,n.interactive=!0;let s={};n.custom=s,s.texture=t.texture||{enter:e.Texture.EMPTY,leave:e.Texture.EMPTY,press:e.Texture.EMPTY,disable:e.Texture.EMPTY},s.isPress=!1,s.flagDrag=!1,s.canMove=!1,s.timer=null,s.obj=null,n.touchstart=n.mousedown=e=>{s.flagDrag&&s.timer&&(n.dragEvent&&(n.dragEvent.curTimes=n.dragEvent.times,n.dragEvent.reset&&n.dragEvent.reset()),s.timer.restart()),n.eventPress(e)},n.touchend=n.mouseup=e=>{s.canMove=!1,s.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventRelease(e)},n.mouseover=e=>{s.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventEnter(e)},n.mouseout=e=>{s.canMove=!1,s.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventLeave(e)},n.touchendoutside=n.mouseupoutside=e=>{s.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventLeave(e)}}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,texture:this.custom.texture};return new B(t)}setTextures(t){let n=this.custom.texture;t&&(n.enter=t.enter||e.Texture.EMPTY,n.leave=t.leave||e.Texture.EMPTY,n.press=t.press||e.Texture.EMPTY,n.disable=t.disable||e.Texture.EMPTY),this.update()}setTexture(e){this.setTextures(e)}setClick(e,t){this.eventClick=e,this.obj=t}eventPress(){let e=this,t=e.custom.texture;e.texture=t.press,e.custom.isPress=!0}eventRelease(){let e=this,t=e.custom.texture;e.custom.isPress?(e.texture=t.leave,"function"==typeof e.eventClick&&e.eventClick(e,e.obj)):e.texture=t.leave,e.custom.isPress=!1}eventEnter(){let e=this,t=e.custom.texture;e.custom.isPress?e.texture=t.press:e.texture=t.enter}eventLeave(){let e=this,t=e.custom.texture;e.texture=t.leave,e.custom.isPress=!1}setDragEnable(e){let t=this,n=t.custom;n.flagDrag=!0,t.mousemove=t.touchmove=e=>{if(n.canMove){n.isPress=!1;let s={x:parseInt(e.data.global.x),y:parseInt(e.data.global.y)};t.x=s.x,t.y=s.y}},t.dragEvent=e,t.dragEvent||(t.dragEvent={},t.dragEvent.times=10),t.dragEvent.curTimes=t.dragEvent.times}setDragDisable(){let e=this;e.custom.flagDrag=!1,e.mousemove=e.touchmove=null}setEnable(e,t){e?this.enable(t):this.disable(t)}enable(e){this.interactive=!0;let t=this.custom.texture;e&&(this.texture=t.leave)}isEnabled(){return this.interactive}disable(e){this.interactive=!1;let t=this.custom.texture;e&&(this.texture=t.disable)}update(){let e=this.custom.texture;this.interactive?this.texture=e.leave:this.texture=e.disable}reload(){let e=this._game.textures,t=this.conf.resource,n=O(e,t.group);n&&this.setTextures(n[t.name])}}}(),function(e){let t=globalThis.PIXI,n=e.sceneManager;D=class extends(_(t.Container)){static get TYPE(){return G}constructor(e){super();let t=this;t._game=e.game,t.conf=e.conf,t.type=G,t.name=e.name,t.objName=e.objName||null,t.isInScene=e.isInScene,t.childList=[],e.pos&&(t.x=e.pos.x||0,t.y=e.pos.y||0),e.pivot&&(t.pivot.x=e.pivot.x||0,t.pivot.y=e.pivot.y||0)}clone(e){super.clone();let t=null;this.conf&&this.conf.childList&&(t=this.conf.childList);let s={game:e||this._game,childList:t,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pivot:this.pivot,pos:this.position};return n.createGroup(s,this._game)}removeFromScene(){super.removeFromScene(),this.stop()}stop(){this.childList.forEach((e=>{e.stop&&e.stop()}))}reload(){this.childList.forEach((e=>{e.reload&&e.reload()}))}}}(n),function(){let e=globalThis.PIXI;U=class extends(_(e.Sprite)){static get TYPE(){return V}constructor(t){super(t.texture||e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=V,n.name=t.name,n.objName=t.objName,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,alpha:this.alpha,texture:this.texture};return new U(t)}}}(),function(){let e=globalThis.PIXI;q=class extends(_(e.Sprite)){static get TYPE(){return J}static get NUM(){return $}constructor(t){super(t.background||e.Texture.EMPTY);let n,s=this;s._game=t.game,s.conf=t.conf,s.type=J,s.name=t.name,s.objName=t.objName,s.isInScene=t.isInScene;let a,r,i,o,l,c,u,h={},m={};for(h.rect=m,h.event={},s.custom=h,m.pos=new e.Point(0,0),m.anchor=new e.Point(0,0),m.width=t.width||64,m.height=t.height||16,t.rect&&(t.rect.pos&&(m.x=t.rect.pos.x,m.y=t.rect.pos.y),t.rect.anchor&&(m.anchor.x=t.rect.anchor.x,m.anchor.y=t.rect.anchor.y),m.width=t.rect.width||m.width,m.height=t.rect.height||m.height),h.textureName=t.textureName||"",h.numCounts=t.numCounts||4,h.charMap=t.charMap||$.CHAR_MAP,h.shift=1,"number"==typeof t.shift&&(h.shift=t.shift),h.enable=!1,h.display=t.display||$.DISPLAY.TRANSVERSE,h.alignType=t.alignType||$.ALIGN_TYPE.RECT,h.offsetType=t.offsetType||$.OFFSET_TYPE.STATIC,h.horiType=t.horiType||$.HORI_ALIGN.LEFT,h.vertiType=t.vertiType||$.VERTI_ALIGN.TOP,h.alpha=1,h.anchor={x:0,y:0},t.anchor&&(h.anchor.x=t.anchor.x,h.anchor.y=t.anchor.y),h.lastCnt=0,h.value=0,h.currentValue=0,h.targetValue=0,h.offsetValue=0,h.background=t.background||e.Texture.EMPTY,h.autoHide=t.autoHide,h.useComma=t.useComma,h.useMoney=t.useMoney,h.useDash=t.useDash,"number"==typeof t.fixVal?h.fixVal=t.fixVal:h.fixVal=0,t.pos&&(s.x=t.pos.x,s.y=t.pos.y),t.pivot&&(s.pivot.x=t.pivot.x,s.pivot.y=t.pivot.y),h.numTe={},h.numSprite=[],u=h.charMap.length,a=0;a<u;a+=1)c=h.charMap[a],r=h.textureName+c,h.numTe[c]=e.utils.TextureCache[r]||e.Texture.EMPTY;for(i=h.numTe[h.charMap[0]],o=i.frame,h.offset=t.offset||o.width,h.symbolOffset=-1,"number"==typeof t.symbolOffset&&(h.symbolOffset=t.symbolOffset),u=h.numCounts,a=0;a<u;a+=1)n=new e.Texture(i.baseTexture,o.clone()),l=new e.Sprite(n),l.anchor.x=h.anchor.x,l.anchor.y=h.anchor.y,h.numSprite[a]=l;s._eventUpdate=s._animChange}clone(e){super.clone();let t=this.custom,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,pivot:this.pivot,anchor:t.anchor,rect:t.rect,display:t.display,alignType:t.alignType,offsetType:t.offsetType,horiType:t.horiType,vertiType:t.vertiType,textureName:t.textureName,numCounts:t.numCounts,charMap:t.charMap,offset:t.offset,symbolOffset:t.symbolOffset,shift:t.shift,background:t.background,autoHide:t.autoHide,fixVal:t.fixVal,useComma:t.useComma,useDash:t.useDash,useMoney:t.useMoney};return new q(n)}removeFromScene(){super.removeFromScene(),this._game.removeUpdate(this)}transverse(){this.setDisplay($.DISPLAY.TRANSVERSE)}straight(){this.setDisplay($.DISPLAY.TRANSVERSE)}setDisplay(e){if(e===$.DISPLAY.TRANSVERSE)this.display=e;else{if(e!==$.DISPLAY.STRAIGHT)return;this.display=e}this.setAlign(this.horiType,this.vertiType)}setBackground(e){this.texture=e}setAnchor(e){if(!e)return;let t,n=this.custom,s=n.anchor,a=n.numSprite.length;for(s.x=e.x,s.y=e.y,t=0;t<a;t+=1)s=n.numSprite[t].anchor,s.x=e.x,s.y=e.y}setAlign(e,t){let n=this.custom;n.alignType=$.ALIGN_TYPE.RECT;let s,a,r=n.rect.pos,i={x:r.x,y:r.y},o=n.anchor,l=n.rect.width,c=n.rect.height,u=n.offset,h={w:0,h:0},m=this.children,d=m.length;if(n.lastCnt===d&&n.horiType===e&&n.vertiType===t)return;switch(n.lastCnt=d,n.horiType=e,n.vertiType=t,m.forEach((e=>{let t=e.texture.frame;"."===e.ch||","===e.ch?(h.w-=u,h.h-=u,a&&(h.w+=a.width,h.h+=a.height),h.w+=t.width,h.h+=t.height,h.w+=2*n.symbolOffset):(h.w+=u,h.h+=u),a=t})),n.horiType){case $.HORI_ALIGN.LEFT:n.display,$.DISPLAY.TRANSVERSE,i.x=r.x;break;case $.HORI_ALIGN.CENTER:n.display===$.DISPLAY.TRANSVERSE?i.x=r.x+.5*l-.5*h.w:i.x=r.x+.5*l;break;case $.HORI_ALIGN.RIGHT:n.display===$.DISPLAY.TRANSVERSE?i.x=r.x+l-h.w:i.x=r.x+l}switch(n.vertiType){case $.VERTI_ALIGN.TOP:i.y=r.y;break;case $.VERTI_ALIGN.CENTER:n.display===$.DISPLAY.TRANSVERSE?i.y=r.y+.5*c:i.y=r.y+.5*c-.5*h.h;break;case $.VERTI_ALIGN.BOTTOM:n.display===$.DISPLAY.TRANSVERSE?i.y=r.y+c:i.y=r.y+c-h.h}let p=0,g={width:0,height:0};for(s=d-1;s>=0;s-=1){let e=m[s],t=e.position,r=e.texture.frame;n.display===$.DISPLAY.TRANSVERSE?(t.x=p+i.x,t.y=i.y):(t.y=p+i.y,t.x=i.x),"."===e.ch||","===e.ch?n.display===$.DISPLAY.TRANSVERSE?(p-=u,p+=g.width,t.x=p+i.x-g.width*o.x+r.width*o.x,p+=r.width+2*n.symbolOffset,t.x+=n.symbolOffset):p+=r.height:p+=u,a=r,g=r}}setAlpha(e){this.children.forEach((t=>{t.alpha=e})),this.custom.alpha=e}set shift(e){this.custom.shift=e}get shift(){return this.custom.shift}set fixVal(e){this.custom.fixVal=e}get fixVal(){return this.custom.fixVal}getValue(){return this.custom.value}setValue(e,t){let n=this,s=n.custom,a=s.event;if(s.currentValue=s.value,s.value=e||0,s.targetValue=e||0,s.currentValue<s.targetValue?s.offsetValue=s.shift:s.currentValue>s.targetValue&&(s.offsetValue=-s.shift),a.begin&&a.begin(n),t)return void n.enable();s.currentValue=s.value;let r,i,o=n,l=n.fixValueString(s.currentValue),c=l.length,u=s.alpha,h=s.numSprite.length-1,m=s.numTe[0].frame;for(;h>=0;){c-=1;let e=s.numSprite[h];c>=0?(i=l[c],r=s.numTe[i],e.ch=i,e.alpha=u,r&&e.texture.width>1&&e.texture.height>1&&(e.texture.frame=r.frame.clone()),o.addChild(e)):(e.ch="0",s.autoHide?o.removeChild(e):(e.texture.width>1&&e.texture.height>1&&(e.texture.frame=m.clone()),e.alpha=u,o.addChild(e))),h-=1}n.setAlign(s.horiType,s.vertiType)}setEvent(e){let t=this.custom.event;t.begin=e.begin||t.begin,t.end=e.end||t.end,t.changeString=e.changeString||t.changeString}_animChange(e){let t=this,n=t.custom,s=n.event,a=n.offsetValue*e*1e3;a<0?n.currentValue<=n.targetValue?(n.currentValue=n.targetValue,t.disable(),s.end&&s.end(t)):n.currentValue=n.currentValue+a:n.currentValue>=n.targetValue?(n.currentValue=n.targetValue,t.disable(),s.end&&s.end(t)):n.currentValue=n.currentValue+a;let r,i,o=t,l=t.fixValueString(n.currentValue),c=n.alpha,u=l.length,h=n.numSprite.length-1,m=n.numTe[0].frame;for(;h>=0;){u-=1;let e=n.numSprite[h];u>=0?(r=l[u],i=n.numTe[r],e.ch=r,e.alpha=c,i&&e.texture.width>1&&e.texture.height>1&&(e.texture.frame=i.frame.clone()),o.addChild(e)):(e.ch="0",n.autoHide?o.removeChild(e):(e.texture.width>1&&e.texture.height>1&&(e.texture.frame=m.clone()),e.alpha=c,o.addChild(e))),h-=1}t.setAlign(n.horiType,n.vertiType)}fixValueString(e){let t=this.custom,n=t.event,s=e.toString(),a=s.lastIndexOf(".");a<0&&t.fixVal>0?(s+=".",a=s.length):a>=0&&0===t.fixVal&&(a=s.lastIndexOf("."),s=s.substr(0,a),a=s.length);for(let e=a+1;e<=a+t.fixVal;e+=1)e>=s.length&&(s=s.concat("0"));let r=s;t.fixVal>0&&s.length>a+t.fixVal&&(r=s.substr(0,a+t.fixVal+1));let i,o,l,c,u=null,h=r.length,m=Math.floor(e);return t.fixVal>0&&(c=r.substr(h-(t.fixVal+1),t.fixVal+1),r=m.toString(),h=r.length),t.useComma?h>6?(i=r.substr(0,h-6),o=r.substr(h-6,3),l=r.substr(h-3,3),u=i+","+o+","+l):h>3?(i=r.substr(0,h-3),o=r.substr(h-3,3),u=i+","+o):u=r:u=r,t.useMoney&&(u="$"+u),t.useDash&&0===t.fixVal&&(u+="_"),t.fixVal>0&&(u+=c),n.changeString&&(u=n.changeString(u)),u}setTexture(e){this.setTextures(e)}setTextures(t){let n=this,s=n.custom;if(s.textureName!==t){let n,a,r,i,o;for(s.textureName=t,n=0,o=s.charMap.length;n<o;n++)i=s.charMap[n],a=s.textureName+i,s.numTe[i]=e.utils.TextureCache[a]||e.Texture.EMPTY;for(r=s.numTe[s.charMap[0]],n=0,o=s.numCounts;n<o;n++){let t=s.numSprite[n];t.texture=new e.Texture(r.baseTexture,r.frame.clone()),t.anchor.x=s.anchor.x,t.anchor.y=s.anchor.y}}s.lastCnt=0,n.setValue(n.custom.currentValue,!1)}enable(){let e=this,t=e.custom;t.enable||(t.enable=!0,e._game.addUpdate(e))}disable(){let e=this,t=e.custom;t.enable&&(t.enable=!1,e._game.removeUpdate(e))}stop(){this.disable()}update(e){this._eventUpdate&&this._eventUpdate(e)}reload(){let t=this,n=t._game.textures,s=t.conf.resource;if(t.custom.textureName="",this.setTextures(s.texture),s.group){let a=O(n,s.group);a&&(t.texture=a[s.background]||e.Texture.EMPTY)}}}}(),function(){let e=globalThis.PIXI;Q=class extends(_(e.Sprite)){static get TYPE(){return W}constructor(t){super(t.background||e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=W,n.name=t.name,n.objName=t.objName,n.isInScene=t.isInScene,n.value={current:1,offset:1,min:1,max:10,range:9},n.value.range=n.value.max-n.value.min,n.eventScroll=null,n.slider=new e.Sprite(t.slider),n.slider.anchor.x=.5,n.addChild(n.slider),t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.limit={offset:0,min:.5*n.conf.slider.width,max:n.conf.width-.5*n.conf.slider.width},n.limit.length=n.limit.max-n.limit.min,n.slider.x=n.limit.min,n.slider.value=0,n.limit.offset=n.limit.length/n.value.range,n.hasMove=!1,n.buttonMode=!0,n.interactive=!0,n.obj=null,n.touchstart=n.mousedown=e=>{let t=parseInt(e.data.global.x);parseInt(e.data.global.y),n.hasMove=!0,n.slider.x=t-n.x,n.slider.x<n.limit.min?n.slider.x=n.limit.min:n.slider.x>=n.limit.max&&(n.slider.x=n.limit.max),n.slider.value=n.slider.x-n.limit.min,n.value.current=n.value.min+n.value.offset*parseInt(n.slider.value/n.limit.offset),n.eventScroll&&n.eventScroll(n.value.current,n)},n.touchend=n.mouseup=e=>{parseInt(e.data.global.x),parseInt(e.data.global.y),n.hasMove=!1},n.slider.buttonMode=!0,n.slider.interactive=!0,n.slider.mousedown=n.slider.touchstart=()=>{n.hasMove=!0},n.slider.mouseup=n.slider.mouseupoutside=n.slider.touchend=n.slider.touchendoutside=()=>{n.hasMove=!1},n.slider.mousemove=n.slider.touchmove=e=>{if(0===e.which&&(n.hasMove=!1),n.hasMove){let t={x:parseInt(e.data.global.x),y:parseInt(e.data.global.y)};n.slider.x=t.x-n.x,n.slider.x<n.limit.min?n.slider.x=n.limit.min:n.slider.x>=n.limit.max&&(n.slider.x=n.limit.max),n.slider.value=n.slider.x-n.limit.min,n.value.current=n.value.min+n.value.offset*parseInt(n.slider.value/n.limit.offset),n.eventScroll&&n.eventScroll(n.value.current,n)}}}clone(){return null}setBindScrollEvent(e){this.eventScroll=e}reset(){this.hasMove=!1}setRange(e){"number"==typeof e.current&&(this.value.current=e.current),"number"==typeof e.offset&&(this.value.offset=e.offset),"number"==typeof e.min&&(this.value.min=e.min),"number"==typeof e.max&&(this.value.max=e.max),"number"==typeof e.range&&(this.value.range=e.range),this.value.current<this.value.min?this.value.current=this.value.min:this.value.current>this.value.max&&(this.value.current=this.value.max),this.value.offset=(this.value.max-this.value.min)/this.value.range,this.limit.offset=this.limit.length/this.value.range,this.slider.value=this.limit.offset*(this.value.current-this.value.min),this.slider.x=this.limit.min+this.slider.value,this.eventScroll&&this.eventScroll(this.value.current,this)}setValue(e){e>=this.value.min&&e<=this.value.max&&(this.value.current=e,this.slider.value=this.limit.offset*((this.value.current-this.value.min)/this.value.range),this.slider.x=this.limit.min+this.slider.value,this.eventScroll&&this.eventScroll(this.value.current,this))}getValue(){return this.value.current}}}(),function(){let e=globalThis.PIXI;X=class extends(_(e.Container)){static get TYPE(){return Y}static getChild(e,t){let n=null,s=e.spineData.slots,a=-1;return s.some(((e,n)=>e.name===t&&(a=n,!0))),a>=0&&(n=e.children[a],n&&n.children[0]&&(n=n.children[0])),n}static getRect(t,n){let s=t.getBounds();if(n){let n=new e.Graphics;t.addChild(n),n.x=0,n.y=0,n.lineStyle(1,255,.75),n.beginFill(65291,.15),n.drawRect(.5*-s.width,.5*-s.height,s.width,s.height),n.endFill(),n.lineStyle(1,0),n.moveTo(0,0),n.lineTo(s.width,s.height),n.moveTo(s.width,0),n.lineTo(0,s.height)}return s}constructor(t){super();let n=this,s=t.spineDataGroup,a=t.textureGroup;n._game=t.game,n.conf=t.conf,n.type=Y,n.name=t.name,n.objName=t.objName||null,n.isInScene=t.isInScene;let r={};n.custom=r,r.childList=[],r.spineAnimList=[],r.group={},r.spineDataGroup=s,r.textureGroup=a,r.configList=t.configList||t.conf&&t.conf.configList,t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),e.spine&&(r.configList.forEach(((t,n)=>{let a,i,o,l;if(i=new e.Sprite(e.Texture.EMPTY),a=new e.spine.Spine(s[t.dataName]),o={x:0,y:0},l=a.getLocalBounds(),a.skeleton.setToSetupPose(),a.autoUpdate=!1,a.state.timeScale=0,a.x=.01,a.y=.01,a.childMap={},a.getChild=e=>a.childMap[e],a.spineData.slots.forEach(((e,t)=>{let n=a.children[t];n&&n.children&&(n=n.children[0],a.childMap[e.name]=n)})),i.name=t.name,i.addChild(a),r.childList[n]=i,t.anchor&&(a.x=-a.width*t.anchor.x+.01,a.y=-a.height*t.anchor.y+.01),o.x=l.x,o.y=l.y,t.fixPosition){let e=t.fixPosition,n=e.offset||{x:0,y:0},s=null;e.childName&&(s=a.getChild(e.childName)),s||(s=a.children[e.childIndex||0].children[0]),l=s.getBounds(),a.x=-l.x+.5*-l.width,a.y=-l.y+.5*-l.height,o.x=a.x+l.x,o.y=a.y+l.y,a.x=a.x+n.x,a.y=a.y+n.y}if(t.debug){let t=new e.Graphics;i.addChild(t),t.x=0,t.y=0,t.lineStyle(1,16711680,.9),t.beginFill(16740363,.1),t.drawRect(a.x+l.x,a.y+l.y,l.width,l.height),t.endFill(),t.lineStyle(0),t.beginFill(0,1),t.drawCircle(o.x,o.y,3),t.endFill(),t.beginFill(16777215,1),t.drawCircle(o.x,o.y,1),t.endFill(),a.children.forEach((t=>{let n=t.children[0];if(n&&n.getBounds||(n=t),n&&n.getBounds){let t=n.getBounds(),s=new e.Graphics;n.addChild(s),s.x=0,s.y=0,s.lineStyle(1,65280,.75),s.beginFill(786288,.15),s.drawRect(.5*-t.width,.5*-t.height,t.width,t.height),s.endFill(),s.lineStyle(0),s.beginFill(0,1),s.drawCircle(0,0,3),s.endFill(),s.beginFill(16777215,1),s.drawCircle(0,0,1),s.endFill()}}))}t.name&&(r.group[t.name]={sprite:i,spine:a,entry:null,animConfig:{animationName:t.animationName,timeScale:t.timeScale,loop:t.loop}}),r.spineAnimList.push(a)})),r.configList.forEach((t=>{let n=r.group[t.name].spine;if(n&&t.mask){let s=e.Texture.EMPTY;a&&(s=a[t.mask.name]||e.Texture.EMPTY);let i=new e.Sprite(s),o=n;if(n.mask=i,t.mask.follow&&(o=r.group[t.mask.follow]),o){let e=o.getLocalBounds();t.mask.local?(i.x=e.x,i.y=e.y):(i.x=0,i.y=0),o.addChild(i)}let l=t.mask.fixPosition;if(l&&o){let e,t=l.offset||{x:0,y:0};l.childName&&(e=o.getChild(l.childName)),e||(e=o.children[l.childIndex||0].children[0]);let n=e.getBounds(),s=o.getBounds(),a=o.getLocalBounds();i.x=a.x+(n.x-s.x)+t.y,i.y=a.y+(n.y-s.y)+t.y}if(t.mask.debug){let t=new e.Graphics,n={x:0,y:0};o&&(n.x=o.x,n.y=o.y,o.parent.addChild(t)),t.x=n.x+i.x,t.y=n.y+i.y,t.lineStyle(1,255,.75),t.beginFill(16740363,.15),t.drawRect(0,0,i.width,i.height),t.endFill(),t.lineStyle(1,0),t.moveTo(0,0),t.lineTo(i.width,i.height),t.moveTo(i.width,0),t.lineTo(0,i.height)}}n&&t.maskList&&t.maskList.forEach((t=>{let s,r,i=e.Texture.EMPTY;a&&(i=a[t.name]||e.Texture.EMPTY);let o=new e.Sprite(i),l=null;t.followName&&(l=n.getChild(t.followName)),l||(l=n.children[t.follow]&&n.children[t.follow].children[0]),s=l,l=null,t.targetName&&(l=n.getChild(t.targetName)),l||(l=n.children[t.target]&&n.children[t.target].children[0]),r=l,r&&(r.mask=o),s&&(o.x=-s.width/2,o.y=-s.height/2,s.addChild(o))}))})))}clone(e){super.clone();let t=this.custom,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,textureGroup:t.textureGroup,spineDataGroup:t.spineDataGroup,configList:t.configList,pos:this.position};return new X(n)}removeFromScene(){this.parent&&this.parent.removeChild(this),this._game.removeUpdate(this)}getGroup(e){return this.custom.group[e]}getSpine(e){let t,n=this.custom.group[e];return n&&(t=n.spine),t}getEntry(e){let t,n=this.custom.group[e];return n&&(t=n.entry),t}getAnimConfig(e){let t,n=this.custom.group[e];return n&&(t=n.animConfig),t}play(e){let t=this,n=t.custom,s=[];e&&Array.isArray(e)?(n.childList.forEach((e=>{t.removeChild(e)})),e.forEach((e=>{let a=n.group[e.name];if(a){let n=a.spine,r=a.sprite,i=a.animConfig;n&&(a.entry=n.state.setAnimation(0,e.animationName||i.animationName,e.loop),n.update(0),n.state.timeScale=e.timeScale||i.timeScale,s.push(n)),t.addChild(r)}}))):Object.getOwnPropertyNames(n.group).forEach((e=>{let a=n.group[e];if(a){let e=a.spine,n=a.sprite,r=a.animConfig;e&&(a.entry=e.state.setAnimation(0,r.animationName,r.loop),e.update(0),e.state.timeScale=r.timeScale,s.push(e)),t.addChild(n)}})),n.spineAnimList=s,t._game.addUpdate(t)}pause(){let e=this.custom;Object.getOwnPropertyNames(e.group).forEach((t=>{let n=e.group[t].spine;n&&(n.state.timeScale=0)}))}resume(){let e=this.custom;Object.getOwnPropertyNames(e.group).forEach((t=>{let n=e.group[t],s=n.spine,a=n.animConfig;s&&(s.state.timeScale=a.timeScale)}))}stop(e){let t=this,n=t.custom;e&&Array.isArray(e)?e.forEach((e=>{let t=n.group[e.name],s=t.spine,a=t.animConfig;a.animationName=e.animationName||a.animationName,s&&(s.state.timeScale=0)})):(Object.getOwnPropertyNames(n.group).forEach((e=>{let t=n.group[e].spine;t&&(t.state.timeScale=0)})),t._game.removeUpdate(t))}update(e){this.custom.spineAnimList.forEach((t=>{t.update(e)}))}reload(){}}}(),function(){let e=globalThis.PIXI;K=class extends(_(e.Sprite)){static get TYPE(){return H}static setFactory(e){z=e}static getFactory(){return z}constructor(t){super(e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=H,n.name=t.name,n.objName=t.objName||null,n.resource={},n.animation={timeScale:1},n.isInScene=t.isInScene,n.isUpdate=!1,t.animation&&(n.animation.name=t.animation.name,n.animation.timeScale=t.animation.timeScale),t.resource&&(n.resource.name=t.resource.name),t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),t.anchor&&(n.anchor.x=t.anchor.x||.5,n.anchor.y=t.anchor.y||.5);let s=z&&z.buildArmature(n.resource.name);if(s){let e=s.display;e.scale.set(1,1),n.addChild(e)}n.armature=s,n.state=null}clone(e){super.clone();let t=this.cloneIndex,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,resource:this.resource,animation:this.animation,name:this.name+".clone."+t,pos:this.sprite.position};return new K(n)}removeFromScene(){let e=this;e.parent&&e.parent.removeChild(e),e.stop()}play(e){let t=this.armature,n=this.animation;t&&(n.name=e||n.name,this.state=t.animation.play(n.name),this.state&&(this.state.timeScale=n.timeScale),this.isUpdate||(this.isUpdate=!0,this._game.addUpdate(this)))}stop(){this.armature&&this.isUpdate&&(this.isUpdate=!1,this._game.removeUpdate(this))}set timeScale(e){this.animation.timeScale=e,this.state&&(this.state.timeScale=e)}get timeScale(){return this.animation.timeScale}update(e){let t=this.armature;t&&t.advanceTime(e)}reload(){}}}(),function(){let e=globalThis.PIXI;ee=class extends(_(e.Text)){static get TYPE(){return Z}constructor(e){super(e.text||"test used");let t=this;t._game=e.game,t.conf=e.conf,t.type=Z,t.name=e.name,t.objName=e.objName,t.isInScene=e.isInScene;let n={fill:"#FFFFFF",stroke:"#000000",strokeThickness:0};e.style&&(n.fill=e.style.fill||"#FFFFFF",n.stroke=e.style.stroke||"#000000",n.strokeThickness=e.style.strokeThickness||0),t.style=n,e.pos&&(t.x=e.pos.x,t.y=e.pos.y),e.anchor&&(t.anchor.x=e.anchor.x||0,t.anchor.y=e.anchor.y||0)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,style:this.style,text:this.text};return new ee(t)}reload(){}}}(),function(){let e=globalThis.PIXI,t=null;e.ParticleContainer?t=e.ParticleContainer:e.particles&&e.particles.ParticleContainer&&(t=e.particles.ParticleContainer),t&&(se=class extends(_(t)){static get TYPE(){return te}static setConfigMap(e){ne=e||ne}static getConfig(e){return ne[e]}constructor(t){super();let n,s=this,a={};s.custom=a,s._game=t.game,s.conf=t.conf,s.type=te,s.name=t.name,s.objName=t.objName,s.isInScene=t.isInScene;let r=t.setting;a.type=r.type,a.config=r.config,a.art=r.art,a.ownerPos=new e.Point(0,0),s.setProperties({scale:!0,position:!0,rotation:!0,uvs:!0,alpha:!0}),e.particles&&e.particles.Emitter&&(n=new e.particles.Emitter(s,a.art,a.config)),n&&("path"===a.type?n.particleConstructor=e.particles.PathParticle:"anim"===a.type&&(n.particleConstructor=e.particles.AnimatedParticle)),t.pos&&(s.x=t.pos.x,s.y=t.pos.y),s.emitter=n}clone(e){super.clone();let t=this.cloneIndex,n=this.custom,s={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+t,pos:this.position,setting:{type:n.type,config:n.config,art:n.art}};return new se(s)}removeFromScene(){super.removeFromScene(),this._game.removeUpdate(this)}play(e,t=0){let n=this,s=n.emitter,a=e||n.custom.ownerPos;s&&(s.emit=!0,s.resetPositionTracking(),s.updateOwnerPos(a.x,a.y),s.update(t),n._game.addUpdate(n))}stop(){this._game.removeUpdate(this)}update(e){this.emitter.update(e)}reload(){}})}(),mt.Animation=F,mt.Button=B,mt.Group=D,mt.Image=U,mt.Number=q,mt.Scrollbar=Q,mt.Spine=X,mt.Bone=K,mt.Text=ee,mt.Particle=se,Ne(n)),ct(n),I(),E(),t(n),pt=!0,e("!! init finish !!")}(null)}))},scene:ht,ui:mt,updateManager:S});export{L,dt as c,gt as n,S as u};
