import e from"mithril";import a from"localforage";import*as t from"nuts";let i={};const n={REAL:"real",DEMO:"demo"},s={OVERVIEW_LOGO:0,OVERVIEW_ANIMATION:1,OVERVIEW_BACKGROUND:2,OVERVIEW_PROGRESS:3,GAME_SCENE_CUSTOM:4,GAME_PERFORMANCE_FPS:5,GAME_DIALOG_CUSTOM:6,GAME_DEBUG_MODE:7},l={PROTOCOL:0,GAME_FORMAT:1},o=45e3;let r=!0,c=!0,g={info:{},isKickOut:!1,group:null,game:null,room:null,host:null,key:null,mode:null,namespace:"develop",currency:null,protocol:null,gameFormat:null,cdn:{errorCounts:0},ping:0},u=[];u[s.OVERVIEW_LOGO]=1,u[s.OVERVIEW_ANIMATION]=1,u[s.OVERVIEW_BACKGROUND]=1,u[s.OVERVIEW_PROGRESS]=0,u[s.GAME_SCENE_CUSTOM]=1,u[s.GAME_PERFORMANCE_FPS]=1,u[s.GAME_DEBUG_MODE]=1,u[s.GAME_DIALOG_CUSTOM]=1;let m={isCheckGameCDN:!1,setting:null,isFinish:!1,loadingEvent:null},h={useAvif:!1,res:null,currentURL:"",isReload:!1,hasCDN:!1,selectCDN:!1,cdnList:[],useCache:!1,hasCache:!1,isCheckGameCDN:!1,disableNet:!1,lobbyName:"",mobileMode:"0",projectURL:"/project/",systemjsURL:"",useOptions:!1,msg:"",ping:!1,isInGame:!1,commandTimeout:15,isManual:!1,launch:null,logo:null,agent:"bg",module:null,langID:"en-us",versionTimestamp:null,version:null},b={URLs:null,isLogin:!1,state:""};var v=Object.freeze({__proto__:null,GAME_MODE:n,MODULE:l,OPTIONS:s,TIME_OUT:45e3,account:b,displayLobby:true,get isDeveloper(){return r},options:u,resource:m,server:g,setting:h,useRelease:function(){r=!1}});let _={EN:"en",JA_JP:"ja-jp",TH_TH:"th-th",VI_VN:"vi-vn",EN_US:"en-us",PT_BR:"pt-br",ZH_TW:"zh-tw",ZH_CN:"zh-cn",IT_IT:"it-it"},p={"en-us":"en-us","en-US":"en-us","ja-jp":"ja-jp","ja-JP":"ja-jp","zh-tw":"zh-tw","zh-TW":"zh-tw","th-th":"th-th","th-TH":"th-th","vi-vn":"vi-vn","vi-VN":"vi-vn","zh-cn":"zh-cn","zh-CN":"zh-cn","pt-br":"pt-br","pt-BR":"pt-br",it:"it-it","it-IT":"it-it","it-it":"it-it",en:"en-us"},T=null,E=_.EN_US;function w(e){let a;return T&&(a=T.get(e)),a}async function f(e){switch(E=p[e],E||(E=_.EN_US),E){case _.EN_US:T=await import("./agent.d7dd0a6b.js");break;case _.IT_IT:T=await import("./agent.5a7ae99d.js");break;case _.JA_JP:T=await import("./agent.90212d40.js");break;case _.PT_BR:T=await import("./agent.65756a56.js");break;case _.TH_TH:T=await import("./agent.f67d617c.js");break;case _.VI_VN:T=await import("./agent.ae6ebf4b.js");break;case _.ZH_CN:T=await import("./agent.ecf95f1a.js");break;case _.ZH_TW:T=await import("./agent.d7b89c71.js")}}function d(){return E}var N=Object.freeze({__proto__:null,ID:_,get:w,getID:d,identify:p,setLanguage:f});var C=Object.freeze({__proto__:null,get:async function(e){let a,t={};switch(e){case"en-us":default:a=await import("./agent.8e9a8961.js"),t=a;break;case"zh-tw":a=await import("./agent.2e7db899.js"),t=a;break;case"zh-cn":a=await import("./agent.fbd66b93.js"),t=a;break;case"vi-vn":a=await import("./agent.c3641b94.js"),t=a}return t}});var O=Object.freeze({__proto__:null,get:async function(e){let a,t={};switch(e){case"en-us":default:a=await import("./agent.b535636e.js"),t=a;break;case"zh-tw":a=await import("./agent.bc59ef4c.js"),t=a;break;case"zh-cn":a=await import("./agent.9a3b4b94.js"),t=a;break;case"vi-vn":a=await import("./agent.7fbc996d.js"),t=a}return t}});let k={client:{eventList:[],errorList:[]}};let L=1;var y={getIP:async function(){try{if(!k.ip){let e=await fetch("//pro.ip-api.com/json?key=5SgCadGS9fH36ub");if(e&&e.ok){let a=await e.json();k.ip=a}}}catch(e){}return k.ip},statistic:k,error:function(e){e&&globalThis.gtag&&gtag("event",e.eventName||"錯誤",{event_category:e.category,event_label:e.label,value:e.value||-1,non_interaction:!0})},report:{name:"",currentURL:""},serviceBegin:function(e){e.time=Math.round(performance.now())},serviceEnd:function(e,a){a||(e.time=Math.round(performance.now())-e.time),globalThis.gtag&&gtag("event","timing_complete",{name:e.name||"後台服務",value:e.time,event_category:e.category,event_label:e.getLabel()});let t={name:e.name||"後台服務",label:e.getLabel(),category:e.category,value:e.time};k.client.eventList.push(t)},loadBegin:function(e){e.time=Math.round(performance.now())},loadEnd:function(e){e.time=Math.round(performance.now())-e.time,globalThis.gtag&&gtag("event","timing_complete",{name:e.name||"加載服務",value:e.time,event_category:e.category,event_label:e.getLabel()});let a={name:e.name||"加載服務",label:e.getLabel(),category:e.category,value:e.time};k.client.eventList.push(a)},log0:function(e){},log:function(e){e&&(globalThis.gtag&&gtag("event",e.eventName||"歷程",{event_category:e.category,event_label:`${e.label}`,value:e.value||-1,non_interaction:!0}),L+=1)}};globalThis.setLobbyName=e=>{h.lobbyName=e},globalThis.disableNetwork=()=>{h.disableNet=!0},globalThis.setLoadingEvent=e=>{m.loadingEvent=e},globalThis.setBaseURL=e=>{globalThis.BASE_URL=e};let j=!1;async function R(){function e(a){globalThis.setCheckGameEvent?(globalThis.setCheckGameEvent({getIP:y.getIP,setLoadingEvent:globalThis.setLoadingEvent,setBaseURL:globalThis.setBaseURL}),globalThis.parent.isCheckGameCDN&&(globalThis.disableNetwork(),globalThis.CDN_LIST=[]),a()):setTimeout((()=>{e(a)}),100)}if(globalThis.parent!==globalThis)return h.isCheckGameCDN=globalThis.parent.isCheckGameCDN,m.isCheckGameCDN=h.isCheckGameCDN,new Promise((a=>{globalThis.parent.isCheckGameCDN||globalThis.parent.isGameManager?e(a):a()}))}!async function(){let{start:n,checkCDN:s}=await import("./agent.f342ba6e.js");await n();let l=h;l.res&&("v1"===l.res?l.useAvif=!1:"v2"===l.res&&(l.useAvif=!0));let o="common";y.log({label:o,category:"啟動程式"});let c={category:"初始化 主網址",getLabel:()=>`${o}`};if(y.loadBegin(c),"check"===l.lobbyName)try{await R()}catch(e){}try{await async function(){let e=null;if(h.useCache){if(navigator.serviceWorker&&navigator.serviceWorker.register)return e=await navigator.serviceWorker.register("/lib.sw.js",{scope:"/"}),h.registration=e,h.hasCache=!0,e.addEventListener("updatefound",(function(){e.update();let a=e.installing;a.addEventListener("statechange",(()=>{"installed"===a.state&&globalThis.location.reload()}))})),navigator.serviceWorker.addEventListener("message",(e=>{})),new Promise((a=>{!function(){if(e&&e.active&&navigator.serviceWorker.controller){let e={};e.config={BASE_URL:globalThis.BASE_URL,CDN_LIST:globalThis.CDN_LIST},navigator.serviceWorker.controller.postMessage(e),a()}else a()}()}))}else navigator.serviceWorker&&navigator.serviceWorker.register&&(e=await navigator.serviceWorker.register("/lib.sw.js?v=2.0.0",{scope:"/"}),e&&e.unregister&&await e.unregister())}()}catch(e){}y.log({eventName:l.hasCache?"使用":"不使用",label:o,category:"確認快取功能"});let g=null,u=null;try{await a.setDriver(a.LOCALSTORAGE),u=a.createInstance({name:"mygames",storeName:"agent2"}),u&&(l.isCheckGameCDN||r||(g=await u.getItem("baseURL"))),l.store=u}catch(e){}if(g)globalThis.BASE_URL=g,y.report.currentURL=g,l.selectCDN=!0;else if(!l.hasCache)try{await s()}catch(e){}y.log({eventName:l.hasCDN?"使用":"不使用",label:o,category:"確認服務線路"});try{const{load:a}=await import("./agent.649098bd.js");await a(),globalThis.Howl=i.Howl,globalThis.Howler=i.Howler,globalThis.Howler&&(globalThis.Howler.autoSuspend=!1),globalThis.isMobile=i.IsMobile(globalThis.navigator.userAgent);let n={Ticker:createjs.Ticker,Howl:i.Howl,m:e};await t.init(n);let o=t.ui.loading,r=async e=>{let a=await e.get(l.langID);l.images=a.images,a.images&&a.images.loading&&o.setScene(a.images.loading)};if(l.useAvif?r(O):r(C),j)return;j=!0;let c=globalThis.createjs.Ticker;c.timingMode=c.TIMEOUT,(await import("./agent.a8e914b0.js").then((function(e){return e.l}))).run({strings:N,checkCDN:s,element:document.body})}catch(e){}y.loadEnd(c),y.log({label:o,category:"初始化 主網址"})}();export{n as G,_ as I,l as M,s as O,o as T,h as a,r as b,g as c,i as d,d as e,m as f,w as g,b as h,p as i,v as j,c as k,u as o,y as r,f as s};
