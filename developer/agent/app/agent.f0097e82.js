import e from"mithril";import t from"localforage";import*as a from"nuts";let n={};const i={REAL:"real",DEMO:"demo"},s={OVERVIEW_LOGO:0,OVERVIEW_ANIMATION:1,OVERVIEW_BACKGROUND:2,OVERVIEW_PROGRESS:3,GAME_SCENE_CUSTOM:4,GAME_PERFORMANCE_FPS:5,GAME_DIALOG_CUSTOM:6,GAME_DEBUG_MODE:7},l={PROTOCOL:0,GAME_FORMAT:1},o=45e3;let r=!0,c=!0,g={info:{},isKickOut:!1,group:null,game:null,room:null,host:null,key:null,mode:null,namespace:"develop",currency:null,protocol:null,gameFormat:null,cdn:{errorCounts:0},ping:0},u=[];u[s.OVERVIEW_LOGO]=1,u[s.OVERVIEW_ANIMATION]=1,u[s.OVERVIEW_BACKGROUND]=1,u[s.OVERVIEW_PROGRESS]=0,u[s.GAME_SCENE_CUSTOM]=1,u[s.GAME_PERFORMANCE_FPS]=1,u[s.GAME_DEBUG_MODE]=1,u[s.GAME_DIALOG_CUSTOM]=1;let m={isCheckGameCDN:!1,setting:null,isFinish:!1,loadingEvent:null},h={useAvif:!1,res:null,currentURL:"",isReload:!1,hasCDN:!1,selectCDN:!1,cdnList:[],useCache:!1,hasCache:!1,isCheckGameCDN:!1,disableNet:!1,lobbyName:"",mobileMode:"0",projectURL:"/project/",systemjsURL:"",useOptions:!1,msg:"",ping:!1,isInGame:!1,commandTimeout:15,isManual:!1,launch:null,logo:"",agent:"bg",module:null,langID:"en-us",versionTimestamp:null,version:null},v={URLs:null,isLogin:!1,state:""};var b=Object.freeze({__proto__:null,GAME_MODE:i,MODULE:l,OPTIONS:s,TIME_OUT:45e3,account:v,displayLobby:true,get isDeveloper(){return r},options:u,resource:m,server:g,setting:h,useRelease:function(){r=!1}});let p={EN:"en",JA_JP:"ja-jp",TH_TH:"th-th",VI_VN:"vi-vn",EN_US:"en-us",PT_BR:"pt-br",ZH_TW:"zh-tw",ZH_CN:"zh-cn",IT_IT:"it-it"},_={"en-us":"en-us","en-US":"en-us","ja-jp":"ja-jp","ja-JP":"ja-jp","zh-tw":"zh-tw","zh-TW":"zh-tw","th-th":"th-th","th-TH":"th-th","vi-vn":"vi-vn","vi-VN":"vi-vn","zh-cn":"zh-cn","zh-CN":"zh-cn","pt-br":"pt-br","pt-BR":"pt-br",it:"it-it","it-IT":"it-it","it-it":"it-it",en:"en-us"},E=null,T=p.EN_US;function f(e){let t;return E&&(t=E.get(e)),t}async function d(e){T=_[e],T||(T=p.EN_US),E=await function(e){switch(e){case"./locales/en-us.js":return import("./agent.5a7ae99d.js");case"./locales/it-it.js":return import("./agent.f67d617c.js");case"./locales/ja-jp.js":return import("./agent.d7dd0a6b.js");case"./locales/pt-br.js":return import("./agent.ae6ebf4b.js");case"./locales/th-th.js":return import("./agent.65756a56.js");case"./locales/vi-vn.js":return import("./agent.90212d40.js");case"./locales/zh-cn.js":return import("./agent.ecf95f1a.js");case"./locales/zh-tw.js":return import("./agent.d7b89c71.js");default:return new Promise((function(t,a){("function"==typeof queueMicrotask?queueMicrotask:setTimeout)(a.bind(null,new Error("Unknown variable dynamic import: "+e)))}))}}(`./locales/${T}.js`)}function w(){return T}var j=Object.freeze({__proto__:null,ID:p,get:f,getID:w,identify:_,setLanguage:d});var C=Object.freeze({__proto__:null,get:async function(e){let t,a={};switch(e){case"en-us":default:t=await import("./agent.48983f6c.js"),a=t;break;case"zh-tw":t=await import("./agent.ae79424e.js"),a=t;break;case"zh-cn":t=await import("./agent.c2d66061.js"),a=t;break;case"vi-vn":t=await import("./agent.581ccda6.js"),a=t}return a}});var N=Object.freeze({__proto__:null,get:async function(e){let t,a={};switch(e){case"en-us":default:t=await import("./agent.77350385.js"),a=t;break;case"zh-tw":t=await import("./agent.20ef0688.js"),a=t;break;case"zh-cn":t=await import("./agent.8de6a296.js"),a=t;break;case"vi-vn":t=await import("./agent.733e1993.js"),a=t}return a}});let O={client:{eventList:[],errorList:[]}};let y=1;var L={getIP:async function(){try{if(!O.ip){let e=await fetch("//pro.ip-api.com/json?key=5SgCadGS9fH36ub");if(e&&e.ok){let t=await e.json();O.ip=t}}}catch(e){}return O.ip},statistic:O,error:function(e){e&&globalThis.gtag&&gtag("event",e.eventName||"錯誤",{event_category:e.category,event_label:e.label,value:e.value||-1,non_interaction:!0})},report:{name:"",currentURL:""},serviceBegin:function(e){e.time=Math.round(performance.now())},serviceEnd:function(e,t){t||(e.time=Math.round(performance.now())-e.time),globalThis.gtag&&gtag("event","timing_complete",{name:e.name||"後台服務",value:e.time,event_category:e.category,event_label:e.getLabel()});let a={name:e.name||"後台服務",label:e.getLabel(),category:e.category,value:e.time};O.client.eventList.push(a)},loadBegin:function(e){e.time=Math.round(performance.now())},loadEnd:function(e){e.time=Math.round(performance.now())-e.time,globalThis.gtag&&gtag("event","timing_complete",{name:e.name||"加載服務",value:e.time,event_category:e.category,event_label:e.getLabel()});let t={name:e.name||"加載服務",label:e.getLabel(),category:e.category,value:e.time};O.client.eventList.push(t)},log0:function(e){},log:function(e){e&&(globalThis.gtag&&gtag("event",e.eventName||"歷程",{event_category:e.category,event_label:`${e.label}`,value:e.value||-1,non_interaction:!0}),y+=1)}};globalThis.setLobbyName=e=>{h.lobbyName=e},globalThis.disableNetwork=()=>{h.disableNet=!0},globalThis.setLoadingEvent=e=>{m.loadingEvent=e},globalThis.setBaseURL=e=>{globalThis.BASE_URL=e};let k=!1;async function M(){function e(t){globalThis.setCheckGameEvent?(globalThis.setCheckGameEvent({getIP:L.getIP,setLoadingEvent:globalThis.setLoadingEvent,setBaseURL:globalThis.setBaseURL}),globalThis.parent.isCheckGameCDN&&(globalThis.disableNetwork(),globalThis.CDN_LIST=[]),t()):setTimeout((()=>{e(t)}),100)}if(globalThis.parent!==globalThis)return h.isCheckGameCDN=globalThis.parent.isCheckGameCDN,m.isCheckGameCDN=h.isCheckGameCDN,new Promise((t=>{globalThis.parent.isCheckGameCDN||globalThis.parent.isGameManager?e(t):t()}))}!async function(){let{start:i,checkCDN:s}=await import("./agent.e24eda1e.js");await i();let l=h;l.res&&("v1"===l.res?l.useAvif=!1:"v2"===l.res&&(l.useAvif=!0));let o="common";L.log({label:o,category:"啟動程式"});let c={category:"初始化 主網址",getLabel:()=>`${o}`};if(L.loadBegin(c),"check"===l.lobbyName)try{await M()}catch(e){}try{await async function(){let e=null;if(h.useCache){if(navigator.serviceWorker&&navigator.serviceWorker.register)return e=await navigator.serviceWorker.register("/lib.sw.js",{scope:"/"}),h.registration=e,h.hasCache=!0,e.addEventListener("updatefound",(function(){e.update();let t=e.installing;t.addEventListener("statechange",(()=>{"installed"===t.state&&globalThis.location.reload()}))})),navigator.serviceWorker.addEventListener("message",(e=>{})),new Promise((t=>{!function(){if(e&&e.active&&navigator.serviceWorker.controller){let e={};e.config={BASE_URL:globalThis.BASE_URL,CDN_LIST:globalThis.CDN_LIST},navigator.serviceWorker.controller.postMessage(e),t()}else t()}()}))}else navigator.serviceWorker&&navigator.serviceWorker.register&&(e=await navigator.serviceWorker.register("/lib.sw.js?v=2.0.0",{scope:"/"}),e&&e.unregister&&await e.unregister())}()}catch(e){}L.log({eventName:l.hasCache?"使用":"不使用",label:o,category:"確認快取功能"});let g=null,u=null;try{await t.setDriver(t.LOCALSTORAGE),u=t.createInstance({name:"mygames",storeName:"agent2"}),u&&(l.isCheckGameCDN||r||(g=await u.getItem("baseURL"))),l.store=u}catch(e){}if(g)globalThis.BASE_URL=g,L.report.currentURL=g,l.selectCDN=!0;else if(!l.hasCache)try{await s()}catch(e){}L.log({eventName:l.hasCDN?"使用":"不使用",label:o,category:"確認服務線路"});try{const{load:t}=await import("./agent.94fe222a.js");await t(),globalThis.Howl=n.Howl,globalThis.Howler=n.Howler,globalThis.Howler&&(globalThis.Howler.autoSuspend=!1),globalThis.isMobile=n.IsMobile(globalThis.navigator.userAgent);let i={Ticker:createjs.Ticker,Howl:n.Howl,m:e};await a.init(i);let o=a.ui.loading,r=async e=>{let t=await e.get(l.langID);l.images=t.images,t.images&&t.images.loading&&o.setScene(t.images.loading)};if(l.useAvif?r(N):r(C),k)return;k=!0;let c=globalThis.createjs.Ticker;c.timingMode=c.TIMEOUT,(await import("./agent.782564cd.js").then((function(e){return e.l}))).run({strings:j,checkCDN:s,element:document.body})}catch(e){}L.loadEnd(c),L.log({label:o,category:"初始化 主網址"})}();export{i as G,p as I,l as M,s as O,o as T,h as a,r as b,g as c,n as d,w as e,m as f,f as g,v as h,_ as i,b as j,c as k,u as o,L as r,d as s};
