import{b as e,s as t,i as o}from"./agent.dd811507.js";import"mithril";import"localforage";let i="filename",r="blob",l={"video/photos":1,"video/domains":1,"video/player":1,"video/player2":1,"scenes/loading":1,"lib/264":1,"lib/player":1};async function a(e,o){let a=globalThis.BASE_URL,n=null,s=null,c=null;if(!t.versionTimestamp){let e=new Date;t.versionTimestamp=e.getTime()}let p=t.versionTimestamp;if(o&&(o.mode&&(n=o.mode),o.version&&(s=o.version)),l[e])try{c=import.meta.resolve(e)}catch(e){}let m=`${t.projectURL}${e}`;if(a&&a.length>0&&("/"===a[a.length-1]&&(a=a.substring(0,a.length-1)),m=m.replace(t.projectURL,"/"),m=`${a}${m}`),!c){let e=null;if(e=s?await fetch(`${m}/v${s}.json`):await fetch(`${m}/index.json?v=${p}`),e&&e.ok){let t=await e.json();c=t.isDebug?t.app:`${m}/${t.app.replace("./","")}`}}if(c){if(n){if(n===i)return{root:a,filename:c,pathname:m};if(n===r){let e=await fetch(c,{credentials:"omit"});if(e&&e.ok){let t=await e.text(),o=new Blob([t]);return{root:a,blob:o,blobURL:globalThis.URL.createObjectURL(o),pathname:m}}return Promise.reject(new Error("getProject error"))}}return{root:a,lib:await import(c),pathname:m}}return Promise.reject(new Error("getProject error"))}async function n(e){return new Promise(((t,o)=>{let i=document.createElement("script");i.type="text/javascript",i.src=e,i.onload=()=>{t()},i.onerror=()=>{o()},document.body.appendChild(i)}))}async function s(){let o,i="/dependence/";t.selectCDN&&(i=`${globalThis.BASE_URL}dependence/`),o=["socket.io/socket.io.min.2.4.0.js","createjs/tweenjs.min.1.0.2.js"];let r=[];for(let e=0;e<o.length;e++){let t=n(i+o[e]);r.push(t)}Promise.all(r);let l=await import("foot"),a=await import("pixi.js"),s=await import("pixi-spine");if(e.PIXI=a,e.spine=s,e.Howl=l.Howl,e.Howler=l.Howler,e.IsMobile=l.IsMobile,e.Mustache=l.Mustache,e.decode=l.decode,!globalThis.PIXI){let t={};Object.defineProperty(t,"PIXI",{get:()=>e.PIXI}),globalThis.PIXI=t.PIXI}}export{a as getProject,s as load};
