var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function a(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),dragonBones;!function(e){var t=function(t){function a(){return t.call(this)||this}return __extends(a,t),a.toString=function(){return"[class dragonBones.PixiTextureAtlasData]"},a.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture&&(this.texture=null)},a.prototype.generateTexture=function(){return e.BaseObject.borrowObject(r)},a}(e.TextureAtlasData);e.PixiTextureAtlasData=t;var r=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.toString=function(){return"[class dragonBones.PixiTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture&&(this.texture.destroy(),this.texture=null)},t}(e.TextureData);e.PixiTextureData=r}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(){return t.call(this)||this}return __extends(r,t),r.prototype._onClear=function(){this._debugDrawer&&this._debugDrawer.destroy(!0),this._armature=null,this._debugDrawer=null,this.destroy()},r.prototype._dispatchEvent=function(e,t){this.emit(e,t)},r.prototype._debugDraw=function(e){if(!this._debugDrawer){this._debugDrawer=new PIXI.Sprite;var t=new PIXI.Graphics;this._debugDrawer.addChild(t)}if(e){this.addChild(this._debugDrawer);var t=this._debugDrawer.getChildAt(0);t.clear();for(var r=this._armature.getBones(),a=0,i=r.length;a<i;++a){var n=r[a],s=n.length,o=n.globalTransformMatrix.tx,l=n.globalTransformMatrix.ty,h=o+n.globalTransformMatrix.a*s,u=l+n.globalTransformMatrix.b*s;t.lineStyle(2,n.ik?16711680:65535,.7),t.moveTo(o,l),t.lineTo(h,u),t.lineStyle(0,0,0),t.beginFill(65535,.7),t.drawCircle(o,l,3),t.endFill()}for(var d=this._armature.getSlots(),a=0,i=d.length;a<i;++a){var p=d[a],_=p.boundingBoxData;if(_){var c=this._debugDrawer.getChildByName(p.name);switch(c||(c=new PIXI.Graphics,c.name=p.name,this._debugDrawer.addChild(c)),c.clear(),c.beginFill(16711935,.3),_.type){case 0:c.drawRect(.5*-_.width,.5*-_.height,_.width,_.height);break;case 1:c.drawEllipse(.5*-_.width,.5*-_.height,_.width,_.height);break;case 2:for(var f=_.vertices,y=0,g=_.vertices.length;y<g;y+=2)0===y?c.moveTo(f[y],f[y+1]):c.lineTo(f[y],f[y+1])}c.endFill(),p._updateTransformAndMatrix();var b=p.globalTransformMatrix.tx-(p.globalTransformMatrix.a*p._pivotX+p.globalTransformMatrix.c*p._pivotY),m=p.globalTransformMatrix.ty-(p.globalTransformMatrix.b*p._pivotX+p.globalTransformMatrix.d*p._pivotY);c.setTransform(b,m,p.global.scaleX,p.global.scaleY,p.global.skewY,p.global.skewX-p.global.skewY)}else{var c=this._debugDrawer.getChildByName(p.name);c&&this._debugDrawer.removeChild(c)}}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},r.prototype.hasEvent=function(e){return this.listeners(e,!0)},r.prototype.addEvent=function(e,t,r){this.addListener(e,t,r)},r.prototype.removeEvent=function(e,t,r){this.removeListener(e,t,r)},r.prototype.dispose=function(e){void 0===e&&(e=!0),this._armature&&(this._armature.dispose(),this._armature=null)},Object.defineProperty(r.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),r.prototype.advanceTimeBySelf=function(t){t?this._armature.clock=e.PixiFactory._clock:this._armature.clock=null},r}(PIXI.Container);e.PixiArmatureDisplay=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(){var e=t.call(this)||this;return e._updateTransform="3"===PIXI.VERSION[0]?e._updateTransformV3:e._updateTransformV4,e}return __extends(r,t),r.toString=function(){return"[class dragonBones.PixiSlot]"},r.prototype._onClear=function(){t.prototype._onClear.call(this),this._renderDisplay=null},r.prototype._initDisplay=function(e){},r.prototype._disposeDisplay=function(e){e.destroy()},r.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},r.prototype._addDisplay=function(){var e=this._armature.display;e.addChild(this._renderDisplay)},r.prototype._replaceDisplay=function(e){var t=this._armature.display,r=e;t.addChild(this._renderDisplay),t.swapChildren(this._renderDisplay,r),t.removeChild(r)},r.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},r.prototype._updateZOrder=function(){var e=this._armature.display,t=e.getChildIndex(this._renderDisplay);t!==this._zOrder&&e.addChildAt(this._renderDisplay,this._zOrder<t?this._zOrder:this._zOrder+1)},r.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},r.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=PIXI.BLEND_MODES.NORMAL;break;case 1:this._renderDisplay.blendMode=PIXI.BLEND_MODES.ADD;break;case 3:this._renderDisplay.blendMode=PIXI.BLEND_MODES.DARKEN;break;case 4:this._renderDisplay.blendMode=PIXI.BLEND_MODES.DIFFERENCE;break;case 6:this._renderDisplay.blendMode=PIXI.BLEND_MODES.HARD_LIGHT;break;case 9:this._renderDisplay.blendMode=PIXI.BLEND_MODES.LIGHTEN;break;case 10:this._renderDisplay.blendMode=PIXI.BLEND_MODES.MULTIPLY;break;case 11:this._renderDisplay.blendMode=PIXI.BLEND_MODES.OVERLAY;break;case 12:this._renderDisplay.blendMode=PIXI.BLEND_MODES.SCREEN}},r.prototype._updateColor=function(){this._renderDisplay.alpha=this._colorTransform.alphaMultiplier},r.prototype._updateFrame=function(){var t=this._meshData&&this._display===this._meshDisplay,r=this._textureData;if(this._displayIndex>=0&&this._display&&r){var a=r.parent;this._armature.replacedTexture&&this._displayData&&a===this._displayData.texture.parent&&(a=this._armature._replaceTextureAtlasData,a||(a=e.BaseObject.borrowObject(e.PixiTextureAtlasData),a.copyFrom(r.parent),a.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=a),r=a.getTexture(r.name));var i=a.texture;if(i){if(r.texture||(r.texture=new PIXI.Texture(i,r.region,r.region,new PIXI.Rectangle(0,0,r.region.width,r.region.height),r.rotated)),t){var n=this._renderDisplay,s=a.width>0?a.width:i.width,o=a.height>0?a.height:i.height;n.uvs=new Float32Array(this._meshData.uvs),n.vertices=new Float32Array(this._meshData.vertices),n.indices=new Uint16Array(this._meshData.vertexIndices);for(var l=0,h=n.uvs.length;l<h;l+=2){var u=n.uvs[l],d=n.uvs[l+1];n.uvs[l]=(r.region.x+u*r.region.width)/s,n.uvs[l+1]=(r.region.y+d*r.region.height)/o}n.texture=r.texture,n.dirty++}else{var p=this._renderDisplay;p.texture=r.texture}return void this._updateVisible()}}if(t){var n=this._renderDisplay;n.visible=!1,n.texture=null,n.x=0,n.y=0}else{var p=this._renderDisplay;p.visible=!1,p.texture=null,p.x=0,p.y=0}},r.prototype._updateMesh=function(){var e=this._renderDisplay,t=this._ffdVertices.length>0;if(this._meshData.skinned)for(var r=0,a=0,i=this._meshData.vertices.length;r<i;r+=2){for(var n=r/2,s=this._meshData.boneIndices[n],o=this._meshData.boneVertices[n],l=this._meshData.weights[n],h=0,u=0,d=0,p=s.length;d<p;++d){var _=this._meshBones[s[d]],c=_.globalTransformMatrix,f=l[d],y=0,g=0;t?(y=o[2*d]+this._ffdVertices[a],g=o[2*d+1]+this._ffdVertices[a+1]):(y=o[2*d],g=o[2*d+1]),h+=(c.a*y+c.c*g+c.tx)*f,u+=(c.b*y+c.d*g+c.ty)*f,a+=2}e.vertices[r]=h,e.vertices[r+1]=u}else if(t)for(var b=this._meshData.vertices,r=0,i=this._meshData.vertices.length;r<i;r+=2){var h=b[r]+this._ffdVertices[r],u=b[r+1]+this._ffdVertices[r+1];e.vertices[r]=h,e.vertices[r+1]=u}},r.prototype._updateTransform=function(e){throw new Error},r.prototype._updateTransformV3=function(e){if(e)this._renderDisplay.setTransform(0,0,1,1,0,0,0,0,0);else{var t=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX+this.globalTransformMatrix.c*this._pivotY),r=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX+this.globalTransformMatrix.d*this._pivotY);this._renderDisplay.setTransform(t,r,this.global.scaleX,this.global.scaleY,this.global.skewY,this.global.skewX-this.global.skewY,0)}},r.prototype._updateTransformV4=function(e){e?this._renderDisplay.setTransform(0,0,1,1,0,0,0,0,0):this._renderDisplay.setTransform(this.globalTransformMatrix.tx,this.globalTransformMatrix.ty,this.global.scaleX,this.global.scaleY,this.global.skewX,0,this.global.skewY-this.global.skewX,this._pivotX,this._pivotY)},r}(e.Slot);e.PixiSlot=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function r(a){void 0===a&&(a=null);var i=t.call(this,a)||this;return r._eventManager||(r._eventManager=new e.PixiArmatureDisplay,r._clock=new e.WorldClock,PIXI.ticker.shared.add(r._clockHandler,r)),i}return __extends(r,t),r._clockHandler=function(e){r._clock.advanceTime(-1)},Object.defineProperty(r,"factory",{get:function(){return r._factory||(r._factory=new r),r._factory},enumerable:!0,configurable:!0}),r.prototype._generateTextureAtlasData=function(t,r){return t?t.texture=r:t=e.BaseObject.borrowObject(e.PixiTextureAtlasData),t},r.prototype._generateArmature=function(t){var a=e.BaseObject.borrowObject(e.Armature),i=new e.PixiArmatureDisplay;return i._armature=a,a._init(t.armature,t.skin,i,i,r._eventManager),a},r.prototype._generateSlot=function(t,r,a){var i=e.BaseObject.borrowObject(e.PixiSlot);i._init(r,new PIXI.Sprite,new PIXI.mesh.Mesh(null,null,null,null,PIXI.mesh.Mesh.DRAW_MODES.TRIANGLES));for(var n=[],s=0,o=r.displays.length;s<o;++s){var l=r.displays[s];switch(l.type){case 0:l.texture&&!t.textureAtlasName||(l.texture=this._getTextureData(t.textureAtlasName||t.dataName,l.path)),n.push(i.rawDisplay);break;case 2:l.texture&&!t.textureAtlasName||(l.texture=this._getTextureData(t.textureAtlasName||t.dataName,l.path)),!l.mesh&&l.share&&(l.mesh=r.getMesh(l.share)),n.push(i.meshDisplay);break;case 1:var h=this.buildArmature(l.path,t.dataName,null,t.textureAtlasName);if(h){if(h.inheritAnimation=l.inheritAnimation,!h.inheritAnimation){var u=r.slot.actions.length>0?r.slot.actions:h.armatureData.actions;if(u.length>0)for(var d=0,p=u.length;d<p;++d)h._bufferAction(u[d]);else h.animation.play()}l.armature=h.armatureData}n.push(h);break;default:n.push(null)}}return i._setDisplayList(n),i},r.prototype.buildArmatureDisplay=function(e,t,a,i){void 0===t&&(t=null),void 0===a&&(a=null),void 0===i&&(i=null);var n=this.buildArmature(e,t,a,i);if(n){var s=n.display;return r._clock.add(n),s}return null},r.prototype.getTextureDisplay=function(e,t){void 0===t&&(t=null);var r=this._getTextureData(t,e);if(r){if(!r.texture){var a=r.parent.texture,i=new PIXI.Rectangle(0,0,r.region.width,r.region.height);r.texture=new PIXI.Texture(a,null,r.region,i,r.rotated)}return new PIXI.Sprite(r.texture)}return null},Object.defineProperty(r.prototype,"soundEventManater",{get:function(){return r._eventManager},enumerable:!0,configurable:!0}),r}(e.BaseFactory);t._factory=null,t._eventManager=null,t._clock=null,e.PixiFactory=t}(dragonBones||(dragonBones={}));