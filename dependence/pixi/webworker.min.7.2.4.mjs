var gc=Object.defineProperty,xc=Object.defineProperties;var vc=Object.getOwnPropertyDescriptors;var bs=Object.getOwnPropertySymbols;var Da=Object.prototype.hasOwnProperty,Ba=Object.prototype.propertyIsEnumerable;var Pa=(e,t,i)=>t in e?gc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Et=(e,t)=>{for(var i in t||(t={}))Da.call(t,i)&&Pa(e,i,t[i]);if(bs)for(var i of bs(t))Ba.call(t,i)&&Pa(e,i,t[i]);return e},Ts=(e,t)=>xc(e,vc(t));var Dr=(e,t)=>{var i={};for(var s in e)Da.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(e!=null&&bs)for(var s of bs(e))t.indexOf(s)<0&&Ba.call(e,s)&&(i[s]=e[s]);return i};var mc;/*!
 * @pixi/webworker - v7.2.4
 * Compiled Thu, 06 Apr 2023 19:36:45 UTC
 *
 * @pixi/webworker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ee=(e=>(e[e.WEBGL_LEGACY=0]="WEBGL_LEGACY",e[e.WEBGL=1]="WEBGL",e[e.WEBGL2=2]="WEBGL2",e))(Ee||{}),Br=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBGL=1]="WEBGL",e[e.CANVAS=2]="CANVAS",e))(Br||{}),Es=(e=>(e[e.COLOR=16384]="COLOR",e[e.DEPTH=256]="DEPTH",e[e.STENCIL=1024]="STENCIL",e))(Es||{}),H=(e=>(e[e.NORMAL=0]="NORMAL",e[e.ADD=1]="ADD",e[e.MULTIPLY=2]="MULTIPLY",e[e.SCREEN=3]="SCREEN",e[e.OVERLAY=4]="OVERLAY",e[e.DARKEN=5]="DARKEN",e[e.LIGHTEN=6]="LIGHTEN",e[e.COLOR_DODGE=7]="COLOR_DODGE",e[e.COLOR_BURN=8]="COLOR_BURN",e[e.HARD_LIGHT=9]="HARD_LIGHT",e[e.SOFT_LIGHT=10]="SOFT_LIGHT",e[e.DIFFERENCE=11]="DIFFERENCE",e[e.EXCLUSION=12]="EXCLUSION",e[e.HUE=13]="HUE",e[e.SATURATION=14]="SATURATION",e[e.COLOR=15]="COLOR",e[e.LUMINOSITY=16]="LUMINOSITY",e[e.NORMAL_NPM=17]="NORMAL_NPM",e[e.ADD_NPM=18]="ADD_NPM",e[e.SCREEN_NPM=19]="SCREEN_NPM",e[e.NONE=20]="NONE",e[e.SRC_OVER=0]="SRC_OVER",e[e.SRC_IN=21]="SRC_IN",e[e.SRC_OUT=22]="SRC_OUT",e[e.SRC_ATOP=23]="SRC_ATOP",e[e.DST_OVER=24]="DST_OVER",e[e.DST_IN=25]="DST_IN",e[e.DST_OUT=26]="DST_OUT",e[e.DST_ATOP=27]="DST_ATOP",e[e.ERASE=26]="ERASE",e[e.SUBTRACT=28]="SUBTRACT",e[e.XOR=29]="XOR",e))(H||{}),Wt=(e=>(e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e))(Wt||{}),R=(e=>(e[e.RGBA=6408]="RGBA",e[e.RGB=6407]="RGB",e[e.RG=33319]="RG",e[e.RED=6403]="RED",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.ALPHA=6406]="ALPHA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e))(R||{}),Oe=(e=>(e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e))(Oe||{}),G=(e=>(e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.BYTE=5120]="BYTE",e[e.SHORT=5122]="SHORT",e[e.INT=5124]="INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.HALF_FLOAT=36193]="HALF_FLOAT",e))(G||{}),ws=(e=>(e[e.FLOAT=0]="FLOAT",e[e.INT=1]="INT",e[e.UINT=2]="UINT",e))(ws||{}),ne=(e=>(e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR",e))(ne||{}),ae=(e=>(e[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e))(ae||{}),$t=(e=>(e[e.OFF=0]="OFF",e[e.POW2=1]="POW2",e[e.ON=2]="ON",e[e.ON_MANUAL=3]="ON_MANUAL",e))($t||{}),Ut=(e=>(e[e.NPM=0]="NPM",e[e.UNPACK=1]="UNPACK",e[e.PMA=2]="PMA",e[e.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",e[e.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",e[e.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",e))(Ut||{}),Yt=(e=>(e[e.NO=0]="NO",e[e.YES=1]="YES",e[e.AUTO=2]="AUTO",e[e.BLEND=0]="BLEND",e[e.CLEAR=1]="CLEAR",e[e.BLIT=2]="BLIT",e))(Yt||{}),As=(e=>(e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL",e))(As||{}),Bt=(e=>(e.LOW="lowp",e.MEDIUM="mediump",e.HIGH="highp",e))(Bt||{}),ut=(e=>(e[e.NONE=0]="NONE",e[e.SCISSOR=1]="SCISSOR",e[e.STENCIL=2]="STENCIL",e[e.SPRITE=3]="SPRITE",e[e.COLOR=4]="COLOR",e))(ut||{}),Oa=(e=>(e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e))(Oa||{}),ot=(e=>(e[e.NONE=0]="NONE",e[e.LOW=2]="LOW",e[e.MEDIUM=4]="MEDIUM",e[e.HIGH=8]="HIGH",e))(ot||{}),qt=(e=>(e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e))(qt||{});const Fa={createCanvas:(e,t)=>{const i=document.createElement("canvas");return i.width=e,i.height=t,i},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var e;return(e=document.baseURI)!=null?e:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},N={ADAPTER:Fa,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Or=/iPhone/i,La=/iPod/i,Ua=/iPad/i,ka=/\biOS-universal(?:.+)Mac\b/i,Fr=/\bAndroid(?:.+)Mobile\b/i,Ga=/Android/i,Ze=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ss=/Silk/i,fe=/Windows Phone/i,Ha=/\bWindows(?:.+)ARM\b/i,Xa=/BlackBerry/i,Va=/BB10/i,za=/Opera Mini/i,ja=/\b(CriOS|Chrome)(?:.+)Mobile/i,Wa=/Mobile(?:.+)Firefox\b/i,$a=function(e){return typeof e!="undefined"&&e.platform==="MacIntel"&&typeof e.maxTouchPoints=="number"&&e.maxTouchPoints>1&&typeof MSStream=="undefined"};function yc(e){return function(t){return t.test(e)}}function Ya(e){var t={userAgent:"",platform:"",maxTouchPoints:0};!e&&typeof navigator!="undefined"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof e=="string"?t.userAgent=e:e&&e.userAgent&&(t={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0});var i=t.userAgent,s=i.split("[FBAN");typeof s[1]!="undefined"&&(i=s[0]),s=i.split("Twitter"),typeof s[1]!="undefined"&&(i=s[0]);var r=yc(i),n={apple:{phone:r(Or)&&!r(fe),ipod:r(La),tablet:!r(Or)&&(r(Ua)||$a(t))&&!r(fe),universal:r(ka),device:(r(Or)||r(La)||r(Ua)||r(ka)||$a(t))&&!r(fe)},amazon:{phone:r(Ze),tablet:!r(Ze)&&r(Ss),device:r(Ze)||r(Ss)},android:{phone:!r(fe)&&r(Ze)||!r(fe)&&r(Fr),tablet:!r(fe)&&!r(Ze)&&!r(Fr)&&(r(Ss)||r(Ga)),device:!r(fe)&&(r(Ze)||r(Ss)||r(Fr)||r(Ga))||r(/\bokhttp\b/i)},windows:{phone:r(fe),tablet:r(Ha),device:r(fe)||r(Ha)},other:{blackberry:r(Xa),blackberry10:r(Va),opera:r(za),firefox:r(Wa),chrome:r(ja),device:r(Xa)||r(Va)||r(za)||r(Wa)||r(ja)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const bc=(mc=Ya.default)!=null?mc:Ya,we=bc(globalThis.navigator);N.RETINA_PREFIX=/@([0-9\.]+)x/,N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Lr=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function am(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Cs(e,t,i){return i={path:t,exports:{},require:function(s,r){return Tc(s,r==null?i.path:r)}},e(i,i.exports),i.exports}function om(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function hm(e){return e&&Object.prototype.hasOwnProperty.call(e,"default")&&Object.keys(e).length===1?e.default:e}function lm(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),t}function Tc(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var bi=Cs(function(e){"use strict";var t=Object.prototype.hasOwnProperty,i="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new r(c,u||h,d),p=i?i+l:l;return h._events[p]?h._events[p].fn?h._events[p]=[h._events[p],f]:h._events[p].push(f):(h._events[p]=f,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new s:delete h._events[l]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)t.call(c,u)&&l.push(i?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=i?i+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},o.prototype.listenerCount=function(l){var c=i?i+l:l,u=this._events[c];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,c,u,d,f,p){var _=i?i+l:l;if(!this._events[_])return!1;var m=this._events[_],x=arguments.length,y,g;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,u),!0;case 4:return m.fn.call(m.context,c,u,d),!0;case 5:return m.fn.call(m.context,c,u,d,f),!0;case 6:return m.fn.call(m.context,c,u,d,f,p),!0}for(g=1,y=new Array(x-1);g<x;g++)y[g-1]=arguments[g];m.fn.apply(m.context,y)}else{var v=m.length,w;for(g=0;g<v;g++)switch(m[g].once&&this.removeListener(l,m[g].fn,void 0,!0),x){case 1:m[g].fn.call(m[g].context);break;case 2:m[g].fn.call(m[g].context,c);break;case 3:m[g].fn.call(m[g].context,c,u);break;case 4:m[g].fn.call(m[g].context,c,u,d);break;default:if(!y)for(w=1,y=new Array(x-1);w<x;w++)y[w-1]=arguments[w];m[g].fn.apply(m[g].context,y)}}return!0},o.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},o.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},o.prototype.removeListener=function(l,c,u,d){var f=i?i+l:l;if(!this._events[f])return this;if(!c)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&a(this,f);else{for(var _=0,m=[],x=p.length;_<x;_++)(p[_].fn!==c||d&&!p[_].once||u&&p[_].context!==u)&&m.push(p[_]);m.length?this._events[f]=m.length===1?m[0]:m:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=i?i+l:l,this._events[c]&&a(this,c)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o}),Ur=Rs,Ec=Rs;function Rs(e,t,i){i=i||2;var s=t&&t.length,r=s?t[0]*i:e.length,n=qa(e,0,r,i,!0),a=[];if(!n||n.next===n.prev)return a;var o,h,l,c,u,d,f;if(s&&(n=Rc(e,t,n,i)),e.length>80*i){o=l=e[0],h=c=e[1];for(var p=i;p<r;p+=i)u=e[p],d=e[p+1],u<o&&(o=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);f=Math.max(l-o,c-h),f=f!==0?32767/f:0}return Ti(n,a,i,o,h,f,0),a}function qa(e,t,i,s,r){var n,a;if(r===Hr(e,t,i,s)>0)for(n=t;n<i;n+=s)a=Qa(n,e[n],e[n+1],a);else for(n=i-s;n>=t;n-=s)a=Qa(n,e[n],e[n+1],a);return a&&Is(a,a.next)&&(wi(a),a=a.next),a}function Fe(e,t){if(!e)return e;t||(t=e);var i=e,s;do if(s=!1,!i.steiner&&(Is(i,i.next)||st(i.prev,i,i.next)===0)){if(wi(i),i=t=i.prev,i===i.next)break;s=!0}else i=i.next;while(s||i!==t);return t}function Ti(e,t,i,s,r,n,a){if(!!e){!a&&n&&Dc(e,s,r,n);for(var o=e,h,l;e.prev!==e.next;){if(h=e.prev,l=e.next,n?Ac(e,s,r,n):wc(e)){t.push(h.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),wi(e),e=l.next,o=l.next;continue}if(e=l,e===o){a?a===1?(e=Sc(Fe(e),t,i),Ti(e,t,i,s,r,n,2)):a===2&&Cc(e,t,i,s,r,n):Ti(Fe(e),t,i,s,r,n,1);break}}}}function wc(e){var t=e.prev,i=e,s=e.next;if(st(t,i,s)>=0)return!1;for(var r=t.x,n=i.x,a=s.x,o=t.y,h=i.y,l=s.y,c=r<n?r<a?r:a:n<a?n:a,u=o<h?o<l?o:l:h<l?h:l,d=r>n?r>a?r:a:n>a?n:a,f=o>h?o>l?o:l:h>l?h:l,p=s.next;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&Ke(r,o,n,h,a,l,p.x,p.y)&&st(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Ac(e,t,i,s){var r=e.prev,n=e,a=e.next;if(st(r,n,a)>=0)return!1;for(var o=r.x,h=n.x,l=a.x,c=r.y,u=n.y,d=a.y,f=o<h?o<l?o:l:h<l?h:l,p=c<u?c<d?c:d:u<d?u:d,_=o>h?o>l?o:l:h>l?h:l,m=c>u?c>d?c:d:u>d?u:d,x=kr(f,p,t,i,s),y=kr(_,m,t,i,s),g=e.prevZ,v=e.nextZ;g&&g.z>=x&&v&&v.z<=y;){if(g.x>=f&&g.x<=_&&g.y>=p&&g.y<=m&&g!==r&&g!==a&&Ke(o,c,h,u,l,d,g.x,g.y)&&st(g.prev,g,g.next)>=0||(g=g.prevZ,v.x>=f&&v.x<=_&&v.y>=p&&v.y<=m&&v!==r&&v!==a&&Ke(o,c,h,u,l,d,v.x,v.y)&&st(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;g&&g.z>=x;){if(g.x>=f&&g.x<=_&&g.y>=p&&g.y<=m&&g!==r&&g!==a&&Ke(o,c,h,u,l,d,g.x,g.y)&&st(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;v&&v.z<=y;){if(v.x>=f&&v.x<=_&&v.y>=p&&v.y<=m&&v!==r&&v!==a&&Ke(o,c,h,u,l,d,v.x,v.y)&&st(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Sc(e,t,i){var s=e;do{var r=s.prev,n=s.next.next;!Is(r,n)&&Za(r,s,s.next,n)&&Ei(r,n)&&Ei(n,r)&&(t.push(r.i/i|0),t.push(s.i/i|0),t.push(n.i/i|0),wi(s),wi(s.next),s=e=n),s=s.next}while(s!==e);return Fe(s)}function Cc(e,t,i,s,r,n){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&Fc(a,o)){var h=Ka(a,o);a=Fe(a,a.next),h=Fe(h,h.next),Ti(a,t,i,s,r,n,0),Ti(h,t,i,s,r,n,0);return}o=o.next}a=a.next}while(a!==e)}function Rc(e,t,i,s){var r=[],n,a,o,h,l;for(n=0,a=t.length;n<a;n++)o=t[n]*s,h=n<a-1?t[n+1]*s:e.length,l=qa(e,o,h,s,!1),l===l.next&&(l.steiner=!0),r.push(Oc(l));for(r.sort(Ic),n=0;n<r.length;n++)i=Mc(r[n],i);return i}function Ic(e,t){return e.x-t.x}function Mc(e,t){var i=Nc(e,t);if(!i)return t;var s=Ka(i,e);return Fe(s,s.next),Fe(i,i.next)}function Nc(e,t){var i=t,s=e.x,r=e.y,n=-1/0,a;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var o=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=s&&o>n&&(n=o,a=i.x<i.next.x?i:i.next,o===s))return a}i=i.next}while(i!==t);if(!a)return null;var h=a,l=a.x,c=a.y,u=1/0,d;i=a;do s>=i.x&&i.x>=l&&s!==i.x&&Ke(r<c?s:n,r,l,c,r<c?n:s,r,i.x,i.y)&&(d=Math.abs(r-i.y)/(s-i.x),Ei(i,e)&&(d<u||d===u&&(i.x>a.x||i.x===a.x&&Pc(a,i)))&&(a=i,u=d)),i=i.next;while(i!==h);return a}function Pc(e,t){return st(e.prev,e,t.prev)<0&&st(t.next,e,e.next)<0}function Dc(e,t,i,s){var r=e;do r.z===0&&(r.z=kr(r.x,r.y,t,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,Bc(r)}function Bc(e){var t,i,s,r,n,a,o,h,l=1;do{for(i=e,e=null,n=null,a=0;i;){for(a++,s=i,o=0,t=0;t<l&&(o++,s=s.nextZ,!!s);t++);for(h=l;o>0||h>0&&s;)o!==0&&(h===0||!s||i.z<=s.z)?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:e=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(a>1);return e}function kr(e,t,i,s,r){return e=(e-i)*r|0,t=(t-s)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Oc(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Ke(e,t,i,s,r,n,a,o){return(r-a)*(t-o)>=(e-a)*(n-o)&&(e-a)*(s-o)>=(i-a)*(t-o)&&(i-a)*(n-o)>=(r-a)*(s-o)}function Fc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Lc(e,t)&&(Ei(e,t)&&Ei(t,e)&&Uc(e,t)&&(st(e.prev,e,t.prev)||st(e,t.prev,t))||Is(e,t)&&st(e.prev,e,e.next)>0&&st(t.prev,t,t.next)>0)}function st(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Is(e,t){return e.x===t.x&&e.y===t.y}function Za(e,t,i,s){var r=Ns(st(e,t,i)),n=Ns(st(e,t,s)),a=Ns(st(i,s,e)),o=Ns(st(i,s,t));return!!(r!==n&&a!==o||r===0&&Ms(e,i,t)||n===0&&Ms(e,s,t)||a===0&&Ms(i,e,s)||o===0&&Ms(i,t,s))}function Ms(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ns(e){return e>0?1:e<0?-1:0}function Lc(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Za(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Ei(e,t){return st(e.prev,e,e.next)<0?st(e,t,e.next)>=0&&st(e,e.prev,t)>=0:st(e,t,e.prev)<0||st(e,e.next,t)<0}function Uc(e,t){var i=e,s=!1,r=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==e);return s}function Ka(e,t){var i=new Gr(e.i,e.x,e.y),s=new Gr(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function Qa(e,t,i,s){var r=new Gr(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function wi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gr(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Rs.deviation=function(e,t,i,s){var r=t&&t.length,n=r?t[0]*i:e.length,a=Math.abs(Hr(e,0,n,i));if(r)for(var o=0,h=t.length;o<h;o++){var l=t[o]*i,c=o<h-1?t[o+1]*i:e.length;a-=Math.abs(Hr(e,l,c,i))}var u=0;for(o=0;o<s.length;o+=3){var d=s[o]*i,f=s[o+1]*i,p=s[o+2]*i;u+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Hr(e,t,i,s){for(var r=0,n=t,a=i-s;n<i;n+=s)r+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return r}Rs.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)for(var a=0;a<t;a++)i.vertices.push(e[r][n][a]);r>0&&(s+=e[r-1].length,i.holes.push(s))}return i},Ur.default=Ec;var kc=Cs(function(e,t){/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i){var s=t&&!t.nodeType&&t,r=e&&!e.nodeType&&e,n=typeof Lr=="object"&&Lr;(n.global===n||n.window===n||n.self===n)&&(i=n);var a,o=2147483647,h=36,l=1,c=26,u=38,d=700,f=72,p=128,_="-",m=/^xn--/,x=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=h-l,w=Math.floor,P=String.fromCharCode,C;function T(S){throw RangeError(g[S])}function M(S,X){for(var Y=S.length,K=[];Y--;)K[Y]=X(S[Y]);return K}function k(S,X){var Y=S.split("@"),K="";Y.length>1&&(K=Y[0]+"@",S=Y[1]),S=S.replace(y,".");var Q=S.split("."),pt=M(Q,X).join(".");return K+pt}function A(S){for(var X=[],Y=0,K=S.length,Q,pt;Y<K;)Q=S.charCodeAt(Y++),Q>=55296&&Q<=56319&&Y<K?(pt=S.charCodeAt(Y++),(pt&64512)==56320?X.push(((Q&1023)<<10)+(pt&1023)+65536):(X.push(Q),Y--)):X.push(Q);return X}function O(S){return M(S,function(X){var Y="";return X>65535&&(X-=65536,Y+=P(X>>>10&1023|55296),X=56320|X&1023),Y+=P(X),Y}).join("")}function E(S){return S-48<10?S-22:S-65<26?S-65:S-97<26?S-97:h}function b(S,X){return S+22+75*(S<26)-((X!=0)<<5)}function V(S,X,Y){var K=0;for(S=Y?w(S/d):S>>1,S+=w(S/X);S>v*c>>1;K+=h)S=w(S/v);return w(K+(v+1)*S/(S+u))}function L(S){var X=[],Y=S.length,K,Q=0,pt=p,lt=f,mt,Tt,Dt,bt,et,ct,dt,se,re;for(mt=S.lastIndexOf(_),mt<0&&(mt=0),Tt=0;Tt<mt;++Tt)S.charCodeAt(Tt)>=128&&T("not-basic"),X.push(S.charCodeAt(Tt));for(Dt=mt>0?mt+1:0;Dt<Y;){for(bt=Q,et=1,ct=h;Dt>=Y&&T("invalid-input"),dt=E(S.charCodeAt(Dt++)),(dt>=h||dt>w((o-Q)/et))&&T("overflow"),Q+=dt*et,se=ct<=lt?l:ct>=lt+c?c:ct-lt,!(dt<se);ct+=h)re=h-se,et>w(o/re)&&T("overflow"),et*=re;K=X.length+1,lt=V(Q-bt,K,bt==0),w(Q/K)>o-pt&&T("overflow"),pt+=w(Q/K),Q%=K,X.splice(Q++,0,pt)}return O(X)}function I(S){var X,Y,K,Q,pt,lt,mt,Tt,Dt,bt,et,ct=[],dt,se,re,yi;for(S=A(S),dt=S.length,X=p,Y=0,pt=f,lt=0;lt<dt;++lt)et=S[lt],et<128&&ct.push(P(et));for(K=Q=ct.length,Q&&ct.push(_);K<dt;){for(mt=o,lt=0;lt<dt;++lt)et=S[lt],et>=X&&et<mt&&(mt=et);for(se=K+1,mt-X>w((o-Y)/se)&&T("overflow"),Y+=(mt-X)*se,X=mt,lt=0;lt<dt;++lt)if(et=S[lt],et<X&&++Y>o&&T("overflow"),et==X){for(Tt=Y,Dt=h;bt=Dt<=pt?l:Dt>=pt+c?c:Dt-pt,!(Tt<bt);Dt+=h)yi=Tt-bt,re=h-bt,ct.push(P(b(bt+yi%re,0))),Tt=w(yi/re);ct.push(P(b(Tt,0))),pt=V(Y,se,K==Q),Y=0,++K}++Y,++X}return ct.join("")}function q(S){return k(S,function(X){return m.test(X)?L(X.slice(4).toLowerCase()):X})}function rt(S){return k(S,function(X){return x.test(X)?"xn--"+I(X):X})}if(a={version:"1.3.2",ucs2:{decode:A,encode:O},decode:L,encode:I,toASCII:rt,toUnicode:q},s&&r)if(e.exports==s)r.exports=a;else for(C in a)a.hasOwnProperty(C)&&(s[C]=a[C]);else i.punycode=a})(Lr)}),oe={isString:function(e){return typeof e=="string"},isObject:function(e){return typeof e=="object"&&e!==null},isNull:function(e){return e===null},isNullOrUndefined:function(e){return e==null}};function Gc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Hc=function(e,t,i,s){t=t||"&",i=i||"=";var r={};if(typeof e!="string"||e.length===0)return r;var n=/\+/g;e=e.split(t);var a=1e3;s&&typeof s.maxKeys=="number"&&(a=s.maxKeys);var o=e.length;a>0&&o>a&&(o=a);for(var h=0;h<o;++h){var l=e[h].replace(n,"%20"),c=l.indexOf(i),u,d,f,p;c>=0?(u=l.substr(0,c),d=l.substr(c+1)):(u=l,d=""),f=decodeURIComponent(u),p=decodeURIComponent(d),Gc(r,f)?Array.isArray(r[f])?r[f].push(p):r[f]=[r[f],p]:r[f]=p}return r},Ai=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},Xc=function(e,t,i,s){return t=t||"&",i=i||"=",e===null&&(e=void 0),typeof e=="object"?Object.keys(e).map(function(r){var n=encodeURIComponent(Ai(r))+i;return Array.isArray(e[r])?e[r].map(function(a){return n+encodeURIComponent(Ai(a))}).join(t):n+encodeURIComponent(Ai(e[r]))}).join(t):s?encodeURIComponent(Ai(s))+i+encodeURIComponent(Ai(e)):""},Xr=Cs(function(e,t){"use strict";t.decode=t.parse=Hc,t.encode=t.stringify=Xc}),Ja=Si,to=tu,Vc=eu,eo=Jc,zc=kt;function kt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var jc=/^([a-z0-9.+-]+:)/i,Wc=/:[0-9]*$/,$c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Yc=["<",">",'"',"`"," ","\r",`
`,"	"],qc=["{","}","|","\\","^","`"].concat(Yc),Vr=["'"].concat(qc),io=["%","/","?",";","#"].concat(Vr),so=["/","?","#"],Zc=255,ro=/^[+a-z0-9A-Z_-]{0,63}$/,Kc=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Qc={javascript:!0,"javascript:":!0},zr={javascript:!0,"javascript:":!0},Qe={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function Si(e,t,i){if(e&&oe.isObject(e)&&e instanceof kt)return e;var s=new kt;return s.parse(e,t,i),s}kt.prototype.parse=function(e,t,i){if(!oe.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var s=e.indexOf("?"),r=s!==-1&&s<e.indexOf("#")?"?":"#",n=e.split(r),a=/\\/g;n[0]=n[0].replace(a,"/"),e=n.join(r);var o=e;if(o=o.trim(),!i&&e.split("#").length===1){var h=$c.exec(o);if(h)return this.path=o,this.href=o,this.pathname=h[1],h[2]?(this.search=h[2],t?this.query=Xr.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var l=jc.exec(o);if(l){l=l[0];var c=l.toLowerCase();this.protocol=c,o=o.substr(l.length)}if(i||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=o.substr(0,2)==="//";u&&!(l&&zr[l])&&(o=o.substr(2),this.slashes=!0)}if(!zr[l]&&(u||l&&!Qe[l])){for(var d=-1,f=0;f<so.length;f++){var p=o.indexOf(so[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var _,m;d===-1?m=o.lastIndexOf("@"):m=o.lastIndexOf("@",d),m!==-1&&(_=o.slice(0,m),o=o.slice(m+1),this.auth=decodeURIComponent(_)),d=-1;for(var f=0;f<io.length;f++){var p=o.indexOf(io[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||"";var x=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!x)for(var y=this.hostname.split(/\./),f=0,g=y.length;f<g;f++){var v=y[f];if(!!v&&!v.match(ro)){for(var w="",P=0,C=v.length;P<C;P++)v.charCodeAt(P)>127?w+="x":w+=v[P];if(!w.match(ro)){var T=y.slice(0,f),M=y.slice(f+1),k=v.match(Kc);k&&(T.push(k[1]),M.unshift(k[2])),M.length&&(o="/"+M.join(".")+o),this.hostname=T.join(".");break}}}this.hostname.length>Zc?this.hostname="":this.hostname=this.hostname.toLowerCase(),x||(this.hostname=kc.toASCII(this.hostname));var A=this.port?":"+this.port:"",O=this.hostname||"";this.host=O+A,this.href+=this.host,x&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!Qc[c])for(var f=0,g=Vr.length;f<g;f++){var E=Vr[f];if(o.indexOf(E)!==-1){var b=encodeURIComponent(E);b===E&&(b=escape(E)),o=o.split(E).join(b)}}var V=o.indexOf("#");V!==-1&&(this.hash=o.substr(V),o=o.slice(0,V));var L=o.indexOf("?");if(L!==-1?(this.search=o.substr(L),this.query=o.substr(L+1),t&&(this.query=Xr.parse(this.query)),o=o.slice(0,L)):t&&(this.search="",this.query={}),o&&(this.pathname=o),Qe[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var A=this.pathname||"",I=this.search||"";this.path=A+I}return this.href=this.format(),this};function Jc(e){return oe.isString(e)&&(e=Si(e)),e instanceof kt?e.format():kt.prototype.format.call(e)}kt.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",s=this.hash||"",r=!1,n="";this.host?r=e+this.host:this.hostname&&(r=e+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&oe.isObject(this.query)&&Object.keys(this.query).length&&(n=Xr.stringify(this.query));var a=this.search||n&&"?"+n||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Qe[t])&&r!==!1?(r="//"+(r||""),i&&i.charAt(0)!=="/"&&(i="/"+i)):r||(r=""),s&&s.charAt(0)!=="#"&&(s="#"+s),a&&a.charAt(0)!=="?"&&(a="?"+a),i=i.replace(/[?#]/g,function(o){return encodeURIComponent(o)}),a=a.replace("#","%23"),t+r+i+a+s};function tu(e,t){return Si(e,!1,!0).resolve(t)}kt.prototype.resolve=function(e){return this.resolveObject(Si(e,!1,!0)).format()};function eu(e,t){return e?Si(e,!1,!0).resolveObject(t):t}kt.prototype.resolveObject=function(e){if(oe.isString(e)){var t=new kt;t.parse(e,!1,!0),e=t}for(var i=new kt,s=Object.keys(this),r=0;r<s.length;r++){var n=s[r];i[n]=this[n]}if(i.hash=e.hash,e.href==="")return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),o=0;o<a.length;o++){var h=a[o];h!=="protocol"&&(i[h]=e[h])}return Qe[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!Qe[e.protocol]){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];i[u]=e[u]}return i.href=i.format(),i}if(i.protocol=e.protocol,!e.host&&!zr[e.protocol]){for(var g=(e.pathname||"").split("/");g.length&&!(e.host=g.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),g[0]!==""&&g.unshift(""),g.length<2&&g.unshift(""),i.pathname=g.join("/")}else i.pathname=e.pathname;if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var d=i.pathname||"",f=i.search||"";i.path=d+f}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var p=i.pathname&&i.pathname.charAt(0)==="/",_=e.host||e.pathname&&e.pathname.charAt(0)==="/",m=_||p||i.host&&e.pathname,x=m,y=i.pathname&&i.pathname.split("/")||[],g=e.pathname&&e.pathname.split("/")||[],v=i.protocol&&!Qe[i.protocol];if(v&&(i.hostname="",i.port=null,i.host&&(y[0]===""?y[0]=i.host:y.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(g[0]===""?g[0]=e.host:g.unshift(e.host)),e.host=null),m=m&&(g[0]===""||y[0]==="")),_)i.host=e.host||e.host===""?e.host:i.host,i.hostname=e.hostname||e.hostname===""?e.hostname:i.hostname,i.search=e.search,i.query=e.query,y=g;else if(g.length)y||(y=[]),y.pop(),y=y.concat(g),i.search=e.search,i.query=e.query;else if(!oe.isNullOrUndefined(e.search)){if(v){i.hostname=i.host=y.shift();var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return i.search=e.search,i.query=e.query,(!oe.isNull(i.pathname)||!oe.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!y.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var P=y.slice(-1)[0],C=(i.host||e.host||y.length>1)&&(P==="."||P==="..")||P==="",T=0,M=y.length;M>=0;M--)P=y[M],P==="."?y.splice(M,1):P===".."?(y.splice(M,1),T++):T&&(y.splice(M,1),T--);if(!m&&!x)for(;T--;T)y.unshift("..");m&&y[0]!==""&&(!y[0]||y[0].charAt(0)!=="/")&&y.unshift(""),C&&y.join("/").substr(-1)!=="/"&&y.push("");var k=y[0]===""||y[0]&&y[0].charAt(0)==="/";if(v){i.hostname=i.host=k?"":y.length?y.shift():"";var w=i.host&&i.host.indexOf("@")>0?i.host.split("@"):!1;w&&(i.auth=w.shift(),i.host=i.hostname=w.shift())}return m=m||i.host&&y.length,m&&!k&&y.unshift(""),y.length?i.pathname=y.join("/"):(i.pathname=null,i.path=null),(!oe.isNull(i.pathname)||!oe.isNull(i.search))&&(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},kt.prototype.parseHost=function(){var e=this.host,t=Wc.exec(e);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var cm={parse:Ja,resolve:to,resolveObject:Vc,format:eo,Url:zc};const no={parse:Ja,format:eo,resolve:to};function Zt(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function Ci(e){return e.split("?")[0].split("#")[0]}function iu(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function su(e,t,i){return e.replace(new RegExp(iu(t),"g"),i)}function ru(e,t){let i="",s=0,r=-1,n=0,a=-1;for(let o=0;o<=e.length;++o){if(o<e.length)a=e.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||n===1))if(r!==o-1&&n===2){if(i.length<2||s!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){const h=i.lastIndexOf("/");if(h!==i.length-1){h===-1?(i="",s=0):(i=i.slice(0,h),s=i.length-1-i.lastIndexOf("/")),r=o,n=0;continue}}else if(i.length===2||i.length===1){i="",s=0,r=o,n=0;continue}}t&&(i.length>0?i+="/..":i="..",s=2)}else i.length>0?i+=`/${e.slice(r+1,o)}`:i=e.slice(r+1,o),s=o-r-1;r=o,n=0}else a===46&&n!==-1?++n:n=-1}return i}const At={toPosix(e){return su(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},hasProtocol(e){return/^[^/:]+:\//.test(this.toPosix(e))},getProtocol(e){Zt(e),e=this.toPosix(e);let t="";const i=/^file:\/\/\//.exec(e),s=/^[^/:]+:\/\//.exec(e),r=/^[^/:]+:\//.exec(e);if(i||s||r){const n=(i==null?void 0:i[0])||(s==null?void 0:s[0])||(r==null?void 0:r[0]);t=n,e=e.slice(n.length)}return t},toAbsolute(e,t,i){if(this.isDataUrl(e))return e;const s=Ci(this.toPosix(t!=null?t:N.ADAPTER.getBaseUrl())),r=Ci(this.toPosix(i!=null?i:this.rootname(s)));return Zt(e),e=this.toPosix(e),e.startsWith("/")?At.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(s,e)},normalize(e){if(e=this.toPosix(e),Zt(e),e.length===0)return".";let t="";const i=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const s=e.endsWith("/");return e=ru(e,!1),e.length>0&&s&&(e+="/"),i?`/${e}`:t+e},isAbsolute(e){return Zt(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){var i;if(e.length===0)return".";let t;for(let s=0;s<e.length;++s){const r=e[s];if(Zt(r),r.length>0)if(t===void 0)t=r;else{const n=(i=e[s-1])!=null?i:"";this.extname(n)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(Zt(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const i=t===47;let s=-1,r=!0;const n=this.getProtocol(e),a=e;e=e.slice(n.length);for(let o=e.length-1;o>=1;--o)if(t=e.charCodeAt(o),t===47){if(!r){s=o;break}}else r=!1;return s===-1?i?"/":this.isUrl(a)?n+e:n:i&&s===1?"//":n+e.slice(0,s)},rootname(e){Zt(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const i=e.indexOf("/",t.length);i!==-1?t=e.slice(0,i):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){Zt(e),t&&Zt(t),e=Ci(this.toPosix(e));let i=0,s=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let a=t.length-1,o=-1;for(n=e.length-1;n>=0;--n){const h=e.charCodeAt(n);if(h===47){if(!r){i=n+1;break}}else o===-1&&(r=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(s=n):(a=-1,s=o))}return i===s?s=o:s===-1&&(s=e.length),e.slice(i,s)}for(n=e.length-1;n>=0;--n)if(e.charCodeAt(n)===47){if(!r){i=n+1;break}}else s===-1&&(r=!1,s=n+1);return s===-1?"":e.slice(i,s)},extname(e){Zt(e),e=Ci(this.toPosix(e));let t=-1,i=0,s=-1,r=!0,n=0;for(let a=e.length-1;a>=0;--a){const o=e.charCodeAt(a);if(o===47){if(!r){i=a+1;break}continue}s===-1&&(r=!1,s=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||s===-1||n===0||n===1&&t===s-1&&t===i+1?"":e.slice(t,s)},parse(e){Zt(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=Ci(this.toPosix(e));let i=e.charCodeAt(0);const s=this.isAbsolute(e);let r;const n="";t.root=this.rootname(e),s||this.hasProtocol(e)?r=1:r=0;let a=-1,o=0,h=-1,l=!0,c=e.length-1,u=0;for(;c>=r;--c){if(i=e.charCodeAt(c),i===47){if(!l){o=c+1;break}continue}h===-1&&(l=!1,h=c+1),i===46?a===-1?a=c:u!==1&&(u=1):a!==-1&&(u=-1)}return a===-1||h===-1||u===0||u===1&&a===h-1&&a===o+1?h!==-1&&(o===0&&s?t.base=t.name=e.slice(1,h):t.base=t.name=e.slice(o,h)):(o===0&&s?(t.name=e.slice(1,a),t.base=e.slice(1,h)):(t.name=e.slice(o,a),t.base=e.slice(o,h)),t.ext=e.slice(a,h)),t.dir=this.dirname(e),n&&(t.dir=n+t.dir),t},sep:"/",delimiter:":"},ao={};function j(e,t,i=3){if(ao[t])return;let s=new Error().stack;typeof s=="undefined"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(s=s.split(`
`).splice(i).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(s))),ao[t]=!0}function nu(){j("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function au(){j("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let jr;function oo(){return typeof jr=="undefined"&&(jr=function(){var i;const t={stencil:!0,failIfMajorPerformanceCaveat:N.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!N.ADAPTER.getWebGLRenderingContext())return!1;const s=N.ADAPTER.createCanvas();let r=s.getContext("webgl",t)||s.getContext("experimental-webgl",t);const n=!!((i=r==null?void 0:r.getContextAttributes())!=null&&i.stencil);if(r){const a=r.getExtension("WEBGL_lose_context");a&&a.loseContext()}return r=null,n}catch(s){return!1}}()),jr}var ou={grad:.9,turn:360,rad:360/(2*Math.PI)},pe=function(e){return typeof e=="string"?e.length>0:typeof e=="number"},_t=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=Math.pow(10,t)),Math.round(i*e)/i+0},Gt=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=1),e>i?i:e>t?e:t},ho=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},lo=function(e){return{r:Gt(e.r,0,255),g:Gt(e.g,0,255),b:Gt(e.b,0,255),a:Gt(e.a)}},Wr=function(e){return{r:_t(e.r),g:_t(e.g),b:_t(e.b),a:_t(e.a,3)}},hu=/^#([0-9a-f]{3,8})$/i,Ps=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},co=function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=Math.max(t,i,s),a=n-Math.min(t,i,s),o=a?n===t?(i-s)/a:n===i?2+(s-t)/a:4+(t-i)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:r}},uo=function(e){var t=e.h,i=e.s,s=e.v,r=e.a;t=t/360*6,i/=100,s/=100;var n=Math.floor(t),a=s*(1-i),o=s*(1-(t-n)*i),h=s*(1-(1-t+n)*i),l=n%6;return{r:255*[s,o,a,a,h,s][l],g:255*[h,s,s,o,a,a][l],b:255*[a,a,h,s,s,o][l],a:r}},fo=function(e){return{h:ho(e.h),s:Gt(e.s,0,100),l:Gt(e.l,0,100),a:Gt(e.a)}},po=function(e){return{h:_t(e.h),s:_t(e.s),l:_t(e.l),a:_t(e.a,3)}},mo=function(e){return uo((i=(t=e).s,{h:t.h,s:(i*=((s=t.l)<50?s:100-s)/100)>0?2*i/(s+i)*100:0,v:s+i,a:t.a}));var t,i,s},Ri=function(e){return{h:(t=co(e)).h,s:(r=(200-(i=t.s))*(s=t.v)/100)>0&&r<200?i*s/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,i,s,r},lu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,cu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,uu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,du=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,$r={string:[[function(e){var t=hu.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?_t(parseInt(e[3]+e[3],16)/255,2):1}:e.length===6||e.length===8?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:e.length===8?_t(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=uu.exec(e)||du.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:lo({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=lu.exec(e)||cu.exec(e);if(!t)return null;var i,s,r=fo({h:(i=t[1],s=t[2],s===void 0&&(s="deg"),Number(i)*(ou[s]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return mo(r)},"hsl"]],object:[[function(e){var t=e.r,i=e.g,s=e.b,r=e.a,n=r===void 0?1:r;return pe(t)&&pe(i)&&pe(s)?lo({r:Number(t),g:Number(i),b:Number(s),a:Number(n)}):null},"rgb"],[function(e){var t=e.h,i=e.s,s=e.l,r=e.a,n=r===void 0?1:r;if(!pe(t)||!pe(i)||!pe(s))return null;var a=fo({h:Number(t),s:Number(i),l:Number(s),a:Number(n)});return mo(a)},"hsl"],[function(e){var t=e.h,i=e.s,s=e.v,r=e.a,n=r===void 0?1:r;if(!pe(t)||!pe(i)||!pe(s))return null;var a=function(o){return{h:ho(o.h),s:Gt(o.s,0,100),v:Gt(o.v,0,100),a:Gt(o.a)}}({h:Number(t),s:Number(i),v:Number(s),a:Number(n)});return uo(a)},"hsv"]]},_o=function(e,t){for(var i=0;i<t.length;i++){var s=t[i][0](e);if(s)return[s,t[i][1]]}return[null,void 0]},go=function(e){return typeof e=="string"?_o(e.trim(),$r.string):typeof e=="object"&&e!==null?_o(e,$r.object):[null,void 0]},um=function(e){return go(e)[1]},Yr=function(e,t){var i=Ri(e);return{h:i.h,s:Gt(i.s+100*t,0,100),l:i.l,a:i.a}},qr=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},xo=function(e,t){var i=Ri(e);return{h:i.h,s:i.s,l:Gt(i.l+100*t,0,100),a:i.a}},Ds=function(){function e(t){this.parsed=go(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return this.parsed!==null},e.prototype.brightness=function(){return _t(qr(this.rgba),2)},e.prototype.isDark=function(){return qr(this.rgba)<.5},e.prototype.isLight=function(){return qr(this.rgba)>=.5},e.prototype.toHex=function(){return t=Wr(this.rgba),i=t.r,s=t.g,r=t.b,a=(n=t.a)<1?Ps(_t(255*n)):"","#"+Ps(i)+Ps(s)+Ps(r)+a;var t,i,s,r,n,a},e.prototype.toRgb=function(){return Wr(this.rgba)},e.prototype.toRgbString=function(){return t=Wr(this.rgba),i=t.r,s=t.g,r=t.b,(n=t.a)<1?"rgba("+i+", "+s+", "+r+", "+n+")":"rgb("+i+", "+s+", "+r+")";var t,i,s,r,n},e.prototype.toHsl=function(){return po(Ri(this.rgba))},e.prototype.toHslString=function(){return t=po(Ri(this.rgba)),i=t.h,s=t.s,r=t.l,(n=t.a)<1?"hsla("+i+", "+s+"%, "+r+"%, "+n+")":"hsl("+i+", "+s+"%, "+r+"%)";var t,i,s,r,n},e.prototype.toHsv=function(){return t=co(this.rgba),{h:_t(t.h),s:_t(t.s),v:_t(t.v),a:_t(t.a,3)};var t},e.prototype.invert=function(){return he({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},e.prototype.saturate=function(t){return t===void 0&&(t=.1),he(Yr(this.rgba,t))},e.prototype.desaturate=function(t){return t===void 0&&(t=.1),he(Yr(this.rgba,-t))},e.prototype.grayscale=function(){return he(Yr(this.rgba,-1))},e.prototype.lighten=function(t){return t===void 0&&(t=.1),he(xo(this.rgba,t))},e.prototype.darken=function(t){return t===void 0&&(t=.1),he(xo(this.rgba,-t))},e.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},e.prototype.alpha=function(t){return typeof t=="number"?he({r:(i=this.rgba).r,g:i.g,b:i.b,a:t}):_t(this.rgba.a,3);var i},e.prototype.hue=function(t){var i=Ri(this.rgba);return typeof t=="number"?he({h:t,s:i.s,l:i.l,a:i.a}):_t(i.h)},e.prototype.isEqual=function(t){return this.toHex()===he(t).toHex()},e}(),he=function(e){return e instanceof Ds?e:new Ds(e)},vo=[],fu=function(e){e.forEach(function(t){vo.indexOf(t)<0&&(t(Ds,$r),vo.push(t))})},dm=function(){return new Ds({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};function pu(e,t){var i={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var r in i)s[i[r]]=r;var n={};e.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=s[this.toHex()];if(l)return l;if(a!=null&&a.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var f in i)n[f]=new e(i[f]).toRgb();for(var p in i){var _=(o=c,h=n[p],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));_<u&&(u=_,d=p)}return d}},t.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":i[o];return h?new e(h).toRgb():null},"name"])}fu([pu]);const Je=class{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof Je)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?Et({},e):e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((r,n)=>r===t[n]);if(e!==null&&t!==null){const r=Object.keys(e),n=Object.keys(t);return r.length!==n.length?!1:r.every(a=>e[a]===t[a])}return e===t}toRgba(){const[e,t,i,s]=this._components;return{r:e,g:t,b:i,a:s}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,s]=this._components;return e=e!=null?e:[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e!=null?e:[];const[t,i,s]=this._components;return e[0]=t,e[1]=i,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,s,r]=Je.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=s,this._components[3]*=r,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,r=this._int&255;return t&&(i=i*e+.5|0,s=s*e+.5|0,r=r*e+.5|0),(e*255<<24)+(i<<16)+(s<<8)+r}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e!=null?e:[];const[t,i,s,r]=this._components;return e[0]=t,e[1]=i,e[2]=s,e[3]=r,e}normalize(e){let t,i,s,r;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const n=e;t=(n>>16&255)/255,i=(n>>8&255)/255,s=(n&255)/255,r=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,s,r=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,s,r=255]=e,t/=255,i/=255,s/=255,r/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const a=Je.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}const n=he(e);n.isValid()&&({r:t,g:i,b:s,a:r}=n.rgba,t/=255,i/=255,s/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=s,this._components[3]=r,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((s,r)=>{e[r]=Math.min(Math.max(s,t),i)}),e)}};let $=Je;$.shared=new Je,$.temp=new Je,$.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function mu(e,t=[]){return j("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),$.shared.setValue(e).toRgbArray(t)}function _u(e){return j("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),$.shared.setValue(e).toHex()}function gu(e){return j("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),$.shared.setValue(e).toNumber()}function xu(e){return j("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),$.shared.setValue(e).toNumber()}function vu(){const e=[],t=[];for(let s=0;s<32;s++)e[s]=s,t[s]=s;e[H.NORMAL_NPM]=H.NORMAL,e[H.ADD_NPM]=H.ADD,e[H.SCREEN_NPM]=H.SCREEN,t[H.NORMAL]=H.NORMAL_NPM,t[H.ADD]=H.ADD_NPM,t[H.SCREEN]=H.SCREEN_NPM;const i=[];return i.push(t),i.push(e),i}const Zr=vu();function Kr(e,t){return Zr[t?1:0][e]}function yu(e,t,i,s=!0){return j("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),$.shared.setValue(e).premultiply(t,s).toArray(i!=null?i:new Float32Array(4))}function bu(e,t){return j("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),$.shared.setValue(e).toPremultiplied(t)}function Tu(e,t,i,s=!0){return j("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),$.shared.setValue(e).premultiply(t,s).toArray(i!=null?i:new Float32Array(4))}const yo=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function bo(e,t=null){const i=e*6;if(t=t||new Uint16Array(i),t.length!==i)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${i}`);for(let s=0,r=0;s<i;s+=6,r+=4)t[s+0]=r+0,t[s+1]=r+1,t[s+2]=r+2,t[s+3]=r+0,t[s+4]=r+2,t[s+5]=r+3;return t}function Bs(e){if(e.BYTES_PER_ELEMENT===4)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(e.BYTES_PER_ELEMENT===2){if(e instanceof Uint16Array)return"Uint16Array"}else if(e.BYTES_PER_ELEMENT===1&&e instanceof Uint8Array)return"Uint8Array";return null}const Eu={Float32Array,Uint32Array,Int32Array,Uint8Array};function wu(e,t){let i=0,s=0;const r={};for(let h=0;h<e.length;h++)s+=t[h],i+=e[h].length;const n=new ArrayBuffer(i*4);let a=null,o=0;for(let h=0;h<e.length;h++){const l=t[h],c=e[h],u=Bs(c);r[u]||(r[u]=new Eu[u](n)),a=r[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*s+o,p=d%l;a[f+p]=c[d]}o+=l}return new Float32Array(n)}function Ii(e){return e+=e===0?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1}function Qr(e){return!(e&e-1)&&!!e}function Jr(e){let t=(e>65535?1:0)<<4;e>>>=t;let i=(e>255?1:0)<<3;return e>>>=i,t|=i,i=(e>15?1:0)<<2,e>>>=i,t|=i,i=(e>3?1:0)<<1,e>>>=i,t|=i,t|e>>1}function ti(e,t,i){const s=e.length;let r;if(t>=s||i===0)return;i=t+i>s?s-t:i;const n=s-i;for(r=t;r<n;++r)e[r]=e[r+i];e.length=n}function Le(e){return e===0?0:e<0?-1:1}let Au=0;function Ae(){return++Au}const To=class{constructor(e,t,i,s){this.left=e,this.top=t,this.right=i,this.bottom=s}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Os=To;Os.EMPTY=new To(0,0,0,0);const tn={},St=Object.create(null),Ot=Object.create(null);function Su(){let e;for(e in St)St[e].destroy();for(e in Ot)Ot[e].destroy()}function Cu(){let e;for(e in St)delete St[e];for(e in Ot)delete Ot[e]}class Eo{constructor(t,i,s){this._canvas=N.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=s||N.RESOLUTION,this.resize(t,i)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,i){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(i*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function wo(e,t,i){for(let s=0,r=4*i*t;s<t;++s,r+=4)if(e[r+3]!==0)return!1;return!0}function Ao(e,t,i,s,r){const n=4*t;for(let a=s,o=s*n+4*i;a<=r;++a,o+=n)if(e[o+3]!==0)return!1;return!0}function So(e){const{width:t,height:i}=e,s=e.getContext("2d",{willReadFrequently:!0});if(s===null)throw new TypeError("Failed to get canvas 2D context");const n=s.getImageData(0,0,t,i).data;let a=0,o=0,h=t-1,l=i-1;for(;o<i&&wo(n,t,o);)++o;if(o===i)return Os.EMPTY;for(;wo(n,t,l);)--l;for(;Ao(n,t,a,o,l);)++a;for(;Ao(n,t,h,o,l);)--h;return++h,++l,new Os(a,o,h,l)}function Co(e){const t=So(e),{width:i,height:s}=t;let r=null;if(!t.isEmpty()){const n=e.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(t.left,t.top,i,s)}return{width:i,height:s,data:r}}function Ru(e){const t=yo.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}let Fs;function Ro(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location,Fs||(Fs=document.createElement("a")),Fs.href=e;const i=no.parse(Fs.href),s=!i.port&&t.port===""||i.port===t.port;return i.hostname!==t.hostname||!s||i.protocol!==t.protocol?"anonymous":""}function me(e,t=1){var s;const i=(s=N.RETINA_PREFIX)==null?void 0:s.exec(e);return i?parseFloat(i[1]):t}var Iu={__proto__:null,isMobile:we,EventEmitter:bi,earcut:Ur,url:no,path:At,sayHello:au,skipHello:nu,isWebGLSupported:oo,hex2rgb:mu,hex2string:_u,rgb2hex:xu,string2hex:gu,correctBlendMode:Kr,premultiplyBlendMode:Zr,premultiplyRgba:yu,premultiplyTint:bu,premultiplyTintToRgba:Tu,DATA_URI:yo,createIndicesForQuads:bo,getBufferType:Bs,interleaveTypedArrays:wu,isPow2:Qr,log2:Jr,nextPow2:Ii,removeItems:ti,sign:Le,uid:Ae,deprecation:j,BoundingBox:Os,BaseTextureCache:Ot,ProgramCache:tn,TextureCache:St,clearTextureCache:Cu,destroyTextureCache:Su,CanvasRenderTarget:Eo,getCanvasBoundingBox:So,trimCanvas:Co,decomposeDataUri:Ru,determineCrossOrigin:Ro,getResolutionOfUrl:me},D=(e=>(e.Renderer="renderer",e.Application="application",e.RendererSystem="renderer-webgl-system",e.RendererPlugin="renderer-webgl-plugin",e.CanvasRendererSystem="renderer-canvas-system",e.CanvasRendererPlugin="renderer-canvas-plugin",e.Asset="asset",e.LoadParser="load-parser",e.ResolveParser="resolve-parser",e.CacheParser="cache-parser",e.DetectionParser="detection-parser",e))(D||{});const en=e=>{if(typeof e=="function"||typeof e=="object"&&e.extension){if(!e.extension)throw new Error("Extension class must have an extension object");const t=typeof e.extension!="object"?{type:e.extension}:e.extension;e=Ts(Et({},t),{ref:e})}if(typeof e=="object")e=Et({},e);else throw new Error("Invalid extension type");return typeof e.type=="string"&&(e.type=[e.type]),e},Io=(e,t)=>{var i;return(i=en(e).priority)!=null?i:t},U={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(en).forEach(t=>{t.type.forEach(i=>{var s,r;return(r=(s=this._removeHandlers)[i])==null?void 0:r.call(s,t)})}),this},add(...e){return e.map(en).forEach(t=>{t.type.forEach(i=>{const s=this._addHandlers,r=this._queue;s[i]?s[i](t):(r[i]=r[i]||[],r[i].push(t))})}),this},handle(e,t,i){const s=this._addHandlers,r=this._removeHandlers;if(s[e]||r[e])throw new Error(`Extension type ${e} already has a handler`);s[e]=t,r[e]=i;const n=this._queue;return n[e]&&(n[e].forEach(a=>t(a)),delete n[e]),this},handleByMap(e,t){return this.handle(e,i=>{t[i.name]=i.ref},i=>{delete t[i.name]})},handleByList(e,t,i=-1){return this.handle(e,s=>{t.includes(s.ref)||(t.push(s.ref),t.sort((r,n)=>Io(n,i)-Io(r,i)))},s=>{const r=t.indexOf(s.ref);r!==-1&&t.splice(r,1)})}};class Ls{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const Mu=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Nu(e){let t="";for(let i=0;i<e;++i)i>0&&(t+=`
else `),i<e-1&&(t+=`if(test == ${i}.0){}`);return t}function Mo(e,t){if(e===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=t.createShader(t.FRAGMENT_SHADER);for(;;){const s=Mu.replace(/%forloop%/gi,Nu(e));if(t.shaderSource(i,s),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))e=e/2|0;else break}return e}const sn=0,rn=1,nn=2,an=3,on=4,hn=5;class de{constructor(){this.data=0,this.blendMode=H.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<sn)}set blend(t){!!(this.data&1<<sn)!==t&&(this.data^=1<<sn)}get offsets(){return!!(this.data&1<<rn)}set offsets(t){!!(this.data&1<<rn)!==t&&(this.data^=1<<rn)}get culling(){return!!(this.data&1<<nn)}set culling(t){!!(this.data&1<<nn)!==t&&(this.data^=1<<nn)}get depthTest(){return!!(this.data&1<<an)}set depthTest(t){!!(this.data&1<<an)!==t&&(this.data^=1<<an)}get depthMask(){return!!(this.data&1<<hn)}set depthMask(t){!!(this.data&1<<hn)!==t&&(this.data^=1<<hn)}get clockwiseFrontFace(){return!!(this.data&1<<on)}set clockwiseFrontFace(t){!!(this.data&1<<on)!==t&&(this.data^=1<<on)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==H.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new de;return t.depthTest=!1,t.blend=!0,t}}const Us=[];function ln(e,t){if(!e)return null;let i="";if(typeof e=="string"){const s=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);s&&(i=s[1].toLowerCase())}for(let s=Us.length-1;s>=0;--s){const r=Us[s];if(r.test&&r.test(e,i))return new r(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class Ft{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,i,s,r,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](t,i,s,r,n,a,o,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const i=this.items.indexOf(t);return i!==-1&&(this.ensureNonAliasedItems(),this.items.splice(i,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Ft.prototype,{dispatch:{value:Ft.prototype.emit},run:{value:Ft.prototype.emit}});class ei{constructor(t=0,i=0){this._width=t,this._height=i,this.destroyed=!1,this.internal=!1,this.onResize=new Ft("setRealSize"),this.onUpdate=new Ft("update"),this.onError=new Ft("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,i){(t!==this._width||i!==this._height)&&(this._width=t,this._height=i,this.onResize.emit(t,i))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,i,s){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,i){return!1}}class ii extends ei{constructor(t,i){const{width:s,height:r}=i||{};if(!s||!r)throw new Error("BufferResource width or height invalid");super(s,r),this.data=t}upload(t,i,s){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ut.UNPACK);const n=i.realWidth,a=i.realHeight;return s.width===n&&s.height===a?r.texSubImage2D(i.target,0,0,0,n,a,i.format,s.type,this.data):(s.width=n,s.height=a,r.texImage2D(i.target,0,s.internalFormat,n,a,0,i.format,s.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const Pu={scaleMode:ne.NEAREST,format:R.RGBA,alphaMode:Ut.NPM},si=class extends bi{constructor(e=null,t=null){super(),t=Object.assign({},si.defaultOptions,t);const{alphaMode:i,mipmap:s,anisotropicLevel:r,scaleMode:n,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:d,resourceOptions:f}=t;e&&!(e instanceof ei)&&(e=ln(e,f),e.internal=!0),this.resolution=d||N.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=r,this._wrapMode=h,this._scaleMode=n,this.format=l,this.type=c,this.target=u,this.alphaMode=i,this.uid=Ae(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Qr(this.realWidth)&&Qr(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Ot[this.cacheId],delete St[this.cacheId],this.cacheId=null),this.dispose(),si.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=N.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let r=null;if(s)r=e;else{if(!e._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${Ae()}`}r=e._pixiId}let n=Ot[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new si(e,t),n.cacheId=r,si.addToCache(n,r)),n}static fromBuffer(e,t,i,s){e=e||new Float32Array(t*i*4);const r=new ii(e,{width:t,height:i}),n=e instanceof Float32Array?G.FLOAT:G.UNSIGNED_BYTE;return new si(r,Object.assign({},Pu,{type:n},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Ot[t]&&Ot[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Ot[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Ot[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete Ot[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Ot[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};let z=si;z.defaultOptions={mipmap:$t.POW2,anisotropicLevel:0,scaleMode:ne.LINEAR,wrapMode:ae.CLAMP,alphaMode:Ut.UNPACK,target:Oe.TEXTURE_2D,format:R.RGBA,type:G.UNSIGNED_BYTE},z._globalBatch=0;class ks{constructor(){this.texArray=null,this.blend=0,this.type=Wt.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Du=0;class nt{constructor(t,i=!0,s=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=s,this.static=i,this.id=Du++,this.disposeRunner=new Ft("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?qt.ELEMENT_ARRAY_BUFFER:qt.ARRAY_BUFFER}get index(){return this.type===qt.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new nt(t)}}class gs{constructor(t,i=0,s=!1,r=G.FLOAT,n,a,o,h=1){this.buffer=t,this.size=i,this.normalized=s,this.type=r,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(t,i,s,r,n){return new gs(t,i,s,r,n)}}const Bu={Float32Array,Uint32Array,Int32Array,Uint8Array};function Ou(e,t){let i=0,s=0;const r={};for(let h=0;h<e.length;h++)s+=t[h],i+=e[h].length;const n=new ArrayBuffer(i*4);let a=null,o=0;for(let h=0;h<e.length;h++){const l=t[h],c=e[h],u=Bs(c);r[u]||(r[u]=new Bu[u](n)),a=r[u];for(let d=0;d<c.length;d++){const f=(d/l|0)*s+o,p=d%l;a[f+p]=c[d]}o+=l}return new Float32Array(n)}const No={5126:4,5123:2,5121:1};let Fu=0;const Lu={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Te{constructor(t=[],i={}){this.buffers=t,this.indexBuffer=null,this.attributes=i,this.glVertexArrayObjects={},this.id=Fu++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Ft("disposeGeometry"),this.refCount=0}addAttribute(t,i,s=0,r=!1,n,a,o,h=!1){if(!i)throw new Error("You must pass a buffer when creating an attribute");i instanceof nt||(i instanceof Array&&(i=new Float32Array(i)),i=new nt(i));const l=t.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],i,s,r,n);return this}let c=this.buffers.indexOf(i);return c===-1&&(this.buffers.push(i),c=this.buffers.length-1),this.attributes[t]=new gs(c,s,r,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof nt||(t instanceof Array&&(t=new Uint16Array(t)),t=new nt(t)),t.type=qt.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],i=[],s=new nt;let r;for(r in this.attributes){const n=this.attributes[r],a=this.buffers[n.buffer];t.push(a.data),i.push(n.size*No[n.type]/4),n.buffer=0}for(s.data=Ou(t,i),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[s],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const i=this.attributes[t];return this.buffers[i.buffer].data.length/(i.stride/4||i.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Te;for(let i=0;i<this.buffers.length;i++)t.buffers[i]=new nt(this.buffers[i].data.slice(0));for(const i in this.attributes){const s=this.attributes[i];t.attributes[i]=new gs(s.buffer,s.size,s.normalized,s.type,s.stride,s.start,s.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=qt.ELEMENT_ARRAY_BUFFER),t}static merge(t){const i=new Te,s=[],r=[],n=[];let a;for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)r[h]=r[h]||0,r[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)s[o]=new Lu[Bs(a.buffers[o].data)](r[o]),i.buffers[o]=new nt(s[o]);for(let o=0;o<t.length;o++){a=t[o];for(let h=0;h<a.buffers.length;h++)s[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(i.attributes=a.attributes,a.indexBuffer){i.indexBuffer=i.buffers[a.buffers.indexOf(a.indexBuffer)],i.indexBuffer.type=qt.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,c=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){c=u;break}for(const u in a.attributes){const d=a.attributes[u];(d.buffer|0)===c&&(h+=d.size*No[d.type]/4)}for(let u=0;u<t.length;u++){const d=t[u].indexBuffer.data;for(let f=0;f<d.length;f++)i.indexBuffer.data[f+l]+=o;o+=t[u].buffers[c].data.length/h,l+=d.length}}return i}}class cn extends Te{constructor(t=!1){super(),this._buffer=new nt(null,t,!1),this._indexBuffer=new nt(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,G.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,G.FLOAT).addAttribute("aColor",this._buffer,4,!0,G.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,G.FLOAT).addIndex(this._indexBuffer)}}const Mi=Math.PI*2,Po=180/Math.PI,Do=Math.PI/180;var gt=(e=>(e[e.POLY=0]="POLY",e[e.RECT=1]="RECT",e[e.CIRC=2]="CIRC",e[e.ELIP=3]="ELIP",e[e.RREC=4]="RREC",e))(gt||{});class J{constructor(t=0,i=0){this.x=0,this.y=0,this.x=t,this.y=i}clone(){return new J(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,i=t){return this.x=t,this.y=i,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Gs=[new J,new J,new J,new J];class W{constructor(t=0,i=0,s=0,r=0){this.x=Number(t),this.y=Number(i),this.width=Number(s),this.height=Number(r),this.type=gt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new W(0,0,0,0)}clone(){return new W(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,i){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height}intersects(t,i){if(!i){const T=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=T)return!1;const k=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>k}const s=this.left,r=this.right,n=this.top,a=this.bottom;if(r<=s||a<=n)return!1;const o=Gs[0].set(t.left,t.top),h=Gs[1].set(t.left,t.bottom),l=Gs[2].set(t.right,t.top),c=Gs[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const u=Math.sign(i.a*i.d-i.b*i.c);if(u===0||(i.apply(o,o),i.apply(h,h),i.apply(l,l),i.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=s||Math.min(o.x,h.x,l.x,c.x)>=r||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const d=u*(h.y-o.y),f=u*(o.x-h.x),p=d*s+f*n,_=d*r+f*n,m=d*s+f*a,x=d*r+f*a;if(Math.max(p,_,m,x)<=d*o.x+f*o.y||Math.min(p,_,m,x)>=d*c.x+f*c.y)return!1;const y=u*(o.y-l.y),g=u*(l.x-o.x),v=y*s+g*n,w=y*r+g*n,P=y*s+g*a,C=y*r+g*a;return!(Math.max(v,w,P,C)<=y*o.x+g*o.y||Math.min(v,w,P,C)>=y*c.x+g*c.y)}pad(t=0,i=t){return this.x-=t,this.y-=i,this.width+=t*2,this.height+=i*2,this}fit(t){const i=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=i,this.width=Math.max(s-i,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,i=.001){const s=Math.ceil((this.x+this.width-i)*t)/t,r=Math.ceil((this.y+this.height-i)*t)/t;return this.x=Math.floor((this.x+i)*t)/t,this.y=Math.floor((this.y+i)*t)/t,this.width=s-this.x,this.height=r-this.y,this}enlarge(t){const i=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=i,this.width=s-i,this.y=r,this.height=n-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Sr{constructor(t=0,i=0,s=0){this.x=t,this.y=i,this.radius=s,this.type=gt.CIRC}clone(){return new Sr(this.x,this.y,this.radius)}contains(t,i){if(this.radius<=0)return!1;const s=this.radius*this.radius;let r=this.x-t,n=this.y-i;return r*=r,n*=n,r+n<=s}getBounds(){return new W(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Cr{constructor(t=0,i=0,s=0,r=0){this.x=t,this.y=i,this.width=s,this.height=r,this.type=gt.ELIP}clone(){return new Cr(this.x,this.y,this.width,this.height)}contains(t,i){if(this.width<=0||this.height<=0)return!1;let s=(t-this.x)/this.width,r=(i-this.y)/this.height;return s*=s,r*=r,s+r<=1}getBounds(){return new W(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Ye{constructor(...t){let i=Array.isArray(t[0])?t[0]:t;if(typeof i[0]!="number"){const s=[];for(let r=0,n=i.length;r<n;r++)s.push(i[r].x,i[r].y);i=s}this.points=i,this.type=gt.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),i=new Ye(t);return i.closeStroke=this.closeStroke,i}contains(t,i){let s=!1;const r=this.points.length/2;for(let n=0,a=r-1;n<r;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],c=this.points[a*2+1];h>i!=c>i&&t<(l-o)*((i-h)/(c-h))+o&&(s=!s)}return s}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,i)=>`${t}, ${i}`,"")}]`}}class Rr{constructor(t=0,i=0,s=0,r=0,n=20){this.x=t,this.y=i,this.width=s,this.height=r,this.radius=n,this.type=gt.RREC}clone(){return new Rr(this.x,this.y,this.width,this.height,this.radius)}contains(t,i){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&i>=this.y&&i<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(i>=this.y+s&&i<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let r=t-(this.x+s),n=i-(this.y+s);const a=s*s;if(r*r+n*n<=a||(r=t-(this.x+this.width-s),r*r+n*n<=a)||(n=i-(this.y+this.height-s),r*r+n*n<=a)||(r=t-(this.x+s),r*r+n*n<=a))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class tt{constructor(t=1,i=0,s=0,r=1,n=0,a=0){this.array=null,this.a=t,this.b=i,this.c=s,this.d=r,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,i,s,r,n,a){return this.a=t,this.b=i,this.c=s,this.d=r,this.tx=n,this.ty=a,this}toArray(t,i){this.array||(this.array=new Float32Array(9));const s=i||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,i){i=i||new J;const s=t.x,r=t.y;return i.x=this.a*s+this.c*r+this.tx,i.y=this.b*s+this.d*r+this.ty,i}applyInverse(t,i){i=i||new J;const s=1/(this.a*this.d+this.c*-this.b),r=t.x,n=t.y;return i.x=this.d*s*r+-this.c*s*n+(this.ty*this.c-this.tx*this.d)*s,i.y=this.a*s*n+-this.b*s*r+(-this.ty*this.a+this.tx*this.b)*s,i}translate(t,i){return this.tx+=t,this.ty+=i,this}scale(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this}rotate(t){const i=Math.cos(t),s=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*i-this.b*s,this.b=r*s+this.b*i,this.c=n*i-this.d*s,this.d=n*s+this.d*i,this.tx=a*i-this.ty*s,this.ty=a*s+this.ty*i,this}append(t){const i=this.a,s=this.b,r=this.c,n=this.d;return this.a=t.a*i+t.b*r,this.b=t.a*s+t.b*n,this.c=t.c*i+t.d*r,this.d=t.c*s+t.d*n,this.tx=t.tx*i+t.ty*r+this.tx,this.ty=t.tx*s+t.ty*n+this.ty,this}setTransform(t,i,s,r,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(s*this.a+r*this.c),this.ty=i-(s*this.b+r*this.d),this}prepend(t){const i=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const s=this.a,r=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=i*t.a+this.ty*t.c+t.tx,this.ty=i*t.b+this.ty*t.d+t.ty,this}decompose(t){const i=this.a,s=this.b,r=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-r,n),h=Math.atan2(s,i),l=Math.abs(o+h);return l<1e-5||Math.abs(Mi-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(i*i+s*s),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*i+a.y*r),t.position.y=this.ty+(a.x*s+a.y*n),t}invert(){const t=this.a,i=this.b,s=this.c,r=this.d,n=this.tx,a=t*r-i*s;return this.a=r/a,this.b=-i/a,this.c=-s/a,this.d=t/a,this.tx=(s*this.ty-r*n)/a,this.ty=-(t*this.ty-i*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new tt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new tt}static get TEMP_MATRIX(){return new tt}}const Ue=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ke=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ge=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],He=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],un=[],Bo=[],Hs=Math.sign;function Uu(){for(let e=0;e<16;e++){const t=[];un.push(t);for(let i=0;i<16;i++){const s=Hs(Ue[e]*Ue[i]+Ge[e]*ke[i]),r=Hs(ke[e]*Ue[i]+He[e]*ke[i]),n=Hs(Ue[e]*Ge[i]+Ge[e]*He[i]),a=Hs(ke[e]*Ge[i]+He[e]*He[i]);for(let o=0;o<16;o++)if(Ue[o]===s&&ke[o]===r&&Ge[o]===n&&He[o]===a){t.push(o);break}}}for(let e=0;e<16;e++){const t=new tt;t.set(Ue[e],ke[e],Ge[e],He[e],0,0),Bo.push(t)}}Uu();const it={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>Ue[e],uY:e=>ke[e],vX:e=>Ge[e],vY:e=>He[e],inv:e=>e&8?e&15:-e&7,add:(e,t)=>un[e][t],sub:(e,t)=>un[e][it.inv(t)],rotate180:e=>e^4,isVertical:e=>(e&3)===2,byDirection:(e,t)=>Math.abs(e)*2<=Math.abs(t)?t>=0?it.S:it.N:Math.abs(t)*2<=Math.abs(e)?e>0?it.E:it.W:t>0?e>0?it.SE:it.SW:e>0?it.NE:it.NW,matrixAppendRotationInv:(e,t,i=0,s=0)=>{const r=Bo[it.inv(t)];r.tx=i,r.ty=s,e.append(r)}};class be{constructor(t,i,s=0,r=0){this._x=s,this._y=r,this.cb=t,this.scope=i}clone(t=this.cb,i=this.scope){return new be(t,i,this._x,this._y)}set(t=0,i=t){return(this._x!==t||this._y!==i)&&(this._x=t,this._y=i,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=${0} y=${0} scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const Oo=class{constructor(){this.worldTransform=new tt,this.localTransform=new tt,this.position=new be(this.onChange,this,0,0),this.scale=new be(this.onChange,this,1,1),this.pivot=new be(this.onChange,this,0,0),this.skew=new be(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){const i=e.worldTransform,s=this.worldTransform;s.a=t.a*i.a+t.b*i.c,s.b=t.a*i.b+t.b*i.d,s.c=t.c*i.a+t.d*i.c,s.d=t.c*i.b+t.d*i.d,s.tx=t.tx*i.a+t.ty*i.c+i.tx,s.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};let Ni=Oo;Ni.IDENTITY=new Oo;var ku=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Gu=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Fo(e,t,i){const s=e.createShader(t);return e.shaderSource(s,i),e.compileShader(s),s}function dn(e){const t=new Array(e);for(let i=0;i<t.length;i++)t[i]=!1;return t}function Lo(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return dn(2*t);case"bvec3":return dn(3*t);case"bvec4":return dn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Xe=[{test:e=>e.type==="float"&&e.size===1&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>(e.type==="sampler2D"||e.type==="samplerCube"||e.type==="sampler2DArray")&&e.size===1&&!e.isArray&&(t==null||t.castToBaseTexture!==void 0),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>e.type==="mat3"&&e.size===1&&!e.isArray&&t.a!==void 0,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>e.type==="vec2"&&e.size===1&&!e.isArray&&t.x!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>e.type==="vec2"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.width!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>e.type==="vec4"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>e.type==="vec3"&&e.size===1&&!e.isArray&&t.red!==void 0,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>e.type==="vec4"&&e.size===1&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],Hu={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Xu={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Vu(e,t){var s;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in e.uniforms){const n=t[r];if(!n){(s=e.uniforms[r])!=null&&s.group&&(e.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const a=e.uniforms[r];let o=!1;for(let h=0;h<Xe.length;h++)if(Xe[h].test(n,a)){i.push(Xe[h].code(r,a)),o=!0;break}if(!o){const l=(n.size===1&&!n.isArray?Hu:Xu)[n.type].replace("location",`ud["${r}"].location`);i.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const Uo={};let ri=Uo;function ko(){if(ri===Uo||(ri==null?void 0:ri.isContextLost())){const e=N.ADAPTER.createCanvas();let t;N.PREFER_ENV>=Ee.WEBGL2&&(t=e.getContext("webgl2",{})),t||(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),ri=t}return ri}let Xs;function zu(){if(!Xs){Xs=Bt.MEDIUM;const e=ko();e&&e.getShaderPrecisionFormat&&(Xs=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision?Bt.HIGH:Bt.MEDIUM)}return Xs}function Go(e,t){const i=e.getShaderSource(t).split(`
`).map((l,c)=>`${c}: ${l}`),s=e.getShaderInfoLog(t),r=s.split(`
`),n={},a=r.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{i[l-1]=`%c${i[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=i.join(`
`);o[0]=h,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function ju(e,t,i,s){e.getProgramParameter(t,e.LINK_STATUS)||(e.getShaderParameter(i,e.COMPILE_STATUS)||Go(e,i),e.getShaderParameter(s,e.COMPILE_STATUS)||Go(e,s),console.error("PixiJS Error: Could not initialize shader."),e.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(t)))}const Wu={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ho(e){return Wu[e]}let Vs=null;const Xo={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Vo(e,t){if(!Vs){const i=Object.keys(Xo);Vs={};for(let s=0;s<i.length;++s){const r=i[s];Vs[e[r]]=Xo[r]}}return Vs[t]}function zo(e,t,i){if(e.substring(0,9)!=="precision"){let s=t;return t===Bt.HIGH&&i!==Bt.HIGH&&(s=Bt.MEDIUM),`precision ${s} float;
${e}`}else if(i!==Bt.HIGH&&e.substring(0,15)==="precision highp")return e.replace("precision highp","precision mediump");return e}let Pi;function jo(){if(typeof Pi=="boolean")return Pi;try{Pi=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(e){Pi=!1}return Pi}let $u=0;const zs={},ni=class{constructor(e,t,i="pixi-shader",s={}){this.extra={},this.id=$u++,this.vertexSrc=e||ni.defaultVertexSrc,this.fragmentSrc=t||ni.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),zs[i]?(zs[i]++,i+=`-${zs[i]}`):zs[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=zo(this.vertexSrc,ni.defaultVertexPrecision,Bt.HIGH),this.fragmentSrc=zo(this.fragmentSrc,ni.defaultFragmentPrecision,zu())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Gu}static get defaultFragmentSrc(){return ku}static from(e,t,i){const s=e+t;let r=tn[s];return r||(tn[s]=r=new ni(e,t,i)),r}};let Ht=ni;Ht.defaultVertexPrecision=Bt.HIGH,Ht.defaultFragmentPrecision=we.apple.device?Bt.HIGH:Bt.MEDIUM;let Yu=0;class jt{constructor(t,i,s){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Yu++,this.static=!!i,this.ubo=!!s,t instanceof nt?(this.buffer=t,this.buffer.type=qt.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new nt(new Float32Array(1)),this.buffer.type=qt.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,i,s){if(!this.ubo)this.uniforms[t]=new jt(i,s);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,i,s){return new jt(t,i,s)}static uboFrom(t,i){return new jt(t,i!=null?i:!0,!0)}}class ie{constructor(t,i){this.uniformBindCount=0,this.program=t,i?i instanceof jt?this.uniformGroup=i:this.uniformGroup=new jt(i):this.uniformGroup=new jt({}),this.disposeRunner=new Ft("disposeShader")}checkUniformExists(t,i){if(i.uniforms[t])return!0;for(const s in i.uniforms){const r=i.uniforms[s];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,i,s){const r=Ht.from(t,i);return new ie(r,s)}}class Wo{constructor(t,i){if(this.vertexSrc=t,this.fragTemplate=i,this.programCache={},this.defaultGroupCache={},!i.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!i.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const s=new Int32Array(t);for(let n=0;n<t;n++)s[n]=n;this.defaultGroupCache[t]=jt.from({uSamplers:s},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${t}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ht(this.vertexSrc,r)}const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new tt,default:this.defaultGroupCache[t]};return new ie(this.programCache[t],i)}generateSampleSrc(t){let i="";i+=`
`,i+=`
`;for(let s=0;s<t;s++)s>0&&(i+=`
else `),s<t-1&&(i+=`if(vTextureId < ${s}.5)`),i+=`
{`,i+=`
	color = texture2D(uSamplers[${s}], vTextureCoord);`,i+=`
}`;return i+=`
`,i+=`
`,i}}class js{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function qu(){return!we.apple.device}function Zu(e){let t=!0;const i=N.ADAPTER.getNavigator();if(we.tablet||we.phone){if(we.apple.device){const s=i.userAgent.match(/OS (\d+)_(\d+)?/);s&&parseInt(s[1],10)<11&&(t=!1)}if(we.android.device){const s=i.userAgent.match(/Android\s([0-9.]*)/);s&&parseInt(s[1],10)<7&&(t=!1)}}return t?e:4}class Di{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Ku=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Qu=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Kt=class extends Di{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=cn,this.vertexSize=6,this.state=de.for2d(),this.size=Kt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){var e;return this._defaultMaxTextures=(e=this._defaultMaxTextures)!=null?e:Zu(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){var e;return this._canUploadSameBuffer=(e=this._canUploadSameBuffer)!=null?e:qu(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return j("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Qu}static get defaultFragmentTemplate(){return Ku}setShaderGenerator({vertex:e=Kt.defaultVertexSrc,fragment:t=Kt.defaultFragmentTemplate}={}){this.shaderGenerator=new Wo(e,t)}contextChange(){const e=this.renderer.gl;N.PREFER_ENV===Ee.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Kt.defaultMaxTextures),this.maxTextures=Mo(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Kt,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new ks);for(;t.length<s;)t.push(new js);for(let r=0;r<this.maxTextures;r++)this._tempBoundTextures[r]=null}onPrerender(){this._flushId=0}render(e){!e._texture.valid||(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=Kt._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let a=++z._globalBatch,o=0,h=i[0],l=0;s.copyBoundTextures(r,t);for(let c=0;c<this._bufferSize;++c){const u=e[c];e[c]=null,u._batchEnabled!==a&&(h.count>=t&&(s.boundArray(h,r,a,t),this.buildDrawCalls(h,l,c),l=c,h=i[++o],++a),u._batchEnabled=a,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(s.boundArray(h,r,a,t),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let c=0;c<r.length;c++)r[c]=null;z._globalBatch=a}buildDrawCalls(e,t,i){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:n,vertexSize:a}=this,o=Kt._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=e;for(let d=t;d<i;++d){const f=s[d],p=f._texture.baseTexture,_=Zr[p.alphaMode?1:0][f.blendMode];s[d]=null,t<d&&u.blend!==_&&(u.size=c-u.start,t=d,u=o[++h],u.texArray=e,u.start=c),this.packInterleavedGeometry(f,r,n,l,c),l+=f.vertexData.length/2*a,c+=f.indices.length,u.blend=_}t<i&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;Kt.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,s=Kt._drawCallPool;let r=null;for(let n=0;n<e;n++){const{texArray:a,type:o,size:h,start:l,blend:c}=s[n];r!==a&&(r=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),t.drawElements(o,h,t.UNSIGNED_SHORT,l*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Kt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Ii(Math.ceil(e/8)),i=Jr(t),s=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new Ls(s*this.vertexSize*4)),r}getIndexBuffer(e){const t=Ii(Math.ceil(e/12)),i=Jr(t),s=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(e,t,i,s,r){const{uint32View:n,float32View:a}=t,o=s/this.vertexSize,h=e.uvs,l=e.indices,c=e.vertexData,u=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),f=$.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let p=0;p<c.length;p+=2)a[s++]=c[p],a[s++]=c[p+1],a[s++]=h[p],a[s++]=h[p+1],n[s++]=f,a[s++]=u;for(let p=0;p<l.length;p++)i[r++]=o+l[p]}};let Xt=Kt;Xt.defaultBatchSize=4096,Xt.extension={name:"batch",type:D.RendererPlugin},Xt._drawCallPool=[],Xt._textureArrayPool=[],U.add(Xt);var Ju=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,td=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Bi=class extends ie{constructor(e,t,i){const s=Ht.from(e||Bi.defaultVertexSrc,t||Bi.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Bi.defaultResolution,this.multisample=Bi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new de}apply(e,t,i,s,r){e.applyFilter(this,t,i,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return td}static get defaultFragmentSrc(){return Ju}};let xt=Bi;xt.defaultResolution=1,xt.defaultMultisample=ot.NONE;class Oi{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new $(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:i,background:s,backgroundAlpha:r}=t,n=s!=null?s:i;n!==void 0&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Oi.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Oi.extension={type:[D.RendererSystem,D.CanvasRendererSystem],name:"background"},U.add(Oi);class fn{constructor(t){this.renderer=t,this.emptyRenderer=new Di(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,i){const{boundTextures:s}=this.renderer.texture;for(let r=i-1;r>=0;--r)t[r]=s[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,i,s,r){const{elements:n,ids:a,count:o}=t;let h=0;for(let l=0;l<o;l++){const c=n[l],u=c._batchLocation;if(u>=0&&u<r&&i[u]===c){a[l]=u;continue}for(;h<r;){const d=i[h];if(d&&d._batchEnabled===s&&d._batchLocation===h){h++;continue}a[l]=h,c._batchLocation=h,i[h]=c;break}}}destroy(){this.renderer=null}}fn.extension={type:D.RendererSystem,name:"batch"},U.add(fn);let $o=0;class Fi{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=$o++}init(t){if(t.context)this.initFromContext(t.context);else{const i=this.renderer.background.alpha<1,s=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:i,premultipliedAlpha:s,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=$o++,this.renderer.runners.contextChange.emit(t);const i=this.renderer.view;i.addEventListener!==void 0&&(i.addEventListener("webglcontextlost",this.handleContextLost,!1),i.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const i=this.createContext(this.renderer.view,t);this.initFromContext(i)}createContext(t,i){let s;if(N.PREFER_ENV>=Ee.WEBGL2&&(s=t.getContext("webgl2",i)),s)this.webGLVersion=2;else if(this.webGLVersion=1,s=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),!s)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,i={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,i,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,i,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const i=t.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),i&&!i.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=s||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Fi.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Fi.extension={type:D.RendererSystem,name:"context"},U.add(Fi);class ed extends ii{upload(t,i,s){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ut.UNPACK);const n=i.realWidth,a=i.realHeight;return s.width===n&&s.height===a?r.texSubImage2D(i.target,0,0,0,n,a,i.format,s.type,this.data):(s.width=n,s.height=a,r.texImage2D(i.target,0,s.internalFormat,n,a,0,i.format,s.type,this.data)),!0}}class Ws{constructor(t,i){this.width=Math.round(t||100),this.height=Math.round(i||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Ft("disposeFramebuffer"),this.multisample=ot.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,i){return this.colorTextures[t]=i||new z(null,{scaleMode:ne.NEAREST,resolution:1,mipmap:$t.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new z(new ed(null,{width:this.width,height:this.height}),{scaleMode:ne.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:$t.OFF,format:R.DEPTH_COMPONENT,type:G.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,i){if(t=Math.round(t),i=Math.round(i),!(t===this.width&&i===this.height)){this.width=t,this.height=i,this.dirtyId++,this.dirtySize++;for(let s=0;s<this.colorTextures.length;s++){const r=this.colorTextures[s],n=r.resolution;r.setSize(t/n,i/n)}if(this.depthTexture){const s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,i/s)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class pn extends z{constructor(t={}){var i;if(typeof t=="number"){const s=arguments[0],r=arguments[1],n=arguments[2],a=arguments[3];t={width:s,height:r,scaleMode:n,resolution:a}}t.width=t.width||100,t.height=t.height||100,(i=t.multisample)!=null||(t.multisample=ot.NONE),super(null,t),this.mipmap=$t.OFF,this.valid=!0,this._clear=new $([0,0,0,0]),this.framebuffer=new Ws(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,i){this.framebuffer.resize(t*this.resolution,i*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class _e extends ei{constructor(t){const i=t,s=i.naturalWidth||i.videoWidth||i.width,r=i.naturalHeight||i.videoHeight||i.height;super(s,r),this.source=t,this.noSubImage=!1}static crossOrigin(t,i,s){s===void 0&&!i.startsWith("data:")?t.crossOrigin=Ro(i):s!==!1&&(t.crossOrigin=typeof s=="string"?s:"anonymous")}upload(t,i,s,r){const n=t.gl,a=i.realWidth,o=i.realHeight;if(r=r||this.source,typeof HTMLImageElement!="undefined"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement!="undefined"&&r instanceof HTMLVideoElement&&r.readyState<=1&&r.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.alphaMode===Ut.UNPACK),!this.noSubImage&&i.target===n.TEXTURE_2D&&s.width===a&&s.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,i.format,s.type,r):(s.width=a,s.height=o,n.texImage2D(i.target,0,s.internalFormat,i.format,s.type,r)),!0}update(){if(this.destroyed)return;const t=this.source,i=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;this.resize(i,s),super.update()}dispose(){this.source=null}}class mn extends _e{constructor(t,i){var s;if(i=i||{},typeof t=="string"){const r=new Image;_e.crossOrigin(r,t,i.crossorigin),r.src=t,t=r}super(t),!t.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((s=i.createBitmap)!=null?s:N.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this.bitmap=null,this._load=null,i.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((i,s)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.resize(r.width,r.height),this._load=null,this.createBitmap?i(this.process()):i(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=a=>{s(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const i=globalThis.createImageBitmap,s=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:s?"cors":"no-cors"}).then(r=>r.blob()).then(r=>i(r,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ut.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,i,s){if(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,i,s);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,i,s,this.bitmap),!this.preserveBitmap){let r=!0;const n=i._glTextures;for(const a in n){const o=n[a];if(o!==s&&o.dirtyId!==i.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement!="undefined"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class _n{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,i,s){const r=i.width,n=i.height;if(s){const a=t.width/2/r,o=t.height/2/n,h=t.x/r+a,l=t.y/n+o;s=it.add(s,it.NW),this.x0=h+a*it.uX(s),this.y0=l+o*it.uY(s),s=it.add(s,2),this.x1=h+a*it.uX(s),this.y1=l+o*it.uY(s),s=it.add(s,2),this.x2=h+a*it.uX(s),this.y2=l+o*it.uY(s),s=it.add(s,2),this.x3=h+a*it.uX(s),this.y3=l+o*it.uY(s)}else this.x0=t.x/r,this.y0=t.y/n,this.x1=(t.x+t.width)/r,this.y1=t.y/n,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/n,this.x3=t.x/r,this.y3=(t.y+t.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Yo=new _n;function $s(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class B extends bi{constructor(t,i,s,r,n,a,o){if(super(),this.noFrame=!1,i||(this.noFrame=!0,i=new W(0,0,1,1)),t instanceof B&&(t=t.baseTexture),this.baseTexture=t,this._frame=i,this.trim=r,this.valid=!1,this._uvs=Yo,this.uvMatrix=null,this.orig=s||i,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new J(a.x,a.y):new J(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=i:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:i}=this.baseTexture;(i==null?void 0:i.url)&&St[i.url]&&B.removeFromCache(i.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,B.removeFromCache(this),this.textureCacheIds=null}clone(){var r;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),s=new B(this.baseTexture,!this.noFrame&&t,i,(r=this.trim)==null?void 0:r.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(s._frame=t),s}updateUvs(){this._uvs===Yo&&(this._uvs=new _n),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,i={},s=N.STRICT_TEXTURE_CACHE){const r=typeof t=="string";let n=null;if(r)n=t;else if(t instanceof z){if(!t.cacheId){const o=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t.cacheId=`${o}-${Ae()}`,z.addToCache(t,t.cacheId)}n=t.cacheId}else{if(!t._pixiId){const o=(i==null?void 0:i.pixiIdPrefix)||"pixiid";t._pixiId=`${o}_${Ae()}`}n=t._pixiId}let a=St[n];if(r&&s&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(t instanceof z)?(i.resolution||(i.resolution=me(t)),a=new B(new z(t,i)),a.baseTexture.cacheId=n,z.addToCache(a.baseTexture,n),B.addToCache(a,n)):!a&&t instanceof z&&(a=new B(t),B.addToCache(a,n)),a}static fromURL(t,i){const s=Object.assign({autoLoad:!1},i==null?void 0:i.resourceOptions),r=B.from(t,Object.assign({resourceOptions:s},i),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(t,i,s,r){return new B(z.fromBuffer(t,i,s,r))}static fromLoader(t,i,s,r){const n=new z(t,Object.assign({scaleMode:z.defaultOptions.scaleMode,resolution:me(i)},r)),{resource:a}=n;a instanceof mn&&(a.url=i);const o=new B(n);return s||(s=i),z.addToCache(o.baseTexture,s),B.addToCache(o,s),s!==i&&(z.addToCache(o.baseTexture,i),B.addToCache(o,i)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(t,i){i&&(t.textureCacheIds.includes(i)||t.textureCacheIds.push(i),St[i]&&St[i]!==t&&console.warn(`Texture added to the cache with an id [${i}] that already had an entry`),St[i]=t)}static removeFromCache(t){if(typeof t=="string"){const i=St[t];if(i){const s=i.textureCacheIds.indexOf(t);return s>-1&&i.textureCacheIds.splice(s,1),delete St[t],i}}else if(t!=null&&t.textureCacheIds){for(let i=0;i<t.textureCacheIds.length;++i)St[t.textureCacheIds[i]]===t&&delete St[t.textureCacheIds[i]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:i,y:s,width:r,height:n}=t,a=i+r>this.baseTexture.width,o=s+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${i} + ${r} = ${i+r} > ${this.baseTexture.width}`,c=`Y: ${s} + ${n} = ${s+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return B._EMPTY||(B._EMPTY=new B(new z),$s(B._EMPTY),$s(B._EMPTY.baseTexture)),B._EMPTY}static get WHITE(){if(!B._WHITE){const t=N.ADAPTER.createCanvas(16,16),i=t.getContext("2d");t.width=16,t.height=16,i.fillStyle="white",i.fillRect(0,0,16,16),B._WHITE=new B(z.from(t)),$s(B._WHITE),$s(B._WHITE.baseTexture)}return B._WHITE}}class Pe extends B{constructor(t,i){super(t,i),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,i,s=!0){const r=this.baseTexture.resolution,n=Math.round(t*r)/r,a=Math.round(i*r)/r;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,s&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(t){const{baseTexture:i}=this;i.resolution!==t&&(i.setResolution(t),this.resize(i.width,i.height,!1))}static create(t){return new Pe(new pn(t))}}class gn{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,i,s=ot.NONE){const r=new pn(Object.assign({width:t,height:i,resolution:1,multisample:s},this.textureOptions));return new Pe(r)}getOptimalTexture(t,i,s=1,r=ot.NONE){let n;t=Math.ceil(t*s-1e-6),i=Math.ceil(i*s-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||i!==this._pixelsHeight?(t=Ii(t),i=Ii(i),n=((t&65535)<<16|i&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(t,i,r)),a.filterPoolKey=n,a.setResolution(s),a}getFilterTexture(t,i,s){const r=this.getOptimalTexture(t.width,t.height,i||t.resolution,s||ot.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const i=t.filterPoolKey;t.filterFrame=null,this.texturePool[i].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const i in this.texturePool){const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const i in this.texturePool){if(!(Number(i)<0))continue;const s=this.texturePool[i];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}gn.SCREEN_KEY=-1;class qo extends Te{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class xn extends Te{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new nt(this.vertices),this.uvBuffer=new nt(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,i){let s=0,r=0;return this.uvs[0]=s,this.uvs[1]=r,this.uvs[2]=s+i.width/t.width,this.uvs[3]=r,this.uvs[4]=s+i.width/t.width,this.uvs[5]=r+i.height/t.height,this.uvs[6]=s,this.uvs[7]=r+i.height/t.height,s=i.x,r=i.y,this.vertices[0]=s,this.vertices[1]=r,this.vertices[2]=s+i.width,this.vertices[3]=r,this.vertices[4]=s+i.width,this.vertices[5]=r+i.height,this.vertices[6]=s,this.vertices[7]=r+i.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Zo{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=ot.NONE,this.sourceFrame=new W,this.destinationFrame=new W,this.bindingSourceFrame=new W,this.bindingDestinationFrame=new W,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ys=[new J,new J,new J,new J],vn=new tt;class yn{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new gn,this.statePool=[],this.quad=new qo,this.quadUv=new xn,this.tempRect=new W,this.activeState={},this.globalUniforms=new jt({outputFrame:new W,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,i){var p,_;const s=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new Zo,a=this.renderer.renderTexture;let o=i[0].resolution,h=i[0].multisample,l=i[0].padding,c=i[0].autoFit,u=(p=i[0].legacy)!=null?p:!0;for(let m=1;m<i.length;m++){const x=i[m];o=Math.min(o,x.resolution),h=Math.min(h,x.multisample),l=this.useMaxPadding?Math.max(l,x.padding):l+x.padding,c=c&&x.autoFit,u=u||((_=x.legacy)!=null?_:!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),r.push(n),n.resolution=o,n.multisample=h,n.legacy=u,n.target=t,n.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),n.sourceFrame.pad(l);const d=this.tempRect.copyFrom(a.sourceFrame);s.projection.transform&&this.transformAABB(vn.copyFrom(s.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:s.resolution,a.sourceFrame,a.destinationFrame,s.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o,h),n.filters=i,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=s.projection.transform,s.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,f),s.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,i=t.pop(),s=i.filters;this.activeState=i;const r=this.globalUniforms.uniforms;r.outputFrame=i.sourceFrame,r.resolution=i.resolution;const n=r.inputSize,a=r.inputPixel,o=r.inputClamp;if(n[0]=i.destinationFrame.width,n[1]=i.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*i.resolution),a[1]=Math.round(n[1]*i.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=i.sourceFrame.width*n[2]-.5*a[2],o[3]=i.sourceFrame.height*n[3]-.5*a[3],i.legacy){const l=r.filterArea;l[0]=i.destinationFrame.width,l[1]=i.destinationFrame.height,l[2]=i.sourceFrame.x,l[3]=i.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const h=t[t.length-1];if(this.renderer.framebuffer.blit(),s.length===1)s[0].apply(this,i.renderTexture,h.renderTexture,Yt.BLEND,i),this.returnFilterTexture(i.renderTexture);else{let l=i.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,i.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<s.length-1;++u){u===1&&i.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,i.resolution),c.filterFrame=l.filterFrame),s[u].apply(this,l,c,Yt.CLEAR,i);const d=l;l=c,c=d}s[u].apply(this,l,h.renderTexture,Yt.BLEND,i),u>1&&i.multisample>1&&this.returnFilterTexture(i.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}i.clear(),this.statePool.push(i)}bindAndClear(t,i=Yt.CLEAR){const{renderTexture:s,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,s.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?s.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(i===Yt.CLEAR||i===Yt.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,i,s,r){const n=this.renderer;n.state.set(t.state),this.bindAndClear(s,r),t.uniforms.uSampler=i,t.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(i._frame,i.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(Wt.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(Wt.TRIANGLE_STRIP))}calculateSpriteMatrix(t,i){const{sourceFrame:s,destinationFrame:r}=this.activeState,{orig:n}=i._texture,a=t.set(r.width,0,0,r.height,s.x,s.y),o=i.worldTransform.copyTo(tt.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(i.anchor.x,i.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,i,s=1,r=ot.NONE){return this.texturePool.getOptimalTexture(t,i,s,r)}getFilterTexture(t,i,s){if(typeof t=="number"){const n=t;t=i,i=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,i||t.resolution,s||ot.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,i){const s=Ys[0],r=Ys[1],n=Ys[2],a=Ys[3];s.set(i.left,i.top),r.set(i.left,i.bottom),n.set(i.right,i.top),a.set(i.right,i.bottom),t.apply(s,s),t.apply(r,r),t.apply(n,n),t.apply(a,a);const o=Math.min(s.x,r.x,n.x,a.x),h=Math.min(s.y,r.y,n.y,a.y),l=Math.max(s.x,r.x,n.x,a.x),c=Math.max(s.y,r.y,n.y,a.y);i.x=o,i.y=h,i.width=l-o,i.height=c-h}roundFrame(t,i,s,r,n){if(!(t.width<=0||t.height<=0||s.width<=0||s.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?vn.copyFrom(n):vn.identity(),n.translate(-s.x,-s.y).scale(r.width/s.width,r.height/s.height).translate(r.x,r.y),this.transformAABB(n,t),t.ceil(i),this.transformAABB(n.invert(),t)}}}yn.extension={type:D.RendererSystem,name:"filter"},U.add(yn);class Ko{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=ot.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const id=new W;class bn{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Ws(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new W,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let i=this.renderer.context.extensions.drawBuffers,s=this.renderer.context.extensions.depthTexture;N.PREFER_ENV===Ee.WEBGL_LEGACY&&(i=null,s=null),i?t.drawBuffers=r=>i.drawBuffersWEBGL(r):(this.hasMRT=!1,t.drawBuffers=()=>{}),s||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,i,s=0){const{gl:r}=this;if(t){const n=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==s&&(t.dirtyId++,t.dirtyFormat++,n.mipLevel=s),n.dirtyId!==t.dirtyId&&(n.dirtyId=t.dirtyId,n.dirtyFormat!==t.dirtyFormat?(n.dirtyFormat=t.dirtyFormat,n.dirtySize=t.dirtySize,this.updateFramebuffer(t,s)):n.dirtySize!==t.dirtySize&&(n.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const o=t.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),i){const a=i.width>>s,o=i.height>>s,h=a/i.width;this.setViewport(i.x*h,i.y*h,a,o)}else{const a=t.width>>s,o=t.height>>s;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),i?this.setViewport(i.x,i.y,i.width,i.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,i,s,r){const n=this.viewport;t=Math.round(t),i=Math.round(i),s=Math.round(s),r=Math.round(r),(n.width!==s||n.height!==r||n.x!==t||n.y!==i)&&(n.x=t,n.y=i,n.width=s,n.height=r,this.gl.viewport(t,i,s,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,i,s,r,n=Es.COLOR|Es.DEPTH){const{gl:a}=this;a.clearColor(t,i,s,r),a.clear(n)}initFramebuffer(t){const{gl:i}=this,s=new Ko(i.createFramebuffer());return s.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=s,this.managedFramebuffers.push(t),t.disposeRunner.add(this),s}resizeFramebuffer(t){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID];s.stencil&&(i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let n=r.length;i.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=r[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&s.msaaBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,i){const{gl:s}=this,r=t.glFramebuffers[this.CONTEXT_UID],n=t.colorTextures;let a=n.length;s.drawBuffers||(a=Math.min(a,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||s.createRenderbuffer():r.msaaBuffer&&(s.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&r.msaaBuffer?(s.bindRenderbuffer(s.RENDERBUFFER,r.msaaBuffer),s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,r.msaaBuffer)):(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,i),o.push(s.COLOR_ATTACHMENT0+h))}if(o.length>1&&s.drawBuffers(o),t.depthTexture&&this.writeDepthTexture){const l=t.depthTexture;this.renderer.texture.bind(l,0),s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,i)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(r.stencil=r.stencil||s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,r.stencil),r.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,r.multisample,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,t.width,t.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,r.stencil)):r.stencil&&(s.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:i}=this;let s=ot.NONE;if(t<=1||i===null)return s;for(let r=0;r<i.length;r++)if(i[r]<=t){s=i[r];break}return s===1&&(s=ot.NONE),s}blit(t,i,s){const{current:r,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!r)return;const h=r.glFramebuffers[o];if(!h)return;if(!t){if(!h.msaaBuffer)return;const c=r.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new Ws(r.width,r.height),h.blitFramebuffer.addColorTexture(0,c)),t=h.blitFramebuffer,t.colorTextures[0]!==c&&(t.colorTextures[0]=c,t.dirtyId++,t.dirtyFormat++),(t.width!==r.width||t.height!==r.height)&&(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}i||(i=id,i.width=r.width,i.height=r.height),s||(s=i);const l=i.width===s.width&&i.height===s.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(i.left,i.top,i.right,i.bottom,s.left,s.top,s.right,s.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,i){const s=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!s)return;delete t.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(t);n>=0&&this.managedFramebuffers.splice(n,1),t.disposeRunner.remove(this),i||(r.deleteFramebuffer(s.framebuffer),s.msaaBuffer&&r.deleteRenderbuffer(s.msaaBuffer),s.stencil&&r.deleteRenderbuffer(s.stencil)),s.blitFramebuffer&&this.disposeFramebuffer(s.blitFramebuffer,i)}disposeAll(t){const i=this.managedFramebuffers;this.managedFramebuffers=[];for(let s=0;s<i.length;s++)this.disposeFramebuffer(i[s],t)}forceStencil(){const t=this.current;if(!t)return;const i=t.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil)return;t.stencil=!0;const s=t.width,r=t.height,n=this.gl,a=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a),i.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,i.multisample,n.DEPTH24_STENCIL8,s,r):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,s,r),i.stencil=a,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new W}destroy(){this.renderer=null}}bn.extension={type:D.RendererSystem,name:"framebuffer"},U.add(bn);const Tn={5126:4,5123:2,5121:1};class En{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,i=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,i.webGLVersion!==2){let s=this.renderer.context.extensions.vertexArrayObject;N.PREFER_ENV===Ee.WEBGL_LEGACY&&(s=null),s?(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=r=>s.bindVertexArrayOES(r),t.deleteVertexArray=r=>s.deleteVertexArrayOES(r)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(i.webGLVersion!==2){const s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=(r,n)=>s.vertexAttribDivisorANGLE(r,n),t.drawElementsInstanced=(r,n,a,o,h)=>s.drawElementsInstancedANGLE(r,n,a,o,h),t.drawArraysInstanced=(r,n,a,o)=>s.drawArraysInstancedANGLE(r,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=i.webGLVersion===2||!!i.extensions.uint32ElementIndex}bind(t,i){i=i||this.renderer.shader.shader;const{gl:s}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const a=r[i.program.id]||this.initGeometryVao(t,i,n);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?s.bindVertexArray(a):this.activateVao(t,i.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,i=this.renderer.buffer;for(let s=0;s<t.buffers.length;s++){const r=t.buffers[s];i.update(r)}}checkCompatibility(t,i){const s=t.attributes,r=i.attributeData;for(const n in r)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(t,i){const s=t.attributes,r=i.attributeData,n=["g",t.id];for(const a in s)r[a]&&n.push(a,r[a].location);return n.join("-")}initGeometryVao(t,i,s=!0){const r=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=i.program;o.glPrograms[n]||this.renderer.shader.generateProgram(i),this.checkCompatibility(t,o);const h=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[o.id]=c,c;const u=t.buffers,d=t.attributes,f={},p={};for(const _ in u)f[_]=0,p[_]=0;for(const _ in d)!d[_].size&&o.attributeData[_]?d[_].size=o.attributeData[_].size:d[_].size||console.warn(`PIXI Geometry attribute '${_}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[_].buffer]+=d[_].size*Tn[d[_].type];for(const _ in d){const m=d[_],x=m.size;m.stride===void 0&&(f[m.buffer]===x*Tn[m.type]?m.stride=0:m.stride=f[m.buffer]),m.start===void 0&&(m.start=p[m.buffer],p[m.buffer]+=x*Tn[m.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let _=0;_<u.length;_++){const m=u[_];a.bind(m),s&&m._glBuffers[n].refCount++}return this.activateVao(t,o),l[o.id]=c,l[h]=c,r.bindVertexArray(null),a.unbind(qt.ARRAY_BUFFER),c}disposeGeometry(t,i){var o;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const s=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=t.buffers,a=(o=this.renderer)==null?void 0:o.buffer;if(t.disposeRunner.remove(this),!!s){if(a)for(let h=0;h<n.length;h++){const l=n[h]._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!i&&a.dispose(n[h],i))}if(!i){for(const h in s)if(h[0]==="g"){const l=s[h];this._activeVao===l&&this.unbind(),r.deleteVertexArray(l)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const i=Object.keys(this.managedGeometries);for(let s=0;s<i.length;s++)this.disposeGeometry(this.managedGeometries[i[s]],t)}activateVao(t,i){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,a=t.buffers,o=t.attributes;t.indexBuffer&&n.bind(t.indexBuffer);let h=null;for(const l in o){const c=o[l],u=a[c.buffer],d=u._glBuffers[r];if(i.attributeData[l]){h!==d&&(n.bind(u),h=d);const f=i.attributeData[l].location;if(s.enableVertexAttribArray(f),s.vertexAttribPointer(f,c.size,c.type||s.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)s.vertexAttribDivisor(f,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,i,s,r){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(t,i||a.indexBuffer.data.length,h,(s||0)*o,r||1):n.drawElements(t,i||a.indexBuffer.data.length,h,(s||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(t,s,i||a.getSize(),r||1):n.drawArrays(t,s,i||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}En.extension={type:D.RendererSystem,name:"geometry"},U.add(En);const Qo=new tt;class qs{constructor(t,i){this._texture=t,this.mapCoord=new tt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof i=="undefined"?.5:i,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,i){i===void 0&&(i=t);const s=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];i[r]=n*s.a+a*s.c+s.tx,i[r+1]=n*s.b+a*s.d+s.ty}return i}update(t){const i=this._texture;if(!i||!i.valid||!t&&this._textureID===i._updateID)return!1;this._textureID=i._updateID,this._updateID++;const s=i._uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const r=i.orig,n=i.trim;n&&(Qo.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Qo));const a=i.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(i._frame.x+h+l)/a.width,o[1]=(i._frame.y+h+l)/a.height,o[2]=(i._frame.x+i._frame.width-h+l)/a.width,o[3]=(i._frame.y+i._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=i._frame.width===a.width&&i._frame.height===a.height&&i.rotate===0,!0}}var sd=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,rd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Jo extends xt{constructor(t,i,s){let r=null;typeof t!="string"&&i===void 0&&s===void 0&&(r=t,t=void 0,i=void 0,s=void 0),super(t||rd,i||sd,s),this.maskSprite=r,this.maskMatrix=new tt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,i,s,r){const n=this._maskSprite,a=n._texture;!a.valid||(a.uvMatrix||(a.uvMatrix=new qs(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,i,s,r))}}class th{constructor(t=null){this.type=ut.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=xt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ut.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class wn{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,i){let s=i;if(!s.isMaskData){const n=this.maskDataPool.pop()||new th;n.pooled=!0,n.maskObject=i,s=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(s.copyCountersOrReset(r),s._colorMask=r?r._colorMask:15,s.autoDetect&&this.detect(s),s._target=t,s.type!==ut.SPRITE&&this.maskStack.push(s),s.enabled)switch(s.type){case ut.SCISSOR:this.renderer.scissor.push(s);break;case ut.STENCIL:this.renderer.stencil.push(s);break;case ut.SPRITE:s.copyCountersOrReset(null),this.pushSpriteMask(s);break;case ut.COLOR:this.pushColorMask(s);break;default:break}s.type===ut.SPRITE&&this.maskStack.push(s)}pop(t){const i=this.maskStack.pop();if(!(!i||i._target!==t)){if(i.enabled)switch(i.type){case ut.SCISSOR:this.renderer.scissor.pop(i);break;case ut.STENCIL:this.renderer.stencil.pop(i.maskObject);break;case ut.SPRITE:this.popSpriteMask(i);break;case ut.COLOR:this.popColorMask(i);break;default:break}if(i.reset(),i.pooled&&this.maskDataPool.push(i),this.maskStack.length!==0){const s=this.maskStack[this.maskStack.length-1];s.type===ut.SPRITE&&s._filters&&(s._filters[0].maskSprite=s.maskObject)}}}detect(t){const i=t.maskObject;i?i.isSprite?t.type=ut.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=ut.SCISSOR:t.type=ut.STENCIL:t.type=ut.COLOR}pushSpriteMask(t){var c,u;const{maskObject:i}=t,s=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new Jo]));const n=this.renderer,a=n.renderTexture;let o,h;if(a.current){const d=a.current;o=t.resolution||d.resolution,h=(c=t.multisample)!=null?c:d.multisample}else o=t.resolution||n.resolution,h=(u=t.multisample)!=null?u:n.multisample;r[0].resolution=o,r[0].multisample=h,r[0].maskSprite=i;const l=s.filterArea;s.filterArea=i.getBounds(!0),n.filter.push(s,r),s.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const i=t._colorMask,s=t._colorMask=i&t.colorMask;s!==i&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}popColorMask(t){const i=t._colorMask,s=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;s!==i&&this.renderer.gl.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)}destroy(){this.renderer=null}}wn.extension={type:D.RendererSystem,name:"mask"},U.add(wn);class eh{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:i}=this.renderer,s=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==s&&(r===0?i.disable(this.glConst):(i.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const ih=new tt,sh=[],Zs=class extends eh{constructor(e){super(e),this.glConst=N.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){var a;if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:s}=this,r=s.renderTexture,n=i.getBounds(!0,(a=sh.pop())!=null?a:new W);this.roundFrameToPixels(n,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:s,d:r}=e;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||Zs.isMatrixRotated(t.worldTransform)||Zs.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,s,r){Zs.isMatrixRotated(r)||(r=r?ih.copyFrom(r):ih.identity(),r.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&sh.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};let An=Zs;An.extension={type:D.RendererSystem,name:"scissor"},U.add(An);class Sn extends eh{constructor(t){super(t),this.glConst=N.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const i=t.maskObject,{gl:s}=this.renderer,r=t._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),s.clearStencil(0),s.clear(s.STENCIL_BUFFER_BIT),s.enable(s.STENCIL_TEST)),t._stencilCounter++;const n=t._colorMask;n!==0&&(t._colorMask=0,s.colorMask(!1,!1,!1,!1)),s.stencilFunc(s.EQUAL,r,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.INCR),i.renderable=!0,i.render(this.renderer),this.renderer.batch.flush(),i.renderable=!1,n!==0&&(t._colorMask=n,s.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(t){const i=this.renderer.gl;if(this.getStackLength()===0)i.disable(i.STENCIL_TEST);else{const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=s?s._colorMask:15;r!==0&&(s._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilOp(i.KEEP,i.KEEP,i.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,r!==0&&(s._colorMask=r,i.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}Sn.extension={type:D.RendererSystem,name:"stencil"},U.add(Sn);class Cn{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return j("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return j("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return j("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const i in t)this.plugins[i]=new t[i](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}Cn.extension={type:[D.RendererSystem,D.CanvasRendererSystem],name:"_plugin"},U.add(Cn);class Rn{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new tt,this.transform=null}update(t,i,s,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=i||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,s,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(t,i,s,r){const n=this.projectionMatrix,a=r?-1:1;n.identity(),n.a=1/i.width*2,n.d=a*(1/i.height*2),n.tx=-1-i.x*n.a,n.ty=-a-i.y*n.d}setTransform(t){}destroy(){this.renderer=null}}Rn.extension={type:D.RendererSystem,name:"projection"},U.add(Rn);const nd=new Ni;class In{constructor(t){this.renderer=t,this._tempMatrix=new tt}generateTexture(t,i){const h=i||{},{region:s}=h,r=Dr(h,["region"]),n=s||t.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const a=Pe.create(Et({width:n.width,height:n.height},r));this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const o=t.transform;return t.transform=nd,this.renderer.render(t,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,a}destroy(){}}In.extension={type:[D.RendererSystem,D.CanvasRendererSystem],name:"textureGenerator"},U.add(In);const Ve=new W,Li=new W;class Mn{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new W,this.destinationFrame=new W,this.viewportFrame=new W}contextChange(){var i;const t=(i=this.renderer)==null?void 0:i.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,i,s){const r=this.renderer;this.current=t;let n,a,o;t?(n=t.baseTexture,o=n.resolution,i||(Ve.width=t.frame.width,Ve.height=t.frame.height,i=Ve),s||(Li.x=t.frame.x,Li.y=t.frame.y,Li.width=i.width,Li.height=i.height,s=Li),a=n.framebuffer):(o=r.resolution,i||(Ve.width=r._view.screen.width,Ve.height=r._view.screen.height,i=Ve),s||(s=Ve,s.width=i.width,s.height=i.height));const h=this.viewportFrame;h.x=s.x*o,h.y=s.y*o,h.width=s.width*o,h.height=s.height*o,t||(h.y=r.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(s,i,o,!a),t?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(i),this.destinationFrame.copyFrom(s)}clear(t,i){const s=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=$.shared.setValue(t||s);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:c,height:u}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,u)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,i),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Mn.extension={type:D.RendererSystem,name:"renderTexture"},U.add(Mn);class ad{}class rh{constructor(t,i){this.program=t,this.uniformData=i,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function od(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const n=t.getActiveAttrib(e,r);if(n.name.startsWith("gl_"))continue;const a=Vo(t,n.type),o={type:a,name:n.name,size:Ho(a),location:t.getAttribLocation(e,n.name)};i[n.name]=o}return i}function hd(e,t){const i={},s=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const n=t.getActiveUniform(e,r),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=Vo(t,n.type);i[a]={name:a,index:r,type:h,size:n.size,isArray:o,value:Lo(h,n.size)}}return i}function nh(e,t){var h;const i=Fo(e,e.VERTEX_SHADER,t.vertexSrc),s=Fo(e,e.FRAGMENT_SHADER,t.fragmentSrc),r=e.createProgram();e.attachShader(r,i),e.attachShader(r,s);const n=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(n&&(typeof e.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(r,n.names,n.bufferMode==="separate"?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||ju(e,r,i,s),t.attributeData=od(r,e),t.uniformData=hd(r,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const l=Object.keys(t.attributeData);l.sort((c,u)=>c>u?1:-1);for(let c=0;c<l.length;c++)t.attributeData[l[c]].location=c,e.bindAttribLocation(r,c,l[c]);e.linkProgram(r)}e.deleteShader(i),e.deleteShader(s);const a={};for(const l in t.uniformData){const c=t.uniformData[l];a[l]={location:e.getUniformLocation(r,l),value:Lo(c.type,c.size)}}return new rh(r,a)}function ld(e,t,i,s,r){i.buffer.update(r)}const cd={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},ah={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function oh(e){const t=e.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let i=0,s=0,r=0;for(let n=0;n<t.length;n++){const a=t[n];if(i=ah[a.data.type],a.data.size>1&&(i=Math.max(i,16)*a.data.size),a.dataLen=i,s%i!==0&&s<16){const o=s%i%16;s+=o,r+=o}s+i>16?(r=Math.ceil(r/16)*16,a.offset=r,r+=i,s=i):(a.offset=r,s+=i,r+=i)}return r=Math.ceil(r/16)*16,{uboElements:t,size:r}}function hh(e,t){const i=[];for(const s in e)t[s]&&i.push(t[s]);return i.sort((s,r)=>s.index-r.index),i}function lh(e,t){if(!e.autoManage)return{size:0,syncFunc:ld};const i=hh(e.uniforms,t),{uboElements:s,size:r}=oh(i),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<s.length;a++){const o=s[a],h=e.uniforms[o.data.name],l=o.data.name;let c=!1;for(let u=0;u<Xe.length;u++){const d=Xe[u];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,Xe[u].codeUbo(o.data.name,h)),c=!0;break}}if(!c)if(o.data.size>1){const u=Ho(o.data.type),d=Math.max(ah[o.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=cd[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let ud=0;const Ks={textureCount:0,uboCount:0};class Nn{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=ud++}systemCheck(){if(!jo())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,i){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const s=t.program,r=s.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==s&&(this.program=s,this.gl.useProgram(r.program)),i||(Ks.textureCount=0,Ks.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ks)),r}setUniforms(t){const i=this.shader.program,s=i.glPrograms[this.renderer.CONTEXT_UID];i.syncUniforms(s.uniformData,t,this.renderer)}syncUniformGroup(t,i){const s=this.getGlProgram();(!t.static||t.dirtyId!==s.uniformDirtyGroups[t.id])&&(s.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,s,i))}syncUniforms(t,i,s){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(i.uniformData,t.uniforms,this.renderer,s)}createSyncGroups(t){const i=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[i]||(this.cache[i]=Vu(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[i],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,i){const s=this.getGlProgram();if(!t.static||t.dirtyId!==0||!s.uniformGroups[t.id]){t.dirtyId=0;const r=s.uniformGroups[t.id]||this.createSyncBufferGroup(t,s,i);t.buffer.update(),r(s.uniformData,t.uniforms,this.renderer,Ks,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,s.uniformBufferBindings[i])}createSyncBufferGroup(t,i,s){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const n=this.gl.getUniformBlockIndex(i.program,s);i.uniformBufferBindings[s]=this.shader.uniformBindCount,r.uniformBlockBinding(i.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=lh(t,this.shader.program.uniformData)),t.autoManage){const h=new Float32Array(o.size/4);t.buffer.update(h)}return i.uniformGroups[t.id]=o.syncFunc,i.uniformGroups[t.id]}getSignature(t,i,s){const r=t.uniforms,n=[`${s}-`];for(const a in r)n.push(a),i[a]&&n.push(i[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const i=this.gl,s=t.program,r=nh(i,s);return s.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Nn.extension={type:D.RendererSystem,name:"shader"},U.add(Nn);class Ui{constructor(t){this.renderer=t}run(t){const{renderer:i}=this;i.runners.init.emit(i.options),t.hello&&console.log(`PixiJS 7.2.4 - ${i.rendererLogId} - https://pixijs.com`),i.resize(i.screen.width,i.screen.height)}destroy(){}}Ui.defaultOptions={hello:!1},Ui.extension={type:[D.RendererSystem,D.CanvasRendererSystem],name:"startup"},U.add(Ui);function dd(e,t=[]){return t[H.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.ADD]=[e.ONE,e.ONE],t[H.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.NONE]=[0,0],t[H.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[H.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[H.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[H.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[H.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[H.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[H.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[H.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[H.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[H.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[H.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}const fd=0,pd=1,md=2,_d=3,gd=4,xd=5,Pn=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=H.NONE,this._blendEq=!1,this.map=[],this.map[fd]=this.setBlend,this.map[pd]=this.setOffset,this.map[md]=this.setCullFace,this.map[_d]=this.setDepthTest,this.map[gd]=this.setFrontFace,this.map[xd]=this.setDepthMask,this.checks=[],this.defaultState=new de,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=dd(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Pn.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Pn.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let Dn=Pn;Dn.extension={type:D.RendererSystem,name:"state"},U.add(Dn);class ch extends bi{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){var r;this.addRunners(...t.runners);const i=((r=t.priority)!=null?r:[]).filter(n=>t.systems[n]),s=[...i,...Object.keys(t.systems).filter(n=>!i.includes(n))];for(const n of s)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(i=>{this.runners[i]=new Ft(i)})}addSystem(t,i){const s=new t(this);if(this[i])throw new Error(`Whoops! The name "${i}" is already in use`);this[i]=s,this._systemsHash[i]=s;for(const r in this.runners)this.runners[r].add(s);return this}emitWithCustomOptions(t,i){const s=Object.keys(this._systemsHash);t.items.forEach(r=>{const n=s.find(a=>this._systemsHash[a]===r);r[t.name](i[n])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Qs=class{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Qs.defaultMaxIdle,this.checkCountMax=Qs.defaultCheckCountMax,this.mode=Qs.defaultMode}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==As.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let s=0;s<t.length;s++){const r=t[s];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(e.destroyTexture(r,!0),t[s]=null,i=!0)}if(i){let s=0;for(let r=0;r<t.length;r++)t[r]!==null&&(t[s++]=t[r]);t.length=s}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}};let Vt=Qs;Vt.defaultMode=As.AUTO,Vt.defaultMaxIdle=60*60,Vt.defaultCheckCountMax=60*10,Vt.extension={type:D.RendererSystem,name:"textureGC"},U.add(Vt);class Js{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=G.UNSIGNED_BYTE,this.internalFormat=R.RGBA,this.samplerType=0}}function vd(e){let t;return"WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?t={[G.UNSIGNED_BYTE]:{[R.RGBA]:e.RGBA8,[R.RGB]:e.RGB8,[R.RG]:e.RG8,[R.RED]:e.R8,[R.RGBA_INTEGER]:e.RGBA8UI,[R.RGB_INTEGER]:e.RGB8UI,[R.RG_INTEGER]:e.RG8UI,[R.RED_INTEGER]:e.R8UI,[R.ALPHA]:e.ALPHA,[R.LUMINANCE]:e.LUMINANCE,[R.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[G.BYTE]:{[R.RGBA]:e.RGBA8_SNORM,[R.RGB]:e.RGB8_SNORM,[R.RG]:e.RG8_SNORM,[R.RED]:e.R8_SNORM,[R.RGBA_INTEGER]:e.RGBA8I,[R.RGB_INTEGER]:e.RGB8I,[R.RG_INTEGER]:e.RG8I,[R.RED_INTEGER]:e.R8I},[G.UNSIGNED_SHORT]:{[R.RGBA_INTEGER]:e.RGBA16UI,[R.RGB_INTEGER]:e.RGB16UI,[R.RG_INTEGER]:e.RG16UI,[R.RED_INTEGER]:e.R16UI,[R.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[G.SHORT]:{[R.RGBA_INTEGER]:e.RGBA16I,[R.RGB_INTEGER]:e.RGB16I,[R.RG_INTEGER]:e.RG16I,[R.RED_INTEGER]:e.R16I},[G.UNSIGNED_INT]:{[R.RGBA_INTEGER]:e.RGBA32UI,[R.RGB_INTEGER]:e.RGB32UI,[R.RG_INTEGER]:e.RG32UI,[R.RED_INTEGER]:e.R32UI,[R.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[G.INT]:{[R.RGBA_INTEGER]:e.RGBA32I,[R.RGB_INTEGER]:e.RGB32I,[R.RG_INTEGER]:e.RG32I,[R.RED_INTEGER]:e.R32I},[G.FLOAT]:{[R.RGBA]:e.RGBA32F,[R.RGB]:e.RGB32F,[R.RG]:e.RG32F,[R.RED]:e.R32F,[R.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[G.HALF_FLOAT]:{[R.RGBA]:e.RGBA16F,[R.RGB]:e.RGB16F,[R.RG]:e.RG16F,[R.RED]:e.R16F},[G.UNSIGNED_SHORT_5_6_5]:{[R.RGB]:e.RGB565},[G.UNSIGNED_SHORT_4_4_4_4]:{[R.RGBA]:e.RGBA4},[G.UNSIGNED_SHORT_5_5_5_1]:{[R.RGBA]:e.RGB5_A1},[G.UNSIGNED_INT_2_10_10_10_REV]:{[R.RGBA]:e.RGB10_A2,[R.RGBA_INTEGER]:e.RGB10_A2UI},[G.UNSIGNED_INT_10F_11F_11F_REV]:{[R.RGB]:e.R11F_G11F_B10F},[G.UNSIGNED_INT_5_9_9_9_REV]:{[R.RGB]:e.RGB9_E5},[G.UNSIGNED_INT_24_8]:{[R.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[G.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[R.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:t={[G.UNSIGNED_BYTE]:{[R.RGBA]:e.RGBA,[R.RGB]:e.RGB,[R.ALPHA]:e.ALPHA,[R.LUMINANCE]:e.LUMINANCE,[R.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[G.UNSIGNED_SHORT_5_6_5]:{[R.RGB]:e.RGB},[G.UNSIGNED_SHORT_4_4_4_4]:{[R.RGBA]:e.RGBA},[G.UNSIGNED_SHORT_5_5_5_1]:{[R.RGBA]:e.RGBA}},t}class Bn{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new z,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=vd(t);const i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=i;for(let r=0;r<i;r++)this.boundTextures[r]=null;this.emptyTextures={};const s=new Js(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Js(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,i=0){const{gl:s}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[i]!==t&&(this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),s.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[i]=t}else this.currentLocation!==i&&(this.currentLocation=i,s.activeTexture(s.TEXTURE0+i)),s.bindTexture(s.TEXTURE_2D,this.emptyTextures[s.TEXTURE_2D].texture),this.boundTextures[i]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:i,boundTextures:s}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<s.length;r++)s[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<s.length;r++)s[r]===t&&(this.currentLocation!==r&&(i.activeTexture(i.TEXTURE0+r),this.currentLocation=r),i.bindTexture(t.target,this.emptyTextures[t.target].texture),s[r]=null)}ensureSamplerType(t){const{boundTextures:i,hasIntegerTextures:s,CONTEXT_UID:r}=this;if(!!s)for(let n=t-1;n>=0;--n){const a=i[n];a&&a._glTextures[r].samplerType!==ws.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const i=new Js(this.gl.createTexture());return i.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=i,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),i}initTextureType(t,i){var s,r;i.internalFormat=(r=(s=this.internalFormats[t.type])==null?void 0:s[t.format])!=null?r:t.format,this.webGLVersion===2&&t.type===G.HALF_FLOAT?i.type=this.gl.HALF_FLOAT:i.type=t.type}updateTexture(t){var r;const i=t._glTextures[this.CONTEXT_UID];if(!i)return;const s=this.renderer;if(this.initTextureType(t,i),(r=t.resource)!=null&&r.upload(s,t,i))i.samplerType!==ws.FLOAT&&(this.hasIntegerTextures=!0);else{const n=t.realWidth,a=t.realHeight,o=s.gl;(i.width!==n||i.height!==a||i.dirtyId<0)&&(i.width=n,i.height=a,o.texImage2D(t.target,0,i.internalFormat,n,a,0,t.format,i.type,null))}t.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(t),i.dirtyId=t.dirtyId}destroyTexture(t,i){const{gl:s}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),s.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!i)){const r=this.managedTextures.indexOf(t);r!==-1&&ti(this.managedTextures,r,1)}}updateTextureStyle(t){var s;const i=t._glTextures[this.CONTEXT_UID];!i||((t.mipmap===$t.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?i.mipmap=!1:i.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?i.wrapMode=ae.CLAMP:i.wrapMode=t.wrapMode,(s=t.resource)!=null&&s.style(this.renderer,t,i)||this.setStyle(t,i),i.dirtyStyleId=t.dirtyStyleId)}setStyle(t,i){const s=this.gl;if(i.mipmap&&t.mipmap!==$t.ON_MANUAL&&s.generateMipmap(t.target),s.texParameteri(t.target,s.TEXTURE_WRAP_S,i.wrapMode),s.texParameteri(t.target,s.TEXTURE_WRAP_T,i.wrapMode),i.mipmap){s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===ne.LINEAR?s.LINEAR_MIPMAP_LINEAR:s.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===ne.LINEAR){const n=Math.min(t.anisotropicLevel,s.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else s.texParameteri(t.target,s.TEXTURE_MIN_FILTER,t.scaleMode===ne.LINEAR?s.LINEAR:s.NEAREST);s.texParameteri(t.target,s.TEXTURE_MAG_FILTER,t.scaleMode===ne.LINEAR?s.LINEAR:s.NEAREST)}destroy(){this.renderer=null}}Bn.extension={type:D.RendererSystem,name:"texture"},U.add(Bn);class On{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glTransformFeedbacks[s]||this.createGLTransformFeedback(t);i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,i){const{gl:s,renderer:r}=this;i&&r.shader.bind(i),s.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:i,renderer:s,CONTEXT_UID:r}=this,n=i.createTransformFeedback();t._glTransformFeedbacks[r]=n,i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];!o||(s.buffer.update(o),o._glBuffers[r].refCount++,i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[r].buffer||null))}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),n}disposeTransformFeedback(t,i){const s=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<t.buffers.length;a++){const o=t.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!i&&n.dispose(o,i))}!s||(i||r.deleteTransformFeedback(s),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}On.extension={type:D.RendererSystem,name:"transformFeedback"},U.add(On);class ki{constructor(t){this.renderer=t}init(t){this.screen=new W(0,0,t.width,t.height),this.element=t.view||N.ADAPTER.createCanvas(),this.resolution=t.resolution||N.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,i){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(i*this.resolution);const s=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=s,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${s}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",s,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var i;t&&((i=this.element.parentNode)==null||i.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ki.defaultOptions={width:800,height:600,resolution:N.RESOLUTION,autoDensity:!1},ki.extension={type:[D.RendererSystem,D.CanvasRendererSystem],name:"_view"},U.add(ki),N.PREFER_ENV=Ee.WEBGL2,N.STRICT_TEXTURE_CACHE=!1,N.RENDER_OPTIONS=Et(Et(Et(Et({},Fi.defaultOptions),Oi.defaultOptions),ki.defaultOptions),Ui.defaultOptions),Object.defineProperties(N,{WRAP_MODE:{get(){return z.defaultOptions.wrapMode},set(e){j("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),z.defaultOptions.wrapMode=e}},SCALE_MODE:{get(){return z.defaultOptions.scaleMode},set(e){j("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),z.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get(){return z.defaultOptions.mipmap},set(e){j("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),z.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get(){return z.defaultOptions.anisotropicLevel},set(e){j("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),z.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get(){return j("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),xt.defaultResolution},set(e){xt.defaultResolution=e}},FILTER_MULTISAMPLE:{get(){return j("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),xt.defaultMultisample},set(e){xt.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get(){return Xt.defaultMaxTextures},set(e){j("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Xt.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get(){return Xt.defaultBatchSize},set(e){j("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Xt.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get(){return Xt.canUploadSameBuffer},set(e){j("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Xt.canUploadSameBuffer=e}},GC_MODE:{get(){return Vt.defaultMode},set(e){j("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Vt.defaultMode=e}},GC_MAX_IDLE:{get(){return Vt.defaultMaxIdle},set(e){j("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Vt.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get(){return Vt.defaultCheckCountMax},set(e){j("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Vt.defaultCheckCountMax=e}},PRECISION_VERTEX:{get(){return Ht.defaultVertexPrecision},set(e){j("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Ht.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get(){return Ht.defaultFragmentPrecision},set(e){j("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Ht.defaultFragmentPrecision=e}}});var Se=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(Se||{});class Fn{constructor(t,i=null,s=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=i,this.priority=s,this.once=r}match(t,i=null){return this.fn===t&&this.context===i}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const i=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),i}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const i=this.next;return this.next=t?null:i,this.previous=null,i}}const Lt=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Fn(null,null,1/0),this.deltaMS=1/Lt.targetFPMS,this.elapsedMS=1/Lt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=Se.NORMAL){return this._addListener(new Fn(e,t,i))}addOnce(e,t,i=Se.NORMAL){return this._addListener(new Fn(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Lt.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,Lt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Lt._shared){const e=Lt._shared=new Lt;e.autoStart=!0,e._protected=!0}return Lt._shared}static get system(){if(!Lt._system){const e=Lt._system=new Lt;e.autoStart=!0,e._protected=!0}return Lt._system}};let ft=Lt;ft.targetFPMS=.06,Object.defineProperties(N,{TARGET_FPMS:{get(){return ft.targetFPMS},set(e){j("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),ft.targetFPMS=e}}});class Ln{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(i){this._ticker&&this._ticker.remove(this.render,this),this._ticker=i,i&&i.add(this.render,this,Se.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?ft.shared:new ft,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Ln.extension=D.Application,U.add(Ln);const uh=[];U.handleByList(D.Renderer,uh);function dh(e){for(const t of uh)if(t.test(e))return new t(e);throw new Error("Unable to auto-detect a suitable renderer.")}var yd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,bd=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const fh=yd,Un=bd;class kn{constructor(t){this.renderer=t}contextChange(t){let i;if(this.renderer.context.webGLVersion===1){const s=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,s)}else{const s=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),i=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,s)}i>=ot.HIGH?this.multisample=ot.HIGH:i>=ot.MEDIUM?this.multisample=ot.MEDIUM:i>=ot.LOW?this.multisample=ot.LOW:this.multisample=ot.NONE}destroy(){}}kn.extension={type:D.RendererSystem,name:"_multisample"},U.add(kn);class Td{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Gn{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);i.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:i}=this;i.bindBuffer(t,null)}bindBufferBase(t,i){const{gl:s,CONTEXT_UID:r}=this;if(this.boundBufferBases[i]!==t){const n=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[i]=t,s.bindBufferBase(s.UNIFORM_BUFFER,i,n.buffer)}}bindBufferRange(t,i,s){const{gl:r,CONTEXT_UID:n}=this;s=s||0;const a=t._glBuffers[n]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,i||0,a.buffer,s*256,256)}update(t){const{gl:i,CONTEXT_UID:s}=this,r=t._glBuffers[s]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,i.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)i.bufferSubData(t.type,0,t.data);else{const n=t.static?i.STATIC_DRAW:i.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,i.bufferData(t.type,t.data,n)}}dispose(t,i){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const s=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),s&&(i||r.deleteBuffer(s.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const i=Object.keys(this.managedBuffers);for(let s=0;s<i.length;s++)this.dispose(this.managedBuffers[i[s]],t)}createGLBuffer(t){const{CONTEXT_UID:i,gl:s}=this;return t._glBuffers[i]=new Td(s.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[i]}}Gn.extension={type:D.RendererSystem,name:"buffer"},U.add(Gn);class Hn{constructor(t){this.renderer=t}render(t,i){const s=this.renderer;let r,n,a,o;if(i&&(r=i.renderTexture,n=i.clear,a=i.transform,o=i.skipUpdateTransform),this.renderingToScreen=!r,s.runners.prerender.emit(),s.emit("prerender"),s.projection.transform=a,!s.context.isLost){if(r||(this.lastObjectRendered=t),!o){const h=t.enableTempParent();t.updateTransform(),t.disableTempParent(h)}s.renderTexture.bind(r),s.batch.currentRenderer.start(),(n!=null?n:s.background.clearBeforeRender)&&s.renderTexture.clear(),t.render(s),s.batch.currentRenderer.flush(),r&&(i.blit&&s.framebuffer.blit(),r.baseTexture.update()),s.runners.postrender.emit(),s.projection.transform=null,s.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Hn.extension={type:D.RendererSystem,name:"objectRenderer"},U.add(Hn);const Xn=class extends ch{constructor(e){super(),this.type=Br.WEBGL,e=Object.assign({},N.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new jt({projectionMatrix:new tt},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Xn.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(j("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Xn.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:oo()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return j("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return j("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return j("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return j("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){j("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return j("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){j("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return j("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};let ze=Xn;ze.extension={type:D.Renderer,priority:1},ze.__plugins={},ze.__systems={},U.handleByMap(D.RendererPlugin,ze.__plugins),U.handleByMap(D.RendererSystem,ze.__systems),U.add(ze);class Vn extends ei{constructor(t,i){const{width:s,height:r}=i||{};super(s,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<t;n++){const a=new z;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,i){for(let s=0;s<this.length;s++)!t[s]||(t[s].castToBaseTexture?this.addBaseTextureAt(t[s].castToBaseTexture(),s):t[s]instanceof ei?this.addResourceAt(t[s],s):this.addResourceAt(ln(t[s],i),s))}dispose(){for(let t=0,i=this.length;t<i;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,i){if(!this.items[i])throw new Error(`Index ${i} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[i].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=t,this.items[i].on("update",t.update,t)}unbind(t){super.unbind(t);for(let i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",t.update,t)}load(){if(this._load)return this._load;const i=this.items.map(s=>s.resource).filter(s=>s).map(s=>s.load());return this._load=Promise.all(i).then(()=>{const{realWidth:s,realHeight:r}=this.items[0];return this.resize(s,r),Promise.resolve(this)}),this._load}}class ph extends Vn{constructor(t,i){const{width:s,height:r}=i||{};let n,a;Array.isArray(t)?(n=t,a=t.length):a=t,super(a,{width:s,height:r}),n&&this.initFromArray(n,i)}addBaseTextureAt(t,i){if(t.resource)this.addResourceAt(t.resource,i);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Oe.TEXTURE_2D_ARRAY}upload(t,i,s){const{length:r,itemDirtyIds:n,items:a}=this,{gl:o}=t;s.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,s.internalFormat,this._width,this._height,r,0,i.format,s.type,null);for(let h=0;h<r;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,i.format,s.type,l.resource.source))}return!0}}class mh extends _e{constructor(t){super(t)}static test(t){const{OffscreenCanvas:i}=globalThis;return i&&t instanceof i?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Gi=class extends Vn{constructor(e,t){const{width:i,height:s,autoLoad:r,linkBaseTexture:n}=t||{};if(e&&e.length!==Gi.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:s});for(let a=0;a<Gi.SIDES;a++)this.items[a].target=Oe.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=n!==!1,e&&this.initFromArray(e,t),r!==!1&&this.load()}bind(e){super.bind(e),e.target=Oe.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Oe.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const s=this.itemDirtyIds;for(let r=0;r<Gi.SIDES;r++){const n=this.items[r];(s[r]<n.dirtyId||i.dirtyId<t.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(e,n,i),s[r]=n.dirtyId):s[r]<-1&&(e.gl.texImage2D(n.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),s[r]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Gi.SIDES}};let zn=Gi;zn.SIDES=6;class qe extends _e{constructor(t,i){var n;i=i||{};let s,r;typeof t=="string"?(s=qe.EMPTY,r=t):(s=t,r=null),super(s),this.url=r,this.crossOrigin=(n=i.crossOrigin)!=null?n:!0,this.alphaMode=typeof i.alphaMode=="number"?i.alphaMode:null,this._load=null,i.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,i)=>{if(this.url===null){t(this);return}try{const s=await N.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await s.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ut.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),t(this)}catch(s){if(this.destroyed)return;i(s),this.onError.emit(s)}}),this._load)}upload(t,i,s){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(i.alphaMode=this.alphaMode),super.upload(t,i,s)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap!="undefined"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){var t;return qe._EMPTY=(t=qe._EMPTY)!=null?t:N.ADAPTER.createCanvas(0,0),qe._EMPTY}}const tr=class extends _e{constructor(e,t){t=t||{},super(N.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),e(this)},tr.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;_e.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{!this._resolve||(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*t,r=this._overrideHeight||this._overrideWidth/t*i),s=Math.round(s),r=Math.round(r);const n=this.source;n.width=s,n.height=r,n._pixiId=`canvas_${Ae()}`,n.getContext("2d").drawImage(e,0,0,t,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(e){const t=tr.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&tr.SVG_XML.test(e)}};let ai=tr;ai.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,ai.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const jn=class extends _e{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);const s=e[0].src||e[0];_e.crossOrigin(i,s,t.crossorigin);for(let r=0;r<e.length;++r){const n=document.createElement("source");let{src:a,mime:o}=e[r];a=a||e[r];const h=a.split("?").shift().toLowerCase(),l=h.slice(h.lastIndexOf(".")+1);o=o||jn.MIME_TYPES[l]||`video/${l}`,n.src=a,n.type=o,i.appendChild(n)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){const t=ft.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(ft.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(ft.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._isConnectedToTicker&&(ft.shared.remove(this.update,this),this._isConnectedToTicker=!1);const e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(ft.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ft.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e)}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||jn.TYPES.includes(t)}};let er=jn;er.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],er.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},Us.push(qe,mn,mh,er,ai,ii,zn,ph);class Ed{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Ft("disposeTransformFeedback")}bindBuffer(t,i){this.buffers[t]=i}destroy(){this.disposeRunner.emit(this,!1)}}const wd="7.2.4";class Hi{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?W.EMPTY:(t=t||new W(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,i){const{a:s,b:r,c:n,d:a,tx:o,ty:h}=t,l=s*i.x+n*i.y+o,c=r*i.x+a*i.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let i=this.minX,s=this.minY,r=this.maxX,n=this.maxY,a=t[0],o=t[1];i=a<i?a:i,s=o<s?o:s,r=a>r?a:r,n=o>n?o:n,a=t[2],o=t[3],i=a<i?a:i,s=o<s?o:s,r=a>r?a:r,n=o>n?o:n,a=t[4],o=t[5],i=a<i?a:i,s=o<s?o:s,r=a>r?a:r,n=o>n?o:n,a=t[6],o=t[7],i=a<i?a:i,s=o<s?o:s,r=a>r?a:r,n=o>n?o:n,this.minX=i,this.minY=s,this.maxX=r,this.maxY=n}addFrame(t,i,s,r,n){this.addFrameMatrix(t.worldTransform,i,s,r,n)}addFrameMatrix(t,i,s,r,n){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,_=this.maxY,m=a*i+h*s+c,x=o*i+l*s+u;d=m<d?m:d,f=x<f?x:f,p=m>p?m:p,_=x>_?x:_,m=a*r+h*s+c,x=o*r+l*s+u,d=m<d?m:d,f=x<f?x:f,p=m>p?m:p,_=x>_?x:_,m=a*i+h*n+c,x=o*i+l*n+u,d=m<d?m:d,f=x<f?x:f,p=m>p?m:p,_=x>_?x:_,m=a*r+h*n+c,x=o*r+l*n+u,d=m<d?m:d,f=x<f?x:f,p=m>p?m:p,_=x>_?x:_,this.minX=d,this.minY=f,this.maxX=p,this.maxY=_}addVertexData(t,i,s){let r=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=i;h<s;h+=2){const l=t[h],c=t[h+1];r=l<r?l:r,n=c<n?c:n,a=l>a?l:a,o=c>o?c:o}this.minX=r,this.minY=n,this.maxX=a,this.maxY=o}addVertices(t,i,s,r){this.addVerticesMatrix(t.worldTransform,i,s,r)}addVerticesMatrix(t,i,s,r,n=0,a=n){const o=t.a,h=t.b,l=t.c,c=t.d,u=t.tx,d=t.ty;let f=this.minX,p=this.minY,_=this.maxX,m=this.maxY;for(let x=s;x<r;x+=2){const y=i[x],g=i[x+1],v=o*y+l*g+u,w=c*g+h*y+d;f=Math.min(f,v-n),_=Math.max(_,v+n),p=Math.min(p,w-a),m=Math.max(m,w+a)}this.minX=f,this.minY=p,this.maxX=_,this.maxY=m}addBounds(t){const i=this.minX,s=this.minY,r=this.maxX,n=this.maxY;this.minX=t.minX<i?t.minX:i,this.minY=t.minY<s?t.minY:s,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>n?t.maxY:n}addBoundsMask(t,i){const s=t.minX>i.minX?t.minX:i.minX,r=t.minY>i.minY?t.minY:i.minY,n=t.maxX<i.maxX?t.maxX:i.maxX,a=t.maxY<i.maxY?t.maxY:i.maxY;if(s<=n&&r<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=s<o?s:o,this.minY=r<h?r:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}addBoundsMatrix(t,i){this.addFrameMatrix(i,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,i){const s=t.minX>i.x?t.minX:i.x,r=t.minY>i.y?t.minY:i.y,n=t.maxX<i.x+i.width?t.maxX:i.x+i.width,a=t.maxY<i.y+i.height?t.maxY:i.y+i.height;if(s<=n&&r<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=s<o?s:o,this.minY=r<h?r:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}pad(t=0,i=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=i,this.maxY+=i)}addFramePad(t,i,s,r,n,a){t-=n,i-=a,s+=n,r+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>s?this.maxX:s,this.minY=this.minY<i?this.minY:i,this.maxY=this.maxY>r?this.maxY:r}}class at extends bi{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Ni,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Hi,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const i=Object.keys(t);for(let s=0;s<i.length;++s){const r=i[s];Object.defineProperty(at.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,i){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),i||(this._boundsRect||(this._boundsRect=new W),i=this._boundsRect),this._bounds.getRectangle(i)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new W),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Hi);const i=this.transform,s=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=s,this.transform=i,this._bounds=r,this._bounds.updateID+=this._boundsID-n,a}toGlobal(t,i,s=!1){return s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,i)}toLocal(t,i,s,r){return i&&(t=i.toGlobal(t,s,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,s)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,i=0,s=1,r=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=t,this.position.y=i,this.scale.x=s||1,this.scale.y=r||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new _h),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Po}set angle(t){this.transform.rotation=t*Do}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount--,i._maskRefCount===0&&(i.renderable=!0,i.isMask=!1))}if(this._mask=t,this._mask){const i=this._mask.isMaskData?this._mask.maskObject:this._mask;i&&(i._maskRefCount===0&&(i.renderable=!1,i.isMask=!0),i._maskRefCount++)}}}}class _h extends at{constructor(){super(...arguments),this.sortDirty=null}}at.prototype.displayObjectUpdateTransform=at.prototype.updateTransform;const Ad=new tt;function Sd(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const Wn=class extends at{constructor(){super(),this.children=[],this.sortableChildren=Wn.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),s=this.getChildIndex(t);this.children[i]=t,this.children[s]=e,this.onChildrenChange(i<s?i:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);ti(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,ti(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,ti(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,s=t,r=s-i;let n;if(r>0&&r<=s){n=this.children.splice(i,r);for(let a=0;a<n.length;++a)n[a].parent=null,n[a].transform&&(n[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}else if(r===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(Sd),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let s=0,r=this.children.length;s<r;++s){const n=this.children[s];n.visible&&n.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Wn.prototype._render&&(i=this.getBounds(!0));const r=e.projection.transform;if(r&&(s?(s=Ad.copyFrom(s),s.prepend(r)):s=r),i&&t.intersects(i,s))this._render(e);else if(this.cullArea)return;for(let n=0,a=this.children.length;n<a;++n){const o=this.children[n],h=o.cullable;o.cullable=h||!this.cullArea,o.render(e),o.cullable=h}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||((t=this.filters)==null?void 0:t.length))this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,s=this.children.length;i<s;++i)this.children[i].render(e)}}renderAdvanced(e){var r,n,a;const t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let o=0;o<t.length;o++)t[o].enabled&&this._enabledFilters.push(t[o])}const s=t&&((r=this._enabledFilters)==null?void 0:r.length)||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==ut.NONE));if(s&&e.batch.flush(),t&&((n=this._enabledFilters)==null?void 0:n.length)&&e.filter.push(this,this._enabledFilters),i&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let o=0,h=this.children.length;o<h;++o)this.children[o].render(e)}s&&e.batch.flush(),i&&e.mask.pop(this),t&&((a=this._enabledFilters)==null?void 0:a.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,i=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<i.length;++s)i[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};let Rt=Wn;Rt.defaultSortableChildren=!1,Rt.prototype.containerUpdateTransform=Rt.prototype.updateTransform,Object.defineProperties(N,{SORTABLE_CHILDREN:{get(){return Rt.defaultSortableChildren},set(e){j("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Rt.defaultSortableChildren=e}}});const Xi=new J,Cd=new Uint16Array([0,1,2,0,2,3]);class De extends Rt{constructor(t){super(),this._anchor=new be(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new $(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=H.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||B.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Cd,this.pluginName="batch",this.isSprite=!0,this._roundPixels=N.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Le(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Le(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const i=this.transform.worldTransform,s=i.a,r=i.b,n=i.c,a=i.d,o=i.tx,h=i.ty,l=this.vertexData,c=t.trim,u=t.orig,d=this._anchor;let f=0,p=0,_=0,m=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,m=c.y-d._y*u.height,_=m+c.height):(p=-d._x*u.width,f=p+u.width,m=-d._y*u.height,_=m+u.height),l[0]=s*p+n*m+o,l[1]=a*m+r*p+h,l[2]=s*f+n*m+o,l[3]=a*m+r*f+h,l[4]=s*f+n*_+o,l[5]=a*_+r*f+h,l[6]=s*p+n*_+o,l[7]=a*_+r*p+h,this._roundPixels){const x=N.RESOLUTION;for(let y=0;y<l.length;++y)l[y]=Math.round(l[y]*x)/x}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,i=this.vertexTrimmedData,s=t.orig,r=this._anchor,n=this.transform.worldTransform,a=n.a,o=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty,d=-r._x*s.width,f=d+s.width,p=-r._y*s.height,_=p+s.height;i[0]=a*d+h*p+c,i[1]=l*p+o*d+u,i[2]=a*f+h*p+c,i[3]=l*p+o*f+u,i[4]=a*f+h*_+c,i[5]=l*_+o*f+u,i[6]=a*d+h*_+c,i[7]=l*_+o*d+u}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,i=this._texture.orig;!t||t.width===i.width&&t.height===i.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Hi),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new W),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Xi);const i=this._texture.orig.width,s=this._texture.orig.height,r=-i*this.anchor.x;let n=0;return Xi.x>=r&&Xi.x<r+i&&(n=-s*this.anchor.y,Xi.y>=n&&Xi.y<n+s)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!s)}this._texture=null}static from(t,i){const s=t instanceof B?t:B.from(t,i);return new De(s)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const i=Le(this.scale.x)||1;this.scale.x=i*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const i=Le(this.scale.y)||1;this.scale.y=i*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||B.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const gh=new tt;at.prototype._cacheAsBitmap=!1,at.prototype._cacheData=null,at.prototype._cacheAsBitmapResolution=null,at.prototype._cacheAsBitmapMultisample=null;class Rd{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(at.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){if(this._cacheAsBitmap===e)return;this._cacheAsBitmap=e;let t;e?(this._cacheData||(this._cacheData=new Rd),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}),at.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},at.prototype._initCachedDisplayObject=function(t){var d,f,p;if((d=this._cacheData)!=null&&d.sprite)return;const i=this.alpha;this.alpha=1,t.batch.flush();const s=this.getLocalBounds(null,!0).clone();if((f=this.filters)!=null&&f.length){const _=this.filters[0].padding;s.pad(_)}s.ceil(N.RESOLUTION);const r=t.renderTexture.current,n=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),o=t.projection.transform,h=Pe.create({width:s.width,height:s.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:(p=this.cacheAsBitmapMultisample)!=null?p:t.multisample}),l=`cacheAsBitmap_${Ae()}`;this._cacheData.textureCacheId=l,z.addToCache(h.baseTexture,l),B.addToCache(h,l);const c=this.transform.localTransform.copyTo(gh).invert().translate(-s.x,-s.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=o,t.renderTexture.bind(r,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new De(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(s.x/s.width),u.anchor.y=-(s.y/s.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)},at.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},at.prototype._initCachedDisplayObjectCanvas=function(t){var c;if((c=this._cacheData)!=null&&c.sprite)return;const i=this.getLocalBounds(null,!0),s=this.alpha;this.alpha=1;const r=t.canvasContext.activeContext,n=t._projTransform;i.ceil(N.RESOLUTION);const a=Pe.create({width:i.width,height:i.height}),o=`cacheAsBitmap_${Ae()}`;this._cacheData.textureCacheId=o,z.addToCache(a.baseTexture,o),B.addToCache(a,o);const h=gh;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=i.x,h.ty-=i.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),t.canvasContext.activeContext=r,t._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=s;const l=new De(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(i.x/i.width),l.anchor.y=-(i.y/i.height),l.alpha=s,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)},at.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},at.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},at.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,z.removeFromCache(this._cacheData.textureCacheId),B.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},at.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},at.prototype.name=null,Rt.prototype.getChildByName=function(t,i){for(let s=0,r=this.children.length;s<r;s++)if(this.children[s].name===t)return this.children[s];if(i)for(let s=0,r=this.children.length;s<r;s++){const n=this.children[s];if(!n.getChildByName)continue;const a=n.getChildByName(t,!0);if(a)return a}return null},at.prototype.getGlobalPosition=function(t=new J,i=!1){return this.parent?this.parent.toGlobal(this.position,t,i):(t.x=this.position.x,t.y=this.position.y),t};var Id=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class xh extends xt{constructor(t=1){super(fh,Id,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const Md={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Nd=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Pd(e){const t=Md[e],i=t.length;let s=Nd,r="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let o=0;o<e;o++){let h=n.replace("%index%",o.toString());a=o,o>=i&&(a=e-o-1),h=h.replace("%value%",t[a].toString()),r+=h,r+=`
`}return s=s.replace("%blur%",r),s=s.replace("%size%",e.toString()),s}const Dd=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function Bd(e,t){const i=Math.ceil(e/2);let s=Dd,r="",n;t?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<e;a++){let o=n.replace("%index%",a.toString());o=o.replace("%sampleIndex%",`${a-(i-1)}.0`),r+=o,r+=`
`}return s=s.replace("%blur%",r),s=s.replace("%size%",e.toString()),s}class ir extends xt{constructor(t,i=8,s=4,r=xt.defaultResolution,n=5){const a=Bd(n,t),o=Pd(n);super(a,o),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=s,this.blur=i}apply(t,i,s,r){if(s?this.horizontal?this.uniforms.strength=1/s.width*(s.width/i.width):this.uniforms.strength=1/s.height*(s.height/i.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/i.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/i.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,i,s,r);else{const n=t.getFilterTexture(),a=t.renderer;let o=i,h=n;this.state.blend=!1,t.applyFilter(this,o,h,Yt.CLEAR);for(let l=1;l<this.passes-1;l++){t.bindAndClear(o,Yt.BLIT),this.uniforms.uSampler=h;const c=h;h=o,o=c,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,h,s,r),t.returnFilterTexture(n)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class vh extends xt{constructor(t=8,i=4,s=xt.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ir(!0,t,i,s,r),this.blurYFilter=new ir(!1,t,i,s,r),this.resolution=s,this.quality=i,this.blur=t,this.repeatEdgePixels=!1}apply(t,i,s,r){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const o=t.getFilterTexture();this.blurXFilter.apply(t,i,o,Yt.CLEAR),this.blurYFilter.apply(t,o,s,r),t.returnFilterTexture(o)}else a?this.blurYFilter.apply(t,i,s,r):this.blurXFilter.apply(t,i,s,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var Od=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class sr extends xt{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Un,Od,t),this.alpha=1}_loadMatrix(t,i=!1){let s=t;i&&(this._multiply(s,this.uniforms.m,t),s=this._colorMatrix(s)),this.uniforms.m=s}_multiply(t,i,s){return t[0]=i[0]*s[0]+i[1]*s[5]+i[2]*s[10]+i[3]*s[15],t[1]=i[0]*s[1]+i[1]*s[6]+i[2]*s[11]+i[3]*s[16],t[2]=i[0]*s[2]+i[1]*s[7]+i[2]*s[12]+i[3]*s[17],t[3]=i[0]*s[3]+i[1]*s[8]+i[2]*s[13]+i[3]*s[18],t[4]=i[0]*s[4]+i[1]*s[9]+i[2]*s[14]+i[3]*s[19]+i[4],t[5]=i[5]*s[0]+i[6]*s[5]+i[7]*s[10]+i[8]*s[15],t[6]=i[5]*s[1]+i[6]*s[6]+i[7]*s[11]+i[8]*s[16],t[7]=i[5]*s[2]+i[6]*s[7]+i[7]*s[12]+i[8]*s[17],t[8]=i[5]*s[3]+i[6]*s[8]+i[7]*s[13]+i[8]*s[18],t[9]=i[5]*s[4]+i[6]*s[9]+i[7]*s[14]+i[8]*s[19]+i[9],t[10]=i[10]*s[0]+i[11]*s[5]+i[12]*s[10]+i[13]*s[15],t[11]=i[10]*s[1]+i[11]*s[6]+i[12]*s[11]+i[13]*s[16],t[12]=i[10]*s[2]+i[11]*s[7]+i[12]*s[12]+i[13]*s[17],t[13]=i[10]*s[3]+i[11]*s[8]+i[12]*s[13]+i[13]*s[18],t[14]=i[10]*s[4]+i[11]*s[9]+i[12]*s[14]+i[13]*s[19]+i[14],t[15]=i[15]*s[0]+i[16]*s[5]+i[17]*s[10]+i[18]*s[15],t[16]=i[15]*s[1]+i[16]*s[6]+i[17]*s[11]+i[18]*s[16],t[17]=i[15]*s[2]+i[16]*s[7]+i[17]*s[12]+i[18]*s[17],t[18]=i[15]*s[3]+i[16]*s[8]+i[17]*s[13]+i[18]*s[18],t[19]=i[15]*s[4]+i[16]*s[9]+i[17]*s[14]+i[18]*s[19]+i[19],t}_colorMatrix(t){const i=new Float32Array(t);return i[4]/=255,i[9]/=255,i[14]/=255,i[19]/=255,i}brightness(t,i){const s=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(s,i)}tint(t,i){const[s,r,n]=$.shared.setValue(t).toArray(),a=[s,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,i)}greyscale(t,i){const s=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(s,i)}blackAndWhite(t){const i=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(i,t)}hue(t,i){t=(t||0)/180*Math.PI;const s=Math.cos(t),r=Math.sin(t),n=Math.sqrt,a=1/3,o=n(a),h=s+(1-s)*a,l=a*(1-s)-o*r,c=a*(1-s)+o*r,u=a*(1-s)+o*r,d=s+a*(1-s),f=a*(1-s)-o*r,p=a*(1-s)-o*r,_=a*(1-s)+o*r,m=s+a*(1-s),x=[h,l,c,0,0,u,d,f,0,0,p,_,m,0,0,0,0,0,1,0];this._loadMatrix(x,i)}contrast(t,i){const s=(t||0)+1,r=-.5*(s-1),n=[s,0,0,0,r,0,s,0,0,r,0,0,s,0,r,0,0,0,1,0];this._loadMatrix(n,i)}saturate(t=0,i){const s=t*2/3+1,r=(s-1)*-.5,n=[s,r,r,0,0,r,s,r,0,0,r,r,s,0,0,0,0,0,1,0];this._loadMatrix(n,i)}desaturate(){this.saturate(-1)}negative(t){const i=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(i,t)}sepia(t){const i=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(i,t)}technicolor(t){const i=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(i,t)}polaroid(t){const i=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(i,t)}toBGR(t){const i=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(i,t)}kodachrome(t){const i=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(i,t)}browni(t){const i=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(i,t)}vintage(t){const i=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(i,t)}colorTone(t,i,s,r,n){t=t||.2,i=i||.15,s=s||16770432,r=r||3375104;const a=$.shared,[o,h,l]=a.setValue(s).toArray(),[c,u,d]=a.setValue(r).toArray(),f=[.3,.59,.11,0,0,o,h,l,t,0,c,u,d,i,0,o-c,h-u,l-d,0,0];this._loadMatrix(f,n)}night(t,i){t=t||.1;const s=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(s,i)}predator(t,i){const s=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(s,i)}lsd(t){const i=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(i,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}sr.prototype.grayscale=sr.prototype.greyscale;var Fd=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,Ld=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class yh extends xt{constructor(t,i){const s=new tt;t.renderable=!1,super(Ld,Fd,{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=s,i==null&&(i=20),this.scale=new J(i,i)}apply(t,i,s,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),o=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&o!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/o,this.uniforms.rotation[3]=n.d/o),t.applyFilter(this,i,s,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var Ud=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,kd=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class bh extends xt{constructor(){super(kd,Ud)}}var Gd=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class Th extends xt{constructor(t=.5,i=Math.random()){super(Un,Gd,{uNoise:0,uSeed:0}),this.noise=t,this.seed=i}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const $n={AlphaFilter:xh,BlurFilter:vh,BlurFilterPass:ir,ColorMatrixFilter:sr,DisplacementFilter:yh,FXAAFilter:bh,NoiseFilter:Th};Object.entries($n).forEach(([e,t])=>{Object.defineProperty($n,e,{get(){return t}})});const Yn=class{constructor(e){this.stage=new Rt,e=Object.assign({forceCanvas:!1},e),this.renderer=dh(e),Yn._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(e,t){const i=Yn._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};let qn=Yn;qn._plugins=[],U.handleByList(D.Application,qn._plugins);class Zn{static init(t){Object.defineProperty(this,"resizeTo",{set(i){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=i,i&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let i,s;if(this._resizeTo===globalThis.window)i=globalThis.innerWidth,s=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;i=r,s=n}this.renderer.resize(i,s),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Zn.extension=D.Application,U.add(Zn);const Eh={loader:D.LoadParser,resolver:D.ResolveParser,cache:D.CacheParser,detection:D.DetectionParser};U.handle(D.Asset,e=>{const t=e.ref;Object.entries(Eh).filter(([i])=>!!t[i]).forEach(([i,s])=>{var r;return U.add(Object.assign(t[i],{extension:(r=t[i].extension)!=null?r:s}))})},e=>{const t=e.ref;Object.keys(Eh).filter(i=>!!t[i]).forEach(i=>U.remove(t[i]))});class Hd{constructor(t,i=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=i}add(t){t.forEach(i=>{this._assetList.push(i)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],i=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<i;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function oi(e,t){if(Array.isArray(t)){for(const i of t)if(e.startsWith(`data:${i}`))return!0;return!1}return e.startsWith(`data:${t}`)}function Ce(e,t){const i=e.split("?")[0],s=At.extname(i).toLowerCase();return Array.isArray(t)?t.includes(s):s===t}const le=(e,t)=>(Array.isArray(e)||(e=[e]),t?e.map(i=>typeof i=="string"?t(i):i):e),rr=(e,t)=>{const i=t.split("?")[1];return i&&(e+=`?${i}`),e};function wh(e,t,i,s,r){const n=t[i];for(let a=0;a<n.length;a++){const o=n[a];i<t.length-1?wh(e.replace(s[i],o),t,i+1,s,r):r.push(e.replace(s[i],o))}}function Ah(e){const t=/\{(.*?)\}/g,i=e.match(t),s=[];if(i){const r=[];i.forEach(n=>{const a=n.substring(1,n.length-1).split(",");r.push(a)}),wh(e,r,0,i,s)}else s.push(e);return s}const Vi=e=>!Array.isArray(e);class Xd{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const i=this._cache.get(t);return i||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),i}set(t,i){const s=le(t);let r;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(i)){r=h.getCacheableAssets(s,i);break}}r||(r={},s.forEach(o=>{r[o]=i}));const n=Object.keys(r),a={cacheKeys:n,keys:s};if(s.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{this._cache.has(o)&&this._cache.get(o)!==i&&console.warn("[Cache] already has key:",o),this._cache.set(o,r[o])}),i instanceof B){const o=i;s.forEach(h=>{o.baseTexture!==B.EMPTY.baseTexture&&z.addToCache(o.baseTexture,h),B.addToCache(o,h)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const i=this._cacheMap.get(t);i.cacheKeys.forEach(r=>{this._cache.delete(r)}),i.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const hi=new Xd;class Vd{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,i,s)=>(this._parsersValidated=!1,t[i]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,i){const s={promise:null,parser:null};return s.promise=(async()=>{var a,o;let r=null,n=null;if(i.loadParser&&(n=this._parserHash[i.loadParser],n||console.warn(`[Assets] specified load parser "${i.loadParser}" not found while loading ${t}`)),!n){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((a=l.test)==null?void 0:a.call(l,t,i,this))){n=l;break}}if(!n)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,i,this),s.parser=n;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((o=l.testParse)==null?void 0:o.call(l,r,i,this))&&(r=await l.parse(r,i,this)||r,s.parser=l)}return r})(),s}async load(t,i){this._parsersValidated||this._validateParsers();let s=0;const r={},n=Vi(t),a=le(t,l=>({src:l})),o=a.length,h=a.map(async l=>{const c=At.toAbsolute(l.src);if(!r[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),r[l.src]=await this.promiseCache[c].promise,i&&i(++s/o)}catch(u){throw delete this.promiseCache[c],delete r[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?r[a[0].src]:r}async unload(t){const s=le(t,r=>({src:r})).map(async r=>{var o,h;const n=At.toAbsolute(r.src),a=this.promiseCache[n];if(a){const l=await a.promise;(h=(o=a.parser)==null?void 0:o.unload)==null||h.call(o,l,r,this),delete this.promiseCache[n]}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,i)=>(t[i.name]&&console.warn(`[Assets] loadParser name conflict "${i.name}"`),Ts(Et({},t),{[i.name]:i})),{})}}var Qt=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(Qt||{});const zd=".json",jd="application/json",Sh={extension:{type:D.LoadParser,priority:Qt.Low},name:"loadJson",test(e){return oi(e,jd)||Ce(e,zd)},async load(e){return await(await N.ADAPTER.fetch(e)).json()}};U.add(Sh);const Wd=".txt",$d="text/plain",Ch={name:"loadTxt",extension:{type:D.LoadParser,priority:Qt.Low},test(e){return oi(e,$d)||Ce(e,Wd)},async load(e){return await(await N.ADAPTER.fetch(e)).text()}};U.add(Ch);const Yd=["normal","bold","100","200","300","400","500","600","700","800","900"],qd=[".ttf",".otf",".woff",".woff2"],Zd=["font/ttf","font/otf","font/woff","font/woff2"],Kd=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Rh(e){const t=At.extname(e),r=At.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let n=r.length>0;for(const o of r)if(!o.match(Kd)){n=!1;break}let a=r.join(" ");return n||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const Ih={extension:{type:D.LoadParser,priority:Qt.Low},name:"loadWebFont",test(e){return oi(e,Zd)||Ce(e,qd)},async load(e,t){var s,r,n,a,o,h;const i=N.ADAPTER.getFontFaceSet();if(i){const l=[],c=(r=(s=t.data)==null?void 0:s.family)!=null?r:Rh(e),u=(o=(a=(n=t.data)==null?void 0:n.weights)==null?void 0:a.filter(f=>Yd.includes(f)))!=null?o:["normal"],d=(h=t.data)!=null?h:{};for(let f=0;f<u.length;f++){const p=u[f],_=new FontFace(c,`url(${encodeURI(e)})`,Ts(Et({},d),{weight:p}));await _.load(),i.add(_),l.push(_)}return l.length===1?l[0]:l}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>N.ADAPTER.getFontFaceSet().delete(t))}};U.add(Ih);let Mh=0,Kn;const Qd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Jd={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${Qd}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},tf={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Qn;class ef{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const i=URL.createObjectURL(new Blob([Jd.code],{type:"application/javascript"})),s=new Worker(i);s.addEventListener("message",r=>{s.terminate(),URL.revokeObjectURL(i),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Kn===void 0&&(Kn=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Kn&&(Qn||(Qn=URL.createObjectURL(new Blob([tf.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(Qn),t.addEventListener("message",i=>{this.complete(i.data),this.returnWorker(i.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,i){await this._initWorkers();const s=new Promise((r,n)=>{this.queue.push({id:t,arguments:i,resolve:r,reject:n})});return this.next(),s}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const i=this.queue.pop(),s=i.id;this.resolveHash[Mh]={resolve:i.resolve,reject:i.reject},t.postMessage({data:i.arguments,uuid:Mh++,id:s})}}const Nh=new ef;function zi(e,t,i){const s=new B(e);return s.baseTexture.on("dispose",()=>{delete t.promiseCache[i]}),s}const sf=[".jpeg",".jpg",".png",".webp",".avif"],rf=["image/jpeg","image/png","image/webp","image/avif"];async function Ph(e){const t=await N.ADAPTER.fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const i=await t.blob();return await createImageBitmap(i)}const ji={name:"loadTextures",extension:{type:D.LoadParser,priority:Qt.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return oi(e,rf)||Ce(e,sf)},async load(e,t,i){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Nh.isImageBitmapSupported()?s=await Nh.loadImageBitmap(e):s=await Ph(e):s=await new Promise(n=>{s=new Image,s.crossOrigin=this.config.crossOrigin,s.src=e,s.complete?n(s):s.onload=()=>{n(s)}});const r=new z(s,Et({resolution:me(e)},t.data));return r.resource.src=e,zi(r,i,e)},unload(e){e.destroy(!0)}};U.add(ji);const nf=".svg",af="image/svg+xml",Dh={extension:{type:D.LoadParser,priority:Qt.High},name:"loadSVG",test(e){return oi(e,af)||Ce(e,nf)},async testParse(e){return ai.test(e)},async parse(e,t,i){var a;const s=new ai(e,(a=t==null?void 0:t.data)==null?void 0:a.resourceOptions);await s.load();const r=new z(s,Et({resolution:me(e)},t==null?void 0:t.data));return r.resource.src=e,zi(r,i,e)},async load(e,t){return(await N.ADAPTER.fetch(e)).text()},unload:ji.unload};U.add(Dh);class of{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,i)=>`${t}${this._bundleIdConnector}${i}`,extractAssetIdFromBundle:(t,i)=>i.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){var i,s,r;if(this._bundleIdConnector=(i=t.connector)!=null?i:this._bundleIdConnector,this._createBundleAssetId=(s=t.createBundleAssetId)!=null?s:this._createBundleAssetId,this._extractAssetIdFromBundle=(r=t.extractAssetIdFromBundle)!=null?r:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(i=>{this._preferredOrder.push(i),i.priority||(i.priority=Object.keys(i.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const i=t;this._defaultSearchParams=Object.keys(i).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(i[s])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(i=>{this.addBundle(i.name,i.assets)})}addBundle(t,i){const s=[];Array.isArray(i)?i.forEach(r=>{if(typeof r.name=="string"){const n=this._createBundleAssetId(t,r.name);s.push(n),this.add([r.name,n],r.srcs,r.data)}else{const n=r.name.map(a=>this._createBundleAssetId(t,a));n.forEach(a=>{s.push(a)}),this.add([...r.name,...n],r.srcs)}}):Object.keys(i).forEach(r=>{s.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],i[r])}),this._bundles[t]=s}add(t,i,s){const r=le(t);r.forEach(a=>{this.hasKey(a)&&console.warn(`[Resolver] already has key: ${a} overwriting`)}),Array.isArray(i)||(typeof i=="string"?i=Ah(i):i=[i]);const n=i.map(a=>{var h;let o=a;if(typeof a=="string"){let l=!1;for(let c=0;c<this._parsers.length;c++){const u=this._parsers[c];if(u.test(a)){o=u.parse(a),l=!0;break}}l||(o={src:a})}return o.format||(o.format=o.src.split(".").pop()),o.alias||(o.alias=r),(this._basePath||this._rootPath)&&(o.src=At.toAbsolute(o.src,this._basePath,this._rootPath)),o.src=this._appendDefaultSearchParams(o.src),o.data=(h=o.data)!=null?h:s,o});r.forEach(a=>{this._assetMap[a]=n})}resolveBundle(t){const i=Vi(t);t=le(t);const s={};return t.forEach(r=>{const n=this._bundles[r];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(r,h)]=l}s[r]=o}}),i?s[t[0]]:s}resolveUrl(t){const i=this.resolve(t);if(typeof t!="string"){const s={};for(const r in i)s[r]=i[r].src;return s}return i.src}resolve(t){const i=Vi(t);t=le(t);const s={};return t.forEach(r=>{var n;if(!this._resolverHash[r])if(this._assetMap[r]){let a=this._assetMap[r];const o=this._getPreferredOrder(a),h=a[0];o==null||o.priority.forEach(l=>{o.params[l].forEach(c=>{const u=a.filter(d=>d[l]?d[l]===c:!1);u.length&&(a=u)})}),this._resolverHash[r]=(n=a[0])!=null?n:h}else{let a=r;(this._basePath||this._rootPath)&&(a=At.toAbsolute(a,this._basePath,this._rootPath)),a=this._appendDefaultSearchParams(a),this._resolverHash[r]={src:a}}s[r]=this._resolverHash[r]}),i?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let i=0;i<t.length;i++){const s=t[0],r=this._preferredOrder.find(n=>n.params.format.includes(s.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const i=/\?/.test(t)?"&":"?";return`${t}${i}${this._defaultSearchParams}`}}class Bh{constructor(){this._detections=[],this._initialized=!1,this.resolver=new of,this.loader=new Vd,this.cache=hi,this._backgroundLoader=new Hd(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,a,o,h;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let l=t.manifest;typeof l=="string"&&(l=await this.load(l)),this.resolver.addManifest(l)}const i=(a=(n=t.texturePreference)==null?void 0:n.resolution)!=null?a:1,s=typeof i=="number"?[i]:i;let r=[];if((o=t.texturePreference)!=null&&o.format){const l=(h=t.texturePreference)==null?void 0:h.format;r=typeof l=="string"?[l]:l;for(const c of this._detections)await c.test()||(r=await c.remove(r))}else for(const l of this._detections)await l.test()&&(r=await l.add(r));this.resolver.prefer({params:{format:r,resolution:s}}),t.preferences&&this.setPreferences(t.preferences)}add(t,i,s){this.resolver.add(t,i,s)}async load(t,i){this._initialized||await this.init();const s=Vi(t),r=le(t).map(o=>typeof o!="string"?(this.resolver.add(o.src,o),o.src):(this.resolver.hasKey(o)||this.resolver.add(o,o),o)),n=this.resolver.resolve(r),a=await this._mapLoadToResolve(n,i);return s?a[r[0]]:a}addBundle(t,i){this.resolver.addBundle(t,i)}async loadBundle(t,i){this._initialized||await this.init();let s=!1;typeof t=="string"&&(s=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},a=Object.keys(r);let o=0,h=0;const l=()=>{i==null||i(++o/h)},c=a.map(u=>{const d=r[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(f=>{n[u]=f})});return await Promise.all(c),s?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(i))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const i=this.resolver.resolveBundle(t);Object.values(i).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return hi.get(t);const i={};for(let s=0;s<t.length;s++)i[s]=hi.get(t[s]);return i}async _mapLoadToResolve(t,i){const s=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const n=await this.loader.load(s,i);this._backgroundLoader.active=!0;const a={};return s.forEach((o,h)=>{const l=n[o.src],c=[o.src];o.alias&&c.push(...o.alias),a[r[h]]=l,hi.set(c,l)}),a}async unload(t){this._initialized||await this.init();const i=le(t).map(r=>typeof r!="string"?r.src:r),s=this.resolver.resolve(i);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=le(t);const i=this.resolver.resolveBundle(t),s=Object.keys(i).map(r=>this._unloadFromResolved(i[r]));await Promise.all(s)}async _unloadFromResolved(t){const i=Object.values(t);i.forEach(s=>{hi.remove(s.src)}),await this.loader.unload(i)}get detections(){return this._detections}get preferWorkers(){return ji.config.preferWorkers}set preferWorkers(t){j("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(i=>{!i.config||Object.keys(i.config).filter(s=>s in t).forEach(s=>{i.config[s]=t[s]})})}}const Wi=new Bh;U.handleByList(D.LoadParser,Wi.loader.parsers).handleByList(D.ResolveParser,Wi.resolver.parsers).handleByList(D.CacheParser,Wi.cache.parsers).handleByList(D.DetectionParser,Wi.detections);const Oh={extension:D.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof B),getCacheableAssets:(e,t)=>{const i={};return e.forEach(s=>{t.forEach((r,n)=>{i[s+(n===0?"":n+1)]=r})}),i}};U.add(Oh);const Fh={extension:{type:D.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await N.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")};U.add(Fh);const Lh={extension:{type:D.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await N.ADAPTER.fetch(e).then(i=>i.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};U.add(Lh);const Uh=["png","jpg","jpeg"],kh={extension:{type:D.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...Uh],remove:async e=>e.filter(t=>!Uh.includes(t))};U.add(kh);const Gh={extension:D.ResolveParser,test:ji.test,parse:e=>{var t,i;return{resolution:parseFloat((i=(t=N.RETINA_PREFIX.exec(e))==null?void 0:t[1])!=null?i:"1"),format:e.split(".").pop(),src:e}}};U.add(Gh);var It=(e=>(e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e))(It||{});const $i={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let ge,li;function Hh(){li={s3tc:ge.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:ge.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:ge.getExtension("WEBGL_compressed_texture_etc"),etc1:ge.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:ge.getExtension("WEBGL_compressed_texture_pvrtc")||ge.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:ge.getExtension("WEBGL_compressed_texture_atc"),astc:ge.getExtension("WEBGL_compressed_texture_astc")}}const Xh={extension:{type:D.DetectionParser,priority:2},test:async()=>{const t=N.ADAPTER.createCanvas().getContext("webgl");return t?(ge=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{li||Hh();const t=[];for(const i in li)!li[i]||t.push(i);return[...t,...e]},remove:async e=>(li||Hh(),e.filter(t=>!(t in li)))};U.add(Xh);class Vh extends ii{constructor(t,i={width:1,height:1,autoLoad:!0}){let s,r;typeof t=="string"?(s=t,r=new Uint8Array):(s=null,r=t),super(r,i),this.origin=s,this.buffer=r?new Ls(r):null,this._load=null,this.loaded=!1,this.origin!==null&&i.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Ls(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Be extends Vh{constructor(t,i){super(t,i),this.format=i.format,this.levels=i.levels||1,this._width=i.width,this._height=i.height,this._extension=Be._formatToExtension(this.format),(i.levelBuffers||this.buffer)&&(this._levelBuffers=i.levelBuffers||Be._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,i,s){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,o=this.levels;a<o;a++){const{levelID:h,levelWidth:l,levelHeight:c,levelBuffer:u}=this._levelBuffers[a];r.compressedTexImage2D(r.TEXTURE_2D,h,this.format,l,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=Be._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,i,s,r,n,a,o){const h=new Array(s);let l=t.byteOffset,c=a,u=o,d=c+r-1&~(r-1),f=u+n-1&~(n-1),p=d*f*$i[i];for(let _=0;_<s;_++)h[_]={levelID:_,levelWidth:s>1?c:d,levelHeight:s>1?u:f,levelBuffer:new Uint8Array(t.buffer,l,p)},l+=p,c=c>>1||1,u=u>>1||1,d=c+r-1&~(r-1),f=u+n-1&~(n-1),p=d*f*$i[i];return h}}const Jn=4,nr=124,hf=32,zh=20,lf=542327876,ar={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},cf={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},or={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};var uf=(e=>(e[e.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",e[e.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",e[e.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",e[e.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",e[e.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",e[e.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",e[e.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",e[e.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",e[e.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",e[e.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",e[e.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",e[e.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",e[e.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",e[e.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",e[e.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",e[e.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",e[e.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",e[e.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",e[e.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",e[e.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",e[e.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",e[e.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",e[e.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",e[e.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",e[e.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",e[e.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",e[e.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",e[e.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",e[e.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",e[e.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",e[e.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",e[e.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",e[e.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",e[e.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",e[e.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",e[e.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",e[e.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",e[e.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",e[e.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",e[e.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",e[e.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",e[e.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",e[e.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",e[e.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",e[e.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",e[e.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",e[e.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",e[e.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",e[e.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",e[e.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",e[e.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",e[e.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",e[e.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",e[e.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",e[e.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",e[e.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",e[e.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",e[e.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",e[e.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",e[e.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",e[e.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",e[e.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",e[e.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",e[e.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",e[e.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",e[e.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",e[e.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",e[e.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",e[e.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",e[e.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",e[e.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",e[e.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",e[e.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",e[e.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",e[e.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",e[e.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",e[e.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",e[e.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",e[e.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",e[e.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",e[e.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",e[e.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",e[e.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",e[e.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",e[e.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",e[e.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",e[e.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",e[e.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",e[e.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",e[e.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",e[e.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",e[e.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",e[e.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",e[e.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",e[e.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",e[e.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",e[e.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",e[e.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",e[e.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",e[e.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",e[e.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",e[e.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",e[e.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",e[e.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",e[e.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",e[e.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",e[e.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",e[e.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",e[e.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",e[e.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",e[e.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",e[e.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",e[e.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",e[e.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",e[e.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",e[e.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",e[e.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",e[e.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",e[e.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",e[e.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",e[e.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",e[e.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT",e))(uf||{}),df=(e=>(e[e.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",e[e.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",e[e.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D",e))(df||{});const ff=1,pf=2,mf=4,_f=64,gf=512,xf=131072,vf=827611204,yf=861165636,bf=894720068,Tf=808540228,Ef=4,wf={[vf]:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,[yf]:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,[bf]:It.COMPRESSED_RGBA_S3TC_DXT5_EXT},Af={[70]:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:It.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:It.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:It.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:It.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:It.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function jh(e){const t=new Uint32Array(e);if(t[0]!==lf)throw new Error("Invalid DDS file magic word");const s=new Uint32Array(e,0,nr/Uint32Array.BYTES_PER_ELEMENT),r=s[ar.HEIGHT],n=s[ar.WIDTH],a=s[ar.MIPMAP_COUNT],o=new Uint32Array(e,ar.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,hf/Uint32Array.BYTES_PER_ELEMENT),h=o[ff];if(h&mf){const l=o[cf.FOURCC];if(l!==Tf){const g=wf[l],v=Jn+nr,w=new Uint8Array(e,v);return[new Be(w,{format:g,width:n,height:r,levels:a})]}const c=Jn+nr,u=new Uint32Array(t.buffer,c,zh/Uint32Array.BYTES_PER_ELEMENT),d=u[or.DXGI_FORMAT],f=u[or.RESOURCE_DIMENSION],p=u[or.MISC_FLAG],_=u[or.ARRAY_SIZE],m=Af[d];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===Ef)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const x=new Array,y=Jn+nr+zh;if(_===1)x.push(new Uint8Array(e,y));else{const g=$i[m];let v=0,w=n,P=r;for(let T=0;T<a;T++){const M=Math.max(1,w+3&-4),k=Math.max(1,P+3&-4);v+=M*k*g,w=w>>>1,P=P>>>1}let C=y;for(let T=0;T<_;T++)x.push(new Uint8Array(e,C,v)),C+=v}return x.map(g=>new Be(g,{format:m,width:n,height:r,levels:a}))}throw h&_f?new Error("DDSParser does not support uncompressed texture data."):h&gf?new Error("DDSParser does not supported YUV uncompressed texture data."):h&xf?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&pf?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Wh=[171,75,84,88,32,49,49,187,13,10,26,10],Sf=67305985,Jt={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},ta=64,ea={[G.UNSIGNED_BYTE]:1,[G.UNSIGNED_SHORT]:2,[G.INT]:4,[G.UNSIGNED_INT]:4,[G.FLOAT]:4,[G.HALF_FLOAT]:8},$h={[R.RGBA]:4,[R.RGB]:3,[R.RG]:2,[R.RED]:1,[R.LUMINANCE]:1,[R.LUMINANCE_ALPHA]:2,[R.ALPHA]:1},Yh={[G.UNSIGNED_SHORT_4_4_4_4]:2,[G.UNSIGNED_SHORT_5_5_5_1]:2,[G.UNSIGNED_SHORT_5_6_5]:2};function qh(e,t,i=!1){const s=new DataView(t);if(!Cf(e,s))return null;const r=s.getUint32(Jt.ENDIANNESS,!0)===Sf,n=s.getUint32(Jt.GL_TYPE,r),a=s.getUint32(Jt.GL_FORMAT,r),o=s.getUint32(Jt.GL_INTERNAL_FORMAT,r),h=s.getUint32(Jt.PIXEL_WIDTH,r),l=s.getUint32(Jt.PIXEL_HEIGHT,r)||1,c=s.getUint32(Jt.PIXEL_DEPTH,r)||1,u=s.getUint32(Jt.NUMBER_OF_ARRAY_ELEMENTS,r)||1,d=s.getUint32(Jt.NUMBER_OF_FACES,r),f=s.getUint32(Jt.NUMBER_OF_MIPMAP_LEVELS,r),p=s.getUint32(Jt.BYTES_OF_KEY_VALUE_DATA,r);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const _=4,m=4,x=h+3&-4,y=l+3&-4,g=new Array(u);let v=h*l;n===0&&(v=x*y);let w;if(n!==0?ea[n]?w=ea[n]*$h[a]:w=Yh[n]:w=$i[o],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const P=i?If(s,p,r):null;let T=v*w,M=h,k=l,A=x,O=y,E=ta+p;for(let b=0;b<f;b++){const V=s.getUint32(E,r);let L=E+4;for(let I=0;I<u;I++){let q=g[I];q||(q=g[I]=new Array(f)),q[b]={levelID:b,levelWidth:f>1||n!==0?M:A,levelHeight:f>1||n!==0?k:O,levelBuffer:new Uint8Array(t,L,T)},L+=T}E+=V+4,E=E%4!==0?E+4-E%4:E,M=M>>1||1,k=k>>1||1,A=M+_-1&~(_-1),O=k+m-1&~(m-1),T=A*O*w}return n!==0?{uncompressed:g.map(b=>{let V=b[0].levelBuffer,L=!1;return n===G.FLOAT?V=new Float32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4):n===G.UNSIGNED_INT?(L=!0,V=new Uint32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4)):n===G.INT&&(L=!0,V=new Int32Array(b[0].levelBuffer.buffer,b[0].levelBuffer.byteOffset,b[0].levelBuffer.byteLength/4)),{resource:new ii(V,{width:b[0].levelWidth,height:b[0].levelHeight}),type:n,format:L?Rf(a):a}}),kvData:P}:{compressed:g.map(b=>new Be(null,{format:o,width:h,height:l,levels:f,levelBuffers:b})),kvData:P}}function Cf(e,t){for(let i=0;i<Wh.length;i++)if(t.getUint8(i)!==Wh[i])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}function Rf(e){switch(e){case R.RGBA:return R.RGBA_INTEGER;case R.RGB:return R.RGB_INTEGER;case R.RG:return R.RG_INTEGER;case R.RED:return R.RED_INTEGER;default:return e}}function If(e,t,i){const s=new Map;let r=0;for(;r<t;){const n=e.getUint32(ta+r,i),a=ta+r+4,o=3-(n+3)%4;if(n===0||n>t-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&e.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(e.buffer,a,h)),c=new DataView(e.buffer,a+h+1,n-h-1);s.set(l,c),r+=4+n+o}return s}const Zh={extension:{type:D.LoadParser,priority:Qt.High},name:"loadDDS",test(e){return Ce(e,".dds")},async load(e,t,i){const r=await(await N.ADAPTER.fetch(e)).arrayBuffer(),a=jh(r).map(o=>{const h=new z(o,Et({mipmap:$t.OFF,alphaMode:Ut.NO_PREMULTIPLIED_ALPHA,resolution:me(e)},t.data));return zi(h,i,e)});return a.length===1?a[0]:a},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};U.add(Zh);const Kh={extension:{type:D.LoadParser,priority:Qt.High},name:"loadKTX",test(e){return Ce(e,".ktx")},async load(e,t,i){const r=await(await N.ADAPTER.fetch(e)).arrayBuffer(),{compressed:n,uncompressed:a,kvData:o}=qh(e,r),h=n!=null?n:a,l=Et({mipmap:$t.OFF,alphaMode:Ut.NO_PREMULTIPLIED_ALPHA,resolution:me(e)},t.data),c=h.map(u=>{h===a&&Object.assign(l,{type:u.type,format:u.format});const d=new z(u,l);return d.ktxKeyValueData=o,zi(d,i,e)});return c.length===1?c[0]:c},unload(e){Array.isArray(e)?e.forEach(t=>t.destroy(!0)):e.destroy(!0)}};U.add(Kh);const Qh={extension:D.ResolveParser,test:e=>{const i=e.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(i)},parse:e=>{var s,r,n,a;if(e.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(h=>e.endsWith(h)))return{resolution:parseFloat((r=(s=N.RETINA_PREFIX.exec(e))==null?void 0:s[1])!=null?r:"1"),format:o.find(h=>e.endsWith(h)),src:e}}return{resolution:parseFloat((a=(n=N.RETINA_PREFIX.exec(e))==null?void 0:n[1])!=null?a:"1"),format:e.split(".").pop(),src:e}}};U.add(Qh);const Mf=new W,Nf=4,Yi=class{constructor(e){this.renderer=e}async image(e,t,i){const s=new Image;return s.src=await this.base64(e,t,i),s}async base64(e,t,i){const s=this.canvas(e);if(s.toBlob!==void 0)return new Promise((r,n)=>{s.toBlob(a=>{if(!a){n(new Error("ICanvas.toBlob failed!"));return}const o=new FileReader;o.onload=()=>r(o.result),o.onerror=n,o.readAsDataURL(a)},t,i)});if(s.toDataURL!==void 0)return s.toDataURL(t,i);if(s.convertToBlob!==void 0){const r=await s.convertToBlob({type:t,quality:i});return new Promise((n,a)=>{const o=new FileReader;o.onload=()=>n(o.result),o.onerror=a,o.readAsDataURL(r)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(e,t);n&&Yi._flipY(i,s,r),Yi._unpremultiplyAlpha(i);const a=new Eo(s,r,1),o=new ImageData(new Uint8ClampedArray(i.buffer),s,r);return a.context.putImageData(o,0,0),a.canvas}pixels(e,t){const{pixels:i,width:s,height:r,flipY:n}=this._rawPixels(e,t);return n&&Yi._flipY(i,s,r),Yi._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,r=!1,n,a=!1;if(e&&(e instanceof Pe?n=e:(n=i.generateTexture(e,{resolution:i.resolution,multisample:i.multisample}),a=!0)),n){if(s=n.baseTexture.resolution,t=t!=null?t:n.frame,r=!1,!a){i.renderTexture.bind(n);const u=n.framebuffer.glFramebuffers[i.CONTEXT_UID];u.blitFramebuffer&&i.framebuffer.bind(u.blitFramebuffer)}}else s=i.resolution,t||(t=Mf,t.width=i.width/s,t.height=i.height/s),r=!0,i.renderTexture.bind();const o=Math.round(t.width*s),h=Math.round(t.height*s),l=new Uint8Array(Nf*o*h),c=i.gl;return c.readPixels(Math.round(t.x*s),Math.round(t.y*s),o,h,c.RGBA,c.UNSIGNED_BYTE,l),a&&(n==null||n.destroy(!0)),{pixels:l,width:o,height:h,flipY:r}}destroy(){this.renderer=null}static _flipY(e,t,i){const s=t<<2,r=i>>1,n=new Uint8Array(s);for(let a=0;a<r;a++){const o=a*s,h=(i-a-1)*s;n.set(e.subarray(o,o+s)),e.copyWithin(o,h,h+s),e.set(n,h)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const s=e[i+3];if(s!==0){const r=255.001/s;e[i]=e[i]*r+.5,e[i+1]=e[i+1]*r+.5,e[i+2]=e[i+2]*r+.5}}}};let ia=Yi;ia.extension={name:"extract",type:D.RendererSystem},U.add(ia);const qi={build(e){const t=e.points;let i,s,r,n,a,o;if(e.type===gt.CIRC){const p=e.shape;i=p.x,s=p.y,a=o=p.radius,r=n=0}else if(e.type===gt.ELIP){const p=e.shape;i=p.x,s=p.y,a=p.width,o=p.height,r=n=0}else{const p=e.shape,_=p.width/2,m=p.height/2;i=p.x+_,s=p.y+m,a=o=Math.max(0,Math.min(p.radius,Math.min(_,m))),r=_-a,n=m-o}if(!(a>=0&&o>=0&&r>=0&&n>=0)){t.length=0;return}const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(r?4:0)+(n?4:0);if(t.length=l,l===0)return;if(h===0){t.length=8,t[0]=t[6]=i+r,t[1]=t[3]=s+n,t[2]=t[4]=i-r,t[5]=t[7]=s-n;return}let c=0,u=h*4+(r?2:0)+2,d=u,f=l;{const p=r+a,_=n,m=i+p,x=i-p,y=s+_;if(t[c++]=m,t[c++]=y,t[--u]=y,t[--u]=x,n){const g=s-_;t[d++]=x,t[d++]=g,t[--f]=g,t[--f]=m}}for(let p=1;p<h;p++){const _=Math.PI/2*(p/h),m=r+Math.cos(_)*a,x=n+Math.sin(_)*o,y=i+m,g=i-m,v=s+x,w=s-x;t[c++]=y,t[c++]=v,t[--u]=v,t[--u]=g,t[d++]=g,t[d++]=w,t[--f]=w,t[--f]=y}{const p=r,_=n+o,m=i+p,x=i-p,y=s+_,g=s-_;t[c++]=m,t[c++]=y,t[--f]=g,t[--f]=m,r&&(t[c++]=x,t[c++]=y,t[--f]=g,t[--f]=x)}},triangulate(e,t){const i=e.points,s=t.points,r=t.indices;if(i.length===0)return;let n=s.length/2;const a=n;let o,h;if(e.type!==gt.RREC){const c=e.shape;o=c.x,h=c.y}else{const c=e.shape;o=c.x+c.width/2,h=c.y+c.height/2}const l=e.matrix;s.push(e.matrix?l.a*o+l.c*h+l.tx:o,e.matrix?l.b*o+l.d*h+l.ty:h),n++,s.push(i[0],i[1]);for(let c=2;c<i.length;c+=2)s.push(i[c],i[c+1]),r.push(n++,a,n);r.push(a+1,a,n)}};function Jh(e,t=!1){const i=e.length;if(i<6)return;let s=0;for(let r=0,n=e[i-2],a=e[i-1];r<i;r+=2){const o=e[r],h=e[r+1];s+=(o-n)*(h+a),n=o,a=h}if(!t&&s>0||t&&s<=0){const r=i/2;for(let n=r+r%2;n<i;n+=2){const a=i-n-2,o=i-n-1,h=n,l=n+1;[e[a],e[h]]=[e[h],e[a]],[e[o],e[l]]=[e[l],e[o]]}}}const sa={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let i=e.points;const s=e.holes,r=t.points,n=t.indices;if(i.length>=6){Jh(i,!1);const a=[];for(let l=0;l<s.length;l++){const c=s[l];Jh(c.points,!0),a.push(i.length/2),i=i.concat(c.points)}const o=Ur(i,a,2);if(!o)return;const h=r.length/2;for(let l=0;l<o.length;l+=3)n.push(o[l]+h),n.push(o[l+1]+h),n.push(o[l+2]+h);for(let l=0;l<i.length;l++)r.push(i[l])}}},tl={build(e){const t=e.shape,i=t.x,s=t.y,r=t.width,n=t.height,a=e.points;a.length=0,r>=0&&n>=0&&a.push(i,s,i+r,s,i+r,s+n,i,s+n)},triangulate(e,t){const i=e.points,s=t.points;if(i.length===0)return;const r=s.length/2;s.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),t.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},el={build(e){qi.build(e)},triangulate(e,t){qi.triangulate(e,t)}};var zt=(e=>(e.MITER="miter",e.BEVEL="bevel",e.ROUND="round",e))(zt||{}),Re=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(Re||{});const Ie={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let i=Math.ceil(e/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}},Pf=Ie;class ra{static curveTo(t,i,s,r,n,a){const o=a[a.length-2],l=a[a.length-1]-i,c=o-t,u=r-i,d=s-t,f=Math.abs(l*d-c*u);if(f<1e-8||n===0)return(a[a.length-2]!==t||a[a.length-1]!==i)&&a.push(t,i),null;const p=l*l+c*c,_=u*u+d*d,m=l*u+c*d,x=n*Math.sqrt(p)/f,y=n*Math.sqrt(_)/f,g=x*m/p,v=y*m/_,w=x*d+y*c,P=x*u+y*l,C=c*(y+g),T=l*(y+g),M=d*(x+v),k=u*(x+v),A=Math.atan2(T-P,C-w),O=Math.atan2(k-P,M-w);return{cx:w+t,cy:P+i,radius:n,startAngle:A,endAngle:O,anticlockwise:c*u>d*l}}static arc(t,i,s,r,n,a,o,h,l){const c=o-a,u=Ie._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Mi)*40),d=c/(u*2),f=d*2,p=Math.cos(d),_=Math.sin(d),m=u-1,x=m%1/m;for(let y=0;y<=m;++y){const g=y+x*y,v=d+a+f*g,w=Math.cos(v),P=-Math.sin(v);l.push((p*w+_*P)*n+s,(p*-P+_*w)*n+r)}}}class il{constructor(){this.reset()}begin(t,i,s){this.reset(),this.style=t,this.start=i,this.attribStart=s}end(t,i){this.attribSize=i-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Ir{static curveLength(t,i,s,r,n,a,o,h){let c=0,u=0,d=0,f=0,p=0,_=0,m=0,x=0,y=0,g=0,v=0,w=t,P=i;for(let C=1;C<=10;++C)u=C/10,d=u*u,f=d*u,p=1-u,_=p*p,m=_*p,x=m*t+3*_*u*s+3*p*d*n+f*o,y=m*i+3*_*u*r+3*p*d*a+f*h,g=w-x,v=P-y,w=x,P=y,c+=Math.sqrt(g*g+v*v);return c}static curveTo(t,i,s,r,n,a,o){const h=o[o.length-2],l=o[o.length-1];o.length-=2;const c=Ie._segmentsCount(Ir.curveLength(h,l,t,i,s,r,n,a));let u=0,d=0,f=0,p=0,_=0;o.push(h,l);for(let m=1,x=0;m<=c;++m)x=m/c,u=1-x,d=u*u,f=d*u,p=x*x,_=p*x,o.push(f*h+3*d*x*t+3*u*p*s+_*n,f*l+3*d*x*i+3*u*p*r+_*a)}}function sl(e,t,i,s,r,n,a,o){const h=e-i*r,l=t-s*r,c=e+i*n,u=t+s*n;let d,f;a?(d=s,f=-i):(d=-s,f=i);const p=h+d,_=l+f,m=c+d,x=u+f;return o.push(p,_,m,x),2}function je(e,t,i,s,r,n,a,o){const h=i-e,l=s-t;let c=Math.atan2(h,l),u=Math.atan2(r-e,n-t);o&&c<u?c+=Math.PI*2:!o&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),_=Math.sqrt(h*h+l*l),m=(15*p*Math.sqrt(_)/Math.PI>>0)+1,x=f/m;if(d+=x,o){a.push(e,t,i,s);for(let y=1,g=d;y<m;y++,g+=x)a.push(e,t,e+Math.sin(g)*_,t+Math.cos(g)*_);a.push(e,t,r,n)}else{a.push(i,s,e,t);for(let y=1,g=d;y<m;y++,g+=x)a.push(e+Math.sin(g)*_,t+Math.cos(g)*_,e,t);a.push(r,n,e,t)}return m*2}function Df(e,t){const i=e.shape;let s=e.points||i.points.slice();const r=t.closePointEps;if(s.length===0)return;const n=e.lineStyle,a=new J(s[0],s[1]),o=new J(s[s.length-2],s[s.length-1]),h=i.type!==gt.POLY||i.closeStroke,l=Math.abs(a.x-o.x)<r&&Math.abs(a.y-o.y)<r;if(h){s=s.slice(),l&&(s.pop(),s.pop(),o.set(s[s.length-2],s[s.length-1]));const I=(a.x+o.x)*.5,q=(o.y+a.y)*.5;s.unshift(I,q),s.push(I,q)}const c=t.points,u=s.length/2;let d=s.length;const f=c.length/2,p=n.width/2,_=p*p,m=n.miterLimit*n.miterLimit;let x=s[0],y=s[1],g=s[2],v=s[3],w=0,P=0,C=-(y-v),T=x-g,M=0,k=0,A=Math.sqrt(C*C+T*T);C/=A,T/=A,C*=p,T*=p;const O=n.alignment,E=(1-O)*2,b=O*2;h||(n.cap===Re.ROUND?d+=je(x-C*(E-b)*.5,y-T*(E-b)*.5,x-C*E,y-T*E,x+C*b,y+T*b,c,!0)+2:n.cap===Re.SQUARE&&(d+=sl(x,y,C,T,E,b,!0,c))),c.push(x-C*E,y-T*E,x+C*b,y+T*b);for(let I=1;I<u-1;++I){x=s[(I-1)*2],y=s[(I-1)*2+1],g=s[I*2],v=s[I*2+1],w=s[(I+1)*2],P=s[(I+1)*2+1],C=-(y-v),T=x-g,A=Math.sqrt(C*C+T*T),C/=A,T/=A,C*=p,T*=p,M=-(v-P),k=g-w,A=Math.sqrt(M*M+k*k),M/=A,k/=A,M*=p,k*=p;const q=g-x,rt=y-v,S=g-w,X=P-v,Y=q*S+rt*X,K=rt*S-X*q,Q=K<0;if(Math.abs(K)<.001*Math.abs(Y)){c.push(g-C*E,v-T*E,g+C*b,v+T*b),Y>=0&&(n.join===zt.ROUND?d+=je(g,v,g-C*E,v-T*E,g-M*E,v-k*E,c,!1)+4:d+=2,c.push(g-M*b,v-k*b,g+M*E,v+k*E));continue}const pt=(-C+x)*(-T+v)-(-C+g)*(-T+y),lt=(-M+w)*(-k+v)-(-M+g)*(-k+P),mt=(q*lt-S*pt)/K,Tt=(X*pt-rt*lt)/K,Dt=(mt-g)*(mt-g)+(Tt-v)*(Tt-v),bt=g+(mt-g)*E,et=v+(Tt-v)*E,ct=g-(mt-g)*b,dt=v-(Tt-v)*b,se=Math.min(q*q+rt*rt,S*S+X*X),re=Q?E:b,yi=se+re*re*_,_c=Dt<=yi;let ys=n.join;if(ys===zt.MITER&&Dt/_>m&&(ys=zt.BEVEL),_c)switch(ys){case zt.MITER:{c.push(bt,et,ct,dt);break}case zt.BEVEL:{Q?c.push(bt,et,g+C*b,v+T*b,bt,et,g+M*b,v+k*b):c.push(g-C*E,v-T*E,ct,dt,g-M*E,v-k*E,ct,dt),d+=2;break}case zt.ROUND:{Q?(c.push(bt,et,g+C*b,v+T*b),d+=je(g,v,g+C*b,v+T*b,g+M*b,v+k*b,c,!0)+4,c.push(bt,et,g+M*b,v+k*b)):(c.push(g-C*E,v-T*E,ct,dt),d+=je(g,v,g-C*E,v-T*E,g-M*E,v-k*E,c,!1)+4,c.push(g-M*E,v-k*E,ct,dt));break}}else{switch(c.push(g-C*E,v-T*E,g+C*b,v+T*b),ys){case zt.MITER:{Q?c.push(ct,dt,ct,dt):c.push(bt,et,bt,et),d+=2;break}case zt.ROUND:{Q?d+=je(g,v,g+C*b,v+T*b,g+M*b,v+k*b,c,!0)+2:d+=je(g,v,g-C*E,v-T*E,g-M*E,v-k*E,c,!1)+2;break}}c.push(g-M*E,v-k*E,g+M*b,v+k*b),d+=2}}x=s[(u-2)*2],y=s[(u-2)*2+1],g=s[(u-1)*2],v=s[(u-1)*2+1],C=-(y-v),T=x-g,A=Math.sqrt(C*C+T*T),C/=A,T/=A,C*=p,T*=p,c.push(g-C*E,v-T*E,g+C*b,v+T*b),h||(n.cap===Re.ROUND?d+=je(g-C*(E-b)*.5,v-T*(E-b)*.5,g-C*E,v-T*E,g+C*b,v+T*b,c,!1)+2:n.cap===Re.SQUARE&&(d+=sl(g,v,C,T,E,b,!1,c)));const V=t.indices,L=Ie.epsilon*Ie.epsilon;for(let I=f;I<d+f-2;++I)x=c[I*2],y=c[I*2+1],g=c[(I+1)*2],v=c[(I+1)*2+1],w=c[(I+2)*2],P=c[(I+2)*2+1],!(Math.abs(x*(v-P)+g*(P-y)+w*(y-v))<L)&&V.push(I,I+1,I+2)}function Bf(e,t){let i=0;const s=e.shape,r=e.points||s.points,n=s.type!==gt.POLY||s.closeStroke;if(r.length===0)return;const a=t.points,o=t.indices,h=r.length/2,l=a.length/2;let c=l;for(a.push(r[0],r[1]),i=1;i<h;i++)a.push(r[i*2],r[i*2+1]),o.push(c,c+1),c++;n&&o.push(c,l)}function na(e,t){e.lineStyle.native?Bf(e,t):Df(e,t)}class Mr{static curveLength(t,i,s,r,n,a){const o=t-2*s+n,h=i-2*r+a,l=2*s-2*t,c=2*r-2*i,u=4*(o*o+h*h),d=4*(o*l+h*c),f=l*l+c*c,p=2*Math.sqrt(u+d+f),_=Math.sqrt(u),m=2*u*_,x=2*Math.sqrt(f),y=d/_;return(m*p+_*d*(p-x)+(4*f*u-d*d)*Math.log((2*_+y+p)/(y+x)))/(4*m)}static curveTo(t,i,s,r,n){const a=n[n.length-2],o=n[n.length-1],h=Ie._segmentsCount(Mr.curveLength(a,o,t,i,s,r));let l=0,c=0;for(let u=1;u<=h;++u){const d=u/h;l=a+(t-a)*d,c=o+(i-o)*d,n.push(l+(t+(s-t)*d-l)*d,c+(i+(r-i)*d-c)*d)}}}const hr={[gt.POLY]:sa,[gt.CIRC]:qi,[gt.ELIP]:qi,[gt.RECT]:tl,[gt.RREC]:el},aa=[],Zi=[];class xs{constructor(t,i=null,s=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=s,this.fillStyle=i,this.matrix=r,this.type=t.type}clone(){return new xs(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ci=new J,rl=class extends cn{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Hi,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Zi.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),aa.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,s=null){const r=new xs(e,t,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new xs(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const s=t[i];if(!!s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,ci):ci.copyFrom(e),s.shape.contains(ci.x,ci.y))){let r=!1;if(s.holes){for(let n=0;n<s.holes.length;n++)if(s.holes[n].shape.contains(ci.x,ci.y)){r=!0;break}}if(!r)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let o=this.shapeIndex;o<t.length;o++){this.shapeIndex++;const h=t[o],l=h.fillStyle,c=h.lineStyle;hr[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(l.visible||c.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?l:c;if(!f.visible)continue;const p=f.texture.baseTexture,_=this.indices.length,m=this.points.length/2;p.wrapMode=ae.REPEAT,d===0?this.processFill(h):this.processLine(h);const x=this.points.length/2-m;x!==0&&(i&&!this._compareStyles(s,f)&&(i.end(_,m),i=null),i||(i=aa.pop()||new il,i.begin(f,_,m),this.batches.push(i),s=f),this.addUvs(this.points,e,f.texture,m,x,f.matrix))}}const r=this.indices.length,n=this.points.length/2;if(i&&i.end(r,n),this.batches.length===0){this.batchable=!0;return}const a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],s=i.fillStyle,r=i.lineStyle;if(s&&!s.texture.baseTexture.valid||r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const s=e[t];for(let r=0;r<s.size;r++){const n=s.start+r;this.indicesUint16[n]=this.indicesUint16[n]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<rl.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++z._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),Zi.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let s=Zi.pop();s||(s=new ks,s.texArray=new js),s.texArray.count=0,s.start=0,s.size=0,s.type=Wt.TRIANGLES;let r=0,n=null,a=0,o=!1,h=Wt.TRIANGLES,l=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,h=o?Wt.LINES:Wt.TRIANGLES,n=null,r=d,e++),n!==p&&(n=p,p._batchEnabled!==e&&(r===d&&(e++,r=0,s.size>0&&(s=Zi.pop(),s||(s=new ks,s.texArray=new js),this.drawCalls.push(s)),s.start=l,s.size=0,s.texArray.count=0,s.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=r,p.wrapMode=ae.REPEAT,s.texArray.elements[s.texArray.count++]=p,r++)),s.size+=u.size,l+=u.size,a=p._batchLocation,this.addColors(t,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(i,a,u.attribSize,u.attribStart)}z._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(e.length*3*4),n=new Float32Array(r),a=new Uint32Array(r);let o=0;for(let h=0;h<e.length/2;h++)n[o++]=e[h*2],n[o++]=e[h*2+1],n[o++]=t[h*2],n[o++]=t[h*2+1],a[o++]=i[h],n[o++]=s[h];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?sa.triangulate(e,this):hr[e.type].triangulate(e,this)}processLine(e){na(e,this);for(let t=0;t<e.holes.length;t++)na(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];hr[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const s=e[i*2],r=e[i*2+1];e[i*2]=t.a*s+t.c*r+t.tx,e[i*2+1]=t.b*s+t.d*r+t.ty}}addColors(e,t,i,s,r=0){const n=$.shared.setValue(t).toLittleEndianNumber(),a=$.shared.setValue(n).toPremultiplied(i);e.length=Math.max(e.length,r+s);for(let o=0;o<s;o++)e[r+o]=a}addTextureIds(e,t,i,s=0){e.length=Math.max(e.length,s+i);for(let r=0;r<i;r++)e[s+r]=t}addUvs(e,t,i,s,r,n=null){let a=0;const o=t.length,h=i.frame;for(;a<r;){let c=e[(s+a)*2],u=e[(s+a)*2+1];if(n){const d=n.a*c+n.c*u+n.tx;u=n.b*c+n.d*u+n.ty,c=d}a++,t.push(c/h.width,u/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(t,i,o,r)}adjustUvs(e,t,i,s){const r=t.baseTexture,n=1e-6,a=i+s*2,o=t.frame,h=o.width/r.width,l=o.height/r.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(e[i]+n),f=Math.floor(e[i+1]+n);for(let p=i+2;p<a;p+=2)d=Math.min(d,Math.floor(e[p]+n)),f=Math.min(f,Math.floor(e[p+1]+n));c-=d,u-=f;for(let p=i;p<a;p+=2)e[p]=(e[p]+c)*h,e[p+1]=(e[p+1]+u)*l}};let oa=rl;oa.BATCHABLE_SIZE=100;class vs{constructor(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new vs;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=B.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Nr extends vs{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Re.BUTT,this.join=zt.MITER,this.miterLimit=10}clone(){const t=new Nr;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const ha={},lr=class extends Rt{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new vs,this._lineStyle=new Nr,this._matrix=null,this._holeMode=!1,this.state=de.for2d(),this._geometry=e||new oa,this._geometry.refCount++,this._transformID=-1,this._tintColor=new $(16777215),this.blendMode=H.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new lr(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,s=.5,r=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:s,native:r}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:B.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Re.BUTT,join:zt.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Ye,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Ye,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return(s!==e||r!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._initCurve();const r=this.currentPath.points;return r.length===0&&this.moveTo(0,0),Mr.curveTo(e,t,i,s,r),this}bezierCurveTo(e,t,i,s,r,n){return this._initCurve(),Ir.curveTo(e,t,i,s,r,n,this.currentPath.points),this}arcTo(e,t,i,s,r){this._initCurve(e,t);const n=this.currentPath.points,a=ra.curveTo(e,t,i,s,r,n);if(a){const{cx:o,cy:h,radius:l,startAngle:c,endAngle:u,anticlockwise:d}=a;this.arc(o,h,l,c,u,d)}return this}arc(e,t,i,s,r,n=!1){if(s===r)return this;if(!n&&r<=s?r+=Mi:n&&s<=r&&(s+=Mi),r-s===0)return this;const o=e+Math.cos(s)*i,h=t+Math.sin(s)*i,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-o),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(o,h)}else this.moveTo(o,h),c=this.currentPath.points;return ra.arc(o,h,e,t,i,s,r,n,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:B.WHITE,color:e,alpha:t})}normalizeColor(e){var i,s;const t=$.shared.setValue((i=e.color)!=null?i:0);e.color=t.toNumber(),(s=e.alpha)!=null||(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:B.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,s){return this.drawShape(new W(e,t,i,s))}drawRoundedRect(e,t,i,s,r){return this.drawShape(new Rr(e,t,i,s,r))}drawCircle(e,t,i){return this.drawShape(new Sr(e,t,i))}drawEllipse(e,t,i,s){return this.drawShape(new Cr(e,t,i,s))}drawPolygon(...e){let t,i=!0;const s=e[0];s.points?(i=s.closeStroke,t=s.points):Array.isArray(e[0])?t=e[0]:t=e;const r=new Ye(t);return r.closeStroke=i,this.drawShape(r),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===gt.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let s=0;s<i;s++){const r=e.batches[s],n=r.style.color,a=new Float32Array(this.vertexData.buffer,r.attribStart*4*2,r.attribSize*2),o=new Float32Array(e.uvsFloat32.buffer,r.attribStart*4*2,r.attribSize*2),h=new Uint16Array(e.indicesUint16.buffer,r.start*2,r.size),l={vertexData:a,blendMode:t,indices:h,uvs:o,_batchRGB:$.shared.setValue(n).toRgbArray(),_tintRGB:n,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[s]=l}}_renderBatched(e){if(!!this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,s=this.worldAlpha,r=t.uniforms,n=i.drawCalls;r.translationMatrix=this.transform.worldTransform,$.shared.setValue(this._tintColor).premultiply(s).toArray(r.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let a=0,o=n.length;a<o;a++)this._renderDrawCallDirect(e,i.drawCalls[a])}_renderDrawCallDirect(e,t){const{texArray:i,type:s,size:r,start:n}=t,a=i.count;for(let o=0;o<a;o++)e.texture.bind(i.elements[o],o);e.geometry.draw(s,r,n)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!ha[i]){const{maxTextures:s}=e.plugins[i],r=new Int32Array(s);for(let o=0;o<s;o++)r[o]=o;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new tt,default:jt.from({uSamplers:r},!0)},a=e.plugins[i]._shader.program;ha[i]=new ie(a,n)}t=ha[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:s,maxY:r}=e.bounds;this._bounds.addFrame(this.transform,t,i,s,r)}containsPoint(e){return this.worldTransform.applyInverse(e,lr._TEMP_POINT),this._geometry.containsPoint(lr._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=$.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,s=t.b,r=t.c,n=t.d,a=t.tx,o=t.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let u=0;u<h.length;u+=2){const d=h[u],f=h[u+1];l[c++]=i*d+r*f+a,l[c++]=n*f+s*d+o}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};let Ki=lr;Ki.curves=Ie,Ki._TEMP_POINT=new J;const Of={buildPoly:sa,buildCircle:qi,buildRectangle:tl,buildRoundedRectangle:el,buildLine:na,ArcUtils:ra,BezierUtils:Ir,QuadraticUtils:Mr,BatchPart:il,FILL_COMMANDS:hr,BATCH_POOL:aa,DRAW_CALL_POOL:Zi};class nl{constructor(t,i){this.uvBuffer=t,this.uvMatrix=i,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const i=this.uvBuffer.data;(!this.data||this.data.length!==i.length)&&(this.data=new Float32Array(i.length)),this.uvMatrix.multiplyUvs(i,this.data),this._updateID++}}const la=new J,al=new Ye,ol=class extends Rt{constructor(e,t,i,s=Wt.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||de.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=N.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Wt.TRIANGLES&&t.length<ol.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],i=t.data,s=t._updateID;if(s===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==i.length&&(this.vertexData=new Float32Array(i.length));const r=this.transform.worldTransform,n=r.a,a=r.b,o=r.c,h=r.d,l=r.tx,c=r.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=i[d*2],p=i[d*2+1];u[d*2]=n*f+o*p+l,u[d*2+1]=a*f+h*p+c}if(this._roundPixels){const d=N.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=s}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new nl(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,la);const t=this.geometry.getBuffer("aVertexPosition").data,i=al.points,s=this.geometry.getIndex().data,r=s.length,n=this.drawMode===4?3:1;for(let a=0;a+2<r;a+=n){const o=s[a]*2,h=s[a+1]*2,l=s[a+2]*2;if(i[0]=t[o],i[1]=t[o+1],i[2]=t[h],i[3]=t[h+1],i[4]=t[l],i[5]=t[l+1],al.contains(la.x,la.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let We=ol;We.BATCHABLE_SIZE=100;class Qi extends Te{constructor(t,i,s){super();const r=new nt(t),n=new nt(i,!0),a=new nt(s,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,G.FLOAT).addAttribute("aTextureCoord",n,2,!1,G.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Ff=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Lf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class ui extends ie{constructor(t,i){const s={uSampler:t,alpha:1,uTextureMatrix:tt.IDENTITY,uColor:new Float32Array([1,1,1,1])};i=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},i),i.uniforms&&Object.assign(s,i.uniforms),super(i.program||Ht.from(Lf,Ff),s),this._colorDirty=!1,this.uvMatrix=new qs(t),this.batchable=i.program===void 0,this.pluginName=i.pluginName,this._tintColor=new $(i.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=i.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const i=this.texture.baseTexture.alphaMode;$.shared.setValue(this._tintColor).premultiply(this._alpha,i).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class hl extends Qi{constructor(t=100,i=100,s=10,r=10){super(),this.segWidth=s,this.segHeight=r,this.width=t,this.height=i,this.build()}build(){const t=this.segWidth*this.segHeight,i=[],s=[],r=[],n=this.segWidth-1,a=this.segHeight-1,o=this.width/n,h=this.height/a;for(let c=0;c<t;c++){const u=c%this.segWidth,d=c/this.segWidth|0;i.push(u*o,d*h),s.push(u/n,d/a)}const l=n*a;for(let c=0;c<l;c++){const u=c%n,d=c/n|0,f=d*this.segWidth+u,p=d*this.segWidth+u+1,_=(d+1)*this.segWidth+u,m=(d+1)*this.segWidth+u+1;r.push(f,p,_,p,m,_)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class ll extends Qi{constructor(t=200,i,s=0){super(new Float32Array(i.length*4),new Float32Array(i.length*4),new Uint16Array((i.length-1)*6)),this.points=i,this._width=t,this.textureScale=s,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const i=this.getBuffer("aVertexPosition"),s=this.getBuffer("aTextureCoord"),r=this.getIndex();if(t.length<1)return;i.data.length/4!==t.length&&(i.data=new Float32Array(t.length*4),s.data=new Float32Array(t.length*4),r.data=new Uint16Array((t.length-1)*6));const n=s.data,a=r.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;let o=0,h=t[0];const l=this._width*this.textureScale,c=t.length;for(let d=0;d<c;d++){const f=d*4;if(this.textureScale>0){const p=h.x-t[d].x,_=h.y-t[d].y,m=Math.sqrt(p*p+_*_);h=t[d],o+=m/l}else o=d/(c-1);n[f]=o,n[f+1]=0,n[f+2]=o,n[f+3]=1}let u=0;for(let d=0;d<c-1;d++){const f=d*2;a[u++]=f,a[u++]=f+1,a[u++]=f+2,a[u++]=f+2,a[u++]=f+1,a[u++]=f+3}s.update(),r.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let i=t[0],s,r=0,n=0;const a=this.buffers[0].data,o=t.length,h=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let l=0;l<o;l++){const c=t[l],u=l*4;l<t.length-1?s=t[l+1]:s=c,n=-(s.x-i.x),r=s.y-i.y;let d=(1-l/(o-1))*10;d>1&&(d=1);const f=Math.sqrt(r*r+n*n);f<1e-6?(r=0,n=0):(r/=f,n/=f,r*=h,n*=h),a[u]=c.x+r,a[u+1]=c.y+n,a[u+2]=c.x-r,a[u+3]=c.y-n,i=c}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class cl extends We{constructor(t,i,s){const r=new hl(t.width,t.height,i,s),n=new ui(B.WHITE);super(r,n),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:i,height:s}=this.shader.texture;this.autoResize&&(t.width!==i||t.height!==s)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const cr=10;class Uf extends cl{constructor(t,i,s,r,n){var a,o,h,l,c,u,d,f;super(B.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=(o=i!=null?i:(a=t.defaultBorders)==null?void 0:a.left)!=null?o:cr,this._rightWidth=(l=r!=null?r:(h=t.defaultBorders)==null?void 0:h.right)!=null?l:cr,this._topHeight=(u=s!=null?s:(c=t.defaultBorders)==null?void 0:c.top)!=null?u:cr,this._bottomHeight=(f=n!=null?n:(d=t.defaultBorders)==null?void 0:d.bottom)!=null?f:cr,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,i=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*i,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*i,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,i=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*i,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*i,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,i=this._width>t?1:this._width/t,s=this._topHeight+this._bottomHeight,r=this._height>s?1:this._height/s;return Math.min(i,r)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,i=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const s=1/this._origWidth,r=1/this._origHeight;i[0]=i[8]=i[16]=i[24]=0,i[1]=i[3]=i[5]=i[7]=0,i[6]=i[14]=i[22]=i[30]=1,i[25]=i[27]=i[29]=i[31]=1,i[2]=i[10]=i[18]=i[26]=s*this._leftWidth,i[4]=i[12]=i[20]=i[28]=1-s*this._rightWidth,i[9]=i[11]=i[13]=i[15]=r*this._topHeight,i[17]=i[19]=i[21]=i[23]=1-r*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class kf extends We{constructor(t=B.EMPTY,i,s,r,n){const a=new Qi(i,s,r);a.getBuffer("aVertexPosition").static=!1;const o=new ui(t);super(a,o,null,n),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class Gf extends We{constructor(t,i,s=0){const r=new ll(t.height,i,s),n=new ui(t);s>0&&(t.baseTexture.wrapMode=ae.REPEAT),super(r,n),this.autoUpdate=!0}_render(t){const i=this.geometry;(this.autoUpdate||i._width!==this.shader.texture.height)&&(i._width=this.shader.texture.height,i.update()),super._render(t)}}class Hf extends Rt{constructor(t=1500,i,s=16384,r=!1){super();const n=16384;s>n&&(s=n),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=s,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=H.NORMAL,this.autoResize=r,this.roundPixels=!0,this.baseTexture=null,this.setProperties(i),this._tintColor=new $(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const i=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<i;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[i]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class ul{constructor(t,i,s){this.geometry=new Te,this.indexBuffer=null,this.size=s,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||G.FLOAT,offset:n.offset},i[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let i=0;this.indexBuffer=new nt(bo(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=i,i+=o.size,this.dynamicStride+=o.size}const s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new nt(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=r,r+=o.size,this.staticStride+=o.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new nt(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];t.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===G.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];t.addAttribute(o.attributeName,this.staticBuffer,0,o.type===G.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(t,i,s){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(t,i,s,n.type===G.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,i,s){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(t,i,s,n.type===G.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Xf=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Vf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ca extends Di{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new tt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:G.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ie.from(Vf,Xf,{}),this.state=de.for2d()}render(t){const i=t.children,s=t._maxSize,r=t._batchSize,n=this.renderer;let a=i.length;if(a===0)return;a>s&&!t.autoResize&&(a=s);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const h=i[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=Kr(t.blendMode,l),n.state.set(this.state);const c=n.gl,u=t.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=$.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<a;f+=r,p+=1){let _=a-f;_>r&&(_=r),p>=o.length&&o.push(this._generateOneMoreBuffer(t));const m=o[p];m.uploadDynamic(i,f,_);const x=t._bufferUpdateIDs[p]||0;d=d||m._updateID<x,d&&(m._updateID=t._updateID,m.uploadStatic(i,f,_)),n.geometry.bind(m.geometry),c.drawElements(c.TRIANGLES,_*6,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const i=[],s=t._maxSize,r=t._batchSize,n=t._properties;for(let a=0;a<s;a+=r)i.push(new ul(this.properties,n,r));return i}_generateOneMoreBuffer(t){const i=t._batchSize,s=t._properties;return new ul(this.properties,s,i)}uploadVertices(t,i,s,r,n,a){let o=0,h=0,l=0,c=0;for(let u=0;u<s;++u){const d=t[i+u],f=d._texture,p=d.scale.x,_=d.scale.y,m=f.trim,x=f.orig;m?(h=m.x-d.anchor.x*x.width,o=h+m.width,c=m.y-d.anchor.y*x.height,l=c+m.height):(o=x.width*(1-d.anchor.x),h=x.width*-d.anchor.x,l=x.height*(1-d.anchor.y),c=x.height*-d.anchor.y),r[a]=h*p,r[a+1]=c*_,r[a+n]=o*p,r[a+n+1]=c*_,r[a+n*2]=o*p,r[a+n*2+1]=l*_,r[a+n*3]=h*p,r[a+n*3+1]=l*_,a+=n*4}}uploadPosition(t,i,s,r,n,a){for(let o=0;o<s;o++){const h=t[i+o].position;r[a]=h.x,r[a+1]=h.y,r[a+n]=h.x,r[a+n+1]=h.y,r[a+n*2]=h.x,r[a+n*2+1]=h.y,r[a+n*3]=h.x,r[a+n*3+1]=h.y,a+=n*4}}uploadRotation(t,i,s,r,n,a){for(let o=0;o<s;o++){const h=t[i+o].rotation;r[a]=h,r[a+n]=h,r[a+n*2]=h,r[a+n*3]=h,a+=n*4}}uploadUvs(t,i,s,r,n,a){for(let o=0;o<s;++o){const h=t[i+o]._texture._uvs;h?(r[a]=h.x0,r[a+1]=h.y0,r[a+n]=h.x1,r[a+n+1]=h.y1,r[a+n*2]=h.x2,r[a+n*2+1]=h.y2,r[a+n*3]=h.x3,r[a+n*3+1]=h.y3,a+=n*4):(r[a]=0,r[a+1]=0,r[a+n]=0,r[a+n+1]=0,r[a+n*2]=0,r[a+n*2+1]=0,r[a+n*3]=0,r[a+n*3+1]=0,a+=n*4)}}uploadTint(t,i,s,r,n,a){for(let o=0;o<s;++o){const h=t[i+o],l=$.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);r[a]=l,r[a+n]=l,r[a+n*2]=l,r[a+n*3]=l,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ca.extension={name:"particle",type:D.RendererPlugin},U.add(ca);var Ji=(e=>(e[e.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",e[e.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",e))(Ji||{});const ur={willReadFrequently:!0},F=class{static get experimentalLetterSpacingSupported(){let e=F._experimentalLetterSpacingSupported;if(e!==void 0){const t=N.ADAPTER.getCanvasRenderingContext2D().prototype;e=F._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,s,r,n,a,o,h){this.text=e,this.style=t,this.width=i,this.height=s,this.lines=r,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(e,t,i,s=F._canvas){i=i==null?t.wordWrap:i;const r=t.toFontString(),n=F.measureFont(r);n.fontSize===0&&(n.fontSize=t.fontSize,n.ascent=t.fontSize);const a=s.getContext("2d",ur);a.font=r;const h=(i?F.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let p=0;p<h.length;p++){const _=F._measureText(h[p],t.letterSpacing,a);l[p]=_,c=Math.max(c,_)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||n.fontSize+t.strokeThickness;let f=Math.max(d,n.fontSize+t.strokeThickness*2)+(h.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new F(e,t,u,f,h,l,d+t.leading,c,n)}static _measureText(e,t,i){let s=!1;F.experimentalLetterSpacingSupported&&(F.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let r=i.measureText(e).width;return r>0&&(s?r-=t:r+=(F.graphemeSegmenter(e).length-1)*t),r}static wordWrap(e,t,i=F._canvas){const s=i.getContext("2d",ur);let r=0,n="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=t,c=F.collapseSpaces(l),u=F.collapseNewlines(l);let d=!c;const f=t.wordWrapWidth+h,p=F.tokenize(e);for(let _=0;_<p.length;_++){let m=p[_];if(F.isNewline(m)){if(!u){a+=F.addLine(n),d=!c,n="",r=0;continue}m=" "}if(c){const y=F.isBreakingSpace(m),g=F.isBreakingSpace(n[n.length-1]);if(y&&g)continue}const x=F.getFromCache(m,h,o,s);if(x>f)if(n!==""&&(a+=F.addLine(n),n="",r=0),F.canBreakWords(m,t.breakWords)){const y=F.wordWrapSplit(m);for(let g=0;g<y.length;g++){let v=y[g],w=v,P=1;for(;y[g+P];){const T=y[g+P];if(!F.canBreakChars(w,T,m,g,t.breakWords))v+=T;else break;w=T,P++}g+=P-1;const C=F.getFromCache(v,h,o,s);C+r>f&&(a+=F.addLine(n),d=!1,n="",r=0),n+=v,r+=C}}else{n.length>0&&(a+=F.addLine(n),n="",r=0);const y=_===p.length-1;a+=F.addLine(m,!y),d=!1,n="",r=0}else x+r>f&&(d=!1,a+=F.addLine(n),n="",r=0),(n.length>0||!F.isBreakingSpace(m)||d)&&(n+=m,r+=x)}return a+=F.addLine(n,!1),a}static addLine(e,t=!0){return e=F.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,s){let r=i[e];return typeof r!="number"&&(r=F._measureText(e,t,s)+t,i[e]=r),r}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!F.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:F._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:F._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){const r=e[s],n=e[s+1];if(F.isBreakingSpace(r,n)||F.isNewline(r)){i!==""&&(t.push(i),i=""),t.push(r);continue}i+=r}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,s,r){return!0}static wordWrapSplit(e){return F.graphemeSegmenter(e)}static measureFont(e){if(F._fonts[e])return F._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=F._canvas,s=F._context;s.font=e;const r=F.METRICS_STRING+F.BASELINE_SYMBOL,n=Math.ceil(s.measureText(r).width);let a=Math.ceil(s.measureText(F.BASELINE_SYMBOL).width);const o=Math.ceil(F.HEIGHT_MULTIPLIER*a);if(a=a*F.BASELINE_MULTIPLIER|0,n===0||o===0)return F._fonts[e]=t,t;i.width=n,i.height=o,s.fillStyle="#f00",s.fillRect(0,0,n,o),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,a);const h=s.getImageData(0,0,n,o).data,l=h.length,c=n*4;let u=0,d=0,f=!1;for(u=0;u<a;++u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d+=c;else break}for(t.ascent=a-u,d=l-c,f=!1,u=o;u>a;--u){for(let p=0;p<c;p+=4)if(h[d+p]!==255){f=!0;break}if(!f)d-=c;else break}return t.descent=u-a,t.fontSize=t.ascent+t.descent,F._fonts[e]=t,t}static clearMetrics(e=""){e?delete F._fonts[e]:F._fonts={}}static get _canvas(){if(!F.__canvas){let e;try{const t=new OffscreenCanvas(0,0),i=t.getContext("2d",ur);if(i!=null&&i.measureText)return F.__canvas=t,t;e=N.ADAPTER.createCanvas()}catch(t){e=N.ADAPTER.createCanvas()}e.width=e.height=10,F.__canvas=e}return F.__canvas}static get _context(){return F.__context||(F.__context=F._canvas.getContext("2d",ur)),F.__context}};let vt=F;vt.METRICS_STRING="|\xC9q\xC5",vt.BASELINE_SYMBOL="M",vt.BASELINE_MULTIPLIER=1.4,vt.HEIGHT_MULTIPLIER=2,vt.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const e=new Intl.Segmenter;return t=>[...e.segment(t)].map(i=>i.segment)}return e=>[...e]})(),vt.experimentalLetterSpacing=!1,vt._fonts={},vt._newlines=[10,13],vt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const zf=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ts=class{constructor(e){this.styleID=0,this.reset(),da(this,e,e)}clone(){const e={};return da(e,this,ts.defaultStyle),new ts(e)}reset(){da(this,ts.defaultStyle,ts.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=ua(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=ua(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){jf(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=ua(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let s=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!zf.includes(s)&&(s=`"${s}"`),t[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};let Me=ts;Me.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ji.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function ua(e){const t=$.shared;return Array.isArray(e)?e.map(i=>t.setValue(i).toHex()):t.setValue(e).toHex()}function jf(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function da(e,t,i){for(const s in i)Array.isArray(t[s])?e[s]=t[s].slice():e[s]=t[s]}const Wf={texture:!0,children:!1,baseTexture:!0},fa=class extends De{constructor(e,t,i){var n;let s=!1;i||(i=N.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const r=B.from(i);r.orig=new W,r.trim=new W,super(r),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=(n=fa.defaultResolution)!=null?n:N.RESOLUTION,this._autoResolution=fa.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return vt.experimentalLetterSpacing}static set experimentalLetterSpacing(e){j("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),vt.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,s=vt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,n=s.height,a=s.lines,o=s.lineHeight,h=s.lineWidths,l=s.maxLineWidth,c=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let u,d;const f=t.dropShadow?2:1;for(let p=0;p<f;++p){const _=t.dropShadow&&p===0,m=_?Math.ceil(Math.max(1,n)+t.padding*2):0,x=m*this._resolution;if(_){i.fillStyle="black",i.strokeStyle="black";const g=t.dropShadowColor,v=t.dropShadowBlur*this._resolution,w=t.dropShadowDistance*this._resolution;i.shadowColor=$.shared.setValue(g).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=v,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*w,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*w+x}else i.fillStyle=this._generateFillStyle(t,a,s),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let y=(o-c.fontSize)/2;o-c.fontSize<0&&(y=0);for(let g=0;g<a.length;g++)u=t.strokeThickness/2,d=t.strokeThickness/2+g*o+c.ascent+y,t.align==="right"?u+=l-h[g]:t.align==="center"&&(u+=(l-h[g])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[g],u+t.padding,d+t.padding-m,!0),t.fill&&this.drawLetterSpacing(a[g],u+t.padding,d+t.padding-m)}this.updateTexture()}drawLetterSpacing(e,t,i,s=!1){const n=this._style.letterSpacing;let a=!1;if(vt.experimentalLetterSpacingSupported&&(vt.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||a){s?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let o=t;const h=vt.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let u=0;u<h.length;++u){const d=h[u];s?this.context.strokeText(d,o,i):this.context.fillText(d,o,i);let f="";for(let p=u+1;p<h.length;++p)f+=h[p];c=this.context.measureText(f).width,o+=l-c+n,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const n=Co(e);n.data&&(e.width=n.width,e.height=n.height,this.context.putImageData(n.data,0,0))}const t=this._texture,i=this._style,s=i.trim?0:i.padding,r=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let r;const n=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,o=this.canvas.width/this._resolution-n-a*2,h=this.canvas.height/this._resolution-n-a*2,l=s.slice(),c=e.fillGradientStops.slice();if(!c.length){const u=l.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(l.unshift(s[0]),c.unshift(0),l.push(s[s.length-1]),c.push(1),e.fillGradientType===Ji.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,a,o/2,h+a);const u=i.fontProperties.fontSize+e.strokeThickness;for(let d=0;d<t.length;d++){const f=i.lineHeight*(d-1)+u,p=i.lineHeight*d;let _=p;d>0&&f>p&&(_=(p+f)/2);const m=p+u,x=i.lineHeight*(d+1);let y=m;d+1<t.length&&x<m&&(y=(m+x)/2);const g=(y-_)/h;for(let v=0;v<l.length;v++){let w=0;typeof c[v]=="number"?w=c[v]:w=v/l.length;let P=Math.min(1,Math.max(0,_/h+w*g));P=Number(P.toFixed(5)),r.addColorStop(P,l[v])}}}else{r=this.context.createLinearGradient(a,h/2,o+a,h/2);const u=l.length+1;let d=1;for(let f=0;f<l.length;f++){let p;typeof c[f]=="number"?p=c[f]:p=d/u,r.addColorStop(p,l[f]),d++}}return r}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Wf,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Le(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Le(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Me?this._style=e:this._style=new Me(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e==null?"":e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};let dr=fa;dr.defaultAutoResolution=!0;class dl{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function $f(e,t){var s;let i=!1;if((s=e==null?void 0:e._textures)!=null&&s.length){for(let r=0;r<e._textures.length;r++)if(e._textures[r]instanceof B){const n=e._textures[r].baseTexture;t.includes(n)||(t.push(n),i=!0)}}return i}function Yf(e,t){if(e.baseTexture instanceof z){const i=e.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function qf(e,t){if(e._texture&&e._texture instanceof B){const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function Zf(e,t){return t instanceof dr?(t.updateText(!0),!0):!1}function Kf(e,t){if(t instanceof Me){const i=t.toFontString();return vt.measureFont(i),!0}return!1}function Qf(e,t){if(e instanceof dr){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);const i=e._texture.baseTexture;return t.includes(i)||t.push(i),!0}return!1}function Jf(e,t){return e instanceof Me?(t.includes(e)||t.push(e),!0):!1}const fl=class{constructor(e){this.limiter=new dl(fl.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(Qf),this.registerFindHook(Jf),this.registerFindHook($f),this.registerFindHook(Yf),this.registerFindHook(qf),this.registerUploadHook(Zf),this.registerUploadHook(Kf)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,ft.system.addOnce(this.tick,this,Se.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)ft.system.addOnce(this.tick,this,Se.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Rt)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&ft.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let es=fl;es.uploadsPerFrame=4,Object.defineProperties(N,{UPLOADS_PER_FRAME:{get(){return es.uploadsPerFrame},set(e){j("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),es.uploadsPerFrame=e}}});function pl(e,t){return t instanceof z?(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0):!1}function tp(e,t){if(!(t instanceof Ki))return!1;const{geometry:i}=t;t.finishPoly(),i.updateBatches();const{batches:s}=i;for(let r=0;r<s.length;r++){const{texture:n}=s[r].style;n&&pl(e,n.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function ep(e,t){return e instanceof Ki?(t.push(e),!0):!1}class pa extends es{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ep),this.registerUploadHook(pl),this.registerUploadHook(tp)}}pa.extension={name:"prepare",type:D.RendererSystem},U.add(pa);class ip{constructor(t){this.maxMilliseconds=t,this.frameStart=0}beginFrame(){this.frameStart=Date.now()}allowedToUpload(){return Date.now()-this.frameStart<this.maxMilliseconds}}class Pr extends De{constructor(t,i=!0){super(t[0]instanceof B?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=i,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){!this._playing||(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ft.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ft.shared.add(this.update,this,Se.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const i=this.animationSpeed*t,s=this.currentFrame;if(this._durations!==null){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=i/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];const n=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=i;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):s!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<s||this.animationSpeed<0&&this.currentFrame>s)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const i=[];for(let s=0;s<t.length;++s)i.push(B.from(t[s]));return new Pr(i)}static fromImages(t){const i=[];for(let s=0;s<t.length;++s)i.push(B.from(t[s]));return new Pr(i)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof B)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let i=0;i<t.length;i++)this._textures.push(t[i].texture),this._durations.push(t[i].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const i=this.currentFrame;this._currentTime=t,i!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(ft.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ft.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const is=new J;class Na extends De{constructor(t,i=100,s=100){super(t),this.tileTransform=new Ni,this._width=i,this._height=s,this.uvMatrix=this.texture.uvMatrix||new qs(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const i=this._texture;!i||!i.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,i=this._height*-this._anchor._y,s=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,i,s,r)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new W),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,is);const i=this._width,s=this._height,r=-i*this.anchor._x;if(is.x>=r&&is.x<r+i){const n=-s*this.anchor._y;if(is.y>=n&&is.y<n+s)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,i){const s=t instanceof B?t:B.from(t,i);return new Na(s,i.width,i.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var sp=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,rp=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,np=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,ml=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,ap=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const fr=new tt;class ma extends Di{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new xn,this.state=de.for2d()}contextChange(){const t=this.renderer,i={globals:t.globalUniforms};this.simpleShader=ie.from(ml,ap,i),this.shader=t.context.webGLVersion>1?ie.from(rp,sp,i):ie.from(ml,np,i)}render(t){const i=this.renderer,s=this.quad;let r=s.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const n=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;r=s.uvs,r[0]=r[6]=-n,r[1]=r[3]=-a,r[2]=r[4]=1-n,r[5]=r[7]=1-a,s.invalidate();const o=t._texture,h=o.baseTexture,l=h.alphaMode>0,c=t.tileTransform.localTransform,u=t.uvMatrix;let d=h.isPowerOfTwo&&o.frame.width===h.width&&o.frame.height===h.height;d&&(h._glTextures[i.CONTEXT_UID]?d=h.wrapMode!==ae.CLAMP:h.wrapMode===ae.CLAMP&&(h.wrapMode=ae.REPEAT));const f=d?this.simpleShader:this.shader,p=o.width,_=o.height,m=t._width,x=t._height;fr.set(c.a*p/m,c.b*p/x,c.c*_/m,c.d*_/x,c.tx/m,c.ty/x),fr.invert(),d?fr.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=fr.toArray(!0),f.uniforms.uColor=$.shared.setValue(t.tint).premultiply(t.worldAlpha,l).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=o,i.shader.bind(f),i.geometry.bind(s),this.state.blendMode=Kr(t.blendMode,l),i.state.set(this.state),i.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}ma.extension={name:"tilingSprite",type:D.RendererPlugin},U.add(ma);const ss=class{constructor(e,t,i=null){this.linkedSheets=[],this._texture=e instanceof B?e:null,this.baseTexture=e instanceof z?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=me(e,null);return i===null&&(i=parseFloat(t!=null?t:"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=ss.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=ss.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const s=this._frameKeys[t],r=this._frames[s],n=r.frame;if(n){let a=null,o=null;const h=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,l=new W(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);r.rotated?a=new W(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):a=new W(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(o=new W(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[s]=new B(this.baseTexture,a,l,o,r.rotated?2:0,r.anchor,r.borders),B.addToCache(this.textures[s],s)}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const s=e[t][i];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*ss.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*ss.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let pr=ss;pr.BATCH_SIZE=1e3;const op=["jpg","png","jpeg","avif","webp"];function _l(e,t,i){const s={};if(e.forEach(r=>{s[r]=t}),Object.keys(t.textures).forEach(r=>{s[r]=t.textures[r]}),!i){const r=At.dirname(e[0]);t.linkedSheets.forEach((n,a)=>{const o=_l([`${r}/${t.data.meta.related_multi_packs[a]}`],n,!0);Object.assign(s,o)})}return s}const gl={extension:D.Asset,cache:{test:e=>e instanceof pr,getCacheableAssets:(e,t)=>_l(e,t,!1)},resolver:{test:e=>{const i=e.split("?")[0].split("."),s=i.pop(),r=i.pop();return s==="json"&&op.includes(r)},parse:e=>{var i,s;const t=e.split(".");return{resolution:parseFloat((s=(i=N.RETINA_PREFIX.exec(e))==null?void 0:i[1])!=null?s:"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:D.LoadParser,priority:Qt.Normal},async testParse(e,t){return At.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,i){var l,c;let s=At.dirname(t.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let r=s+e.meta.image;r=rr(r,t.src);const a=(await i.load([r]))[r],o=new pr(a.baseTexture,e,t.src);await o.parse();const h=(l=e==null?void 0:e.meta)==null?void 0:l.related_multi_packs;if(Array.isArray(h)){const u=[];for(const f of h){if(typeof f!="string")continue;let p=s+f;(c=t.data)!=null&&c.ignoreMultiPack||(p=rr(p,t.src),u.push(i.load({src:p,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(u);o.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[o].concat(o.linkedSheets.filter(p=>p!==f))})}return o},unload(e){e.destroy(!0)}}};U.add(gl);class rs{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class ns{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const i=t.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in i){const a=i[n].match(/^[a-z]+/gm)[0],o=i[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in o){const c=o[l].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;h[u]=p}s[a].push(h)}const r=new rs;return s.info.forEach(n=>r.info.push({face:n.face,size:parseInt(n.size,10)})),s.common.forEach(n=>r.common.push({lineHeight:parseInt(n.lineHeight,10)})),s.page.forEach(n=>r.page.push({id:parseInt(n.id,10),file:n.file})),s.char.forEach(n=>r.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),s.kerning.forEach(n=>r.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),s.distanceField.forEach(n=>r.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),r}}class mr{static test(t){const i=t;return"getElementsByTagName"in i&&i.getElementsByTagName("page").length&&i.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const i=new rs,s=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),h=t.getElementsByTagName("distanceField");for(let l=0;l<s.length;l++)i.info.push({face:s[l].getAttribute("face"),size:parseInt(s[l].getAttribute("size"),10)});for(let l=0;l<r.length;l++)i.common.push({lineHeight:parseInt(r[l].getAttribute("lineHeight"),10)});for(let l=0;l<n.length;l++)i.page.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});for(let l=0;l<a.length;l++){const c=a[l];i.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let l=0;l<o.length;l++)i.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)i.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return i}}class _r{static test(t){return typeof t=="string"&&t.includes("<font>")?mr.test(N.ADAPTER.parseXML(t)):!1}static parse(t){return mr.parse(N.ADAPTER.parseXML(t))}}const _a=[ns,mr,_r];function xl(e){for(let t=0;t<_a.length;t++)if(_a[t].test(e))return _a[t];return null}function hp(e,t,i,s,r,n){const a=i.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=e.width/s-h-l*2,u=e.height/s-h-l*2,d=a.slice(),f=i.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let _=1;_<p;++_)f.push(_/p)}if(d.unshift(a[0]),f.unshift(0),d.push(a[a.length-1]),f.push(1),i.fillGradientType===Ji.LINEAR_VERTICAL){o=t.createLinearGradient(c/2,l,c/2,u+l);let p=0;const m=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let x=0;x<r.length;x++){const y=n.lineHeight*x;for(let g=0;g<d.length;g++){let v=0;typeof f[g]=="number"?v=f[g]:v=g/d.length;const w=y/u+v*m;let P=Math.max(p,w);P=Math.min(P,1),o.addColorStop(P,d[g]),p=P}}}else{o=t.createLinearGradient(l,u/2,c+l,u/2);const p=d.length+1;let _=1;for(let m=0;m<d.length;m++){let x;typeof f[m]=="number"?x=f[m]:x=_/p,o.addColorStop(x,d[m]),_++}}return o}function lp(e,t,i,s,r,n,a){const o=i.text,h=i.fontProperties;t.translate(s,r),t.scale(n,n);const l=a.strokeThickness/2,c=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=hp(e,t,a,n,[o],i),t.strokeStyle=a.stroke,a.dropShadow){const u=a.dropShadowColor,d=a.dropShadowBlur*n,f=a.dropShadowDistance*n;t.shadowColor=$.shared.setValue(u).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=d,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*f,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(o,l,c+i.lineHeight-h.descent),a.fill&&t.fillText(o,l,c+i.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function gr(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}function vl(e){return Array.from?Array.from(e):e.split("")}function cp(e){typeof e=="string"&&(e=[e]);const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),a=r[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...vl(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const te=class{constructor(e,t,i){var l,c;const[s]=e.info,[r]=e.common,[n]=e.page,[a]=e.distanceField,o=me(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=r.lineHeight/o,this.chars={},this.pageTextures=h;for(let u=0;u<e.page.length;u++){const{id:d,file:f}=e.page[u];h[d]=t instanceof Array?t[u]:t[f],(a==null?void 0:a.fieldType)&&a.fieldType!=="none"&&(h[d].baseTexture.alphaMode=Ut.NO_PREMULTIPLIED_ALPHA,h[d].baseTexture.mipmap=$t.OFF)}for(let u=0;u<e.char.length;u++){const{id:d,page:f}=e.char[u];let{x:p,y:_,width:m,height:x,xoffset:y,yoffset:g,xadvance:v}=e.char[u];p/=o,_/=o,m/=o,x/=o,y/=o,g/=o,v/=o;const w=new W(p+h[f].frame.x/o,_+h[f].frame.y/o,m,x);this.chars[d]={xOffset:y,yOffset:g,xAdvance:v,kerning:{},texture:new B(h[f].baseTexture,w),page:f}}for(let u=0;u<e.kerning.length;u++){let{first:d,second:f,amount:p}=e.kerning[u];d/=o,f/=o,p/=o,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=(c=(l=a==null?void 0:a.fieldType)==null?void 0:l.toLowerCase())!=null?c:"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let s;if(e instanceof rs)s=e;else{const n=xl(e);if(!n)throw new Error("Unrecognized data format for font.");s=n.parse(e)}t instanceof B&&(t=[t]);const r=new te(s,t,i);return te.available[r.font]=r,r}static uninstall(e){const t=te.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete te.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const P=Object.assign({},te.defaultOptions,i),{chars:s,padding:r,resolution:n,textureWidth:a,textureHeight:o}=P,h=Dr(P,["chars","padding","resolution","textureWidth","textureHeight"]),l=cp(s),c=t instanceof Me?t:new Me(t),u=a,d=new rs;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f=0,p=0,_,m,x,y=0;const g=[],v=[];for(let C=0;C<l.length;C++){_||(_=N.ADAPTER.createCanvas(),_.width=a,_.height=o,m=_.getContext("2d"),x=new z(_,Et({resolution:n},h)),g.push(x),v.push(new B(x)),d.page.push({id:v.length-1,file:""}));const T=l[C],M=vt.measureText(T,c,!1,_),k=M.width,A=Math.ceil(M.height),O=Math.ceil((c.fontStyle==="italic"?2:1)*k);if(p>=o-A*n){if(p===0)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${T}')`);--C,_=null,m=null,x=null,p=0,f=0,y=0;continue}if(y=Math.max(A+M.fontProperties.descent,y),O*n+f>=u){if(f===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${T}')`);--C,p+=y*n,p=Math.ceil(p),f=0,y=0;continue}lp(_,m,M,f,p,n,c);const E=gr(M.text);d.char.push({id:E,page:v.length-1,x:f/n,y:p/n,width:O,height:A,xoffset:0,yoffset:0,xadvance:k-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),f+=(O+2*r)*n,f=Math.ceil(f)}for(let C=0,T=l.length;C<T;C++){const M=l[C];for(let k=0;k<T;k++){const A=l[k],O=m.measureText(M).width,E=m.measureText(A).width,V=m.measureText(M+A).width-(O+E);V&&d.kerning.push({first:gr(M),second:gr(A),amount:V})}}const w=new te(d,v,!0);return te.available[e]!==void 0&&te.uninstall(e),te.available[e]=w,w}};let Ct=te;Ct.ALPHA=[["a","z"],["A","Z"]," "],Ct.NUMERIC=[["0","9"]],Ct.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ct.ASCII=[[" ","~"]],Ct.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:te.ALPHANUMERIC},Ct.available={};var up=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,dp=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const yl=[],bl=[],Tl=[],El=class extends Rt{constructor(e,t={}){super();const{align:i,tint:s,maxWidth:r,letterSpacing:n,fontName:a,fontSize:o}=Object.assign({},El.styleDefaults,t);if(!Ct.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new $(s),this._font=void 0,this._fontName=a,this._fontSize=o,this.text=e,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new be(()=>{this.dirty=!0},this,0,0),this._roundPixels=N.ROUND_PIXELS,this.dirty=!0,this._resolution=N.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var k;const e=Ct.available[this._fontName],t=this.fontSize,i=t/e.size,s=new J,r=[],n=[],a=[],o=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",h=vl(o),l=this._maxWidth*e.size/t,c=e.distanceFieldType==="none"?yl:bl;let u=null,d=0,f=0,p=0,_=-1,m=0,x=0,y=0,g=0;for(let A=0;A<h.length;A++){const O=h[A],E=gr(O);if(/(?:\s)/.test(O)&&(_=A,m=d,g++),O==="\r"||O===`
`){n.push(d),a.push(-1),f=Math.max(f,d),++p,++x,s.x=0,s.y+=e.lineHeight,u=null,g=0;continue}const b=e.chars[E];if(!b)continue;u&&b.kerning[u]&&(s.x+=b.kerning[u]);const V=Tl.pop()||{texture:B.EMPTY,line:0,charCode:0,prevSpaces:0,position:new J};V.texture=b.texture,V.line=p,V.charCode=E,V.position.x=Math.round(s.x+b.xOffset+this._letterSpacing/2),V.position.y=Math.round(s.y+b.yOffset),V.prevSpaces=g,r.push(V),d=V.position.x+Math.max(b.xAdvance-b.xOffset,b.texture.orig.width),s.x+=b.xAdvance+this._letterSpacing,y=Math.max(y,b.yOffset+b.texture.height),u=E,_!==-1&&l>0&&s.x>l&&(++x,ti(r,1+_-x,1+A-_),A=_,_=-1,n.push(m),a.push(r.length>0?r[r.length-1].prevSpaces:0),f=Math.max(f,m),p++,s.x=0,s.y+=e.lineHeight,u=null,g=0)}const v=h[h.length-1];v!=="\r"&&v!==`
`&&(/(?:\s)/.test(v)&&(d=m),n.push(d),f=Math.max(f,d),a.push(-1));const w=[];for(let A=0;A<=p;A++){let O=0;this._align==="right"?O=f-n[A]:this._align==="center"?O=(f-n[A])/2:this._align==="justify"&&(O=a[A]<0?0:(f-n[A])/a[A]),w.push(O)}const P=r.length,C={},T=[],M=this._activePagesMeshData;c.push(...M);for(let A=0;A<P;A++){const O=r[A].texture,E=O.baseTexture.uid;if(!C[E]){let b=c.pop();if(!b){const L=new Qi;let I,q;e.distanceFieldType==="none"?(I=new ui(B.EMPTY),q=H.NORMAL):(I=new ui(B.EMPTY,{program:Ht.from(dp,up),uniforms:{uFWidth:0}}),q=H.NORMAL_NPM);const rt=new We(L,I);rt.blendMode=q,b={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:rt,vertices:null,uvs:null,indices:null}}b.index=0,b.indexCount=0,b.vertexCount=0,b.uvsCount=0,b.total=0;const{_textureCache:V}=this;V[E]=V[E]||new B(O.baseTexture),b.mesh.texture=V[E],b.mesh.tint=this._tintColor.value,T.push(b),C[E]=b}C[E].total++}for(let A=0;A<M.length;A++)T.includes(M[A])||this.removeChild(M[A].mesh);for(let A=0;A<T.length;A++)T[A].mesh.parent!==this&&this.addChild(T[A].mesh);this._activePagesMeshData=T;for(const A in C){const O=C[A],E=O.total;if(!(((k=O.indices)==null?void 0:k.length)>6*E)||O.vertices.length<We.BATCHABLE_SIZE*2)O.vertices=new Float32Array(4*2*E),O.uvs=new Float32Array(4*2*E),O.indices=new Uint16Array(6*E);else{const b=O.total,V=O.vertices;for(let L=b*4*2;L<V.length;L++)V[L]=0}O.mesh.size=6*E}for(let A=0;A<P;A++){const O=r[A];let E=O.position.x+w[O.line]*(this._align==="justify"?O.prevSpaces:1);this._roundPixels&&(E=Math.round(E));const b=E*i,V=O.position.y*i,L=O.texture,I=C[L.baseTexture.uid],q=L.frame,rt=L._uvs,S=I.index++;I.indices[S*6+0]=0+S*4,I.indices[S*6+1]=1+S*4,I.indices[S*6+2]=2+S*4,I.indices[S*6+3]=0+S*4,I.indices[S*6+4]=2+S*4,I.indices[S*6+5]=3+S*4,I.vertices[S*8+0]=b,I.vertices[S*8+1]=V,I.vertices[S*8+2]=b+q.width*i,I.vertices[S*8+3]=V,I.vertices[S*8+4]=b+q.width*i,I.vertices[S*8+5]=V+q.height*i,I.vertices[S*8+6]=b,I.vertices[S*8+7]=V+q.height*i,I.uvs[S*8+0]=rt.x0,I.uvs[S*8+1]=rt.y0,I.uvs[S*8+2]=rt.x1,I.uvs[S*8+3]=rt.y1,I.uvs[S*8+4]=rt.x2,I.uvs[S*8+5]=rt.y2,I.uvs[S*8+6]=rt.x3,I.uvs[S*8+7]=rt.y3}this._textWidth=f*i,this._textHeight=(s.y+e.lineHeight)*i;for(const A in C){const O=C[A];if(this.anchor.x!==0||this.anchor.y!==0){let L=0;const I=this._textWidth*this.anchor.x,q=this._textHeight*this.anchor.y;for(let rt=0;rt<O.total;rt++)O.vertices[L++]-=I,O.vertices[L++]-=q,O.vertices[L++]-=I,O.vertices[L++]-=q,O.vertices[L++]-=I,O.vertices[L++]-=q,O.vertices[L++]-=I,O.vertices[L++]-=q}this._maxLineHeight=y*i;const E=O.mesh.geometry.getBuffer("aVertexPosition"),b=O.mesh.geometry.getBuffer("aTextureCoord"),V=O.mesh.geometry.getIndex();E.data=O.vertices,b.data=O.uvs,V.data=O.indices,E.update(),b.update(),V.update()}for(let A=0;A<r.length;A++)Tl.push(r[A]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:s}=Ct.available[this._fontName];if(i!=="none"){const{a:r,b:n,c:a,d:o}=this.worldTransform,h=Math.sqrt(r*r+n*n),l=Math.sqrt(a*a+o*o),c=(Math.abs(h)+Math.abs(l))/2,u=this.fontSize/s,d=e._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*t*u*d}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Ct.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Ct.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){var e;return(e=this._fontSize)!=null?e:Ct.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e==null?"":e),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,s=Ct.available[this._fontName].distanceFieldType==="none"?yl:bl;s.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],s.filter(r=>t[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=B.EMPTY});for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};let wl=El;wl.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const fp=[".xml",".fnt"],Al={extension:{type:D.LoadParser,priority:Qt.Normal},name:"loadBitmapFont",test(e){return fp.includes(At.extname(e).toLowerCase())},async testParse(e){return ns.test(e)||_r.test(e)},async parse(e,t,i){const s=ns.test(e)?ns.parse(e):_r.parse(e),{src:r}=t,{page:n}=s,a=[];for(let l=0;l<n.length;++l){const c=n[l].file;let u=At.join(At.dirname(r),c);u=rr(u,r),a.push(u)}const o=await i.load(a),h=a.map(l=>o[l]);return Ct.install(s,h,!0)},async load(e,t){return(await N.ADAPTER.fetch(e)).text()},unload(e){e.destroy()}};U.add(Al);function pp(e,t,i){if(i===void 0&&(i=Array.prototype),e&&typeof i.find=="function")return i.find.call(e,t);for(var s=0;s<e.length;s++)if(Object.prototype.hasOwnProperty.call(e,s)){var r=e[s];if(t.call(void 0,r,s,e))return r}}function ga(e,t){return t===void 0&&(t=Object),t&&typeof t.freeze=="function"?t.freeze(e):e}function mp(e,t){if(e===null||typeof e!="object")throw new TypeError("target is not an object");for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}var Sl=ga({HTML:"text/html",isHTML:function(e){return e===Sl.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Cl=ga({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(e){return e===Cl.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}),_p=mp,gp=pp,xp=ga,vp=Sl,yp=Cl,as={assign:_p,find:gp,freeze:xp,MIME_TYPE:vp,NAMESPACE:yp},ce=as.find,os=as.NAMESPACE;function bp(e){return e!==""}function Tp(e){return e?e.split(/[\t\n\f\r ]+/).filter(bp):[]}function Ep(e,t){return e.hasOwnProperty(t)||(e[t]=!0),e}function Rl(e){if(!e)return[];var t=Tp(e);return Object.keys(t.reduce(Ep,{}))}function wp(e){return function(t){return e&&e.indexOf(t)!==-1}}function hs(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}function Mt(e,t){var i=e.prototype;if(!(i instanceof t)){let s=function(){};s.prototype=t.prototype,s=new s,hs(i,s),e.prototype=i=s}i.constructor!=e&&(typeof e!="function"&&console.error("unknown Class:"+e),i.constructor=e)}var Nt={},ee=Nt.ELEMENT_NODE=1,di=Nt.ATTRIBUTE_NODE=2,xr=Nt.TEXT_NODE=3,Il=Nt.CDATA_SECTION_NODE=4,Ml=Nt.ENTITY_REFERENCE_NODE=5,Ap=Nt.ENTITY_NODE=6,Nl=Nt.PROCESSING_INSTRUCTION_NODE=7,Pl=Nt.COMMENT_NODE=8,Dl=Nt.DOCUMENT_NODE=9,Bl=Nt.DOCUMENT_TYPE_NODE=10,xe=Nt.DOCUMENT_FRAGMENT_NODE=11,Sp=Nt.NOTATION_NODE=12,wt={},yt={},fm=wt.INDEX_SIZE_ERR=(yt[1]="Index size error",1),pm=wt.DOMSTRING_SIZE_ERR=(yt[2]="DOMString size error",2),Pt=wt.HIERARCHY_REQUEST_ERR=(yt[3]="Hierarchy request error",3),mm=wt.WRONG_DOCUMENT_ERR=(yt[4]="Wrong document",4),_m=wt.INVALID_CHARACTER_ERR=(yt[5]="Invalid character",5),gm=wt.NO_DATA_ALLOWED_ERR=(yt[6]="No data allowed",6),xm=wt.NO_MODIFICATION_ALLOWED_ERR=(yt[7]="No modification allowed",7),Ol=wt.NOT_FOUND_ERR=(yt[8]="Not found",8),vm=wt.NOT_SUPPORTED_ERR=(yt[9]="Not supported",9),Fl=wt.INUSE_ATTRIBUTE_ERR=(yt[10]="Attribute in use",10),ym=wt.INVALID_STATE_ERR=(yt[11]="Invalid state",11),bm=wt.SYNTAX_ERR=(yt[12]="Syntax error",12),Tm=wt.INVALID_MODIFICATION_ERR=(yt[13]="Invalid modification",13),Em=wt.NAMESPACE_ERR=(yt[14]="Invalid namespace",14),wm=wt.INVALID_ACCESS_ERR=(yt[15]="Invalid access",15);function ht(e,t){if(t instanceof Error)var i=t;else i=this,Error.call(this,yt[e]),this.message=yt[e],Error.captureStackTrace&&Error.captureStackTrace(this,ht);return i.code=e,t&&(this.message=this.message+": "+t),i}ht.prototype=Error.prototype,hs(wt,ht);function ve(){}ve.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var i=[],s=0;s<this.length;s++)pi(this[s],i,e,t);return i.join("")},filter:function(e){return Array.prototype.filter.call(this,e)},indexOf:function(e){return Array.prototype.indexOf.call(this,e)}};function fi(e,t){this._node=e,this._refresh=t,xa(this)}function xa(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var i=e._refresh(e._node);Jl(e,"length",i.length),hs(i,e),e._inc=t}}fi.prototype.item=function(e){return xa(this),this[e]},Mt(fi,ve);function vr(){}function Ll(e,t){for(var i=e.length;i--;)if(e[i]===t)return i}function Ul(e,t,i,s){if(s?t[Ll(t,s)]=i:t[t.length++]=i,e){i.ownerElement=e;var r=e.ownerDocument;r&&(s&&Xl(r,e,s),Cp(r,e,i))}}function kl(e,t,i){var s=Ll(t,i);if(s>=0){for(var r=t.length-1;s<r;)t[s]=t[++s];if(t.length=r,e){var n=e.ownerDocument;n&&(Xl(n,e,i),i.ownerElement=null)}}else throw new ht(Ol,new Error(e.tagName+"@"+i))}vr.prototype={length:0,item:ve.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var i=this[t];if(i.nodeName==e)return i}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new ht(Fl);var i=this.getNamedItem(e.nodeName);return Ul(this._ownerElement,this,e,i),i},setNamedItemNS:function(e){var t=e.ownerElement,i;if(t&&t!=this._ownerElement)throw new ht(Fl);return i=this.getNamedItemNS(e.namespaceURI,e.localName),Ul(this._ownerElement,this,e,i),i},removeNamedItem:function(e){var t=this.getNamedItem(e);return kl(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var i=this.getNamedItemNS(e,t);return kl(this._ownerElement,this,i),i},getNamedItemNS:function(e,t){for(var i=this.length;i--;){var s=this[i];if(s.localName==t&&s.namespaceURI==e)return s}return null}};function Gl(){}Gl.prototype={hasFeature:function(e,t){return!0},createDocument:function(e,t,i){var s=new cs;if(s.implementation=this,s.childNodes=new ve,s.doctype=i||null,i&&s.appendChild(i),t){var r=s.createElementNS(e,t);s.appendChild(r)}return s},createDocumentType:function(e,t,i){var s=new Tr;return s.name=e,s.nodeName=e,s.publicId=t||"",s.systemId=i||"",s}};function Z(){}Z.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return yr(this,e,t)},replaceChild:function(e,t){yr(this,e,t,Wl),t&&this.removeChild(t)},removeChild:function(e){return Vl(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(e){return Ca(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==xr&&e.nodeType==xr?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var i=t._nsMap;if(i){for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s)&&i[s]===e)return s}t=t.nodeType==di?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var i=t._nsMap;if(i&&Object.prototype.hasOwnProperty.call(i,e))return i[e];t=t.nodeType==di?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return t==null}};function Hl(e){return e=="<"&&"&lt;"||e==">"&&"&gt;"||e=="&"&&"&amp;"||e=='"'&&"&quot;"||"&#"+e.charCodeAt()+";"}hs(Nt,Z),hs(Nt,Z.prototype);function ls(e,t){if(t(e))return!0;if(e=e.firstChild)do if(ls(e,t))return!0;while(e=e.nextSibling)}function cs(){this.ownerDocument=this}function Cp(e,t,i){e&&e._inc++;var s=i.namespaceURI;s===os.XMLNS&&(t._nsMap[i.prefix?i.localName:""]=i.value)}function Xl(e,t,i,s){e&&e._inc++;var r=i.namespaceURI;r===os.XMLNS&&delete t._nsMap[i.prefix?i.localName:""]}function va(e,t,i){if(e&&e._inc){e._inc++;var s=t.childNodes;if(i)s[s.length++]=i;else{for(var r=t.firstChild,n=0;r;)s[n++]=r,r=r.nextSibling;s.length=n,delete s[s.length]}}}function Vl(e,t){var i=t.previousSibling,s=t.nextSibling;return i?i.nextSibling=s:e.firstChild=s,s?s.previousSibling=i:e.lastChild=i,t.parentNode=null,t.previousSibling=null,t.nextSibling=null,va(e.ownerDocument,e),t}function Rp(e){return e&&(e.nodeType===Z.DOCUMENT_NODE||e.nodeType===Z.DOCUMENT_FRAGMENT_NODE||e.nodeType===Z.ELEMENT_NODE)}function Ip(e){return e&&(ue(e)||ya(e)||ye(e)||e.nodeType===Z.DOCUMENT_FRAGMENT_NODE||e.nodeType===Z.COMMENT_NODE||e.nodeType===Z.PROCESSING_INSTRUCTION_NODE)}function ye(e){return e&&e.nodeType===Z.DOCUMENT_TYPE_NODE}function ue(e){return e&&e.nodeType===Z.ELEMENT_NODE}function ya(e){return e&&e.nodeType===Z.TEXT_NODE}function zl(e,t){var i=e.childNodes||[];if(ce(i,ue)||ye(t))return!1;var s=ce(i,ye);return!(t&&s&&i.indexOf(s)>i.indexOf(t))}function jl(e,t){var i=e.childNodes||[];function s(n){return ue(n)&&n!==t}if(ce(i,s))return!1;var r=ce(i,ye);return!(t&&r&&i.indexOf(r)>i.indexOf(t))}function Mp(e,t,i){if(!Rp(e))throw new ht(Pt,"Unexpected parent node type "+e.nodeType);if(i&&i.parentNode!==e)throw new ht(Ol,"child not in parent");if(!Ip(t)||ye(t)&&e.nodeType!==Z.DOCUMENT_NODE)throw new ht(Pt,"Unexpected node type "+t.nodeType+" for parent node type "+e.nodeType)}function Np(e,t,i){var s=e.childNodes||[],r=t.childNodes||[];if(t.nodeType===Z.DOCUMENT_FRAGMENT_NODE){var n=r.filter(ue);if(n.length>1||ce(r,ya))throw new ht(Pt,"More than one element or text in fragment");if(n.length===1&&!zl(e,i))throw new ht(Pt,"Element in fragment can not be inserted before doctype")}if(ue(t)&&!zl(e,i))throw new ht(Pt,"Only one element can be added and only after doctype");if(ye(t)){if(ce(s,ye))throw new ht(Pt,"Only one doctype is allowed");var a=ce(s,ue);if(i&&s.indexOf(a)<s.indexOf(i))throw new ht(Pt,"Doctype can only be inserted before an element");if(!i&&a)throw new ht(Pt,"Doctype can not be appended since element is present")}}function Wl(e,t,i){var s=e.childNodes||[],r=t.childNodes||[];if(t.nodeType===Z.DOCUMENT_FRAGMENT_NODE){var n=r.filter(ue);if(n.length>1||ce(r,ya))throw new ht(Pt,"More than one element or text in fragment");if(n.length===1&&!jl(e,i))throw new ht(Pt,"Element in fragment can not be inserted before doctype")}if(ue(t)&&!jl(e,i))throw new ht(Pt,"Only one element can be added and only after doctype");if(ye(t)){if(ce(s,function(h){return ye(h)&&h!==i}))throw new ht(Pt,"Only one doctype is allowed");var a=ce(s,ue);if(i&&s.indexOf(a)<s.indexOf(i))throw new ht(Pt,"Doctype can only be inserted before an element")}}function yr(e,t,i,s){Mp(e,t,i),e.nodeType===Z.DOCUMENT_NODE&&(s||Np)(e,t,i);var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===xe){var n=t.firstChild;if(n==null)return t;var a=t.lastChild}else n=a=t;var o=i?i.previousSibling:e.lastChild;n.previousSibling=o,a.nextSibling=i,o?o.nextSibling=n:e.firstChild=n,i==null?e.lastChild=a:i.previousSibling=a;do n.parentNode=e;while(n!==a&&(n=n.nextSibling));return va(e.ownerDocument||e,e),t.nodeType==xe&&(t.firstChild=t.lastChild=null),t}function Pp(e,t){return t.parentNode&&t.parentNode.removeChild(t),t.parentNode=e,t.previousSibling=e.lastChild,t.nextSibling=null,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,e.lastChild=t,va(e.ownerDocument,e,t),t}cs.prototype={nodeName:"#document",nodeType:Dl,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==xe){for(var i=e.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,t),i=s}return e}return yr(this,e,t),e.ownerDocument=this,this.documentElement===null&&e.nodeType===ee&&(this.documentElement=e),e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),Vl(this,e)},replaceChild:function(e,t){yr(this,e,t,Wl),e.ownerDocument=this,t&&this.removeChild(t),ue(e)&&(this.documentElement=e)},importNode:function(e,t){return Ql(this,e,t)},getElementById:function(e){var t=null;return ls(this.documentElement,function(i){if(i.nodeType==ee&&i.getAttribute("id")==e)return t=i,!0}),t},getElementsByClassName:function(e){var t=Rl(e);return new fi(this,function(i){var s=[];return t.length>0&&ls(i.documentElement,function(r){if(r!==i&&r.nodeType===ee){var n=r.getAttribute("class");if(n){var a=e===n;if(!a){var o=Rl(n);a=t.every(wp(o))}a&&s.push(r)}}}),s})},createElement:function(e){var t=new $e;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.localName=e,t.childNodes=new ve;var i=t.attributes=new vr;return i._ownerElement=t,t},createDocumentFragment:function(){var e=new Er;return e.ownerDocument=this,e.childNodes=new ve,e},createTextNode:function(e){var t=new ba;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new Ta;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new Ea;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var i=new Aa;return i.ownerDocument=this,i.tagName=i.target=e,i.nodeValue=i.data=t,i},createAttribute:function(e){var t=new br;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new wa;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var i=new $e,s=t.split(":"),r=i.attributes=new vr;return i.childNodes=new ve,i.ownerDocument=this,i.nodeName=t,i.tagName=t,i.namespaceURI=e,s.length==2?(i.prefix=s[0],i.localName=s[1]):i.localName=t,r._ownerElement=i,i},createAttributeNS:function(e,t){var i=new br,s=t.split(":");return i.ownerDocument=this,i.nodeName=t,i.name=t,i.namespaceURI=e,i.specified=!0,s.length==2?(i.prefix=s[0],i.localName=s[1]):i.localName=t,i}},Mt(cs,Z);function $e(){this._nsMap={}}$e.prototype={nodeType:ee,hasAttribute:function(e){return this.getAttributeNode(e)!=null},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var i=this.ownerDocument.createAttribute(e);i.value=i.nodeValue=""+t,this.setAttributeNode(i)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===xe?this.insertBefore(e,null):Pp(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);i&&this.removeAttributeNode(i)},hasAttributeNS:function(e,t){return this.getAttributeNodeNS(e,t)!=null},getAttributeNS:function(e,t){var i=this.getAttributeNodeNS(e,t);return i&&i.value||""},setAttributeNS:function(e,t,i){var s=this.ownerDocument.createAttributeNS(e,t);s.value=s.nodeValue=""+i,this.setAttributeNode(s)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new fi(this,function(t){var i=[];return ls(t,function(s){s!==t&&s.nodeType==ee&&(e==="*"||s.tagName==e)&&i.push(s)}),i})},getElementsByTagNameNS:function(e,t){return new fi(this,function(i){var s=[];return ls(i,function(r){r!==i&&r.nodeType===ee&&(e==="*"||r.namespaceURI===e)&&(t==="*"||r.localName==t)&&s.push(r)}),s})}},cs.prototype.getElementsByTagName=$e.prototype.getElementsByTagName,cs.prototype.getElementsByTagNameNS=$e.prototype.getElementsByTagNameNS,Mt($e,Z);function br(){}br.prototype.nodeType=di,Mt(br,Z);function us(){}us.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(yt[Pt])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,i){var s=this.data.substring(0,e),r=this.data.substring(e+t);i=s+i+r,this.nodeValue=this.data=i,this.length=i.length}},Mt(us,Z);function ba(){}ba.prototype={nodeName:"#text",nodeType:xr,splitText:function(e){var t=this.data,i=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},Mt(ba,us);function Ta(){}Ta.prototype={nodeName:"#comment",nodeType:Pl},Mt(Ta,us);function Ea(){}Ea.prototype={nodeName:"#cdata-section",nodeType:Il},Mt(Ea,us);function Tr(){}Tr.prototype.nodeType=Bl,Mt(Tr,Z);function $l(){}$l.prototype.nodeType=Sp,Mt($l,Z);function Yl(){}Yl.prototype.nodeType=Ap,Mt(Yl,Z);function wa(){}wa.prototype.nodeType=Ml,Mt(wa,Z);function Er(){}Er.prototype.nodeName="#document-fragment",Er.prototype.nodeType=xe,Mt(Er,Z);function Aa(){}Aa.prototype.nodeType=Nl,Mt(Aa,Z);function ql(){}ql.prototype.serializeToString=function(e,t,i){return Zl.call(e,t,i)},Z.prototype.toString=Zl;function Zl(e,t){var i=[],s=this.nodeType==9&&this.documentElement||this,r=s.prefix,n=s.namespaceURI;if(n&&r==null){var r=s.lookupPrefix(n);if(r==null)var a=[{namespace:n,prefix:null}]}return pi(this,i,e,t,a),i.join("")}function Kl(e,t,i){var s=e.prefix||"",r=e.namespaceURI;if(!r||s==="xml"&&r===os.XML||r===os.XMLNS)return!1;for(var n=i.length;n--;){var a=i[n];if(a.prefix===s)return a.namespace!==r}return!0}function Sa(e,t,i){e.push(" ",t,'="',i.replace(/[<>&"\t\n\r]/g,Hl),'"')}function pi(e,t,i,s,r){if(r||(r=[]),s)if(e=s(e),e){if(typeof e=="string"){t.push(e);return}}else return;switch(e.nodeType){case ee:var n=e.attributes,a=n.length,x=e.firstChild,o=e.tagName;i=os.isHTML(e.namespaceURI)||i;var h=o;if(!i&&!e.prefix&&e.namespaceURI){for(var l,c=0;c<n.length;c++)if(n.item(c).name==="xmlns"){l=n.item(c).value;break}if(!l)for(var u=r.length-1;u>=0;u--){var d=r[u];if(d.prefix===""&&d.namespace===e.namespaceURI){l=d.namespace;break}}if(l!==e.namespaceURI)for(var u=r.length-1;u>=0;u--){var d=r[u];if(d.namespace===e.namespaceURI){d.prefix&&(h=d.prefix+":"+o);break}}}t.push("<",h);for(var f=0;f<a;f++){var p=n.item(f);p.prefix=="xmlns"?r.push({prefix:p.localName,namespace:p.value}):p.nodeName=="xmlns"&&r.push({prefix:"",namespace:p.value})}for(var f=0;f<a;f++){var p=n.item(f);if(Kl(p,i,r)){var _=p.prefix||"",m=p.namespaceURI;Sa(t,_?"xmlns:"+_:"xmlns",m),r.push({prefix:_,namespace:m})}pi(p,t,i,s,r)}if(o===h&&Kl(e,i,r)){var _=e.prefix||"",m=e.namespaceURI;Sa(t,_?"xmlns:"+_:"xmlns",m),r.push({prefix:_,namespace:m})}if(x||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(o)){if(t.push(">"),i&&/^script$/i.test(o))for(;x;)x.data?t.push(x.data):pi(x,t,i,s,r.slice()),x=x.nextSibling;else for(;x;)pi(x,t,i,s,r.slice()),x=x.nextSibling;t.push("</",h,">")}else t.push("/>");return;case Dl:case xe:for(var x=e.firstChild;x;)pi(x,t,i,s,r.slice()),x=x.nextSibling;return;case di:return Sa(t,e.name,e.value);case xr:return t.push(e.data.replace(/[<&>]/g,Hl));case Il:return t.push("<![CDATA[",e.data,"]]>");case Pl:return t.push("<!--",e.data,"-->");case Bl:var y=e.publicId,g=e.systemId;if(t.push("<!DOCTYPE ",e.name),y)t.push(" PUBLIC ",y),g&&g!="."&&t.push(" ",g),t.push(">");else if(g&&g!=".")t.push(" SYSTEM ",g,">");else{var v=e.internalSubset;v&&t.push(" [",v,"]"),t.push(">")}return;case Nl:return t.push("<?",e.target," ",e.data,"?>");case Ml:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function Ql(e,t,i){var s;switch(t.nodeType){case ee:s=t.cloneNode(!1),s.ownerDocument=e;case xe:break;case di:i=!0;break}if(s||(s=t.cloneNode(!1)),s.ownerDocument=e,s.parentNode=null,i)for(var r=t.firstChild;r;)s.appendChild(Ql(e,r,i)),r=r.nextSibling;return s}function Ca(e,t,i){var s=new t.constructor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];typeof n!="object"&&n!=s[r]&&(s[r]=n)}switch(t.childNodes&&(s.childNodes=new ve),s.ownerDocument=e,s.nodeType){case ee:var a=t.attributes,o=s.attributes=new vr,h=a.length;o._ownerElement=s;for(var l=0;l<h;l++)s.setAttributeNode(Ca(e,a.item(l),!0));break;case di:i=!0}if(i)for(var c=t.firstChild;c;)s.appendChild(Ca(e,c,i)),c=c.nextSibling;return s}function Jl(e,t,i){e[t]=i}try{if(Object.defineProperty){let e=function(t){switch(t.nodeType){case ee:case xe:var i=[];for(t=t.firstChild;t;)t.nodeType!==7&&t.nodeType!==8&&i.push(e(t)),t=t.nextSibling;return i.join("");default:return t.nodeValue}};Object.defineProperty(fi.prototype,"length",{get:function(){return xa(this),this.$$length}}),Object.defineProperty(Z.prototype,"textContent",{get:function(){return e(this)},set:function(t){switch(this.nodeType){case ee:case xe:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),Jl=function(t,i,s){t["$$"+i]=s}}}catch(e){}var Dp=Tr,Bp=ht,Op=Gl,Fp=$e,Lp=Z,Up=ve,kp=ql,Ra={DocumentType:Dp,DOMException:Bp,DOMImplementation:Op,Element:Fp,Node:Lp,NodeList:Up,XMLSerializer:kp},tc=Cs(function(e,t){var i=as.freeze;t.XML_ENTITIES=i({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),t.HTML_ENTITIES=i({lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"\xC0",Aacute:"\xC1",Acirc:"\xC2",Atilde:"\xC3",Auml:"\xC4",Aring:"\xC5",AElig:"\xC6",Ccedil:"\xC7",Egrave:"\xC8",Eacute:"\xC9",Ecirc:"\xCA",Euml:"\xCB",Igrave:"\xCC",Iacute:"\xCD",Icirc:"\xCE",Iuml:"\xCF",ETH:"\xD0",Ntilde:"\xD1",Ograve:"\xD2",Oacute:"\xD3",Ocirc:"\xD4",Otilde:"\xD5",Ouml:"\xD6",Oslash:"\xD8",Ugrave:"\xD9",Uacute:"\xDA",Ucirc:"\xDB",Uuml:"\xDC",Yacute:"\xDD",THORN:"\xDE",szlig:"\xDF",agrave:"\xE0",aacute:"\xE1",acirc:"\xE2",atilde:"\xE3",auml:"\xE4",aring:"\xE5",aelig:"\xE6",ccedil:"\xE7",egrave:"\xE8",eacute:"\xE9",ecirc:"\xEA",euml:"\xEB",igrave:"\xEC",iacute:"\xED",icirc:"\xEE",iuml:"\xEF",eth:"\xF0",ntilde:"\xF1",ograve:"\xF2",oacute:"\xF3",ocirc:"\xF4",otilde:"\xF5",ouml:"\xF6",oslash:"\xF8",ugrave:"\xF9",uacute:"\xFA",ucirc:"\xFB",uuml:"\xFC",yacute:"\xFD",thorn:"\xFE",yuml:"\xFF",nbsp:"\xA0",iexcl:"\xA1",cent:"\xA2",pound:"\xA3",curren:"\xA4",yen:"\xA5",brvbar:"\xA6",sect:"\xA7",uml:"\xA8",copy:"\xA9",ordf:"\xAA",laquo:"\xAB",not:"\xAC",shy:"\xAD\xAD",reg:"\xAE",macr:"\xAF",deg:"\xB0",plusmn:"\xB1",sup2:"\xB2",sup3:"\xB3",acute:"\xB4",micro:"\xB5",para:"\xB6",middot:"\xB7",cedil:"\xB8",sup1:"\xB9",ordm:"\xBA",raquo:"\xBB",frac14:"\xBC",frac12:"\xBD",frac34:"\xBE",iquest:"\xBF",times:"\xD7",divide:"\xF7",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220B",prod:"\u220F",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221A",prop:"\u221D",infin:"\u221E",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222A",int:"\u222B",there4:"\u2234",sim:"\u223C",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22A5",sdot:"\u22C5",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039A",Lambda:"\u039B",Mu:"\u039C",Nu:"\u039D",Xi:"\u039E",Omicron:"\u039F",Pi:"\u03A0",Rho:"\u03A1",Sigma:"\u03A3",Tau:"\u03A4",Upsilon:"\u03A5",Phi:"\u03A6",Chi:"\u03A7",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u03B5",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",omicron:"\u03BF",pi:"\u03C0",rho:"\u03C1",sigmaf:"\u03C2",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9",thetasym:"\u03D1",upsih:"\u03D2",piv:"\u03D6",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02C6",tilde:"\u02DC",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200C",zwj:"\u200D",lrm:"\u200E",rlm:"\u200F",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201A",ldquo:"\u201C",rdquo:"\u201D",bdquo:"\u201E",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203A",oline:"\u203E",euro:"\u20AC",trade:"\u2122",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21B5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230A",rfloor:"\u230B",loz:"\u25CA",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"}),t.entityMap=t.HTML_ENTITIES}),ds=as.NAMESPACE,Ia=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ec=new RegExp("[\\-\\.0-9"+Ia.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),ic=new RegExp("^"+Ia.source+ec.source+"*(?::"+Ia.source+ec.source+"*)?$"),fs=0,Ne=1,mi=2,ps=3,_i=4,gi=5,ms=6,wr=7;function xi(e,t){this.message=e,this.locator=t,Error.captureStackTrace&&Error.captureStackTrace(this,xi)}xi.prototype=new Error,xi.prototype.name=xi.name;function sc(){}sc.prototype={parse:function(e,t,i){var s=this.domBuilder;s.startDocument(),ac(t,t={}),Gp(e,t,i,s,this.errorHandler),s.endDocument()}};function Gp(e,t,i,s,r){function n(L){if(L>65535){L-=65536;var I=55296+(L>>10),q=56320+(L&1023);return String.fromCharCode(I,q)}else return String.fromCharCode(L)}function a(L){var I=L.slice(1,-1);return Object.hasOwnProperty.call(i,I)?i[I]:I.charAt(0)==="#"?n(parseInt(I.substr(1).replace("x","0x"))):(r.error("entity not found:"+L),L)}function o(L){if(L>_){var I=e.substring(_,L).replace(/&#?\w+;/g,a);d&&h(_),s.characters(I,0,L-_),_=L}}function h(L,I){for(;L>=c&&(I=u.exec(e));)l=I.index,c=l+I[0].length,d.lineNumber++;d.columnNumber=L-l+1}for(var l=0,c=0,u=/.*(?:\r\n?|\n)|.*$/g,d=s.locator,f=[{currentNSMap:t}],p={},_=0;;){try{var m=e.indexOf("<",_);if(m<0){if(!e.substr(_).match(/^\s*$/)){var x=s.doc,y=x.createTextNode(e.substr(_));x.appendChild(y),s.currentElement=y}return}switch(m>_&&o(m),e.charAt(m+1)){case"/":var A=e.indexOf(">",m+3),g=e.substring(m+2,A).replace(/[ \t\n\r]+$/g,""),v=f.pop();A<0?(g=e.substring(m+2).replace(/[\s<].*/,""),r.error("end tag name: "+g+" is not complete:"+v.tagName),A=m+1+g.length):g.match(/\s</)&&(g=g.replace(/[\s<].*/,""),r.error("end tag name: "+g+" maybe not complete"),A=m+1+g.length);var w=v.localNSMap,P=v.tagName==g,C=P||v.tagName&&v.tagName.toLowerCase()==g.toLowerCase();if(C){if(s.endElement(v.uri,v.localName,g),w)for(var T in w)Object.prototype.hasOwnProperty.call(w,T)&&s.endPrefixMapping(T);P||r.fatalError("end tag name: "+g+" is not match the current start tagName:"+v.tagName)}else f.push(v);A++;break;case"?":d&&h(m),A=jp(e,m,s);break;case"!":d&&h(m),A=zp(e,m,s,r);break;default:d&&h(m);var M=new oc,k=f[f.length-1].currentNSMap,A=Hp(e,m,M,k,a,r),O=M.length;if(!M.closed&&Vp(e,A,M.tagName,p)&&(M.closed=!0,i.nbsp||r.warning("unclosed xml attribute")),d&&O){for(var E=rc(d,{}),b=0;b<O;b++){var V=M[b];h(V.offset),V.locator=rc(d,{})}s.locator=E,nc(M,s,k)&&f.push(M),s.locator=d}else nc(M,s,k)&&f.push(M);ds.isHTML(M.uri)&&!M.closed?A=Xp(e,A,M.tagName,a,s):A++}}catch(L){if(L instanceof xi)throw L;r.error("element parse error: "+L),A=-1}A>_?_=A:o(Math.max(m,_)+1)}}function rc(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function Hp(e,t,i,s,r,n){function a(f,p,_){i.attributeNames.hasOwnProperty(f)&&n.fatalError("Attribute "+f+" redefined"),i.addValue(f,p.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,r),_)}for(var o,h,l=++t,c=fs;;){var u=e.charAt(l);switch(u){case"=":if(c===Ne)o=e.slice(t,l),c=ps;else if(c===mi)c=ps;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(c===ps||c===Ne)if(c===Ne&&(n.warning('attribute value must after "="'),o=e.slice(t,l)),t=l+1,l=e.indexOf(u,t),l>0)h=e.slice(t,l),a(o,h,t-1),c=gi;else throw new Error("attribute value no end '"+u+"' match");else if(c==_i)h=e.slice(t,l),a(o,h,t),n.warning('attribute "'+o+'" missed start quot('+u+")!!"),t=l+1,c=gi;else throw new Error('attribute value must after "="');break;case"/":switch(c){case fs:i.setTagName(e.slice(t,l));case gi:case ms:case wr:c=wr,i.closed=!0;case _i:case Ne:case mi:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return n.error("unexpected end of input"),c==fs&&i.setTagName(e.slice(t,l)),l;case">":switch(c){case fs:i.setTagName(e.slice(t,l));case gi:case ms:case wr:break;case _i:case Ne:h=e.slice(t,l),h.slice(-1)==="/"&&(i.closed=!0,h=h.slice(0,-1));case mi:c===mi&&(h=o),c==_i?(n.warning('attribute "'+h+'" missed quot(")!'),a(o,h,t)):((!ds.isHTML(s[""])||!h.match(/^(?:disabled|checked|selected)$/i))&&n.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),a(h,h,t));break;case ps:throw new Error("attribute value missed!!")}return l;case"\x80":u=" ";default:if(u<=" ")switch(c){case fs:i.setTagName(e.slice(t,l)),c=ms;break;case Ne:o=e.slice(t,l),c=mi;break;case _i:var h=e.slice(t,l);n.warning('attribute "'+h+'" missed quot(")!!'),a(o,h,t);case gi:c=ms;break}else switch(c){case mi:var d=i.tagName;(!ds.isHTML(s[""])||!o.match(/^(?:disabled|checked|selected)$/i))&&n.warning('attribute "'+o+'" missed value!! "'+o+'" instead2!!'),a(o,o,t),t=l,c=Ne;break;case gi:n.warning('attribute space is required"'+o+'"!!');case ms:c=Ne,t=l;break;case ps:c=_i,t=l;break;case wr:throw new Error("elements closed character '/' and '>' must be connected to")}}l++}}function nc(e,t,i){for(var s=e.tagName,r=null,u=e.length;u--;){var n=e[u],a=n.qName,o=n.value,d=a.indexOf(":");if(d>0)var h=n.prefix=a.slice(0,d),l=a.slice(d+1),c=h==="xmlns"&&l;else l=a,h=null,c=a==="xmlns"&&"";n.localName=l,c!==!1&&(r==null&&(r={},ac(i,i={})),i[c]=r[c]=o,n.uri=ds.XMLNS,t.startPrefixMapping(c,o))}for(var u=e.length;u--;){n=e[u];var h=n.prefix;h&&(h==="xml"&&(n.uri=ds.XML),h!=="xmlns"&&(n.uri=i[h||""]))}var d=s.indexOf(":");d>0?(h=e.prefix=s.slice(0,d),l=e.localName=s.slice(d+1)):(h=null,l=e.localName=s);var f=e.uri=i[h||""];if(t.startElement(f,l,s,e),e.closed){if(t.endElement(f,l,s),r)for(h in r)Object.prototype.hasOwnProperty.call(r,h)&&t.endPrefixMapping(h)}else return e.currentNSMap=i,e.localNSMap=r,!0}function Xp(e,t,i,s,r){if(/^(?:script|textarea)$/i.test(i)){var n=e.indexOf("</"+i+">",t),a=e.substring(t+1,n);if(/[&<]/.test(a))return/^script$/i.test(i)?(r.characters(a,0,a.length),n):(a=a.replace(/&#?\w+;/g,s),r.characters(a,0,a.length),n)}return t+1}function Vp(e,t,i,s){var r=s[i];return r==null&&(r=e.lastIndexOf("</"+i+">"),r<t&&(r=e.lastIndexOf("</"+i)),s[i]=r),r<t}function ac(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}function zp(e,t,i,s){var r=e.charAt(t+2);switch(r){case"-":if(e.charAt(t+3)==="-"){var n=e.indexOf("-->",t+4);return n>t?(i.comment(e,t+4,n-t-4),n+3):(s.error("Unclosed comment"),-1)}else return-1;default:if(e.substr(t+3,6)=="CDATA["){var n=e.indexOf("]]>",t+9);return i.startCDATA(),i.characters(e,t+9,n-t-9),i.endCDATA(),n+3}var a=Wp(e,t),o=a.length;if(o>1&&/!doctype/i.test(a[0][0])){var h=a[1][0],l=!1,c=!1;o>3&&(/^public$/i.test(a[2][0])?(l=a[3][0],c=o>4&&a[4][0]):/^system$/i.test(a[2][0])&&(c=a[3][0]));var u=a[o-1];return i.startDTD(h,l,c),i.endDTD(),u.index+u[0].length}}return-1}function jp(e,t,i){var s=e.indexOf("?>",t);if(s){var r=e.substring(t,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(r){var n=r[0].length;return i.processingInstruction(r[1],r[2]),s+2}else return-1}return-1}function oc(){this.attributeNames={}}oc.prototype={setTagName:function(e){if(!ic.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},addValue:function(e,t,i){if(!ic.test(e))throw new Error("invalid attribute:"+e);this.attributeNames[e]=this.length,this[this.length++]={qName:e,value:t,offset:i}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}};function Wp(e,t){var i,s=[],r=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(r.lastIndex=t,r.exec(e);i=r.exec(e);)if(s.push(i),i[1])return s}var $p=sc,Yp=xi,hc={XMLReader:$p,ParseError:Yp},qp=Ra.DOMImplementation,lc=as.NAMESPACE,Zp=hc.ParseError,Kp=hc.XMLReader;function cc(e){return e.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function uc(e){this.options=e||{locator:{}}}uc.prototype.parseFromString=function(e,t){var i=this.options,s=new Kp,r=i.domBuilder||new _s,n=i.errorHandler,a=i.locator,o=i.xmlns||{},h=/\/x?html?$/.test(t),l=h?tc.HTML_ENTITIES:tc.XML_ENTITIES;a&&r.setDocumentLocator(a),s.errorHandler=Qp(n,r,a),s.domBuilder=i.domBuilder||r,h&&(o[""]=lc.HTML),o.xml=o.xml||lc.XML;var c=i.normalizeLineEndings||cc;return e&&typeof e=="string"?s.parse(c(e),o,l):s.errorHandler.error("invalid doc source"),r.doc};function Qp(e,t,i){if(!e){if(t instanceof _s)return t;e=t}var s={},r=e instanceof Function;i=i||{};function n(a){var o=e[a];!o&&r&&(o=e.length==2?function(h){e(a,h)}:e),s[a]=o&&function(h){o("[xmldom "+a+"]	"+h+Ma(i))}||function(){}}return n("warning"),n("error"),n("fatalError"),s}function _s(){this.cdata=!1}function vi(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}_s.prototype={startDocument:function(){this.doc=new qp().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,i,s){var r=this.doc,n=r.createElementNS(e,i||t),a=s.length;Ar(this,n),this.currentElement=n,this.locator&&vi(this.locator,n);for(var o=0;o<a;o++){var e=s.getURI(o),h=s.getValue(o),i=s.getQName(o),l=r.createAttributeNS(e,i);this.locator&&vi(s.getLocator(o),l),l.value=l.nodeValue=h,n.setAttributeNode(l)}},endElement:function(e,t,i){var s=this.currentElement,r=s.tagName;this.currentElement=s.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var i=this.doc.createProcessingInstruction(e,t);this.locator&&vi(this.locator,i),Ar(this,i)},ignorableWhitespace:function(e,t,i){},characters:function(e,t,i){if(e=dc.apply(this,arguments),e){if(this.cdata)var s=this.doc.createCDATASection(e);else var s=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(s):/^\s*$/.test(e)&&this.doc.appendChild(s),this.locator&&vi(this.locator,s)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,i){e=dc.apply(this,arguments);var s=this.doc.createComment(e);this.locator&&vi(this.locator,s),Ar(this,s)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,i){var s=this.doc.implementation;if(s&&s.createDocumentType){var r=s.createDocumentType(e,t,i);this.locator&&vi(this.locator,r),Ar(this,r),this.doc.doctype=r}},warning:function(e){console.warn("[xmldom warning]	"+e,Ma(this.locator))},error:function(e){console.error("[xmldom error]	"+e,Ma(this.locator))},fatalError:function(e){throw new Zp(e,this.locator)}};function Ma(e){if(e)return`
@`+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function dc(e,t,i){return typeof e=="string"?e.substr(t,i):e.length>=t+i||t?new java.lang.String(e,t,i)+"":e}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){_s.prototype[e]=function(){return null}});function Ar(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}var Jp=_s,tm=cc,em=uc,im={__DOMHandler:Jp,normalizeLineEndings:tm,DOMParser:em},sm=Ra.DOMImplementation,rm=Ra.XMLSerializer,fc=im.DOMParser,Am={DOMImplementation:sm,XMLSerializer:rm,DOMParser:fc};const pc={createCanvas:(e,t)=>new OffscreenCanvas(e!=null?e:0,t!=null?t:0),getCanvasRenderingContext2D:()=>OffscreenCanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>globalThis.location.href,getFontFaceSet:()=>globalThis.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new fc().parseFromString(e,"text/xml")};N.ADAPTER=pc;export{Ut as ALPHA_MODES,Vn as AbstractMultiResource,xh as AlphaFilter,Pr as AnimatedSprite,qn as Application,ph as ArrayResource,Wi as Assets,Bh as AssetsClass,gs as Attribute,H as BLEND_MODES,Es as BUFFER_BITS,qt as BUFFER_TYPE,Oi as BackgroundSystem,_e as BaseImageResource,es as BasePrepare,pn as BaseRenderTexture,z as BaseTexture,ks as BatchDrawCall,cn as BatchGeometry,Xt as BatchRenderer,Wo as BatchShaderGenerator,fn as BatchSystem,js as BatchTextureArray,Ct as BitmapFont,rs as BitmapFontData,wl as BitmapText,Vh as BlobResource,vh as BlurFilter,ir as BlurFilterPass,Hi as Bounds,Fa as BrowserAdapter,nt as Buffer,ii as BufferResource,Gn as BufferSystem,Yt as CLEAR_MODES,Oa as COLOR_MASK_BITS,hi as Cache,mh as CanvasResource,Sr as Circle,$ as Color,sr as ColorMatrixFilter,Be as CompressedTextureResource,Rt as Container,Fi as ContextSystem,dl as CountLimiter,zn as CubeResource,Do as DEG_TO_RAD,Wt as DRAW_MODES,yh as DisplacementFilter,at as DisplayObject,Ee as ENV,Cr as Ellipse,D as ExtensionType,ia as Extract,R as FORMATS,$h as FORMATS_TO_COMPONENTS,bh as FXAAFilter,vs as FillStyle,xt as Filter,Zo as FilterState,yn as FilterSystem,Ws as Framebuffer,bn as FramebufferSystem,As as GC_MODES,Ko as GLFramebuffer,rh as GLProgram,Js as GLTexture,Pf as GRAPHICS_CURVES,In as GenerateTextureSystem,Te as Geometry,En as GeometrySystem,Ki as Graphics,xs as GraphicsData,oa as GraphicsGeometry,ad as IGLUniformData,Us as INSTALLED,It as INTERNAL_FORMATS,$i as INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,qe as ImageBitmapResource,mn as ImageResource,Re as LINE_CAP,zt as LINE_JOIN,Nr as LineStyle,Qt as LoaderParserPriority,ut as MASK_TYPES,$t as MIPMAP_MODES,ot as MSAA_QUALITY,th as MaskData,wn as MaskSystem,tt as Matrix,We as Mesh,nl as MeshBatchUvs,Qi as MeshGeometry,ui as MeshMaterial,kn as MultisampleSystem,Uf as NineSlicePlane,Th as NoiseFilter,Di as ObjectRenderer,Hn as ObjectRendererSystem,be as ObservablePoint,Mi as PI_2,Bt as PRECISION,Hf as ParticleContainer,ca as ParticleRenderer,hl as PlaneGeometry,Cn as PluginSystem,J as Point,Ye as Polygon,pa as Prepare,Ht as Program,Rn as ProjectionSystem,qo as Quad,xn as QuadUv,Po as RAD_TO_DEG,Br as RENDERER_TYPE,W as Rectangle,Pe as RenderTexture,gn as RenderTexturePool,Mn as RenderTextureSystem,ze as Renderer,Zn as ResizePlugin,ei as Resource,ll as RopeGeometry,Rr as RoundedRectangle,Ft as Runner,ws as SAMPLER_TYPES,ne as SCALE_MODES,gt as SHAPES,ai as SVGResource,An as ScissorSystem,ie as Shader,Nn as ShaderSystem,kf as SimpleMesh,cl as SimplePlane,Gf as SimpleRope,De as Sprite,Jo as SpriteMaskFilter,pr as Spritesheet,Ui as StartupSystem,de as State,Dn as StateSystem,Sn as StencilSystem,ch as SystemManager,Oe as TARGETS,Ji as TEXT_GRADIENT,G as TYPES,ea as TYPES_TO_BYTES_PER_COMPONENT,Yh as TYPES_TO_BYTES_PER_PIXEL,_h as TemporaryDisplayObject,dr as Text,ns as TextFormat,vt as TextMetrics,Me as TextStyle,B as Texture,Vt as TextureGCSystem,qs as TextureMatrix,Bn as TextureSystem,_n as TextureUvs,ft as Ticker,Ln as TickerPlugin,Na as TilingSprite,ma as TilingSpriteRenderer,ip as TimeLimiter,Ni as Transform,Ed as TransformFeedback,On as TransformFeedbackSystem,Se as UPDATE_PRIORITY,jt as UniformGroup,wd as VERSION,er as VideoResource,ki as ViewSystem,Ls as ViewableBuffer,ae as WRAP_MODES,pc as WebWorkerAdapter,mr as XMLFormat,_r as XMLStringFormat,xl as autoDetectFormat,dh as autoDetectRenderer,ln as autoDetectResource,Oh as cacheTextureArray,oi as checkDataUrl,Ce as checkExtension,Mo as checkMaxIfStatementsInShader,le as convertToList,rr as copySearchParams,Ah as createStringVariations,zi as createTexture,oh as createUBOElements,Ie as curves,Un as defaultFilterVertex,fh as defaultVertex,Fh as detectAvif,Xh as detectCompressedTextures,kh as detectDefaults,Lh as detectWebp,U as extensions,$n as filters,nh as generateProgram,lh as generateUniformBufferSync,Rh as getFontFamilyName,ko as getTestContext,hh as getUBOData,Of as graphicsUtils,it as groupD8,we as isMobile,Vi as isSingleItem,Al as loadBitmapFont,Zh as loadDDS,Ph as loadImageBitmap,Sh as loadJson,Kh as loadKTX,Dh as loadSVG,ji as loadTextures,Ch as loadTxt,Ih as loadWebFont,jh as parseDDS,qh as parseKTX,Qh as resolveCompressedTextureUrl,Gh as resolveTextureUrl,N as settings,gl as spritesheetAsset,Xe as uniformParsers,jo as unsafeEvalSupported,Iu as utils};
//# sourceMappingURL=webworker.min.mjs.map
