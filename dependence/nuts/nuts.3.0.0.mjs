let app={},socketio=null;function init$i(e){socketio=e.io}class Network{constructor(e,t=""){let n={event:e&&e.event,socket:null,cmdList:e&&e.commandList,isConnect:!1,host:e&&e.host,roomName:t};this.isConnect=()=>n.isConnect,this.setHost=e=>n.host=e,this.setCommandList=e=>n.cmdList=e,this.registerCommand=(e,t)=>{let r=n.socket;r&&r.on(e,t)},this.sendCommand=(e,t)=>{let r=n.socket;r&&r.compress(!0).emit(e,t)},this.setEvent=e=>{n.event=e},this.connect=e=>{let t,r=n.cmdList;if(n.socket)return!1;t=socketio(n.host+n.roomName,{transports:["websocket"]});let a={};if(e?(n.event=e,a.connect=e.connect,a.disconnect=e.disconnect):n.event&&(a.connect=n.event.connect,a.disconnect=n.event.disconnect),n.socket=t,t.on("connect",(()=>{n.isConnect=!0,a.connect&&(a.connect(),a.connect=null)})),t.on("disconnect",(()=>{n.isConnect=!1,a.disconnect&&(a.disconnect(),a.disconnect=null)})),r){Object.getOwnPropertyNames(r).forEach((e=>{t.on(e,r[e])}))}return!0},this.disconnect=()=>{let e=n.socket;e&&e.disconnect()}}}var client=Object.freeze({__proto__:null,Network:Network,init:init$i});let CMD$1,RESULT$1,STATE$1;class CommandList{static init(e){CMD$1=e.CMD,RESULT$1=e.RESULT,STATE$1=e.STATE}static create(e){let t,n=e.lobbyBuffer,r=e.gameBuffer,a=null,s={cmdList:null,gameProc:null,setEventMap(e){a=e}};t=(e=>{let t={},i=e.gameEvent;return t.checkData=(e,t,n,r)=>{let a=STATE$1.OK;return t.resultCode!==RESULT$1.OK?(a=STATE$1.ERROR,r&&r.error&&r.error(t)):r&&r.handle&&r.handle(t),a},t.gameProc=e=>{let t=i[e.gid];t&&t.recvGameData&&t.recvGameData(e.packet)},t.broadcastProc=e=>{Object.getOwnPropertyNames(i).forEach((t=>{let n=i[t];n&&n.recvBroadcast&&n.recvBroadcast(e)}))},s.gameProc=t.gameProc,{connect(e){let t=a&&a.connect;t&&t.handle&&t.handle(e)},reconnect(e){let t=a&&a.reconnect;t&&t.handle&&t.handle(e)},login(r){let s=a&&a.login;t.checkData(CMD$1.LOGIN,r,n,s)&&(e.connectionToken=r.connectionToken)},relogin(r){let s=a&&a.relogin;t.checkData(CMD$1.RELOGIN,r,n,s)&&(e.connectionToken=r.connectionToken)},inGame(e){let r=a&&a.inGame;t.checkData(CMD$1.IN_GAME,e,n,r)},exitGame(e){let r=a&&a.exitGame;t.checkData(CMD$1.EXIT_GAME,e,n,r)},toGame(e){let n=a&&a.toGame;t.checkData(CMD$1.TO_GAME,e,r,n),t.gameProc(e)},broadCastMsg(e){let n=a&&a.broadcast;n&&n.handle&&n.handle(e),t.broadcastProc(e)},ping(e){let t=a&&a.ping;t&&t.handle&&t.handle(e)},pong(e){let t=a&&a.pong;t&&t.handle&&t.handle(e)},disconnectMsg(e){let t=a&&a.disconnectMsg;t&&t.handle&&t.handle(e)},disconnect(e){let t=a&&a.disconnect;t&&t.handle&&t.handle(e)}}})(e),s.cmdList=t,e.commandManager=s}}let Ticker=null,objList=[],onceList=[],updateOnce=!1;function add(e){let t=!1;return e&&e.update&&(Object.prototype.hasOwnProperty.call(e,"__updateIndex")||(e.__updateIndex=objList.length,objList.push(e),t=!0)),t}function remove(e){let t,n,r=objList.length;if("number"==typeof e.__updateIndex){if(t=e.__updateIndex,t>=0&&t<r){let e=r-1;n=objList[e],objList[t]=n,n.__updateIndex=t,objList.splice(e,1)}delete e.__updateIndex}}function setTimeout(e,t){let n={currentTime:0,func:e,update:e=>{n.currentTime>=t&&(remove(n),n.func&&n.func(n.currentTime)),n.currentTime+=e}};return add(n),n}function idle(e){return new Promise((t=>{setTimeout((function(){t()}),e)}))}function setInterval(e,t){let n={currentTime:0,func:e,update:e=>{n.currentTime+=e,n.currentTime>=t&&(n.func&&n.func(n.currentTime),n.currentTime=0)}};return add(n),n}function clearInterval(e){remove(e)}function once(e){e&&e.update&&(onceList.push(e),updateOnce=!0)}function reset(){objList.forEach((e=>{delete e.__updateIndex})),objList=[]}function update(e){updateOnce&&(onceList.forEach((t=>{t.update(e),t.pause&&t.pause()})),onceList=[],updateOnce=!1),objList.forEach((t=>{t.update(e)}))}let lastTime=-1,isPlay=!1,isInit$2=!1;function refresh$1(){let e,t=.001*performance.now();isPlay&&(lastTime<0?(e=0,lastTime=t):(e=t-lastTime,lastTime=t),update(e))}function init$h(){isInit$2||(isInit$2=!0,Ticker=app.Ticker,Ticker&&(Ticker.timingMode=Ticker.TIMEOUT,Ticker.interval=1e3/60,Ticker.addEventListener("tick",refresh$1)),reset())}function play(){isPlay||(isPlay=!0,lastTime=-1)}function pause(){isPlay&&(isPlay=!1)}var updateManager=Object.freeze({__proto__:null,add:add,clearInterval:clearInterval,idle:idle,init:init$h,once:once,pause:pause,play:play,refresh:refresh$1,remove:remove,reset:reset,setInterval:setInterval,setTimeout:setTimeout});const ERROR="error",CONNECT="connect",RECONNECT="reconnect",LOGIN="login",RELOGIN="relogin",IN_GAME="inGame",EXIT_GAME="exitGame",TO_GAME="toGame",BROADCAST="broadCastMsg",DISCONNECT="disconnect",DISCONNECT_MSG="disconnectMsg",CMD={ERROR:ERROR,CONNECT:CONNECT,RECONNECT:RECONNECT,LOGIN:LOGIN,RELOGIN:RELOGIN,IN_GAME:IN_GAME,EXIT_GAME:EXIT_GAME,TO_GAME:TO_GAME,BROADCAST:BROADCAST,DISCONNECT_MSG:DISCONNECT_MSG,DISCONNECT:DISCONNECT},RESULT={ERROR:0,OK:1},STATE={SEND_LOCK:-3,CONNECT_TIMEOUT:-2,BUFFER_FULL:-1,ERROR:0,OK:1,LOGIN:3,ROOM:4,CONNECT:2};class Lobby extends Network{constructor(e,t){let n={gameEvent:{},sendEvent:{},commandManager:null,connectionToken:null,timer:null,login:null,game:{configMap:{},template:null},lobbyBuffer:{sendCommandList:[],token:null},gameBuffer:{sendCommandList:[],token:null}};super(e,t);let r=this;CommandList.init({CMD:CMD,RESULT:RESULT,STATE:STATE}),n.timer||(n.timer=setInterval((function(){let e,t=n.lobbyBuffer,a=n.gameBuffer,s=t.sendCommandList;s.length>0&&(e=s.shift(),r.sendLobbyCommand(e)),s=a.sendCommandList,s.length>0&&(e=s.shift(),r.sendGameCommand(e))}),.1)),this.init=()=>{CommandList.create(n),r.setCommandList(n.commandManager.cmdList)},this.getGame=()=>n.game,this.getCommandManager=()=>n.commandManager,this.gameProc=e=>{n.commandManager&&n.commandManager.gameProc(e)},this.setEventMap=e=>{n.commandManager&&n.commandManager.setEventMap(e)},this.setSendEvent=e=>{n.sendEvent.game=e.game},this.login=e=>{let t=e;r.sendCommand(LOGIN,t)},this.relogin=()=>{let e={connectionToken:n.connectionToken};r.sendCommand(RELOGIN,e)},this.registerGameEvent=(e,t)=>{t&&(n.gameEvent[t]=e)},this.unregisterGameEvent=e=>{n.gameEvent[e]=null},this.setLobbyCommand=(e,t)=>(n.lobbyBuffer.sendCommandList.push({name:e,data:t}),STATE.OK),this.sendLobbyCommand=e=>{r.sendCommand(e.name,e.data)},this.setGameCommand=(e,t)=>(n.gameBuffer.sendCommandList.push({gid:t,packet:e}),STATE.OK),this.sendGameCommand=e=>{let t=e.packet;"object"==typeof t.data&&(t.data=JSON.stringify(t.data));let a={gid:e.gid,packet:e.packet};r.sendCommand(TO_GAME,a),n.sendEvent.game&&n.sendEvent.game(e.gid)}}static get STATE(){return STATE}static get CMD(){return CMD}static get RESULT(){return RESULT}}function debug(e,t){let n=e.getBounds(),r=e.graphics;if(!r){let a=e.anchor;r=new t.Graphics,e.graphics=r,e.addChild(r),r.x=0,r.y=0,r.lineStyle(1,16777215,1),r.beginFill(65280,.15),r.drawRect(-n.width*a.x,-n.height*a.y,n.width,n.height),r.endFill()}}function getTextureGroup$1(e,t){let n=e;if(n){let r=t&&t.split(".");r&&r.every((e=>{let t=n[e];return t?(n=t,!0):(n=null,!1)})),n===e&&(n=null)}return n}function make(e){return class extends e{constructor(e){super(e,!1),this.cloneIndex=0}clone(){this.cloneIndex+=1}addToScene(e){e.addChild(this)}removeFromScene(){this.parent&&this.parent.removeChild(this)}reload(){let e=this,t=e._game.textures,n=e.conf.resource,r=getTextureGroup$1(t,n.group);r&&(e.texture=r[n.name]||PIXI.Texture.EMPTY)}}}class BaseOld{constructor(){this.cloneIndex=0}clone(){this.cloneIndex+=1}addToScene(e){e.addChild(this)}removeFromScene(){let e=this;e.parent&&e.parent.removeChild(e)}}var base$1=Object.freeze({__proto__:null,debug:debug,default:BaseOld,getTextureGroup:getTextureGroup$1,make:make});const TYPE$9="animation";let Animation=null;function init$g(){let e=app.PIXI,t=null;t=e.AnimatedSprite?e.AnimatedSprite:e.extras.AnimatedSprite,Animation=class extends(make(t)){static get TYPE(){return TYPE$9}constructor(t){super(t.textures||[e.Texture.EMPTY],!1);let n=this;n._game=t.game,n.conf=t.conf,n.type=TYPE$9,n.name=t.name,n.objName=t.objName||null,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.loop=t.loop,"number"==typeof t.speed&&(n.animationSpeed=t.speed)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,loop:this.loop,speed:this.animationSpeed,pos:this.position,anchor:this.anchor,textures:this.textures};return new Animation(t)}removeFromScene(){super.removeFromScene(),this._game&&this._game.removeUpdate(this)}addToScene(e){e.addChild(this),this.playing&&this._game&&this._game.addUpdate(this)}play(){this._game&&this._game.addUpdate(this),super.play()}stop(){this._game&&this._game.removeUpdate(this),super.stop()}update(e){super.update(60*e)}reload(){let t=this._game.textures,n=this.conf,r=this.conf.resource,a=getTextureGroup$1(t,r.group);a&&(this.textures=a[r.name]||[e.Texture.EMPTY]),n.loop&&this.play()}}}const TYPE$8="button";let Button=null;function init$f(){let e=app.PIXI;Button=class extends(make(e.Sprite)){static get TYPE(){return TYPE$8}constructor(t){super(t.texture&&t.texture.leave||e.Texture.EMPTY);let n=this;n._game=t.game,n.type=TYPE$8,n.conf=t.conf,n.objName=t.objName||null,n.name=t.name,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.scale.x=1,n.buttonMode=!0,n.interactive=!0;let r={};n.custom=r,r.texture=t.texture||{enter:e.Texture.EMPTY,leave:e.Texture.EMPTY,press:e.Texture.EMPTY,disable:e.Texture.EMPTY},r.isPress=!1,r.flagDrag=!1,r.canMove=!1,r.timer=null,r.obj=null,n.touchstart=n.mousedown=e=>{r.flagDrag&&r.timer&&(n.dragEvent&&(n.dragEvent.curTimes=n.dragEvent.times,n.dragEvent.reset&&n.dragEvent.reset()),r.timer.restart()),n.eventPress(e)},n.touchend=n.mouseup=e=>{r.canMove=!1,r.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventRelease(e)},n.mouseover=e=>{r.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventEnter(e)},n.mouseout=e=>{r.canMove=!1,r.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventLeave(e)},n.touchendoutside=n.mouseupoutside=e=>{r.flagDrag&&n.dragEvent&&n.dragEvent.reset&&n.dragEvent.reset(),n.eventLeave(e)}}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,texture:this.custom.texture};return new Button(t)}setTextures(t){let n=this.custom.texture;t&&(n.enter=t.enter||e.Texture.EMPTY,n.leave=t.leave||e.Texture.EMPTY,n.press=t.press||e.Texture.EMPTY,n.disable=t.disable||e.Texture.EMPTY),this.update()}setTexture(e){this.setTextures(e)}setClick(e,t){this.eventClick=e,this.obj=t}eventPress(){let e=this,t=e.custom.texture;e.texture=t.press,e.custom.isPress=!0}eventRelease(){let e=this,t=e.custom.texture;e.custom.isPress?(e.texture=t.leave,"function"==typeof e.eventClick&&e.eventClick(e,e.obj)):e.texture=t.leave,e.custom.isPress=!1}eventEnter(){let e=this,t=e.custom.texture;e.custom.isPress?e.texture=t.press:e.texture=t.enter}eventLeave(){let e=this,t=e.custom.texture;e.texture=t.leave,e.custom.isPress=!1}setDragEnable(e){let t=this,n=t.custom;n.flagDrag=!0,t.mousemove=t.touchmove=e=>{if(n.canMove){n.isPress=!1;let r={x:parseInt(e.data.global.x),y:parseInt(e.data.global.y)};t.x=r.x,t.y=r.y}},t.dragEvent=e,t.dragEvent||(t.dragEvent={},t.dragEvent.times=10),t.dragEvent.curTimes=t.dragEvent.times}setDragDisable(){let e=this;e.custom.flagDrag=!1,e.mousemove=e.touchmove=null}setEnable(e,t){e?this.enable(t):this.disable(t)}enable(e){this.interactive=!0;let t=this.custom.texture;e&&(this.texture=t.leave)}isEnabled(){return this.interactive}disable(e){this.interactive=!1;let t=this.custom.texture;e&&(this.texture=t.disable)}update(){let e=this.custom.texture;this.interactive?this.texture=e.leave:this.texture=e.disable}reload(){let e=this._game.textures,t=this.conf.resource,n=getTextureGroup$1(e,t.group);n&&this.setTextures(n[t.name])}}}const TYPE$7="group";let Group=null;function init$e(e){let t=app.PIXI,n=e.sceneManager;Group=class extends(make(t.Container)){static get TYPE(){return TYPE$7}constructor(e){super();let t=this;t._game=e.game,t.conf=e.conf,t.type=TYPE$7,t.name=e.name,t.objName=e.objName||null,t.isInScene=e.isInScene,t.childList=[],e.pos&&(t.x=e.pos.x||0,t.y=e.pos.y||0),e.pivot&&(t.pivot.x=e.pivot.x||0,t.pivot.y=e.pivot.y||0)}clone(e){super.clone();let t=null;this.conf&&this.conf.childList&&(t=this.conf.childList);let r={game:e||this._game,childList:t,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pivot:this.pivot,pos:this.position};return n.createGroup(r,this._game)}removeFromScene(){super.removeFromScene(),this.stop()}stop(){this.childList.forEach((e=>{e.stop&&e.stop()}))}reload(){this.childList.forEach((e=>{e.reload&&e.reload()}))}}}const TYPE$6="image";let Image=null;function init$d(){let e=app.PIXI;Image=class extends(make(e.Sprite)){static get TYPE(){return TYPE$6}constructor(t){super(t.texture||e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=TYPE$6,n.name=t.name,n.objName=t.objName,n.isInScene=t.isInScene,t.pos&&(n.x=t.pos.x,n.y=t.pos.y),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,alpha:this.alpha,texture:this.texture};return new Image(t)}}}const TYPE$5="spine";let Spine=null;function init$c(){let e=app.PIXI;Spine=class extends(make(e.Container)){static get TYPE(){return TYPE$5}static getChild(e,t){let n=null,r=e.spineData.slots,a=-1;return r.some(((e,n)=>e.name===t&&(a=n,!0))),a>=0&&(n=e.children[a],n&&n.children[0]&&(n=n.children[0])),n}static getRect(t,n){let r=t.getBounds();if(n){let n=new e.Graphics;t.addChild(n),n.x=0,n.y=0,n.lineStyle(1,255,.75),n.beginFill(65291,.15),n.drawRect(.5*-r.width,.5*-r.height,r.width,r.height),n.endFill(),n.lineStyle(1,0),n.moveTo(0,0),n.lineTo(r.width,r.height),n.moveTo(r.width,0),n.lineTo(0,r.height)}return r}constructor(t){super();let n=this,r=t.spineDataGroup,a=t.textureGroup;n._game=t.game,n.conf=t.conf,n.type=TYPE$5,n.name=t.name,n.objName=t.objName||null,n.isInScene=t.isInScene;let s={};n.custom=s,s.childList=[],s.spineAnimList=[],s.group={},s.spineDataGroup=r,s.textureGroup=a,s.configList=t.configList||t.conf&&t.conf.configList,t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),s.configList.forEach(((t,n)=>{let a,i,o,l;if(i=new e.Sprite(e.Texture.EMPTY),a=new app.spine.Spine(r[t.dataName]),o={x:0,y:0},l=a.getLocalBounds(),a.skeleton.setToSetupPose(),a.autoUpdate=!1,a.state.timeScale=0,a.x=.01,a.y=.01,a.childMap={},a.getChild=e=>a.childMap[e],a.spineData.slots.forEach(((e,t)=>{let n=a.children[t];n&&n.children&&(n=n.children[0],a.childMap[e.name]=n)})),i.name=t.name,i.addChild(a),s.childList[n]=i,t.anchor&&(a.x=-a.width*t.anchor.x+.01,a.y=-a.height*t.anchor.y+.01),o.x=l.x,o.y=l.y,t.fixPosition){let e=t.fixPosition,n=e.offset||{x:0,y:0},r=null;e.childName&&(r=a.getChild(e.childName)),r||(r=a.children[e.childIndex||0].children[0]),l=r.getBounds(),a.x=-l.x+.5*-l.width,a.y=-l.y+.5*-l.height,o.x=a.x+l.x,o.y=a.y+l.y,a.x=a.x+n.x,a.y=a.y+n.y}if(t.debug){let t=new e.Graphics;i.addChild(t),t.x=0,t.y=0,t.lineStyle(1,16711680,.9),t.beginFill(16740363,.1),t.drawRect(a.x+l.x,a.y+l.y,l.width,l.height),t.endFill(),t.lineStyle(0),t.beginFill(0,1),t.drawCircle(o.x,o.y,3),t.endFill(),t.beginFill(16777215,1),t.drawCircle(o.x,o.y,1),t.endFill(),a.children.forEach((t=>{let n=t.children[0];if(n&&n.getBounds||(n=t),n&&n.getBounds){let t=n.getBounds(),r=new e.Graphics;n.addChild(r),r.x=0,r.y=0,r.lineStyle(1,65280,.75),r.beginFill(786288,.15),r.drawRect(.5*-t.width,.5*-t.height,t.width,t.height),r.endFill(),r.lineStyle(0),r.beginFill(0,1),r.drawCircle(0,0,3),r.endFill(),r.beginFill(16777215,1),r.drawCircle(0,0,1),r.endFill()}}))}t.name&&(s.group[t.name]={sprite:i,spine:a,entry:null,animConfig:{animationName:t.animationName,timeScale:t.timeScale,loop:t.loop}}),s.spineAnimList.push(a)})),s.configList.forEach((t=>{let n=s.group[t.name].spine;if(n&&t.mask){let r=e.Texture.EMPTY;a&&(r=a[t.mask.name]||e.Texture.EMPTY);let i=new e.Sprite(r),o=n;if(n.mask=i,t.mask.follow&&(o=s.group[t.mask.follow]),o){let e=o.getLocalBounds();t.mask.local?(i.x=e.x,i.y=e.y):(i.x=0,i.y=0),o.addChild(i)}let l=t.mask.fixPosition;if(l&&o){let e,t=l.offset||{x:0,y:0};l.childName&&(e=o.getChild(l.childName)),e||(e=o.children[l.childIndex||0].children[0]);let n=e.getBounds(),r=o.getBounds(),a=o.getLocalBounds();i.x=a.x+(n.x-r.x)+t.y,i.y=a.y+(n.y-r.y)+t.y}if(t.mask.debug){let t=new e.Graphics,n={x:0,y:0};o&&(n.x=o.x,n.y=o.y,o.parent.addChild(t)),t.x=n.x+i.x,t.y=n.y+i.y,t.lineStyle(1,255,.75),t.beginFill(16740363,.15),t.drawRect(0,0,i.width,i.height),t.endFill(),t.lineStyle(1,0),t.moveTo(0,0),t.lineTo(i.width,i.height),t.moveTo(i.width,0),t.lineTo(0,i.height)}}n&&t.maskList&&t.maskList.forEach((t=>{let r,s,i=e.Texture.EMPTY;a&&(i=a[t.name]||e.Texture.EMPTY);let o=new e.Sprite(i),l=null;t.followName&&(l=n.getChild(t.followName)),l||(l=n.children[t.follow]&&n.children[t.follow].children[0]),r=l,l=null,t.targetName&&(l=n.getChild(t.targetName)),l||(l=n.children[t.target]&&n.children[t.target].children[0]),s=l,s&&(s.mask=o),r&&(o.x=-r.width/2,o.y=-r.height/2,r.addChild(o))}))}))}clone(e){super.clone();let t=this.custom,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,textureGroup:t.textureGroup,spineDataGroup:t.spineDataGroup,configList:t.configList,pos:this.position};return new Spine(n)}removeFromScene(){this.parent&&this.parent.removeChild(this),this._game.removeUpdate(this)}getGroup(e){return this.custom.group[e]}getSpine(e){let t,n=this.custom.group[e];return n&&(t=n.spine),t}getEntry(e){let t,n=this.custom.group[e];return n&&(t=n.entry),t}getAnimConfig(e){let t,n=this.custom.group[e];return n&&(t=n.animConfig),t}play(e){let t=this,n=t.custom,r=[];if(e&&Array.isArray(e))n.childList.forEach((e=>{t.removeChild(e)})),e.forEach((e=>{let a=n.group[e.name];if(a){let n=a.spine,s=a.sprite,i=a.animConfig;n&&(a.entry=n.state.setAnimation(0,e.animationName||i.animationName,e.loop),n.update(0),n.state.timeScale=e.timeScale||i.timeScale,r.push(n)),t.addChild(s)}}));else{Object.getOwnPropertyNames(n.group).forEach((e=>{let a=n.group[e];if(a){let e=a.spine,n=a.sprite,s=a.animConfig;e&&(a.entry=e.state.setAnimation(0,s.animationName,s.loop),e.update(0),e.state.timeScale=s.timeScale,r.push(e)),t.addChild(n)}}))}n.spineAnimList=r,t._game.addUpdate(t)}pause(){let e=this.custom;Object.getOwnPropertyNames(e.group).forEach((t=>{let n=e.group[t].spine;n&&(n.state.timeScale=0)}))}resume(){let e=this.custom;Object.getOwnPropertyNames(e.group).forEach((t=>{let n=e.group[t],r=n.spine,a=n.animConfig;r&&(r.state.timeScale=a.timeScale)}))}stop(e){let t=this,n=t.custom;if(e&&Array.isArray(e))e.forEach((e=>{let t=n.group[e.name],r=t.spine,a=t.animConfig;a.animationName=e.animationName||a.animationName,r&&(r.state.timeScale=0)}));else{Object.getOwnPropertyNames(n.group).forEach((e=>{let t=n.group[e].spine;t&&(t.state.timeScale=0)})),t._game.removeUpdate(t)}}update(e){this.custom.spineAnimList.forEach((t=>{t.update(e)}))}reload(){}}}const TYPE$4="bone";let factory=null,Bone=null;function init$b(){let e=app.PIXI;Bone=class extends(make(e.Sprite)){static get TYPE(){return TYPE$4}static setFactory(e){factory=e}static getFactory(){return factory}constructor(t){super(e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=TYPE$4,n.name=t.name,n.objName=t.objName||null,n.resource={},n.animation={timeScale:1},n.isInScene=t.isInScene,n.isUpdate=!1,t.animation&&(n.animation.name=t.animation.name,n.animation.timeScale=t.animation.timeScale),t.resource&&(n.resource.name=t.resource.name),t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),t.anchor&&(n.anchor.x=t.anchor.x||.5,n.anchor.y=t.anchor.y||.5);let r=factory&&factory.buildArmature(n.resource.name);if(r){let e=r.display;e.scale.set(1,1),n.addChild(e)}n.armature=r,n.state=null}clone(e){super.clone();let t=this.cloneIndex,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,resource:this.resource,animation:this.animation,name:this.name+".clone."+t,pos:this.sprite.position};return new Bone(n)}removeFromScene(){let e=this;e.parent&&e.parent.removeChild(e),e.stop()}play(e){let t=this.armature,n=this.animation;t&&(n.name=e||n.name,this.state=t.animation.play(n.name),this.state&&(this.state.timeScale=n.timeScale),this.isUpdate||(this.isUpdate=!0,this._game.addUpdate(this)))}stop(){this.armature&&this.isUpdate&&(this.isUpdate=!1,this._game.removeUpdate(this))}set timeScale(e){this.animation.timeScale=e,this.state&&(this.state.timeScale=e)}get timeScale(){return this.animation.timeScale}update(e){let t=this.armature;t&&t.advanceTime(e)}reload(){}}}const TYPE$3="digit",NUM={CHAR_MAP:["0","1","2","3","4","5","6","7","8","9","."],DISPLAY:{TRANSVERSE:1,STRAIGHT:2},ALIGN_TYPE:{POS:1,RECT:2},OFFSET_TYPE:{STATIC:1,DYNAMIC:2},HORI_ALIGN:{LEFT:1,CENTER:2,RIGHT:3},VERTI_ALIGN:{TOP:1,CENTER:2,BOTTOM:3}};let Digit=null;function init$a(){let e=app.PIXI;Digit=class extends(make(e.Sprite)){static get TYPE(){return TYPE$3}static get NUM(){return NUM}constructor(t){super(t.background||e.Texture.EMPTY);let n,r=this;r._game=t.game,r.conf=t.conf,r.type=TYPE$3,r.name=t.name,r.objName=t.objName,r.isInScene=t.isInScene;let a,s,i,o,l,c,u,p={},d={};for(p.rect=d,p.event={},r.custom=p,d.pos=new e.Point(0,0),d.anchor=new e.Point(0,0),d.width=t.width||64,d.height=t.height||16,t.rect&&(t.rect.pos&&(d.x=t.rect.pos.x,d.y=t.rect.pos.y),t.rect.anchor&&(d.anchor.x=t.rect.anchor.x,d.anchor.y=t.rect.anchor.y),d.width=t.rect.width||d.width,d.height=t.rect.height||d.height),p.textureName=t.textureName||"",p.numCounts=t.numCounts||4,p.charMap=t.charMap||NUM.CHAR_MAP,p.shift=1,"number"==typeof t.shift&&(p.shift=t.shift),p.enable=!1,p.display=t.display||NUM.DISPLAY.TRANSVERSE,p.alignType=t.alignType||NUM.ALIGN_TYPE.RECT,p.offsetType=t.offsetType||NUM.OFFSET_TYPE.STATIC,p.horiType=t.horiType||NUM.HORI_ALIGN.LEFT,p.vertiType=t.vertiType||NUM.VERTI_ALIGN.TOP,p.alpha=1,p.anchor={x:0,y:0},t.anchor&&(p.anchor.x=t.anchor.x,p.anchor.y=t.anchor.y),p.lastCnt=0,p.value=0,p.currentValue=0,p.targetValue=0,p.offsetValue=0,p.background=t.background||e.Texture.EMPTY,p.autoHide=t.autoHide,p.useComma=t.useComma,p.useMoney=t.useMoney,p.useDash=t.useDash,"number"==typeof t.fixVal?p.fixVal=t.fixVal:p.fixVal=0,t.pos&&(r.x=t.pos.x,r.y=t.pos.y),t.pivot&&(r.pivot.x=t.pivot.x,r.pivot.y=t.pivot.y),p.numTe={},p.numSprite=[],u=p.charMap.length,a=0;a<u;a+=1)c=p.charMap[a],s=p.textureName+c,p.numTe[c]=e.utils.TextureCache[s]||e.Texture.EMPTY;for(i=p.numTe[p.charMap[0]],o=i.frame,p.offset=t.offset||o.width,p.symbolOffset=-1,"number"==typeof t.symbolOffset&&(p.symbolOffset=t.symbolOffset),u=p.numCounts,a=0;a<u;a+=1)n=new e.Texture(i.baseTexture,o.clone()),l=new e.Sprite(n),l.anchor.x=p.anchor.x,l.anchor.y=p.anchor.y,p.numSprite[a]=l;r._eventUpdate=r._animChange}clone(e){super.clone();let t=this.custom,n={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,pivot:this.pivot,anchor:t.anchor,rect:t.rect,display:t.display,alignType:t.alignType,offsetType:t.offsetType,horiType:t.horiType,vertiType:t.vertiType,textureName:t.textureName,numCounts:t.numCounts,charMap:t.charMap,offset:t.offset,symbolOffset:t.symbolOffset,shift:t.shift,background:t.background,autoHide:t.autoHide,fixVal:t.fixVal,useComma:t.useComma,useDash:t.useDash,useMoney:t.useMoney};return new Digit(n)}removeFromScene(){super.removeFromScene(),this._game.removeUpdate(this)}transverse(){this.setDisplay(NUM.DISPLAY.TRANSVERSE)}straight(){this.setDisplay(NUM.DISPLAY.TRANSVERSE)}setDisplay(e){if(e===NUM.DISPLAY.TRANSVERSE)this.display=e;else{if(e!==NUM.DISPLAY.STRAIGHT)return;this.display=e}this.setAlign(this.horiType,this.vertiType)}setBackground(e){this.texture=e}setAnchor(e){if(!e)return;let t,n=this.custom,r=n.anchor,a=n.numSprite.length;for(r.x=e.x,r.y=e.y,t=0;t<a;t+=1)r=n.numSprite[t].anchor,r.x=e.x,r.y=e.y}setAlign(e,t){let n=this.custom;n.alignType=NUM.ALIGN_TYPE.RECT;let r,a,s=n.rect.pos,i={x:s.x,y:s.y},o=n.anchor,l=n.rect.width,c=n.rect.height,u=n.offset,p={w:0,h:0},d=this.children,m=d.length;if(n.lastCnt===m&&n.horiType===e&&n.vertiType===t)return;switch(n.lastCnt=m,n.horiType=e,n.vertiType=t,d.forEach((e=>{let t=e.texture.frame;"."===e.ch||","===e.ch?(p.w-=u,p.h-=u,a&&(p.w+=a.width,p.h+=a.height),p.w+=t.width,p.h+=t.height,p.w+=2*n.symbolOffset):(p.w+=u,p.h+=u),a=t})),n.horiType){case NUM.HORI_ALIGN.LEFT:n.display,NUM.DISPLAY.TRANSVERSE,i.x=s.x;break;case NUM.HORI_ALIGN.CENTER:n.display===NUM.DISPLAY.TRANSVERSE?i.x=s.x+.5*l-.5*p.w:i.x=s.x+.5*l;break;case NUM.HORI_ALIGN.RIGHT:n.display===NUM.DISPLAY.TRANSVERSE?i.x=s.x+l-p.w:i.x=s.x+l}switch(n.vertiType){case NUM.VERTI_ALIGN.TOP:i.y=s.y;break;case NUM.VERTI_ALIGN.CENTER:n.display===NUM.DISPLAY.TRANSVERSE?i.y=s.y+.5*c:i.y=s.y+.5*c-.5*p.h;break;case NUM.VERTI_ALIGN.BOTTOM:n.display===NUM.DISPLAY.TRANSVERSE?i.y=s.y+c:i.y=s.y+c-p.h}let h=0,g={width:0,height:0};for(r=m-1;r>=0;r-=1){let e=d[r],t=e.position,s=e.texture.frame;n.display===NUM.DISPLAY.TRANSVERSE?(t.x=h+i.x,t.y=i.y):(t.y=h+i.y,t.x=i.x),"."===e.ch||","===e.ch?n.display===NUM.DISPLAY.TRANSVERSE?(h-=u,h+=g.width,t.x=h+i.x-g.width*o.x+s.width*o.x,h+=s.width+2*n.symbolOffset,t.x+=n.symbolOffset):h+=s.height:h+=u,a=s,g=s}}setAlpha(e){this.children.forEach((t=>{t.alpha=e})),this.custom.alpha=e}set shift(e){this.custom.shift=e}get shift(){return this.custom.shift}set fixVal(e){this.custom.fixVal=e}get fixVal(){return this.custom.fixVal}getValue(){return this.custom.value}setValue(e,t){let n=this,r=n.custom,a=r.event;if(r.currentValue=r.value,r.value=e||0,r.targetValue=e||0,r.currentValue<r.targetValue?r.offsetValue=r.shift:r.currentValue>r.targetValue&&(r.offsetValue=-r.shift),a.begin&&a.begin(n),t)return void n.enable();r.currentValue=r.value;let s,i,o=n,l=n.fixValueString(r.currentValue),c=l.length,u=r.alpha,p=r.numSprite.length-1,d=r.numTe[0].frame;for(;p>=0;){c-=1;let e=r.numSprite[p];c>=0?(i=l[c],s=r.numTe[i],e.ch=i,e.alpha=u,s&&e.texture.width>1&&e.texture.height>1&&(e.texture.frame=s.frame.clone()),o.addChild(e)):(e.ch="0",r.autoHide?o.removeChild(e):(e.texture.width>1&&e.texture.height>1&&(e.texture.frame=d.clone()),e.alpha=u,o.addChild(e))),p-=1}n.setAlign(r.horiType,r.vertiType)}setEvent(e){let t=this.custom.event;t.begin=e.begin||t.begin,t.end=e.end||t.end,t.changeString=e.changeString||t.changeString}_animChange(e){let t=this,n=t.custom,r=n.event,a=n.offsetValue*e*1e3;a<0?n.currentValue<=n.targetValue?(n.currentValue=n.targetValue,t.disable(),r.end&&r.end(t)):n.currentValue=n.currentValue+a:n.currentValue>=n.targetValue?(n.currentValue=n.targetValue,t.disable(),r.end&&r.end(t)):n.currentValue=n.currentValue+a;let s,i,o=t,l=t.fixValueString(n.currentValue),c=n.alpha,u=l.length,p=n.numSprite.length-1,d=n.numTe[0].frame;for(;p>=0;){u-=1;let e=n.numSprite[p];u>=0?(s=l[u],i=n.numTe[s],e.ch=s,e.alpha=c,i&&e.texture.width>1&&e.texture.height>1&&(e.texture.frame=i.frame.clone()),o.addChild(e)):(e.ch="0",n.autoHide?o.removeChild(e):(e.texture.width>1&&e.texture.height>1&&(e.texture.frame=d.clone()),e.alpha=c,o.addChild(e))),p-=1}t.setAlign(n.horiType,n.vertiType)}fixValueString(e){let t=this.custom,n=t.event,r=e.toString(),a=r.lastIndexOf(".");a<0&&t.fixVal>0?(r+=".",a=r.length):a>=0&&0===t.fixVal&&(a=r.lastIndexOf("."),r=r.substr(0,a),a=r.length);for(let e=a+1;e<=a+t.fixVal;e+=1)e>=r.length&&(r=r.concat("0"));let s=r;t.fixVal>0&&r.length>a+t.fixVal&&(s=r.substr(0,a+t.fixVal+1));let i,o,l,c,u=null,p=s.length,d=Math.floor(e);return t.fixVal>0&&(c=s.substr(p-(t.fixVal+1),t.fixVal+1),s=d.toString(),p=s.length),t.useComma?p>6?(i=s.substr(0,p-6),o=s.substr(p-6,3),l=s.substr(p-3,3),u=i+","+o+","+l):p>3?(i=s.substr(0,p-3),o=s.substr(p-3,3),u=i+","+o):u=s:u=s,t.useMoney&&(u="$"+u),t.useDash&&0===t.fixVal&&(u+="_"),t.fixVal>0&&(u+=c),n.changeString&&(u=n.changeString(u)),u}setTexture(e){this.setTextures(e)}setTextures(t){let n=this,r=n.custom;if(r.textureName!==t){let n,a,s,i,o;for(r.textureName=t,n=0,o=r.charMap.length;n<o;n++)i=r.charMap[n],a=r.textureName+i,r.numTe[i]=e.utils.TextureCache[a]||e.Texture.EMPTY;for(s=r.numTe[r.charMap[0]],n=0,o=r.numCounts;n<o;n++){let t=r.numSprite[n];t.texture=new e.Texture(s.baseTexture,s.frame.clone()),t.anchor.x=r.anchor.x,t.anchor.y=r.anchor.y}}r.lastCnt=0,n.setValue(n.custom.currentValue,!1)}enable(){let e=this,t=e.custom;t.enable||(t.enable=!0,e._game.addUpdate(e))}disable(){let e=this,t=e.custom;t.enable&&(t.enable=!1,e._game.removeUpdate(e))}stop(){this.disable()}update(e){this._eventUpdate&&this._eventUpdate(e)}reload(){let t=this,n=t._game.textures,r=t.conf.resource;if(t.custom.textureName="",this.setTextures(r.texture),r.group){let a=getTextureGroup$1(n,r.group);a&&(t.texture=a[r.background]||e.Texture.EMPTY)}}}}const TYPE$2="scrollbar";let Scrollbar=null;function init$9(){let e=app.PIXI;Scrollbar=class extends(make(e.Sprite)){static get TYPE(){return TYPE$2}constructor(t){super(t.background||e.Texture.EMPTY);let n=this;n._game=t.game,n.conf=t.conf,n.type=TYPE$2,n.name=t.name,n.objName=t.objName,n.isInScene=t.isInScene,n.value={current:1,offset:1,min:1,max:10,range:9},n.value.range=n.value.max-n.value.min,n.eventScroll=null,n.slider=new e.Sprite(t.slider),n.slider.anchor.x=.5,n.addChild(n.slider),t.pos&&(n.x=t.pos.x||0,n.y=t.pos.y||0),t.anchor&&(n.anchor.x=t.anchor.x||0,n.anchor.y=t.anchor.y||0),n.limit={offset:0,min:.5*n.conf.slider.width,max:n.conf.width-.5*n.conf.slider.width},n.limit.length=n.limit.max-n.limit.min,n.slider.x=n.limit.min,n.slider.value=0,n.limit.offset=n.limit.length/n.value.range,n.hasMove=!1,n.buttonMode=!0,n.interactive=!0,n.obj=null,n.touchstart=n.mousedown=e=>{let t=parseInt(e.data.global.x);parseInt(e.data.global.y);n.hasMove=!0,n.slider.x=t-n.x,n.slider.x<n.limit.min?n.slider.x=n.limit.min:n.slider.x>=n.limit.max&&(n.slider.x=n.limit.max),n.slider.value=n.slider.x-n.limit.min,n.value.current=n.value.min+n.value.offset*parseInt(n.slider.value/n.limit.offset),n.eventScroll&&n.eventScroll(n.value.current,n)},n.touchend=n.mouseup=e=>{parseInt(e.data.global.x),parseInt(e.data.global.y);n.hasMove=!1},n.slider.buttonMode=!0,n.slider.interactive=!0,n.slider.mousedown=n.slider.touchstart=()=>{n.hasMove=!0},n.slider.mouseup=n.slider.mouseupoutside=n.slider.touchend=n.slider.touchendoutside=()=>{n.hasMove=!1},n.slider.mousemove=n.slider.touchmove=e=>{if(0===e.which&&(n.hasMove=!1),n.hasMove){let t={x:parseInt(e.data.global.x),y:parseInt(e.data.global.y)};n.slider.x=t.x-n.x,n.slider.x<n.limit.min?n.slider.x=n.limit.min:n.slider.x>=n.limit.max&&(n.slider.x=n.limit.max),n.slider.value=n.slider.x-n.limit.min,n.value.current=n.value.min+n.value.offset*parseInt(n.slider.value/n.limit.offset),n.eventScroll&&n.eventScroll(n.value.current,n)}}}clone(){return null}setBindScrollEvent(e){this.eventScroll=e}reset(){this.hasMove=!1}setRange(e){"number"==typeof e.current&&(this.value.current=e.current),"number"==typeof e.offset&&(this.value.offset=e.offset),"number"==typeof e.min&&(this.value.min=e.min),"number"==typeof e.max&&(this.value.max=e.max),"number"==typeof e.range&&(this.value.range=e.range),this.value.current<this.value.min?this.value.current=this.value.min:this.value.current>this.value.max&&(this.value.current=this.value.max),this.value.offset=(this.value.max-this.value.min)/this.value.range,this.limit.offset=this.limit.length/this.value.range,this.slider.value=this.limit.offset*(this.value.current-this.value.min),this.slider.x=this.limit.min+this.slider.value,this.eventScroll&&this.eventScroll(this.value.current,this)}setValue(e){e>=this.value.min&&e<=this.value.max&&(this.value.current=e,this.slider.value=this.limit.offset*((this.value.current-this.value.min)/this.value.range),this.slider.x=this.limit.min+this.slider.value,this.eventScroll&&this.eventScroll(this.value.current,this))}getValue(){return this.value.current}}}const TYPE$1="text";let Text=null;function init$8(){let e=app.PIXI;Text=class extends(make(e.Text)){static get TYPE(){return TYPE$1}constructor(e){super(e.text||"test used");let t=this;t._game=e.game,t.conf=e.conf,t.type=TYPE$1,t.name=e.name,t.objName=e.objName,t.isInScene=e.isInScene;let n={fill:"#FFFFFF",stroke:"#000000",strokeThickness:0};e.style&&(n.fill=e.style.fill||"#FFFFFF",n.stroke=e.style.stroke||"#000000",n.strokeThickness=e.style.strokeThickness||0),t.style=n,e.pos&&(t.x=e.pos.x,t.y=e.pos.y),e.anchor&&(t.anchor.x=e.anchor.x||0,t.anchor.y=e.anchor.y||0)}clone(e){super.clone();let t={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+this.cloneIndex,pos:this.position,anchor:this.anchor,style:this.style,text:this.text};return new Text(t)}reload(){}}}const TYPE="particle";let configMap={demo:{alpha:{start:1,end:0},scale:{start:.1,end:1.5},color:{start:"ffffff",end:"ffffff"},speed:{start:600,end:200},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:20},lifetime:{min:.5,max:.7},blendMode:"normal",frequency:16e-6,emitterLifetime:-1,maxParticles:100,pos:{x:0,y:0},addAtBack:!1,spawnType:"point"}},Particle=null;function init$7(){let e=app.PIXI,t=null;e.ParticleContainer?t=e.ParticleContainer:e.particles&&e.particles.ParticleContainer&&(t=e.particles.ParticleContainer),t&&(Particle=class extends(make(t)){static get TYPE(){return TYPE}static setConfigMap(e){configMap=e||configMap}static getConfig(e){return configMap[e]}constructor(t){super();let n,r=this,a={};r.custom=a,r._game=t.game,r.conf=t.conf,r.type=TYPE,r.name=t.name,r.objName=t.objName,r.isInScene=t.isInScene;let s=t.setting;a.type=s.type,a.config=s.config,a.art=s.art,a.ownerPos=new e.Point(0,0),r.setProperties({scale:!0,position:!0,rotation:!0,uvs:!0,alpha:!0}),e.particles&&e.particles.Emitter&&(n=new e.particles.Emitter(r,a.art,a.config)),n&&("path"===a.type?n.particleConstructor=e.particles.PathParticle:"anim"===a.type&&(n.particleConstructor=e.particles.AnimatedParticle)),t.pos&&(r.x=t.pos.x,r.y=t.pos.y),r.emitter=n}clone(e){super.clone();let t=this.cloneIndex,n=this.custom,r={game:e||this._game,conf:this.conf,isInScene:this.isInScene,name:this.name+".clone."+t,pos:this.position,setting:{type:n.type,config:n.config,art:n.art}};return new Particle(r)}removeFromScene(){super.removeFromScene(),this._game.removeUpdate(this)}play(e,t=0){let n=this,r=n.emitter,a=e||n.custom.ownerPos;r&&(r.emit=!0,r.resetPositionTracking(),r.updateOwnerPos(a.x,a.y),r.update(t),n._game.addUpdate(n))}stop(){this._game.removeUpdate(this)}update(e){this.emitter.update(e)}reload(){}})}function filenameInfo(e){let t,n,r,a,s=e.lastIndexOf("/");return s>0&&(s+=1,t=e.slice(0,s),n=e.slice(s)),s=n.lastIndexOf("."),s>0&&(a=n.slice(0,s),s+=1,r=n.slice(s)),{dir:t,base:n,name:a,ext:r}}function handleData(e,t,n){let r=null;r=n||(e=>e);let a,s=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},i=(e,t,n)=>{let r;Object.getOwnPropertyNames(e).forEach((a=>{let o=e[a];"string"==typeof o?t[a]=n(o):Array.isArray(o)?(r=[],s(o,r,n),t[a]=r):"object"==typeof o&&(r={},i(o,r,n),t[a]=r)}))};a=Object.getOwnPropertyNames(e),a.forEach((n=>{let a,o=t[n];a=e[n],Array.isArray(a)?o?s(a,o,r):(o=[],s(a,o,r),t[n]=o):"object"==typeof a?o?i(a,o,r):(o={},i(a,o,r),t[n]=o):"string"==typeof a&&(t[n]=r(a))}))}var utils=Object.freeze({__proto__:null,filenameInfo:filenameInfo,handleData:handleData});let dragon=null,PIXI$1=null;const ID_CREATE_SOUND="sound",ID_CREATE_TEXTURE="texture",ID_CREATE_OBJECT="object",ID_CREATE_ASSET="asset",ID_CREATE_SPINE="spine",ID_CREATE_BONES="bones",OBJ_TYPE={INFO:"info",GROUP:"group",SCROLLBAR:"scrollbar",BACKGROUND:"background",PARTICLE:"particle",TEXT:"text",IMAGE:"image",SPINE:"spine",BONE:"bone",ANMIMATION:"animation",NUMBER:"number",BUTTON:"button"};let property={event:{resBegin:null,resEnd:null,sceneResBegin:null,SceneResLoading:null,SceneResEnd:null},state:null,game:null,baseURL:"",base:0,baseProgress:0,baseIndex:0,baseMax:0,objectFactory:{},isBusy:!1,textures:null,spines:null,sounds:null,bonesFactory:null,soundMapList:[]},getTextureGroup=getTextureGroup$1,getSpineDataGroup=e=>{let t=property.spines,n=e&&e.split(".");return t&&n&&n.every((e=>{let n=t[e];return!!n&&(t=n,!0)})),t},createInfo=e=>{let t={};return t.conf=e,t.name=e.name,t.objName=e.objName,t};function createDebugTxeture(e,t,n="#000000"){return PIXI$1.Texture.Draw((e=>{t?(e.width=t.width||140,e.height=t.height||40):(e.width=100,e.height=24);let r=e.getContext("2d");r.strokeStyle=n,r.strokeRect(0,0,e.width,e.height),r.fillStyle="#FFFFFF",r.fillRect(0,0,2,2),r.fillRect(e.width-2,0,2,2),r.fillRect(0,e.height-2,2,2),r.fillRect(e.width-2,e.height-2,2,2),r.beginPath(),r.lineCap="round",r.moveTo(0,0),r.lineTo(e.width,e.height),r.moveTo(e.width,0),r.lineTo(0,e.height),r.stroke(),r.fillStyle="#FFFFFF";let a=e.width/2,s=e.height/2;r.fillRect(a,s,2,2)}))}let createParticle=(e,t)=>{let n=null,r=e.resource.group,a=e.resource.name,s=e.pos||{x:0,y:0},i=getTextureGroup(property.textures,r),o=i&&i[a],l=Particle.getConfig(e.config.name);if(o&&l){if(e.debug){let t=createDebugTxeture(e.name,e);Array.isArray(o)||(o=[o]),o.push(t)}n=new Particle({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,setting:{type:e.type,config:l,art:o,useParticleContainer:e.useParticleContainer},pos:s})}return n},createSpine=(e,t)=>{let n=null,r=e.pos||{x:0,y:0},a=getSpineDataGroup(e.resource.spineData),s=getTextureGroup(property.textures,e.resource.texture);return a&&(n=new Spine({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,spineDataGroup:a,textureGroup:s,pos:r})),n},createBone=(e,t)=>{let n,r=e.pos||{x:0,y:0},a={},s={timeScale:1};return e.resource&&"string"==typeof e.resource.name&&(a.name=e.resource.name),e.animation&&(s.name=e.animation.name,s.timeScale=e.animation.timeScale),n=new Bone({game:t,conf:e,name:e.name,objName:e.objName,resource:a,animation:s,isInScene:e.isInScene,pos:r}),n},createGroup=(e,t)=>{let n,r=e.pos||{x:0,y:0},a=property.objectFactory;return n=new Group({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pivot:e.pivot,pos:r}),e.childList&&e.childList.forEach((e=>{let r,s=a[e.type];s&&(r=s(e,t),r&&(e.isInScene&&r&&n.addChild(r),n.childList.push(r)))})),n},createText=(e,t)=>{let n,r=e.pos||{x:0,y:0},a=e.anchor||{x:0,y:0};return n=new Text({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:r,anchor:a,text:e.text||"文字訊息"}),n},createScrollbar=(e,t)=>{let n,r=e.resource,a=r.group,s=getTextureGroup(property.textures,a),i=PIXI$1.Texture.EMPTY,o=PIXI$1.Texture.EMPTY;return e.debug?o=createDebugTxeture(e.name,e):s&&(i=s[r.slider]||i,o=s[r.background]||o),n=new Scrollbar({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:e.pos,anchor:e.anchor,slider:i,background:o}),n},createBackground=(e,t)=>{let n,r=e.resource.group,a=e.resource.name,s=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=getTextureGroup(property.textures,r);"number"==typeof a&&a<0&&(a=0);let l=o&&o[a]||PIXI$1.Texture.EMPTY;return e.debug&&(l=createDebugTxeture(e.name,e)),n=new Image({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:s,anchor:i,texture:l}),n},createImage=(e,t)=>{let n,r=e.resource.group,a=e.resource.name,s=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=getTextureGroup(property.textures,r),l=e.blend;"number"==typeof a&&a<0&&(a=0);let c=o&&o[a]||PIXI$1.Texture.EMPTY;return"number"==typeof l?l<0&&(l=0):l=0,e.debug&&(c=createDebugTxeture(e.name,e)),n=new Image({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:s,anchor:i,alpha:e.alpha||1,texture:c}),n.blendMode=l,n},createAnimation=(e,t)=>{let n,r=e.resource.group,a=e.resource.name,s=e.pos||{x:0,y:0},i=e.anchor||{x:0,y:0},o=e.speed||.33,l=e.loop,c=getTextureGroup(property.textures,r),u=c&&c[a]||[PIXI$1.Texture.EMPTY];return e.debug&&(u=[createDebugTxeture(e.name,e)]),n=new Animation({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,speed:o,loop:l,pos:s,anchor:i,textures:u}),n},createNumber=(e,t)=>{let n,r=e.resource,a=e.resource.texture,s=getTextureGroup(property.textures,r.group),i=e.numCounts||4,o=e.offset,l=e.symbolOffset,c=e.charMap,u=e.autoHide,p={pos:{x:0,y:0},width:e.width,height:e.height},d=s&&s[e.resource.background]||PIXI$1.Texture.EMPTY;return e.debug&&(d=createDebugTxeture(e.name,e)),n=new Digit({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,autoHide:u,fixVal:e.fixVal,useComma:e.useComma,useDash:e.useDash,useMoney:e.useMoney,pos:e.pos,anchor:e.anchor,pivot:e.pivot,rect:p,textureName:a,background:d,numCounts:i,charMap:c,symbolOffset:l,offset:o}),n},createButton=(e,t)=>{let n,r,a=e.resource,s=a.group,i=a.name,o=getTextureGroup(property.textures,s),l={enter:PIXI$1.Texture.EMPTY,press:PIXI$1.Texture.EMPTY,leave:PIXI$1.Texture.EMPTY,disable:PIXI$1.Texture.EMPTY};return e.debug?(l.enter=createDebugTxeture(e.name,e),l.press=l.enter,l.leave=l.enter,l.disable=l.enter):(n=o&&o[i],n&&(l.enter=n[a.enter]||l.enter,l.press=n[a.press]||l.press,l.leave=n[a.leave]||l.leave,l.disable=n[a.disable]||l.disable)),r=new Button({game:t,conf:e,name:e.name,objName:e.objName,isInScene:e.isInScene,pos:e.pos,anchor:e.anchor,texture:l}),r};function init$6(e){property.objectFactory[OBJ_TYPE.INFO]=createInfo,property.objectFactory[OBJ_TYPE.GROUP]=createGroup,property.objectFactory[OBJ_TYPE.SCROLLBAR]=createScrollbar,property.objectFactory[OBJ_TYPE.BACKGROUND]=createBackground,property.objectFactory[OBJ_TYPE.TEXT]=createText,property.objectFactory[OBJ_TYPE.IMAGE]=createImage,property.objectFactory[OBJ_TYPE.ANMIMATION]=createAnimation,property.objectFactory[OBJ_TYPE.NUMBER]=createNumber,property.objectFactory[OBJ_TYPE.BUTTON]=createButton,property.objectFactory[OBJ_TYPE.SPINE]=createSpine,property.objectFactory[OBJ_TYPE.PARTICLE]=createParticle,dragon=e.dragon,PIXI$1=app.PIXI,dragon&&(property.objectFactory[OBJ_TYPE.BONE]=createBone)}function registerFactory(e){property.objectFactory[e.type]=e.create}function loadSceneEx(e){let t,n,r=property.event;if(property.isBusy)return!1;property.isBusy=!0,property.game=e.game;let a=e.objData,s=e.proc,i=e.callback,o=e.finish,l=0,c=e=>{let s=i[l];s&&s(e),r.resEnd&&r.resEnd(l),l+=1,l<a.length?(r.resBegin&&r.resBegin(l),n(l)):t()};if(t=()=>{property.isBusy=!1,o&&o()},n=e=>{let t,n;t=s[e],n=a[e],property.baseIndex=e,property.baseProgress=property.baseIndex/property.baseMax*100,t&&n&&t(n,c)},!Array.isArray(a))return!1;if(!Array.isArray(s))return!1;if(!Array.isArray(i))return!1;if(a.length!==s.length)return!1;return property.baseIndex=0,property.baseProgress=0,property.baseMax=a.length,property.base=1/property.baseMax,l=0,n(l),!0}function setEvent(e){let t=property.event;e?(t.resBegin=e.resBegin||t.resBegin,t.resEnd=e.resEnd||t.resEnd,t.sceneResBegin=e.sceneResBegin||t.sceneResBegin,t.sceneResLoading=e.sceneResLoading||t.sceneResLoading,t.sceneResEnd=e.sceneResEnd||t.sceneResEnd):(t.resBegin=null,t.resEnd=null,t.sceneResBegin=null,t.sceneResLoading=null,t.sceneResEnd=null)}function setState$1(e){property.state=e}function createRawData(e,t){"object"==typeof e.particle&&Particle.setConfigMap(e.particle),t(e)}function createSpineData(e,t){let n=property.event,r=0,a={},s=t,i=e=>{let t=e.progress;t>100&&(t=100);let r={currentProgress:t,totalProgress:property.baseProgress+t*property.base,state:property.state};n.sceneResLoading&&n.sceneResLoading(r)},o=t=>{let r={};if(!t||!t.resources)return void s(r);let a=t.resources,i=e=>{let t=null;return a[e]&&a[e].spineData&&(t=a[e].spineData),t},o=(e,t,n)=>{let r;Object.getOwnPropertyNames(e).forEach((a=>{let s=e[a];"string"==typeof s?t[a]=n(s):Array.isArray(s)?(r=[],((e,t,n)=>{e.forEach((e=>{t.push(n(e))}))})(s,r,n),t[a]=r):"object"==typeof s&&(r={},o(s,r,n),t[a]=r)}))};e&&e.spines&&e.atlas&&e.spineDataMap?o(e.spineDataMap.spines,r,i):e&&e.spines&&o(e.spines,r,i),n.sceneResEnd&&n.sceneResEnd(ID_CREATE_SPINE),property.spines=r,s(r)},l=e=>{a[e]=e},c=(e,t)=>{Object.getOwnPropertyNames(e).forEach((n=>{let r=e[n];"string"==typeof r?t(r):Array.isArray(r)?((e,t)=>{e.forEach((e=>{t(e)}))})(r,t):"object"==typeof r&&c(r,t)}))};(()=>{n.sceneResBegin&&n.sceneResBegin(ID_CREATE_SPINE);let t=function(){function e(e){this.index=0,this.lines=e.split(/\r\n|\r|\n/)}return e.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},e.prototype.readValue=function(){var e=this.readLine(),t=e.indexOf(":");if(-1===t)throw new Error("Invalid line: "+e);return e.substring(t+1).trim()},e.prototype.readTuple=function(e){var t=this.readLine(),n=t.indexOf(":");if(-1===n)throw new Error("Invalid line: "+t);for(var r=0,a=n+1;r<3;r++){var s=t.indexOf(",",a);if(-1===s)break;e[r]=t.substr(a,s-a).trim(),a=s+1}return e[r]=t.substring(a).trim(),r+1},e}();if(e&&e.spines&&e.atlas){let n={},r={},a=e.atlas,s=Object.getOwnPropertyNames(a);s.forEach((e=>{let n=a[e],s=filenameInfo(e);if(!n)return;let i=new t(n);!function(){let e=!0;for(;;){let t=i.readLine();if(null===t)return;if(0!==t.length){if(t.length<=2&&t.indexOf(" ")>=0)e=!0;else if(e){e=!1;let n=s.dir+t;r[n]=1}}else e=!0}}()}));let l=Object.getOwnPropertyNames(r),c=null;c=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let u=new c(property.baseURL,50);u.onProgress.add(i),u.add(l),u.load((t=>{let r=null,i=null,l=null;app.spine&&(r=app.spine.TextureAtlas,i=app.spine.AtlasAttachmentLoader,l=app.spine.SkeletonJson,s.forEach((s=>{let o=a[s],c=filenameInfo(s);if(!o)return;let u=new r(o,((e,n)=>{let r,a=c.dir+e,s=t.resources[a];r=s?s.texture:PIXI$1.Texture.EMPTY,n(r.baseTexture)})),p=new i(u),d=new l(p),m=`${c.dir}${c.name}.json`,h=e.spines[m];if(h){let e=d.readSkeletonData(h);n[m]={spineData:e}}}))),o({resources:n})}))}else if(e&&e.spines){c(e.spines,l);let t=Object.getOwnPropertyNames(a);if(r=t.length,0===r)o();else{let e=null;e=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let n=new e(property.baseURL,50);t.forEach((e=>{n.add(e,e)})),n.onProgress.add(i),n.load(o)}}else o()})()}function createBonesData(e,t){let n=property.event,r={},a=t,s=e=>{let t=e.progress;t>100&&(t=100),t=property.baseProgress+t*property.base,n.sceneResLoading&&n.sceneResLoading({current:t,length:100,state:property.state})},i=t=>{let r=null;if(dragon&&(r=new dragon.dragonBones.PixiFactory),!t)return void a(r);let s=t.resources,i=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))};i(e.bones.data,[],(e=>{let t=s[e].data;return r&&r.parseDragonBonesData(t),t}));i(e.bones.resource,[],(e=>{let t=s[e.atlas]&&s[e.atlas].data;if(t=JSON.parse(t),r){let n=getTextureGroup(property.textures,e.texture.group),a=n&&n[e.texture.name];a&&r.parseTextureAtlasData(t,a)}return t})),n.sceneResEnd&&n.sceneResEnd("bones"),property.bonesFactory=r,Bone.setFactory(r),a(r)},o=e=>{r[e]=e},l=e=>{r[e.atlas]=e.atlas},c=(e,t)=>{e.forEach((e=>{t(e)}))},u=(e,t)=>{Object.getOwnPropertyNames(e).forEach((n=>{let r=e[n];"string"==typeof r?t(r):Array.isArray(r)?c(r,t):"object"==typeof r&&u(r,t)}))};(()=>{if(n.sceneResBegin&&n.sceneResBegin("bones"),e&&e.bones&&e.bones.data){u(e.bones.data,o),c(e.bones.resource,l);let t=Object.getOwnPropertyNames(r);if(0===t.length)i();else{let e=null;e=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let n=new e(property.baseURL,50);t.forEach((e=>{n.add(e,e)})),n.onProgress.add(s),n.load(i)}}else i()})()}function createObject(e,t){let n,r=e.objects,a=property.objectFactory,s=[],i=0,o=0,l=property.event,c=[];l.sceneResBegin&&l.sceneResBegin(ID_CREATE_OBJECT),o=r.length,r.forEach((e=>{let t=a[e.type];t?(n=t(e,property.game),n&&s.push(n)):c.push(e),i+=1;let r=i/o*100,u={currentProgress:r,totalProgress:property.baseProgress+r*property.base,state:property.state};l.sceneResLoading&&l.sceneResLoading(u)})),l.sceneResEnd&&l.sceneResEnd(ID_CREATE_OBJECT),t&&t(s,c)}function createTexture(e,t){let n={},r=!1,a={},s=property.event,i={};property.textures=null;let o=0,l={currentProgress:0,totalProgress:property.baseProgress,state:property.state};s.sceneResLoading&&s.sceneResLoading(l);let c=e=>{let t=e.progress;t>100&&(t=100);let n=0;n=o>0?100*o+property.baseProgress+t*o:property.baseProgress+t*property.base;let r={currentProgress:t,totalProgress:n,state:property.state};s.sceneResLoading&&s.sceneResLoading(r)},u=r=>{let a,i=r.resources,o=e=>i[e].texture,l=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},c=(e,t,n)=>{let r;Object.getOwnPropertyNames(e).forEach((a=>{let s=e[a];"string"==typeof s?t[a]=n(s):Array.isArray(s)?(r=[],l(s,r,n),t[a]=r):"object"==typeof s&&(r={},c(s,r,n),t[a]=r)}))};a=Object.getOwnPropertyNames(e.images),a.forEach((t=>{let r,a=n[t];r=e.images[t],Array.isArray(r)?a?l(r,a,o):(a=[],l(r,a,o),n[t]=a):"object"==typeof r?a?c(r,a,o):(a={},c(r,a,o),n[t]=a):"string"==typeof r&&(n[t]=o(r))})),s.sceneResEnd&&s.sceneResEnd(ID_CREATE_TEXTURE),property.textures=n,t&&t(n)},p=e=>{let t=e.progress;t>100&&(t=100);let n=0;n=o>0?property.baseProgress+t*o:property.baseProgress+t*property.base;let r={currentProgress:t,totalProgress:n,state:property.state};s.sceneResLoading&&s.sceneResLoading(r)},d=null,m=()=>{s.sceneResEnd&&s.sceneResEnd(ID_CREATE_ASSET),d(e)},h=t=>{let n=t.resources,r=t.assetNames,a=e.assets;r.forEach((e=>{let t=a[e],r=n[t.meta.filename].texture;if(r&&t){new PIXI$1.Spritesheet(r.baseTexture,t).parse((()=>{}))}})),s.sceneResEnd&&s.sceneResEnd(ID_CREATE_ASSET),d(e)},g=e=>{a[e]=e},f=(e,t)=>{e.forEach((e=>{t(e)}))},y=(e,t)=>{if(!e)return;Object.getOwnPropertyNames(e).forEach((n=>{let r=e[n];"string"==typeof r?t(r):Array.isArray(r)?f(r,t):"object"==typeof r&&y(r,t)}))},x=e=>PIXI$1.utils.TextureCache[e],b=(e,t,n)=>{e.forEach((e=>{t.push(n(e))}))},T=(e,t,n)=>{Object.getOwnPropertyNames(e).forEach((r=>{let a=e[r],s=[];"string"==typeof a?t[r]=n(a):Array.isArray(a)?(b(a,s,n),t[r]=s):"object"==typeof a&&(t[r]=s,T(a,s,n))}))};if(d=e=>{let i,o,l;if(e.images){i=Object.getOwnPropertyNames(e.images),i.forEach((t=>{let n;n=e.images[t],Array.isArray(n)?f(n,g):"object"==typeof n?y(n,g):"string"==typeof n&&g(n)})),o=Object.getOwnPropertyNames(a),s.sceneResBegin&&s.sceneResBegin(ID_CREATE_TEXTURE);let t=null;t=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let n=new t(property.baseURL,50);o.forEach((e=>{n.add(e,e)})),n.onProgress.add(c),n.load(u)}else r=!0;e.frames&&(l=Object.getOwnPropertyNames(e.frames),l.forEach((t=>{let r,a=n[t];r=e.frames[t],Array.isArray(r)?a?b(r,a,x):(a=[],b(r,a,x),n[t]=a):"object"==typeof r?a?T(r,a,x):(a=[],T(r,a,x),n[t]=a):"string"==typeof r&&(n[t]=x(r))}))),r&&(property.textures=n,t&&t(n))},e&&e.assets){e.images&&(o=.5*property.base);let t=e.assets;if(Array.isArray(t)){s.sceneResBegin&&s.sceneResBegin(ID_CREATE_ASSET);let e=null;e=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let n=new e(property.baseURL,50);t.forEach((e=>{n.add(e)})),n.onProgress.add(p),n.load(m)}else if("object"==typeof t){let e=null;e=PIXI$1.Loader?PIXI$1.Loader:PIXI$1.loaders.Loader;let n=new e(property.baseURL,50),r=Object.getOwnPropertyNames(t);n.assetNames=r,r.forEach((e=>{let r,a,s,i=e.lastIndexOf("/");i>0&&(i+=1,r=e.slice(0,i),a=e.slice(i)),i=a.lastIndexOf("."),i>0&&(i+=1,s=a.slice(i));let o=t[e];a=r+(o.meta&&o.meta.image),o.meta.filename=a,n.add(a)})),n.onProgress.add(p),n.load(h)}}else d(e),i.textures=n;return i}function setTextures(e){property.textures=e}function setSpineData(e){property.spines=e}function setBaseURL(e){property.baseURL=e||""}function getBaseURL(){return property.baseURL}function getTextures(e,t){let n,r=e;return t.split(".").every((function(e){return n=r[e],!!n&&(r=n,!0)})),r}function createSound(e,t){let n,r,a,s=0,i=0,o=property.event,l={},c=property.soundMapList;if(!app.Howl||!e.sounds)return t&&t(null),!1;r=Object.getOwnPropertyNames(e.sounds),o.sceneResBegin&&o.sceneResBegin(ID_CREATE_SOUND);let u=0,p=0;s=0;let d=property.baseURL;return r.forEach((t=>{let r={};a=e.sounds[t],i=a.length,p+=i,a.forEach((e=>{let t=e.config.src;if(Array.isArray(e.config.src)){let t=[];e.config.src.forEach((e=>{t.push(d+e)})),e.config.src=t}n=new Howl(e.config),e.config.src=t,r[e.objName]=n,s+=1,u=s/p*100;let a=property.baseProgress+u*property.base,i={currentProgress:u,totalProgress:a,state:property.state};o.sceneResLoading&&o.sceneResLoading(i)})),a.length>0?l[t]=r:l[t]=null})),o.sceneResEnd&&o.sceneResEnd(ID_CREATE_SOUND),c.push(l),t&&t(l),!0}function destroySound(e){Object.getOwnPropertyNames(e).forEach((t=>{let n=e[t];n&&n.stop?(n.stop(),n.unload()):destroySound(n),delete e[t]}))}function destroyAllSound(){property.soundMapList.forEach((e=>{Object.getOwnPropertyNames(e).forEach((t=>{destroySound(e[t]),delete e[t]}))}))}class Scene{constructor(e){this.game=e,this.isInScene=!1}show(e){let t=this,n=t.game;t.isInScene||(t.isInScene=!0,e||(e=n.layer.main),t.objs&&t.objs.forEach((t=>{t&&(t._game=n,t.isInScene&&(t.addToScene?t.addToScene(e):e.addChild(t)))})))}hide(){let e=this;e.isInScene&&(e.isInScene=!1,e.objs&&e.objs.forEach((e=>{e&&(e.removeFromScene?e.removeFromScene():e.parent&&e.parent.removeChild(e))})))}init(e){let t={};function n(e){e.childList.forEach((t=>{if(t){let r=t.conf;if(r.objName){e[r.objName]=t;t.objName;OBJ_TYPE.GROUP===t.type&&n(t)}}}))}this.entity=t,e.forEach((e=>{let r="";e&&e.objName&&(t[e.objName]=e,r='set entity name"'+e.objName+'"',OBJ_TYPE.GROUP===e.type&&n(e))}))}}function createScene(e,t){let n=new Promise(((n,r)=>{if(property.isBusy)return void r("忙碌中");let a=e.game,s=e.infoList,i=e.loading,o=e.loadingEvent,l=new Scene(a),c={data:{proc:createRawData,callback(e){l.data=e,t&&t.eventRawData&&t.eventRawData(e)}},sound:{proc:createSound,callback(e){l.sounds=e,t&&t.eventSound&&t.eventSound(e)}},texture:{proc:createTexture,callback(e){l.textures=e,t&&t.eventTexture&&t.eventTexture(e)}},spine:{proc:createSpineData,callback(e){l.spines=e,t&&t.eventSpine&&t.eventSpine(e)}},object:{proc:createObject,callback(e){l.objs?e.forEach((e=>{l.objs.push(e)})):l.objs=e,l.init(e),t&&t.eventObject&&t.eventObject(e)}}};o&&o.start&&o.start();let u={game:a,objData:[],proc:[],callback:[],finish:function(){i&&i.setState(!0),t&&t.finish&&t.finish(l),o&&o.finish&&o.finish(l),n(l)}};s&&Array.isArray(s)&&s.forEach((e=>{let t=c[e.eventName];t&&e.obj&&t.proc&&(u.objData.push(e.obj),u.proc.push(t.proc)),u.callback.push(t.callback)})),i?i.go({loadingEvent:o,game:a,layer:a.layer&&a.layer.overlay,load(){loadSceneEx(u)}}):loadSceneEx(u)}));return n}var sceneManager=Object.freeze({__proto__:null,OBJ_TYPE:OBJ_TYPE,createBonesData:createBonesData,createDebugTxeture:createDebugTxeture,createGroup:createGroup,createObject:createObject,createRawData:createRawData,createScene:createScene,createSound:createSound,createSpineData:createSpineData,createTexture:createTexture,destroyAllSound:destroyAllSound,destroySound:destroySound,getBaseURL:getBaseURL,getTextures:getTextures,init:init$6,loadSceneEx:loadSceneEx,registerFactory:registerFactory,setBaseURL:setBaseURL,setEvent:setEvent,setSpineData:setSpineData,setState:setState$1,setTextures:setTextures});let properties$1={isBusy:!1,game:null,loading:null,useLobbyState:!1,state:{currentIndex:0,totals:0}};function go$2(e,t){if(properties$1.isBusy||!properties$1.game||!Array.isArray(e))return!1;let n,r,a=properties$1.game,s=properties$1.loading,i=0,o=e.length,l=t,c=e;return setState$1(properties$1.state),n=()=>{if(!(i<o))return properties$1.isBusy=!1,properties$1.useLobbyState||s&&s.setState(!0),l&&l(),!1;{let e=c[i].scene;if(i+=1,e)return r(e);n()}},r=e=>{properties$1.state.currentIndex=i,properties$1.state.totals=o;let t=!1;return!e.isCreate()&&e.createScene?(t=!0,e.createScene(n)):n(),t},properties$1.isBusy=!0,properties$1.useLobbyState?n():s.go({game:a,layer:a.layer&&a.layer.overlay,load(){n()}}),!0}function setUseLobbyState(e){properties$1.useLobbyState=e,e&&properties$1.game&&properties$1.game.scene?setEvent(properties$1.game.scene.loadingEvent):(properties$1.useLobbyState=!1,setEvent(null))}function setGame(e){properties$1.game=e}function setDisplayLoading(e){properties$1.loading=e}var loadingManager=Object.freeze({__proto__:null,go:go$2,setDisplayLoading:setDisplayLoading,setGame:setGame,setUseLobbyState:setUseLobbyState});let scene$1={init:null,release:null,resource:null,eventResBegin:null,eventResCheck:null,eventResEnd:null,eventStart:null,eventEnter:null,eventLeave:null},currentUpdate=null,eventFinish=null;function refresh(e){currentUpdate&&currentUpdate(e)}class Loading{static resCreate(e){scene$1.resource&&scene$1.resource(e)}static frameStart(e){scene$1.eventStart&&scene$1.eventStart(e),currentUpdate=Loading.frameEnter}static frameFinish(e){scene$1.release&&scene$1.release(e),currentUpdate=null,eventFinish&&(eventFinish(),eventFinish=null)}static frameEnter(e){let t=!0;scene$1.eventEnter&&(t=scene$1.eventEnter(e)),t&&(currentUpdate=Loading.resBegin)}static frameLeave(e){let t=!0;scene$1.eventLeave&&(t=scene$1.eventLeave(e)),t&&(currentUpdate=Loading.frameFinish)}static resBegin(e){scene$1.eventResBegin&&scene$1.eventResBegin(e),Loading.resCreate(),currentUpdate=Loading.resLoading}static resLoading(e){scene$1.eventResCheck?scene$1.eventResCheck(e)&&(currentUpdate=Loading.resEnd):currentUpdate=Loading.resEnd}static resEnd(e){scene$1.eventResEnd&&scene$1.eventResEnd(e),currentUpdate=Loading.frameLeave}}function go$1(e){return currentUpdate||("object"==typeof e&&(scene$1.init=e.init,scene$1.release=e.release,scene$1.resource=e.resource,scene$1.eventResBegin=e.resBegin,scene$1.eventResCheck=e.resCheck,scene$1.eventResEnd=e.resEnd,scene$1.eventStart=e.start,scene$1.eventEnter=e.enter,scene$1.eventLeave=e.leave,eventFinish=e.finish),scene$1.init&&scene$1.init(),currentUpdate=Loading.frameStart),!0}var loading=Object.freeze({__proto__:null,go:go$1,refresh:refresh});let properties={event:null,scene:{anim:null,message:null,percent:null},isInit:!1,strings:null,resList:null,state:!1},sceneEvent=null;function init$5(){}function setState(e){properties.state=e}function setStrings(e){properties.strings=e}function setPosition(e){let t=properties.scene.anim;t&&(t.x=e.x,t.y=e.y),properties.pos?(properties.pos.x=e.x,properties.pos.y=e.y):properties.pos={x:e.x,y:e.y}}function setScene(e){properties.resList=e,properties.isInit=!1}function go(e){if(!app.PIXI)return!1;let t=app.PIXI,n=e.loadingEvent||{},r=e.game,a=properties.strings;sceneEvent={resBegin(e){n.resBegin&&n.resBegin(e)},resEnd(e){n.resEnd&&n.resEnd(e)},sceneResBegin(e){let t=e;a&&a.get&&(t=a.get(e)),n.sceneResBegin&&n.sceneResBegin(e)},sceneResLoading(e){let t=e.state,r=e.totalProgress;if(t){r=(t.currentIndex-1)/t.totals*100+r/t.totals}let a=r.toFixed(0)+"%";n.sceneResLoading&&n.sceneResLoading(e),properties.percent&&(properties.percent.text=a)},sceneResEnd(e){let t=e;a&&a.get&&(t=a.get(e)),n.sceneResEnd&&n.sceneResEnd(e)}},setEvent(sceneEvent);let s={name:"loading",screen:{width:r.screen&&r.screen.width||1024,height:r.screen&&r.screen.height||768},movieClip:null,layer:e.layer||null,load:e.load,init:()=>{if(!properties.isInit){properties.isInit=!0;let e,n=properties.resList,r=[];n.forEach((n=>{e=t.Texture.from(n),r.push(e)}));let a=null;a=t.AnimatedSprite?new t.AnimatedSprite(r):new t.extras.AnimatedSprite(r),a.animationSpeed=.33,a.anchor.x=.5,a.anchor.y=.5,properties.scene.anim=a;let i=new t.Text("message");i.style.fill="#FFFFFF",i.style.stroke="#006600",i.style.strokeThickness=1,i.anchor.x=.5,i.anchor.y=.5,i.x=0,i.y=-44,properties.message=i;let o=new t.Text("init");o.style.fill="#FFFFFF",o.style.stroke="#aa0000",o.style.strokeThickness=1,o.anchor.x=.5,o.anchor.y=.5,o.x=0,o.y=24,properties.percent=o,a.addChild(i),a.addChild(o),properties.pos||(properties.pos={x:s.screen.width/2,y:s.screen.height/2}),properties.anchor=new t.Point(.5,.5)}r.addRefresh(s.name,refresh)},release:()=>{null!==s.layer&&null!==properties.scene.anim&&s.layer.removeChild(properties.scene.anim),r.removeRefresh(s.name)},resource:()=>{s.load&&s.load()},resBegin:()=>{},resCheck:()=>properties.state,resEnd:()=>{},start:()=>{if(null!==s.layer&&null!==properties.scene.anim){properties.percent&&(properties.percent.text="start");let e=properties.scene.anim;e.x=properties.pos.x,e.y=properties.pos.y,e.anchor.x=properties.anchor.x,e.anchor.y=properties.anchor.y,e.alpha=0,e.gotoAndPlay(0),s.layer.addChild(e)}},enter:()=>{let e=!1,t=properties.scene.anim;return null!==t?t.alpha>=1?(t.alpha=1,e=!0):t.alpha+=.05:e=!0,e},leave:()=>{let e=!1,t=properties.scene.anim;return null!==t?(t.alpha<=0&&(t.alpha=0,e=!0),t.alpha-=.05,t.alpha<=0&&(t.alpha=0)):e=!0,e},finish:()=>{}};return properties.event=s,properties.state=!1,go$1(properties.event)}var uiLoading=Object.freeze({__proto__:null,go:go,init:init$5,setPosition:setPosition,setScene:setScene,setState:setState,setStrings:setStrings});let Base$1=class e{constructor(){let t=this,n=null,r={autoUpdate:!0,debug:!1,timeBase:1,currentTime:-1,renderer:null,pause:!0,isInit:!1},a=null,s=[],i=[],o={};t.custom={},t.setEngine=e=>{a=e},t.setElement=e=>{r.element=e},t.getElement=()=>r.element,t.getCanvas=()=>r.canvas,t.update=e=>{r.debug&&n&&n.begin(),r.currentTime<0&&(e=0,r.currentTime=1),e*=r.timeBase,s.forEach((t=>{let n=o[t];n.update?n.update(e):n(e)})),i.forEach((t=>{t.update&&t.update(e)})),r.autoUpdate&&a&&a.render(e),r.debug&&n&&n.end()},r.debug=!1,t.addRefresh=(e,t)=>{o[e]=t,s=Object.getOwnPropertyNames(o)},t.removeRefresh=e=>{Object.prototype.hasOwnProperty.call(o,e)&&(delete o[e],s=Object.getOwnPropertyNames(o))},t.addUpdate=e=>{let t=!1;return e&&e.update&&!Object.prototype.hasOwnProperty.call(e,"__updateIndex")&&(e.__updateIndex=i.length,i[e.__updateIndex]=e,t=!0),t},t.removeUpdate=e=>{let t,n,r=i.length;if("number"==typeof e.__updateIndex){if(t=e.__updateIndex,t>=0&&t<r){let e=r-1;n=i[e],i[t]=n,n.__updateIndex=t,i.splice(e,1)}delete e.__updateIndex}},t.resetUpdate=()=>{i.forEach((e=>{delete e.__updateIndex})),i=[]},t.setTimeout=(e,n)=>{let r={currentTime:0,func:e,update:e=>{r.currentTime.toFixed(2)>=n&&(t.removeUpdate(r),r.func&&r.func(r.currentTime)),r.currentTime+=e}};return t.addUpdate(r),r},t.idle=e=>new Promise((n=>{t.setTimeout((function(){n()}),e)})),t.setInterval=(e,n)=>{let r=0,a={func:e,update:e=>{r+=e,r.toFixed(2)>=n&&(a.func&&a.func(r),r=0)}};return t.addUpdate(a),a},t.clearInterval=e=>{t.removeUpdate(e)},t.isPause=()=>r.pause,t.play=()=>{r.pause&&(r.pause=!1,r.currentTime=-1,add(t))},t.once=()=>{r.pause=!1,r.currentTime=-1,once(t)},t.pause=()=>{r.pause||(r.pause=!0,remove(t))},t.stop=()=>{r.pause=!0,remove(t),t.resetUpdate()},t.add=e=>{r.timeBase<1&&(r.timeBase=1),r.timeBase+=e,r.timeBase>4&&(r.timeBase=4)},t.dec=e=>{r.timeBase>1&&(r.timeBase=1),r.timeBase-=e,r.timeBase<.1&&(r.timeBase=.1)},t.reset=()=>{r.timeBase=1},t.getTimeBase=()=>r.timeBase,t.setTimeBase=e=>{r.timeBase=e,r.timeBase<.1?r.timeBase=.1:r.timeBase>4&&(r.timeBase=4)},t.init=e=>!r.isInit&&(r.isInit=!0,r.element=e.element,r.canvas=e.view,r.currentTime=-1,t.pause(),!0),t.getRenderer=()=>a&&a.renderer,t.setAutoUpdate=e=>{r.autoUpdate=e},Object.defineProperty(t,"layer",{get:()=>a&&a.layer}),Object.defineProperty(t,"debug",{set(a){n||e.Stats&&(n=new e.Stats,t.stats=n),a?n&&r.element&&(n.dom.style.position="absolute",r.element.appendChild(n.dom)):n&&r.element&&n.dom.parentElement&&r.element.removeChild(n.dom),r.debug=a},get:()=>r.debug}),t.stats=null}};function init$4(e){return!Base$1.isInitial&&(e.Stats&&(Base$1.Stats=e.Stats.default||e.Stats),Base$1.isInitial=!0,!0)}Base$1.Stats=null,Base$1.isInitial=!1;var base=Object.freeze({__proto__:null,Base:Base$1,init:init$4});let isInit$1=!1;function init$3(){if(isInit$1)return;isInit$1=!0;let e=app.PIXI;e&&(e.Texture.Draw=t=>{let n=document.createElement("canvas");return"function"==typeof t&&t(n),e.Texture.fromCanvas(n)})}function create(e){if(!app.PIXI)return null;let t,n,r={},a=e,s=app.PIXI;return n=s.Renderer?new s.Renderer(a):new s.WebGLRenderer(a),t=new s.Container,r.stage=t,r.overlay=new s.Container,r.foreground=new s.Container,r.main=new s.Container,r.background=new s.Container,t.addChildAt(r.overlay,0),t.addChildAt(r.foreground,0),t.addChildAt(r.main,0),t.addChildAt(r.background,0),{renderer:n,stage:t,layer:r,render(){n.render(t)}}}let m=null;function init$2(e){m=e.m,init$3()}let canvasStyle={position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},baseStyle={zIndex:10,position:"absolute",left:"0%",top:"0%",width:"100%",height:"100%"},Component={oninit(e){let t=this,n=e.attrs,r=e.attrs.config;t.config=r,t.game=r.game,t.style=n.style||baseStyle,t.ready=n.ready},oncreate(e){let t=this,n=t.config;n.view=e.instance.children[0].dom,n.element=e.dom;let r=t.game;r||(r=new Base$1,t.game=r),r.init(n);let a=create(n);r.setEngine(a),n&&n.ready&&n.ready(r),t.ready&&t.ready(r)},onremove(){let e=this.game;e&&e.stop()},view(){return m(".",{style:this.style},m("canvas",{style:canvasStyle}))}};function init$1(e){init$4(e),init$2(e)}function run(e){let t;if(t=new Base$1,window.parent&&window.parent!==window){let n,r;if(window.Howl=window.parent.Howl,window.Howler=window.parent.Howler,window.parent.scene){let a=e.id,s=e.event||{};n=window.parent.scene[a],Object.defineProperty(t,"scene",{get:()=>n}),n&&n.event&&(r={create(e){window.parent.lobby&&(t.table=window.parent.lobby.table[e.id],t.currentUser=window.parent.lobby.currentUser,t.command=window.parent.lobby.net.gameCommand,t.lobby={setEvent:window.parent.lobby.setEvent,setCommand:window.parent.lobby.net.setLobbyCommand,CMD:window.parent.lobby.net.CMD}),s.create&&(e.game=t,s.create(e))},play(e){t.play(),s.play&&(e.game=t,s.play(e))},pause(e){t.pause(),s.pause&&(e.game=t,s.pause(e))},enter(e){s.enter&&(e.game=t,s.enter(e))},leave(e){s.leave&&(e.game=t,s.leave(e))},focus(){s.focus&&s.focus()},blur(){s.blur&&s.blur()},lock(e){s.lock&&s.lock(e)},fullscreen(e){s.fullscreen&&s.fullscreen(e)},resize(e){s.resize&&s.resize(e)},music(e){s.music&&s.music(e)},sound(e){s.sound&&s.sound(e)}},n.setEvent(r),n.game=t)}}return t}var game=Object.freeze({__proto__:null,init:init$1,run:run});class Base{constructor(e){let t=this,n={name:e,root:null,game:null,center:{entity:{}},initMap:null,currentTime:0,isCreate:!1,isInScene:!1};t.properties=n,Object.defineProperty(t,"center",{get:()=>n.center}),Object.defineProperty(t,"entity",{get:()=>n.center.entity})}getName(){return this.properties.name}getGame(){return this.properties.game}isCreate(){return this.properties.isCreate}isInScene(){return this.properties.isInScene}getCurrentTime(){return this.properties.currentTime}getCenter(){return this.properties.center}getRoot(){return this.properties.root}setRoot(e){let t=this.properties;t.root=e,t.center=e.center}setInitMap(e){this.properties.initMap=e}setLayer(e){this.properties.center.layer=e}getLayer(){return this.properties.center.layer}getRawData(){return this.properties.center.rawdata}getSound(e){let t=this.properties.center.sounds;return t&&"string"==typeof e&&(t=t[e]),t}mute(e,t){let n=this.properties.center.sounds[e];if(n){Object.getOwnPropertyNames(n).forEach((e=>{n[e].mute(t)}))}}getTexture(e){let t=this.properties.center.textures;return t&&"string"==typeof e&&(t=t[e]),t}getObject(){return this.properties.center.objs}getEntity(){return this.properties.center.entity}eventFinish(){let e=this,t=e.properties,n=t.center;n.textures&&setTextures(n.textures),n.spines&&setSpineData(n.spines),t.initMap&&t.initMap(e)}eventRawData(e){}eventSound(e){}eventTexture(e){}eventSpine(e){}eventBones(e){}eventObject(e){}refresh(e){let t=this.getCenter();t&&t.update&&t.update(e)}setGame(e,t){let n=this.properties;n.game=e,e.layer&&t&&Object.prototype.hasOwnProperty.call(e.layer,t)&&(n.center.layer=e.layer[t])}addToScene(e){let t=this,n=t.properties;if(n.isInScene)return!1;n.isInScene=!0;let r=n.center;n.currentTime=-1,n.game=e||n.game,n.game&&n.game.addRefresh(n.name,(function(e){n.currentTime<0?(n.currentTime=0,e=0):t.currentTime+=e,t.refresh(e)}));let a=r.layer;return!r||!r.objs||(r.objs.forEach((e=>{e&&(e._game=n.game||e._game,e.isInScene&&(e.addToScene?e.addToScene(a):a.addChild(e)))})),!0)}removeFromScene(){let e=this.properties;if(!e.isInScene)return!1;e.isInScene=!1,e.game&&e.game.removeRefresh(e.name);let t=e.center;return!t||!t.objs||(t.objs.forEach((e=>{e&&(e.removeFromScene?e.removeFromScene():e.parent&&e.parent.removeChild(e))})),!0)}init(e){let t=this.properties,n=t.center;const r=OBJ_TYPE;if(!n||!n.objs)return;let a=n.entity,s={},i=e=>{e.childList.forEach((n=>{if(n){n._game=t.game||n._game;let a=n.conf;if(a.objName){e[a.objName]=n;n.objName}r.GROUP===n.type&&i(n)}}))};if(n.objs.forEach((e=>{let n="";e&&(e._game=t.game||e._game,e.objName&&(a[e.objName]=e,n='set entity name"'+e.objName+'"'),r.GROUP===e.type&&i(e))})),!e)return;s=e.set||{};s.setupGroup=s.setupGroup||(e=>{e.childList.forEach((e=>{if(e){let t=e.conf;r.GROUP===e.type&&s.setupGroup(e),t&&Object.prototype.hasOwnProperty.call(s,t.init)&&s[t.init](e)}}))}),n.objs.forEach((e=>{let t,n="";e&&(t=e.conf,r.GROUP===e.type&&s.setupGroup(e),t&&Object.prototype.hasOwnProperty.call(s,t.init)&&(n=(e.name||e.objName)+" init : "+t.init,s[t.init](e,t)))}))}createScene(e,t){let n=this,r=n.properties;if(r.isCreate)return e&&e(),!1;let a=t.infoList,s=r.center,i={data:{proc:createRawData,callback:e=>{s&&(s.rawdata=e),n.eventRawData(e)}},sound:{proc:createSound,callback:e=>{s&&(s.sounds=e),n.eventSound(e)}},texture:{proc:createTexture,callback:e=>{s&&(s.textures=e),n.eventTexture(e)}},spine:{proc:createSpineData,callback:e=>{s&&(s.spines=e),n.eventSpine(e)}},bone:{proc:createBonesData,callback:e=>{s&&(s.bonesFactory=e),n.eventBones(e)}},object:{proc:createObject,callback:e=>{s&&(s.objs?e.forEach((e=>{s.objs.push(e)})):s.objs=e),n.eventObject(e)}}};s&&(s.createFinish=e);let o={game:r.game,objData:[],proc:[],callback:[],finish:function(){r.isCreate=!0,s&&s.createFinish&&s.createFinish()}};return a&&Array.isArray(a)&&a.forEach((e=>{let t=i[e.eventName];t&&e.obj&&t.proc&&(o.objData.push(e.obj),o.proc.push(t.proc)),o.callback.push(t.callback)})),loadSceneEx(o),!0}destroyScene(){this.removeFromScene();let e=this.properties,t=e.center;if(!e.isCreate)return!1;if(t&&(t.bonesFactory&&(t.bonesFactory.clear(),t.bonesFactory=null),t.sounds)){destroySound(t.sounds)}return t.objs&&(t.objs.forEach(((e,n)=>{e&&delete t.objs[n]})),t.objs=null),e.isCreate=!1,!0}}let scene={utils:utils,Base:Base,sceneManager:sceneManager,loadingManager:loadingManager,loading:loading,set:e=>{let t=OBJ_TYPE,n=e.game,r=e.scene,a=e.set;a.setupGroup=a.setupGroup||(e=>{e.childList.forEach((e=>{if(e){e._game=n;let r=e.conf;t.GROUP===e.type&&a.setupGroup(e),r&&Object.prototype.hasOwnProperty.call(a,r.init)&&a[r.init](e)}}))}),r.objs.forEach((e=>{let r,s="";e&&(e._game=n,r=e.conf,t.GROUP===e.type&&a.setupGroup(e),r&&Object.prototype.hasOwnProperty.call(a,r.init)&&(s=(e.name||e.objName)+" init : "+r.init,a[r.init](e,r)))}))}},ui={loading:uiLoading,base:base$1},components={game:{pixi:Component}},isInit=!1;function init(e){let t=e||{},n=t.plugin||[];return Array.isArray(n)||(n=[]),app.PIXI=e.PIXI,app.spine=e.spine,app.Ticker=e.Ticker,app.Howl=e.Howl,new Promise((e=>{isInit&&e("!! init finish again !!"),function r(){if(n.length>0){let e=n.shift();window.System?System.import(e).then(r):r()}else t.sceneManager=sceneManager,app.PIXI&&(init$g(),init$f(),init$e(t),init$d(),init$a(),init$9(),init$c(),init$b(),init$8(),init$7(),ui.Animation=Animation,ui.Button=Button,ui.Group=Group,ui.Image=Image,ui.Number=Digit,ui.Scrollbar=Scrollbar,ui.Spine=Spine,ui.Bone=Bone,ui.Text=Text,ui.Particle=Particle,init$6(t)),init$1(t),init$h(),play(),init$i(t),isInit=!0,e("!! init finish !!")}()}))}export{base as GameBase,Lobby,client,components,game,init,scene,ui,updateManager};